/*! For license information please see bundle.js.LICENSE.txt */
(()=>{var __webpack_modules__={5312:(e,t)=>{!function(){"use strict";var e={474:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.RGBA=t.RGB=t.GREY=t.VGA=t.BINARY=void 0,t.BINARY=1,t.VGA=4,t.GREY=8,t.RGB=24,t.RGBA=32},179:function(e,t,i){var n=this&&this.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,i=t&&e[t],n=0;if(i)return i.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(t,"__esModule",{value:!0}),t.make=void 0;var r=i(474),s=i(917),o=i(148);t.make=function(e){var t,i,a=e.bits,l=e.width,u=e.height,c=e.palette,d=e.data,h=a>r.GREY?0:4*((null==c?void 0:c.length)||1<<a),p=4*Math.floor((a*l+31)/32)*Math.abs(u),f=54+h,g=f+p,m=new ArrayBuffer(g),v=new s.SequentialDataView(m);if(v.appendUint16(16973),v.appendUint32(g,!0),v.appendUint16(0,!0),v.appendUint16(0,!0),v.appendUint32(f,!0),v.appendUint32(40,!0),v.appendUint32(l,!0),v.appendUint32(u,!0),v.appendUint16(1,!0),v.appendUint16(a,!0),v.appendUint32(0,!0),v.appendUint32(p,!0),v.appendUint32(0,!0),v.appendUint32(0,!0),v.appendUint32(0,!0),v.appendUint32(0,!0),a<=r.GREY)if(Array.isArray(c)&&c.length>0)try{for(var y=n(c),w=y.next();!w.done;w=y.next()){var b=w.value;v.appendUint32((0,o.rgba2bgra)(b))}}catch(e){t={error:e}}finally{try{w&&!w.done&&(i=y.return)&&i.call(y)}finally{if(t)throw t.error}}else for(var x=255/((1<<a)-1),_=0;_<256;_+=x)v.appendUint32((_<<24)+(_<<16)+(_<<8));for(var k=Math.min(8,a),C=l*Math.ceil(a/8),T=u-1;T>=0;T-=1)for(var S=0,O=0,E=0;E<C;E+=1){var I=T*C+E;if(a>r.GREY)switch(I%(a/8)){case 0:I+=2;break;case 2:I-=2}S<<=k,S+=d[I],32===(O+=k)?(v.appendUint32(S),S=0,O=0):E===C-1&&(S<<=32-O,v.appendUint32(S),S=0,O=0)}return new Uint8Array(m)}},917:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.SequentialDataView=void 0;var i=function(){function e(e){this.view=new DataView(e),this.pos=0}return e.prototype.appendUint16=function(e,t){this.view.setUint16(this.pos,e,t),this.pos+=2},e.prototype.appendUint32=function(e,t){this.view.setUint32(this.pos,e,t),this.pos+=4},e}();t.SequentialDataView=i},235:function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.fromCanvas=void 0;var n=i(474),r=i(179),s=[[0,128,32,160,8,136,40,168],[192,64,224,96,200,72,232,104],[48,176,16,144,56,184,24,152],[240,112,208,80,248,120,216,88],[12,140,44,172,4,132,36,164],[204,76,236,108,196,68,228,100],[60,188,28,156,52,180,20,148],[252,124,220,92,244,116,212,8]];t.fromCanvas=function(e,t){var i=t.getContext("2d").getImageData(0,0,t.width,t.height),o=i.width,a=i.height,l=i.data;if(e===n.GREY||e===n.BINARY){for(var u=new Uint8ClampedArray(o*a),c=0;c<u.length;c+=1){var d=.299*l[4*c+0]+.587*l[4*c+1]+.114*l[4*c+2];if(e===n.GREY)u[c]=d;else{var h=c%o,p=Math.floor(c/o);u[c]=d>s[h%8][p%8]?1:0}}return(0,r.make)({bits:e,width:o,height:a,data:u})}if(e===n.RGBA)return(0,r.make)({bits:e,width:o,height:a,data:l});throw new Error("Support 1 or 8 or 32 bits color only, recieved [".concat(e,"]"))}},148:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.rgba2bgra=void 0,t.rgba2bgra=function(e){var t=e.replace(/^#/,""),i=t.slice(0,2),n=t.slice(2,4);return function(e){var t=e.replace(/^#/,"");return parseInt(t.padEnd(8,"0"),16)}(t.slice(4,6)+n+i+t.slice(6,8).padEnd(2,"F"))}},607:function(e,t,i){var n=this&&this.__createBinding||(Object.create?function(e,t,i,n){void 0===n&&(n=i),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[i]}})}:function(e,t,i,n){void 0===n&&(n=i),e[n]=t[i]}),r=this&&this.__exportStar||function(e,t){for(var i in e)"default"===i||Object.prototype.hasOwnProperty.call(t,i)||n(t,e,i)};Object.defineProperty(t,"__esModule",{value:!0}),t.fromCanvas=t.make=void 0,r(i(474),t);var s=i(179);Object.defineProperty(t,"make",{enumerable:!0,get:function(){return s.make}});var o=i(235);Object.defineProperty(t,"fromCanvas",{enumerable:!0,get:function(){return o.fromCanvas}})}},i={},n=function t(n){var r=i[n];if(void 0!==r)return r.exports;var s=i[n]={exports:{}};return e[n].call(s.exports,s,s.exports,t),s.exports}(607),r=t;for(var s in n)r[s]=n[s];n.__esModule&&Object.defineProperty(r,"__esModule",{value:!0})}()},8283:e=>{e.exports={MenuBar:class{constructor(e,t){this.menuBarElement=e,this.menuItems=t,this.stateOpen=!1,this.stateFocus=!1,this.stateOpening=!1;const i=this;e.classList.add("jdmenu-bar"),e.onmouseleave=function(){i.stateFocus=!1},e.onmouseenter=function(){i.stateFocus=!0},document.addEventListener("click",(function(){i.stateOpen&&!1===i.stateFocus&&i.closeAll(i)})),document.body.addEventListener("keydown",(function(e){"Escape"===e.key&&i.stateOpen&&i.closeAll(i)})),this.parseMenuItems(e,t)}parseMenuItems(e,t){const i=this,n=e===this.menuBarElement;for(let r=0;r<t.length;r++){const s=t[r];if("text"in s==0){"separator"in s&&!0===s.separator&&e.appendChild(document.createElement("hr"));continue}const o=document.createElement("div");if(o.classList.add("jdmenu-item"),o.jdmenu_menu=e,e.appendChild(o),!1===n){const e=document.createElement("span"),t=document.createElement("span"),i=document.createElement("span");o.appendChild(e),o.appendChild(t),o.appendChild(i),"icon"in s&&(e.innerHTML=s.icon),t.innerHTML=s.text,"subMenuItems"in s?(i.classList.add("jdmenu-submenu-symbol"),i.innerText="▶"):"shortcut"in s&&(i.innerHTML=s.shortcut)}else o.innerHTML=s.text;if("enabled"in s&&!1===s.enabled)o.classList.add("jdmenu-item-disabled");else if("subMenuItems"in s){const t=document.createElement("div");t.classList.add("jdmenu-submenu"),t.jdmenu_parentItem=o,t.jdmenu_parentMenu=e,e.appendChild(t),this.parseMenuItems(t,s.subMenuItems,!1),n&&(o.onclick=function(){i.toggleSubMenu(i,t)}),o.onmouseover=function(){i.stateOpen&&i.openSubMenu(i,t)}}else!1===n&&(o.onmouseover=function(){i.openSubMenu(i,e)},"handler"in s&&(o.onclick=function(){i.closeAll(i),s.handler()}))}}toggleSubMenu(e,t){"block"===t.style.display?this.closeSubMenu(e,t):this.openSubMenu(e,t)}closeSubMenu(e,t){if(e.stateOpening)return;const i=t.jdmenu_parentItem;t.style.display="none",i.jdmenu_menu===e.menuBarElement&&(e.stateOpen=!1)}openSubMenu(e,t){this.closeAll(e),e.stateOpen=!0;let i=t;for(;i!==e.menuBarElement;)i.style.display="block",i=i.jdmenu_parentMenu;const n=t.jdmenu_parentItem.getBoundingClientRect();t.jdmenu_parentMenu===e.menuBarElement?(t.style.left=n.left+"px",t.style.top=n.bottom+"px"):(t.style.left=n.right+"px",t.style.top=n.top+"px"),e.stateOpening=!0,setTimeout((function(){e.stateOpening=!1}),100)}closeAll(e){const t=e.menuBarElement.getElementsByClassName("jdmenu-submenu");for(const e of t)e.style.display="none";e.stateOpen=!1}getItemWithId(e){return this.getItemWithIdOf(e,this.menuItems)}getItemWithIdOf(e,t){for(let i=0;i<t.length;i++){const n=t[i];if("id"in n&&n.id===e)return n;if("subMenuItems"in n){const t=this.getItemWithIdOf(e,n.subMenuItems);if(null!=t)return t}}return null}update(){for(;this.menuBarElement.firstChild;)this.menuBarElement.removeChild(this.menuBarElement.firstChild);this.stateOpen=!1,this.stateFocus=!1,this.parseMenuItems(this.menuBarElement,this.menuItems)}}}},1281:(module,__unused_webpack_exports,__webpack_require__)=>{var jQuery=__webpack_require__(9755),w2ui=w2ui||{},w2obj=w2obj||{},w2utils=function(e){var t={},i={version:"1.5",settings:{locale:"en-us",dateFormat:"m/d/yyyy",timeFormat:"hh:mi pm",datetimeFormat:"m/d/yyyy|hh:mi pm",currencyPrefix:"$",currencySuffix:"",currencyPrecision:2,groupSymbol:",",decimalSymbol:".",shortmonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],fullmonths:["January","February","March","April","May","June","July","August","September","October","November","December"],shortdays:["M","T","W","T","F","S","S"],fulldays:["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],weekStarts:"M",dataType:"HTTPJSON",phrases:{},dateStartYear:1950,dateEndYear:2030,macButtonOrder:!1},isBin:function(e){return/^[0-1]+$/.test(e)},isInt:n,isFloat:function(e){return"string"==typeof e&&(e=e.replace(/\s+/g,"").replace(w2utils.settings.groupSymbol,"").replace(w2utils.settings.decimalSymbol,".")),("number"==typeof e||"string"==typeof e&&""!==e)&&!isNaN(Number(e))},isMoney:function(e){var t=w2utils.settings,i=new RegExp("^"+(t.currencyPrefix?"\\"+t.currencyPrefix+"?":"")+"[-+]?"+(t.currencyPrefix?"\\"+t.currencyPrefix+"?":"")+"[0-9]*[\\"+t.decimalSymbol+"]?[0-9]+"+(t.currencySuffix?"\\"+t.currencySuffix+"?":"")+"$","i");return"string"==typeof e&&(e=e.replace(new RegExp(t.groupSymbol,"g"),"")),"object"!=typeof e&&""!==e&&i.test(e)},isHex:function(e){return/^(0x)?[0-9a-fA-F]+$/.test(e)},isAlphaNumeric:function(e){return/^[a-zA-Z0-9_-]+$/.test(e)},isEmail:function(e){return/^[a-zA-Z0-9._%\-+]+@[а-яА-Яa-zA-Z0-9.-]+\.[а-яА-Яa-zA-Z]+$/.test(e)},isIpAddress:function(e){return new RegExp("^((25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?).){3}(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$").test(e)},isDate:function(e,t,i){if(!e)return!1;var r,s,o,a="Invalid Date";if(null==t&&(t=w2utils.settings.dateFormat),"function"==typeof e.getFullYear)o=e.getFullYear(),r=e.getMonth()+1,s=e.getDate();else if(parseInt(e)==e&&parseInt(e)>0)o=(e=new Date(parseInt(e))).getFullYear(),r=e.getMonth()+1,s=e.getDate();else{if(e=String(e),new RegExp("mon","ig").test(t)){t=t.replace(/month/gi,"m").replace(/mon/gi,"m").replace(/dd/gi,"d").replace(/[, ]/gi,"/").replace(/\/\//g,"/").toLowerCase(),e=e.replace(/[, ]/gi,"/").replace(/\/\//g,"/").toLowerCase();for(var l=0,u=w2utils.settings.fullmonths.length;l<u;l++){var c=w2utils.settings.fullmonths[l];e=e.replace(new RegExp(c,"ig"),parseInt(l)+1).replace(new RegExp(c.substr(0,3),"ig"),parseInt(l)+1)}}var d=e.replace(/-/g,"/").replace(/\./g,"/").toLowerCase().split("/"),h=t.replace(/-/g,"/").replace(/\./g,"/").toLowerCase();"mm/dd/yyyy"===h&&(r=d[0],s=d[1],o=d[2]),"m/d/yyyy"===h&&(r=d[0],s=d[1],o=d[2]),"dd/mm/yyyy"===h&&(r=d[1],s=d[0],o=d[2]),"d/m/yyyy"===h&&(r=d[1],s=d[0],o=d[2]),"yyyy/dd/mm"===h&&(r=d[2],s=d[1],o=d[0]),"yyyy/d/m"===h&&(r=d[2],s=d[1],o=d[0]),"yyyy/mm/dd"===h&&(r=d[1],s=d[2],o=d[0]),"yyyy/m/d"===h&&(r=d[1],s=d[2],o=d[0]),"mm/dd/yy"===h&&(r=d[0],s=d[1],o=d[2]),"m/d/yy"===h&&(r=d[0],s=d[1],o=parseInt(d[2])+1900),"dd/mm/yy"===h&&(r=d[1],s=d[0],o=parseInt(d[2])+1900),"d/m/yy"===h&&(r=d[1],s=d[0],o=parseInt(d[2])+1900),"yy/dd/mm"===h&&(r=d[2],s=d[1],o=parseInt(d[0])+1900),"yy/d/m"===h&&(r=d[2],s=d[1],o=parseInt(d[0])+1900),"yy/mm/dd"===h&&(r=d[1],s=d[2],o=parseInt(d[0])+1900),"yy/m/d"===h&&(r=d[1],s=d[2],o=parseInt(d[0])+1900)}return!!n(o)&&(!!n(r)&&(!!n(s)&&(o=+o,r=+r,s=+s,(a=new Date(o,r-1,s)).setFullYear(o),null!=r&&("Invalid Date"!==String(a)&&(a.getMonth()+1===r&&a.getDate()===s&&a.getFullYear()===o&&(!0!==i||a))))))},isTime:function(t,i){if(null==t)return!1;var n,r,s;r=(t=(t=String(t)).toUpperCase()).indexOf("AM")>=0;var o=(s=t.indexOf("PM")>=0)||r;n=o?12:24,t=t.replace("AM","").replace("PM","");var a=(t=e.trim(t)).split(":"),l=parseInt(a[0]||0),u=parseInt(a[1]||0),c=parseInt(a[2]||0);return!!(o&&1===a.length||2===a.length||3===a.length)&&(!(""===a[0]||l<0||l>n||!this.isInt(a[0])||a[0].length>2)&&(!(a.length>1&&(""===a[1]||u<0||u>59||!this.isInt(a[1])||2!==a[1].length))&&(!(a.length>2&&(""===a[2]||c<0||c>59||!this.isInt(a[2])||2!==a[2].length))&&(!!(o||n!==l||0===u&&0===c)&&((!o||1!==a.length||0!==l)&&(!0!==i||(s&&12!==l&&(l+=12),r&&12===l&&(l+=12),{hours:l,minutes:u,seconds:c})))))))},isDateTime:function(e,t,i){if("function"==typeof e.getFullYear)return!0!==i||e;var n=parseInt(e);if(n===e)return!(n<0)&&(!0!==i||new Date(n));var r=String(e).indexOf(" ");if(r<0)return!(String(e).indexOf("T")<0||"Invalid Date"==String(new Date(e)))&&(!0!==i||new Date(e));null==t&&(t=w2utils.settings.datetimeFormat);var s=t.split("|"),o=[e.substr(0,r),e.substr(r).trim()];s[0]=s[0].trim(),s[1]&&(s[1]=s[1].trim());var a=w2utils.isDate(o[0],s[0],!0),l=w2utils.isTime(o[1],!0);return!1!==a&&!1!==l&&(!0!==i||(a.setHours(l.hours),a.setMinutes(l.minutes),a.setSeconds(l.seconds),a))},age:function(e){var t;if(""===e||null==e)return"";if(t="function"==typeof e.getFullYear?e:parseInt(e)==e&&parseInt(e)>0?new Date(parseInt(e)):new Date(e),"Invalid Date"===String(t))return"";var i=((new Date).getTime()-t.getTime())/1e3,n="",r="";return i<0?(n=0,r="sec"):i<60?(n=Math.floor(i),r="sec",i<0&&(n=0,r="sec")):i<3600?(n=Math.floor(i/60),r="min"):i<86400?(n=Math.floor(i/60/60),r="hour"):i<2592e3?(n=Math.floor(i/24/60/60),r="day"):i<31536e3?(n=Math.floor(i/30/24/60/60*10)/10,r="month"):i<126144e3?(n=Math.floor(i/365/24/60/60*10)/10,r="year"):i>=126144e3&&(n=Math.floor(i/365.25/24/60/60*10)/10,r="year"),n+" "+r+(n>1?"s":"")},interval:function(e){return e<1e3?"< 1 sec":e<6e4?Math.floor(e/1e3)+" secs":e<36e5?Math.floor(e/6e4)+" mins":e<864e5?Math.floor(e/36e5*10)/10+" hours":e<2628e6?Math.floor(e/864e5*10)/10+" days":e<31536e6?Math.floor(e/2628e6*10)/10+" months":Math.floor(e/31536e5)/10+" years"},date:function(e){if(""===e||null==e||"object"==typeof e&&!e.getMonth)return"";var t=new Date(e);if(w2utils.isInt(e)&&(t=new Date(Number(e))),"Invalid Date"===String(t))return"";var i=w2utils.settings.shortmonths,n=new Date,r=new Date;r.setTime(r.getTime()-864e5);var s=i[t.getMonth()]+" "+t.getDate()+", "+t.getFullYear(),o=i[n.getMonth()]+" "+n.getDate()+", "+n.getFullYear(),a=i[r.getMonth()]+" "+r.getDate()+", "+r.getFullYear(),l=t.getHours()-(t.getHours()>12?12:0)+":"+(t.getMinutes()<10?"0":"")+t.getMinutes()+" "+(t.getHours()>=12?"pm":"am"),u=t.getHours()-(t.getHours()>12?12:0)+":"+(t.getMinutes()<10?"0":"")+t.getMinutes()+":"+(t.getSeconds()<10?"0":"")+t.getSeconds()+" "+(t.getHours()>=12?"pm":"am"),c=s;return s===o&&(c=l),s===a&&(c=w2utils.lang("Yesterday")),'<span title="'+s+" "+u+'">'+c+"</span>"},formatSize:function(e){if(!w2utils.isFloat(e)||""===e)return"";if(0===(e=parseFloat(e)))return 0;var t=parseInt(Math.floor(Math.log(e)/Math.log(1024)));return(Math.floor(e/Math.pow(1024,t)*10)/10).toFixed(0===t?0:1)+" "+(["Bt","KB","MB","GB","TB","PB","EB","ZB"][t]||"??")},formatNumber:function(e,t,i){if(null==e||""===e||"object"==typeof e)return"";var n={minimumFractionDigits:t,maximumFractionDigits:t,useGrouping:i};return(null==t||t<0)&&(n.minimumFractionDigits=0,n.maximumFractionDigits=20),parseFloat(e)},formatDate:function(e,t){if(t||(t=this.settings.dateFormat),""===e||null==e||"object"==typeof e&&!e.getMonth)return"";var i=new Date(e);if(w2utils.isInt(e)&&(i=new Date(Number(e))),"Invalid Date"===String(i))return"";var n=i.getFullYear(),r=i.getMonth(),s=i.getDate();return t.toLowerCase().replace("month",w2utils.settings.fullmonths[r]).replace("mon",w2utils.settings.shortmonths[r]).replace(/yyyy/g,("000"+n).slice(-4)).replace(/yyy/g,("000"+n).slice(-4)).replace(/yy/g,("0"+n).slice(-2)).replace(/(^|[^a-z$])y/g,"$1"+n).replace(/mm/g,("0"+(r+1)).slice(-2)).replace(/dd/g,("0"+s).slice(-2)).replace(/th/g,1==s?"st":"th").replace(/th/g,2==s?"nd":"th").replace(/th/g,3==s?"rd":"th").replace(/(^|[^a-z$])m/g,"$1"+(r+1)).replace(/(^|[^a-z$])d/g,"$1"+s)},formatTime:function(e,t){if(w2utils.settings.shortmonths,w2utils.settings.fullmonths,t||(t=this.settings.timeFormat),""===e||null==e||"object"==typeof e&&!e.getMonth)return"";var i=new Date(e);if(w2utils.isInt(e)&&(i=new Date(Number(e))),w2utils.isTime(e)){var n=w2utils.isTime(e,!0);(i=new Date).setHours(n.hours),i.setMinutes(n.minutes)}if("Invalid Date"===String(i))return"";var r="am",s=i.getHours(),o=i.getHours(),a=i.getMinutes(),l=i.getSeconds();return a<10&&(a="0"+a),l<10&&(l="0"+l),-1===t.indexOf("am")&&-1===t.indexOf("pm")||(s>=12&&(r="pm"),s>12&&(s-=12),0===s&&(s=12)),t.toLowerCase().replace("am",r).replace("pm",r).replace("hhh",s<10?"0"+s:s).replace("hh24",o<10?"0"+o:o).replace("h24",o).replace("hh",s).replace("mm",a).replace("mi",a).replace("ss",l).replace(/(^|[^a-z$])h/g,"$1"+s).replace(/(^|[^a-z$])m/g,"$1"+a).replace(/(^|[^a-z$])s/g,"$1"+l)},formatDateTime:function(e,t){var i;return""===e||null==e||"object"==typeof e&&!e.getMonth?"":("string"!=typeof t?i=[this.settings.dateFormat,this.settings.timeFormat]:((i=t.split("|"))[0]=i[0].trim(),i[1]=i.length>1?i[1].trim():this.settings.timeFormat),"h12"===i[1]&&(i[1]="h:m pm"),"h24"===i[1]&&(i[1]="h24:m"),this.formatDate(e,i[0])+" "+this.formatTime(e,i[1]))},stripTags:function(t){if(null==t)return t;switch(typeof t){case"number":break;case"string":t=String(t).replace(/<(?:[^>=]|='[^']*'|="[^"]*"|=[^'"][^\s>]*)*>/gi,"");break;case"object":if(Array.isArray(t)){t=e.extend(!0,[],t);for(var i=0;i<t.length;i++)t[i]=this.stripTags(t[i])}else for(var i in t=e.extend(!0,{},t))t[i]=this.stripTags(t[i])}return t},encodeTags:r,decodeTags:function(t){if(null==t)return t;switch(typeof t){case"number":break;case"string":t=String(t).replace(/&gt;/g,">").replace(/&lt;/g,"<").replace(/&quot;/g,'"').replace(/&amp;/g,"&");break;case"object":if(Array.isArray(t)){t=e.extend(!0,[],t);for(var i=0;i<t.length;i++)t[i]=this.decodeTags(t[i])}else for(var i in t=e.extend(!0,{},t))t[i]=this.decodeTags(t[i])}return t},escapeId:function(e){return""===e||null==e?"":String(e).replace(/([;&,\.\+\*\~'`:"\!\^#$%@\[\]\(\)=<>\|\/? {}\\])/g,"\\$1")},base64encode:function(e){var t,i,n,r,s,o,a,l="",u=0,c="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";for(e=function(e){e=String(e).replace(/\r\n/g,"\n");for(var t="",i=0;i<e.length;i++){var n=e.charCodeAt(i);n<128?t+=String.fromCharCode(n):n>127&&n<2048?(t+=String.fromCharCode(n>>6|192),t+=String.fromCharCode(63&n|128)):(t+=String.fromCharCode(n>>12|224),t+=String.fromCharCode(n>>6&63|128),t+=String.fromCharCode(63&n|128))}return t}(e);u<e.length;)r=(t=e.charCodeAt(u++))>>2,s=(3&t)<<4|(i=e.charCodeAt(u++))>>4,o=(15&i)<<2|(n=e.charCodeAt(u++))>>6,a=63&n,isNaN(i)?o=a=64:isNaN(n)&&(a=64),l=l+c.charAt(r)+c.charAt(s)+c.charAt(o)+c.charAt(a);return l},base64decode:function(e){var t,i,n,r,s,o,a="",l=0,u="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";for(e=e.replace(/[^A-Za-z0-9\+\/\=]/g,"");l<e.length;)t=u.indexOf(e.charAt(l++))<<2|(r=u.indexOf(e.charAt(l++)))>>4,i=(15&r)<<4|(s=u.indexOf(e.charAt(l++)))>>2,n=(3&s)<<6|(o=u.indexOf(e.charAt(l++))),a+=String.fromCharCode(t),64!==s&&(a+=String.fromCharCode(i)),64!==o&&(a+=String.fromCharCode(n));return a=function(e){for(var t,i,n="",r=0,s=0;r<e.length;)(s=e.charCodeAt(r))<128?(n+=String.fromCharCode(s),r++):s>191&&s<224?(t=e.charCodeAt(r+1),n+=String.fromCharCode((31&s)<<6|63&t),r+=2):(t=e.charCodeAt(r+1),i=e.charCodeAt(r+2),n+=String.fromCharCode((15&s)<<12|(63&t)<<6|63&i),r+=3);return n}(a),a},md5:function(e){function t(e,t,i,n,r,s){return o((a=o(o(t,e),o(n,s)))<<(l=r)|a>>>32-l,i);var a,l}function i(e,i,n,r,s,o,a){return t(i&n|~i&r,e,i,s,o,a)}function n(e,i,n,r,s,o,a){return t(i&r|n&~r,e,i,s,o,a)}function r(e,i,n,r,s,o,a){return t(i^n^r,e,i,s,o,a)}function s(e,i,n,r,s,o,a){return t(n^(i|~r),e,i,s,o,a)}function o(e,t){var i=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(i>>16)<<16|65535&i}return function(e){for(var t,i="0123456789abcdef",n="",r=0;r<e.length;r++)t=e.charCodeAt(r),n+=i.charAt(t>>>4&15)+i.charAt(15&t);return n}(function(e){return function(e){for(var t="",i=0;i<32*e.length;i+=8)t+=String.fromCharCode(e[i>>5]>>>i%32&255);return t}(function(e,t){e[t>>5]|=128<<t%32,e[14+(t+64>>>9<<4)]=t;for(var a=1732584193,l=-271733879,u=-1732584194,c=271733878,d=0;d<e.length;d+=16){var h=a,p=l,f=u,g=c;a=i(a,l,u,c,e[d+0],7,-680876936),c=i(c,a,l,u,e[d+1],12,-389564586),u=i(u,c,a,l,e[d+2],17,606105819),l=i(l,u,c,a,e[d+3],22,-1044525330),a=i(a,l,u,c,e[d+4],7,-176418897),c=i(c,a,l,u,e[d+5],12,1200080426),u=i(u,c,a,l,e[d+6],17,-1473231341),l=i(l,u,c,a,e[d+7],22,-45705983),a=i(a,l,u,c,e[d+8],7,1770035416),c=i(c,a,l,u,e[d+9],12,-1958414417),u=i(u,c,a,l,e[d+10],17,-42063),l=i(l,u,c,a,e[d+11],22,-1990404162),a=i(a,l,u,c,e[d+12],7,1804603682),c=i(c,a,l,u,e[d+13],12,-40341101),u=i(u,c,a,l,e[d+14],17,-1502002290),a=n(a,l=i(l,u,c,a,e[d+15],22,1236535329),u,c,e[d+1],5,-165796510),c=n(c,a,l,u,e[d+6],9,-1069501632),u=n(u,c,a,l,e[d+11],14,643717713),l=n(l,u,c,a,e[d+0],20,-373897302),a=n(a,l,u,c,e[d+5],5,-701558691),c=n(c,a,l,u,e[d+10],9,38016083),u=n(u,c,a,l,e[d+15],14,-660478335),l=n(l,u,c,a,e[d+4],20,-405537848),a=n(a,l,u,c,e[d+9],5,568446438),c=n(c,a,l,u,e[d+14],9,-1019803690),u=n(u,c,a,l,e[d+3],14,-187363961),l=n(l,u,c,a,e[d+8],20,1163531501),a=n(a,l,u,c,e[d+13],5,-1444681467),c=n(c,a,l,u,e[d+2],9,-51403784),u=n(u,c,a,l,e[d+7],14,1735328473),a=r(a,l=n(l,u,c,a,e[d+12],20,-1926607734),u,c,e[d+5],4,-378558),c=r(c,a,l,u,e[d+8],11,-2022574463),u=r(u,c,a,l,e[d+11],16,1839030562),l=r(l,u,c,a,e[d+14],23,-35309556),a=r(a,l,u,c,e[d+1],4,-1530992060),c=r(c,a,l,u,e[d+4],11,1272893353),u=r(u,c,a,l,e[d+7],16,-155497632),l=r(l,u,c,a,e[d+10],23,-1094730640),a=r(a,l,u,c,e[d+13],4,681279174),c=r(c,a,l,u,e[d+0],11,-358537222),u=r(u,c,a,l,e[d+3],16,-722521979),l=r(l,u,c,a,e[d+6],23,76029189),a=r(a,l,u,c,e[d+9],4,-640364487),c=r(c,a,l,u,e[d+12],11,-421815835),u=r(u,c,a,l,e[d+15],16,530742520),a=s(a,l=r(l,u,c,a,e[d+2],23,-995338651),u,c,e[d+0],6,-198630844),c=s(c,a,l,u,e[d+7],10,1126891415),u=s(u,c,a,l,e[d+14],15,-1416354905),l=s(l,u,c,a,e[d+5],21,-57434055),a=s(a,l,u,c,e[d+12],6,1700485571),c=s(c,a,l,u,e[d+3],10,-1894986606),u=s(u,c,a,l,e[d+10],15,-1051523),l=s(l,u,c,a,e[d+1],21,-2054922799),a=s(a,l,u,c,e[d+8],6,1873313359),c=s(c,a,l,u,e[d+15],10,-30611744),u=s(u,c,a,l,e[d+6],15,-1560198380),l=s(l,u,c,a,e[d+13],21,1309151649),a=s(a,l,u,c,e[d+4],6,-145523070),c=s(c,a,l,u,e[d+11],10,-1120210379),u=s(u,c,a,l,e[d+2],15,718787259),l=s(l,u,c,a,e[d+9],21,-343485551),a=o(a,h),l=o(l,p),u=o(u,f),c=o(c,g)}return Array(a,l,u,c)}(function(e){for(var t=Array(e.length>>2),i=0;i<t.length;i++)t[i]=0;for(i=0;i<8*e.length;i+=8)t[i>>5]|=(255&e.charCodeAt(i/8))<<i%32;return t}(e),8*e.length))}(function(e){for(var t,i,n="",r=-1;++r<e.length;)t=e.charCodeAt(r),i=r+1<e.length?e.charCodeAt(r+1):0,55296<=t&&t<=56319&&56320<=i&&i<=57343&&(t=65536+((1023&t)<<10)+(1023&i),r++),t<=127?n+=String.fromCharCode(t):t<=2047?n+=String.fromCharCode(192|t>>>6&31,128|63&t):t<=65535?n+=String.fromCharCode(224|t>>>12&15,128|t>>>6&63,128|63&t):t<=2097151&&(n+=String.fromCharCode(240|t>>>18&7,128|t>>>12&63,128|t>>>6&63,128|63&t));return n}(e)))},transition:function(t,i,n,r){var s=e(t).width(),o=e(t).height();if(t&&i){switch(t.parentNode.style.cssText+="perspective: 900px; overflow: hidden;",t.style.cssText+="; position: absolute; z-index: 1019; backface-visibility: hidden",i.style.cssText+="; position: absolute; z-index: 1020; backface-visibility: hidden",n){case"slide-left":t.style.cssText+="overflow: hidden; transform: translate3d(0, 0, 0)",i.style.cssText+="overflow: hidden; transform: translate3d("+s+"px, 0, 0)",e(i).show(),window.setTimeout((function(){i.style.cssText+="transition: 0.5s; transform: translate3d(0, 0, 0)",t.style.cssText+="transition: 0.5s; transform: translate3d(-"+s+"px, 0, 0)"}),1);break;case"slide-right":t.style.cssText+="overflow: hidden; transform: translate3d(0, 0, 0)",i.style.cssText+="overflow: hidden; transform: translate3d(-"+s+"px, 0, 0)",e(i).show(),window.setTimeout((function(){i.style.cssText+="transition: 0.5s; transform: translate3d(0px, 0, 0)",t.style.cssText+="transition: 0.5s; transform: translate3d("+s+"px, 0, 0)"}),1);break;case"slide-down":t.style.cssText+="overflow: hidden; z-index: 1; transform: translate3d(0, 0, 0)",i.style.cssText+="overflow: hidden; z-index: 0; transform: translate3d(0, 0, 0)",e(i).show(),window.setTimeout((function(){i.style.cssText+="transition: 0.5s; transform: translate3d(0, 0, 0)",t.style.cssText+="transition: 0.5s; transform: translate3d(0, "+o+"px, 0)"}),1);break;case"slide-up":t.style.cssText+="overflow: hidden; transform: translate3d(0, 0, 0)",i.style.cssText+="overflow: hidden; transform: translate3d(0, "+o+"px, 0)",e(i).show(),window.setTimeout((function(){i.style.cssText+="transition: 0.5s; transform: translate3d(0, 0, 0)",t.style.cssText+="transition: 0.5s; transform: translate3d(0, 0, 0)"}),1);break;case"flip-left":t.style.cssText+="overflow: hidden; transform: rotateY(0deg)",i.style.cssText+="overflow: hidden; transform: rotateY(-180deg)",e(i).show(),window.setTimeout((function(){i.style.cssText+="transition: 0.5s; transform: rotateY(0deg)",t.style.cssText+="transition: 0.5s; transform: rotateY(180deg)"}),1);break;case"flip-right":t.style.cssText+="overflow: hidden; transform: rotateY(0deg)",i.style.cssText+="overflow: hidden; transform: rotateY(180deg)",e(i).show(),window.setTimeout((function(){i.style.cssText+="transition: 0.5s; transform: rotateY(0deg)",t.style.cssText+="transition: 0.5s; transform: rotateY(-180deg)"}),1);break;case"flip-down":t.style.cssText+="overflow: hidden; transform: rotateX(0deg)",i.style.cssText+="overflow: hidden; transform: rotateX(180deg)",e(i).show(),window.setTimeout((function(){i.style.cssText+="transition: 0.5s; transform: rotateX(0deg)",t.style.cssText+="transition: 0.5s; transform: rotateX(-180deg)"}),1);break;case"flip-up":t.style.cssText+="overflow: hidden; transform: rotateX(0deg)",i.style.cssText+="overflow: hidden; transform: rotateX(-180deg)",e(i).show(),window.setTimeout((function(){i.style.cssText+="transition: 0.5s; transform: rotateX(0deg)",t.style.cssText+="transition: 0.5s; transform: rotateX(180deg)"}),1);break;case"pop-in":t.style.cssText+="overflow: hidden; transform: translate3d(0, 0, 0)",i.style.cssText+="overflow: hidden; transform: translate3d(0, 0, 0); transform: scale(.8); opacity: 0;",e(i).show(),window.setTimeout((function(){i.style.cssText+="transition: 0.5s; transform: scale(1); opacity: 1;",t.style.cssText+="transition: 0.5s;"}),1);break;case"pop-out":t.style.cssText+="overflow: hidden; transform: translate3d(0, 0, 0); transform: scale(1); opacity: 1;",i.style.cssText+="overflow: hidden; transform: translate3d(0, 0, 0); opacity: 0;",e(i).show(),window.setTimeout((function(){i.style.cssText+="transition: 0.5s; opacity: 1;",t.style.cssText+="transition: 0.5s; transform: scale(1.7); opacity: 0;"}),1);break;default:t.style.cssText+="overflow: hidden; transform: translate3d(0, 0, 0)",i.style.cssText+="overflow: hidden; translate3d(0, 0, 0); opacity: 0;",e(i).show(),window.setTimeout((function(){i.style.cssText+="transition: 0.5s; opacity: 1;",t.style.cssText+="transition: 0.5s"}),1)}setTimeout((function(){"slide-down"===n&&(e(t).css("z-index","1019"),e(i).css("z-index","1020")),i&&e(i).css({opacity:"1"}).css(w2utils.cssPrefix({transition:"",transform:""})),t&&e(t).css({opacity:"1"}).css(w2utils.cssPrefix({transition:"",transform:""})),"function"==typeof r&&r()}),500)}else console.log("ERROR: Cannot do transition when one of the divs is null")},lock:function(t,i,n){var r={};"object"==typeof i?r=i:(r.msg=i,r.spinner=n),r.msg||0===r.msg||(r.msg=""),w2utils.unlock(t),e(t).prepend('<div class="w2ui-lock"></div><div class="w2ui-lock-msg"></div>');var s=e(t).find(".w2ui-lock"),o=e(t).find(".w2ui-lock-msg");r.msg||o.css({"background-color":"transparent",border:"0px"}),!0===r.spinner&&(r.msg='<div class="w2ui-spinner" '+(r.msg?"":'style="width: 35px; height: 35px"')+"></div>"+r.msg),null!=r.opacity&&s.css("opacity",r.opacity),"function"==typeof s.fadeIn?(s.fadeIn(200),o.html(r.msg).fadeIn(200)):(s.show(),o.html(r.msg).show(0))},unlock:function(t,i){n(i)?(e(t).find(".w2ui-lock").fadeOut(i),setTimeout((function(){e(t).find(".w2ui-lock").remove(),e(t).find(".w2ui-lock-msg").remove()}),i)):(e(t).find(".w2ui-lock").remove(),e(t).find(".w2ui-lock-msg").remove())},message:function(t,i){var n,r,s=this;e().w2tag(),i||(i={width:200,height:100}),null==i.on&&e.extend(i,w2utils.event),null==i.width&&(i.width=200),null==i.height&&(i.height=100);var o=parseInt(e(t.box).width()),a=parseInt(e(t.box).height()),l=parseInt(e(t.box).find(t.title).css("height")||0);i.width>o&&(i.width=o-10),i.height>a-l&&(i.height=a-10-l),i.originalWidth=i.width,i.originalHeight=i.height,parseInt(i.width)<0&&(i.width=o+i.width),parseInt(i.width)<10&&(i.width=10),parseInt(i.height)<0&&(i.height=a+i.height-l),parseInt(i.height)<10&&(i.height=10),null==i.hideOnClick&&(i.hideOnClick=!1);var u=e(t.box).data("options")||{};(null==i.width||i.width>u.width-10)&&(i.width=u.width-10),(null==i.height||i.height>u.height-l-5)&&(i.height=u.height-l-5),i.originalHeight<0&&(i.height=a+i.originalHeight-l),i.originalWidth<0&&(i.width=o+2*i.originalWidth);var c=e(t.box).find(t.title),d=e(t.box).find(".w2ui-message.w2ui-closing");e(t.box).find(".w2ui-message.w2ui-closing").length>0&&(clearTimeout(n),g(d,d.data("options")||{}));var h=e(t.box).find(".w2ui-message").length;if(""===e.trim(i.html)&&""===e.trim(i.body)&&""===e.trim(i.buttons)){if(0===h)return;var p=e(t.box).find("#w2ui-message"+(h-1));if(i=p.data("options")||{},!0===(r=i.trigger({phase:"before",type:"close",target:"self"})).isCancelled)return;p.css(w2utils.cssPrefix({transition:"0.15s",transform:"translateY(-"+i.height+"px)"})).addClass("w2ui-closing"),1===h?this.unlock&&(t.param?this.unlock(t.param,150):this.unlock(150)):e(t.box).find("#w2ui-message"+(h-2)).css("z-index",1500),n=setTimeout((function(){g(p,i)}),150)}else{""===e.trim(i.body)&&""===e.trim(i.buttons)||(i.html='<div class="w2ui-message-body">'+(i.body||"")+'</div><div class="w2ui-message-buttons">'+(i.buttons||"")+"</div>"),e(t.box).find(".w2ui-message").css("z-index",1390),c.data("old-z-index",c.css("z-index")),c.css("z-index",1501),e(t.box).find(t.body).before('<div id="w2ui-message'+h+'" onmousedown="event.stopPropagation();"    class="w2ui-message" style="display: none; z-index: 1500; '+(0===c.length?"top: 0px;":"top: "+w2utils.getSize(c,"height")+"px;")+(null!=i.width?"width: "+i.width+"px; left: "+(o-i.width)/2+"px;":"left: 10px; right: 10px;")+(null!=i.height?"height: "+i.height+"px;":"bottom: 6px;")+w2utils.cssPrefix("transition",".3s",!0)+'"'+(!0===i.hideOnClick?t.param?'onclick="'+t.path+".message('"+t.param+"');\"":'onclick="'+t.path+'.message();"':"")+"></div>"),e(t.box).find("#w2ui-message"+h).data("options",i).data("prev_focus",e(":focus"));var f=e(t.box).find("#w2ui-message"+h).css("display");if(e(t.box).find("#w2ui-message"+h).css(w2utils.cssPrefix({transform:"none"===f?"translateY(-"+i.height+"px)":"translateY(0px)"})),"none"===f){if(e(t.box).find("#w2ui-message"+h).show().html(i.html),i.box=e(t.box).find("#w2ui-message"+h),!0===(r=i.trigger({phase:"before",type:"open",target:"self"})).isCancelled)return c.css("z-index",c.data("old-z-index")),void e(t.box).find("#w2ui-message"+h).remove();setTimeout((function(){e(t.box).find("#w2ui-message"+h).css(w2utils.cssPrefix({transform:"none"===f?"translateY(0px)":"translateY(-"+i.height+"px)"}))}),1),0===h&&this.lock&&(t.param?this.lock(t.param):this.lock()),setTimeout((function(){e(t.box).find("#w2ui-message"+h).css(w2utils.cssPrefix({transition:"0s"})),i.trigger(e.extend(r,{phase:"after"}))}),350)}}function g(i,n){if(null==r&&!0===(r=n.trigger({phase:"before",type:"open",target:"self"})).isCancelled)return c.css("z-index",c.data("old-z-index")),void e(t.box).find("#w2ui-message"+h).remove();var o=i.data("prev_focus");i.remove(),o&&o.length>0?o.focus():s&&s.focus&&s.focus(),c.css("z-index",c.data("old-z-index")),n.trigger(e.extend(r,{phase:"after"}))}},naturalCompare:function(e,t){var i,n,r=1,s=0,o=0,a=String.alphabet;function l(e,t,n){if(n){for(i=t;(n=l(e,i))<76&&n>65;)++i;return+e.slice(t-1,i)}return(n=a&&a.indexOf(e.charAt(t)))>-1?n+76:(n=e.charCodeAt(t)||0)<45||n>127?n:n<46?65:n<48?n-1:n<58?n+18:n<65?n-11:n<91?n+11:n<97?n-37:n<123?n+5:n-63}if((e+="")!=(t+=""))for(;r;)if(n=l(e,s++),r=l(t,o++),n<76&&r<76&&n>66&&r>66&&(n=l(e,s,s),r=l(t,o,s=i),o=i),n!=r)return n<r?-1:1;return 0},lang:function(e){var t=this.settings.phrases[e];return null==t?e:t},locale:function(t,i){t||(t="en-us"),"string"==typeof t?(5===t.length&&(t="locale/"+t+".json"),w2utils.settings.phrases={},e.ajax({url:t,type:"GET",dataType:"JSON",success:function(t,n,r){w2utils.settings=e.extend(!0,w2utils.settings,t),"function"==typeof i&&i()},error:function(e,i,n){console.log("ERROR: Cannot load locale "+t)}})):w2utils.settings=e.extend(!0,w2utils.settings,t)},getSize:function(t,i){var n=e(t),r=parseInt(n.css("border-left-width"))||0,s=parseInt(n.css("border-right-width"))||0,o=parseInt(n.css("border-top-width"))||0,a=parseInt(n.css("border-bottom-width"))||0,l=parseInt(n.css("margin-left"))||0,u=parseInt(n.css("margin-right"))||0,c=parseInt(n.css("margin-top"))||0,d=parseInt(n.css("margin-bottom"))||0,h=parseInt(n.css("padding-left"))||0,p=parseInt(n.css("padding-right"))||0,f=parseInt(n.css("padding-top"))||0,g=parseInt(n.css("padding-bottom"))||0;switch(i){case"top":return o+c+f;case"bottom":return a+d+g;case"left":return r+l+h;case"right":return s+u+p;case"width":return r+s+l+u+h+p+parseInt(n.width());case"height":return o+a+c+d+f+g+parseInt(n.height());case"+width":return r+s+l+u+h+p;case"+height":return o+a+c+d+f+g}return 0},getStrWidth:function(t,i){var n,s='<div id="_tmp_width" style="position: absolute; top: -900px;'+(i||"")+'">'+r(t)+"</div>";return e("body").append(s),n=e("#_tmp_width").width(),e("#_tmp_width").remove(),n},scrollBarSize:function(){return t.scrollBarSize||(e("body").append('<div id="_scrollbar_width" style="position: absolute; top: -300px; width: 100px; height: 100px; overflow-y: scroll;">    <div style="height: 120px">1</div></div>'),t.scrollBarSize=100-e("#_scrollbar_width > div").width(),e("#_scrollbar_width").remove(),String(navigator.userAgent).indexOf("MSIE")>=0&&(t.scrollBarSize=t.scrollBarSize/2)),t.scrollBarSize},checkName:function(e,t){return e&&null!=e.name?null!=w2ui[e.name]?(console.log('ERROR: The parameter "name" is not unique. There are other objects already created with the same name (obj: '+e.name+")."),!1):!!w2utils.isAlphaNumeric(e.name)||(console.log('ERROR: The parameter "name" has to be alpha-numeric (a-z, 0-9, dash and underscore). '),!1):(console.log('ERROR: The parameter "name" is required but not supplied in $().'+t+"()."),!1)},checkUniqueId:function(t,i,n,r){e.isArray(i)||(i=[i]);for(var s=0;s<i.length;s++)if(i[s].id===t)return console.log('ERROR: The parameter "id='+t+'" is not unique within the current '+n+". (obj: "+r+")"),!1;return!0},parseRoute:function(e){var t=[],i=e.replace(/\/\(/g,"(?:/").replace(/\+/g,"__plus__").replace(/(\/)?(\.)?:(\w+)(?:(\(.*?\)))?(\?)?/g,(function(e,i,n,r,s,o){return t.push({name:r,optional:!!o}),i=i||"",(o?"":i)+"(?:"+(o?i:"")+(n||"")+(s||(n?"([^/.]+?)":"([^/]+?)"))+")"+(o||"")})).replace(/([\/.])/g,"\\$1").replace(/__plus__/g,"(.+)").replace(/\*/g,"(.*)");return{path:new RegExp("^"+i+"$","i"),keys:t}},cssPrefix:function(t,i,n){var r={},s={},o="";for(var a in e.isPlainObject(t)?(r=t,!0===i&&(n=!0)):r[t]=i,r)s[a]=r[a],s["-webkit-"+a]=r[a],s["-moz-"+a]=r[a].replace("-webkit-","-moz-"),s["-ms-"+a]=r[a].replace("-webkit-","-ms-"),s["-o-"+a]=r[a].replace("-webkit-","-o-");if(!0===n)for(var a in s)o+=a+": "+s[a]+"; ";else o=s;return o},parseColor:function(e){if("string"!=typeof e)return null;"#"===(e=e.trim().toUpperCase())[0]&&(e=e.substr(1));var t={};if(3===e.length)t={r:parseInt(e[0]+e[0],16),g:parseInt(e[1]+e[1],16),b:parseInt(e[2]+e[2],16),a:1};else if(6===e.length)t={r:parseInt(e.substr(0,2),16),g:parseInt(e.substr(2,2),16),b:parseInt(e.substr(4,2),16),a:1};else if(8===e.length)t={r:parseInt(e.substr(0,2),16),g:parseInt(e.substr(2,2),16),b:parseInt(e.substr(4,2),16),a:Math.round(parseInt(e.substr(6,2),16)/255*100)/100};else if(e.length>4&&"RGB("===e.substr(0,4)){var i=e.replace("RGB","").replace(/\(/g,"").replace(/\)/g,"").split(",");t={r:parseInt(i[0],10),g:parseInt(i[1],10),b:parseInt(i[2],10),a:1}}else{if(!(e.length>5&&"RGBA("===e.substr(0,5)))return null;i=e.replace("RGBA","").replace(/\(/g,"").replace(/\)/g,"").split(","),t={r:parseInt(i[0],10),g:parseInt(i[1],10),b:parseInt(i[2],10),a:parseFloat(i[3])}}return t},hsv2rgb:function(e,t,i,n){var r,s,o,a,l,u,c,d;switch(1===arguments.length&&(t=e.s,i=e.v,n=e.a,e=e.h),u=(i/=100)*(1-(t/=100)),c=i*(1-(l=6*(e/=360)-(a=Math.floor(6*e)))*t),d=i*(1-(1-l)*t),a%6){case 0:r=i,s=d,o=u;break;case 1:r=c,s=i,o=u;break;case 2:r=u,s=i,o=d;break;case 3:r=u,s=c,o=i;break;case 4:r=d,s=u,o=i;break;case 5:r=i,s=u,o=c}return{r:Math.round(255*r),g:Math.round(255*s),b:Math.round(255*o),a:null!=n?n:1}},rgb2hsv:function(e,t,i,n){1===arguments.length&&(t=e.g,i=e.b,n=e.a,e=e.r);var r,s=Math.max(e,t,i),o=Math.min(e,t,i),a=s-o,l=0===s?0:a/s,u=s/255;switch(s){case o:r=0;break;case e:r=t-i+a*(t<i?6:0),r/=6*a;break;case t:r=i-e+2*a,r/=6*a;break;case i:r=e-t+4*a,r/=6*a}return{h:Math.round(360*r),s:Math.round(100*l),v:Math.round(100*u),a:null!=n?n:1}},tooltip:function(e,t){var i="mouseenter",n="mouseleave";return(t=t||{}).showOn&&(i=t.showOn,delete t.showOn),t.hideOn&&(n=t.hideOn,delete t.hideOn),"on"+i+"=\"$(this).w2tag(w2utils.base64decode('"+w2utils.base64encode(e)+"'),JSON.parse(w2utils.base64decode('"+w2utils.base64encode(JSON.stringify(t))+"')))\"on"+n+'="$(this).w2tag()"'},getCursorPosition:function(e){if(null==e)return null;var t,i=0,n=e.ownerDocument||e.document,r=n.defaultView||n.parentWindow;if(e.tagName&&"INPUT"===e.tagName.toUpperCase()&&e.selectionStart)i=e.selectionStart;else if(r.getSelection){if((t=r.getSelection()).rangeCount>0){var s=t.getRangeAt(0),o=s.cloneRange();o.selectNodeContents(e),o.setEnd(s.endContainer,s.endOffset),i=o.toString().length}}else if((t=n.selection)&&"Control"!==t.type){var a=t.createRange(),l=n.body.createTextRange();l.moveToElementText(e),l.setEndPoint("EndToEnd",a),i=l.text.length}return i},setCursorPosition:function(t,i,n){var r,s=document.createRange(),o=window.getSelection();if(null!=t){for(var a=0;a<t.childNodes.length;a++){var l=e(t.childNodes[a]).text();if(t.childNodes[a].tagName&&(l=(l=e(t.childNodes[a]).html()).replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&").replace(/&quot;/g,'"').replace(/&nbsp;/g," ")),i<=l.length){(r=t.childNodes[a]).childNodes&&r.childNodes.length>0&&(r=r.childNodes[0]),r.childNodes&&r.childNodes.length>0&&(r=r.childNodes[0]);break}i-=l.length}null!=r&&(i>r.length&&(i=r.length),s.setStart(r,i),n?s.setEnd(r,n):s.collapse(!0),o.removeAllRanges(),o.addRange(s))}},testLocalStorage:s,hasLocalStorage:s(),isIOS:-1!==navigator.userAgent.toLowerCase().indexOf("iphone")||-1!==navigator.userAgent.toLowerCase().indexOf("ipod")||-1!==navigator.userAgent.toLowerCase().indexOf("ipad")||-1!==navigator.userAgent.toLowerCase().indexOf("mobile")||-1!==navigator.userAgent.toLowerCase().indexOf("android"),isIE:-1!==navigator.userAgent.toLowerCase().indexOf("msie")||-1!==navigator.userAgent.toLowerCase().indexOf("trident")};return i;function n(e){return/^[-+]?[0-9]+$/.test(e)}function r(t){if(null==t)return t;switch(typeof t){case"number":break;case"string":t=String(t).replace(/&/g,"&amp;").replace(/>/g,"&gt;").replace(/</g,"&lt;").replace(/"/g,"&quot;");break;case"object":if(Array.isArray(t)){t=e.extend(!0,[],t);for(var i=0;i<t.length;i++)t[i]=this.encodeTags(t[i])}else for(var i in t=e.extend(!0,{},t))t[i]=this.encodeTags(t[i])}return t}function s(){var e="w2ui_test";try{return localStorage.setItem(e,e),localStorage.removeItem(e),!0}catch(e){return!1}}}(jQuery),$;w2utils.formatters={number:function(e,t){return parseInt(t)>20&&(t=20),parseInt(t)<0&&(t=0),null==e||""===e?"":w2utils.formatNumber(parseFloat(e),t,!0)},float:function(e,t){return w2utils.formatters.number(e,t)},int:function(e,t){return w2utils.formatters.number(e,0)},money:function(e,t){if(null==e||""===e)return"";var i=w2utils.formatNumber(Number(e),w2utils.settings.currencyPrecision||2);return(w2utils.settings.currencyPrefix||"")+i+(w2utils.settings.currencySuffix||"")},currency:function(e,t){return w2utils.formatters.money(e,t)},percent:function(e,t){return null==e||""===e?"":w2utils.formatNumber(e,t||1)+"%"},size:function(e,t){return null==e||""===e?"":w2utils.formatSize(parseInt(e))},date:function(e,t){if(""===t&&(t=w2utils.settings.dateFormat),null==e||0===e||""===e)return"";var i=w2utils.isDateTime(e,t,!0);return!1===i&&(i=w2utils.isDate(e,t,!0)),'<span title="'+i+'">'+w2utils.formatDate(i,t)+"</span>"},datetime:function(e,t){if(""===t&&(t=w2utils.settings.datetimeFormat),null==e||0===e||""===e)return"";var i=w2utils.isDateTime(e,t,!0);return!1===i&&(i=w2utils.isDate(e,t,!0)),'<span title="'+i+'">'+w2utils.formatDateTime(i,t)+"</span>"},time:function(e,t){if(""===t&&(t=w2utils.settings.timeFormat),"h12"===t&&(t="hh:mi pm"),"h24"===t&&(t="h24:mi"),null==e||0===e||""===e)return"";var i=w2utils.isDateTime(e,t,!0);return!1===i&&(i=w2utils.isDate(e,t,!0)),'<span title="'+i+'">'+w2utils.formatTime(e,t)+"</span>"},timestamp:function(e,t){if(""===t&&(t=w2utils.settings.datetimeFormat),null==e||0===e||""===e)return"";var i=w2utils.isDateTime(e,t,!0);return!1===i&&(i=w2utils.isDate(e,t,!0)),i.toString?i.toString():""},gmt:function(e,t){if(""===t&&(t=w2utils.settings.datetimeFormat),null==e||0===e||""===e)return"";var i=w2utils.isDateTime(e,t,!0);return!1===i&&(i=w2utils.isDate(e,t,!0)),i.toUTCString?i.toUTCString():""},age:function(e,t){if(null==e||0===e||""===e)return"";var i=w2utils.isDateTime(e,null,!0);return!1===i&&(i=w2utils.isDate(e,null,!0)),'<span title="'+i+'">'+w2utils.age(e)+(t?" "+t:"")+"</span>"},interval:function(e,t){return null==e||0===e||""===e?"":w2utils.interval(e)+(t?" "+t:"")},toggle:function(e,t){return e?"Yes":""},password:function(e,t){for(var i="",n=0;n<e.length;n++)i+="*";return i}},w2utils.event={on:function(e,t){var i,n=jQuery;if("string"==typeof e&&-1!==e.indexOf(".")){var r=e.split(".");e=r[0],i=r[1]}if("string"==typeof e&&-1!==e.indexOf(":")&&(r=e.split(":"),-1!==["complete","done"].indexOf(e[1])&&(e[1]="after"),e={type:r[0],execute:r[1]},i&&(e.scope=i)),n.isPlainObject(e)||(e={type:e,scope:i}),(e=n.extend({type:null,execute:"before",target:null,onComplete:null},e)).type){if(t)return n.isArray(this.handlers)||(this.handlers=[]),this.handlers.push({edata:e,handler:t}),this;console.log("ERROR: You must specify event handler function when calling .on() method of "+this.name)}else console.log("ERROR: You must specify event type when calling .on() method of "+this.name)},off:function(e,t){var i,n=jQuery;if("string"==typeof e&&-1!==e.indexOf(".")){var r=e.split(".");e=r[0],i=r[1],""===e&&(e="*")}if("string"==typeof e&&-1!==e.indexOf(":")&&(r=e.split(":"),-1!==["complete","done"].indexOf(e[1])&&(e[1]="after"),e={type:r[0],execute:r[1]}),n.isPlainObject(e)||(e={type:e}),(e=n.extend({},{type:null,execute:null,target:null,onComplete:null},e)).type||i){t||(t=null);for(var s=[],o=0,a=this.handlers.length;o<a;o++){var l=this.handlers[o];(l.edata.type!==e.type&&"*"!==e.type&&(null==l.edata.scope||""!=e.type)||l.edata.target!==e.target&&null!=e.target||l.edata.execute!==e.execute&&null!=e.execute||!(l.handler===t&&null!=t||null!=i&&l.edata.scope==i))&&s.push(l)}return this.handlers=s,this}console.log("ERROR: You must specify event type when calling .off() method of "+this.name)},trigger:function(e){var t,i,n,r=jQuery;"before"===(e=r.extend({type:null,phase:"before",target:null,doneHandlers:[]},e,{isStopped:!1,isCancelled:!1,done:function(e){this.doneHandlers.push(e)},preventDefault:function(){this.isCancelled=!0},stopPropagation:function(){this.isStopped=!0}})).phase&&(e.onComplete=null),null==e.target&&(e.target=null),r.isArray(this.handlers)||(this.handlers=[]);for(var s=this.handlers.length-1;s>=0;s--){var o=this.handlers[s];if(!(null==o||o.edata.type!==e.type&&"*"!==o.edata.type||o.edata.target!==e.target&&null!=o.edata.target||o.edata.execute!==e.phase&&"*"!==o.edata.execute&&"*"!==o.edata.phase)&&(e=r.extend({},o.edata,e),t=[],(n=new RegExp(/\((.*?)\)/).exec(o.handler))&&(t=n[1].split(/\s*,\s*/)),2===t.length?o.handler.call(this,e.target,e):o.handler.call(this,e),!0===e.isStopped||!0===e.stop))return e}var a="on"+e.type.substr(0,1).toUpperCase()+e.type.substr(1);if("before"===e.phase&&"function"==typeof this[a]&&(i=this[a],t=[],(n=new RegExp(/\((.*?)\)/).exec(i))&&(t=n[1].split(/\s*,\s*/)),2===t.length?i.call(this,e.target,e):i.call(this,e),!0===e.isStopped||!0===e.stop))return e;if(null!=e.object&&"before"===e.phase&&"function"==typeof e.object[a]&&(i=e.object[a],t=[],(n=new RegExp(/\((.*?)\)/).exec(i))&&(t=n[1].split(/\s*,\s*/)),2===t.length?i.call(this,e.target,e):i.call(this,e),!0===e.isStopped||!0===e.stop))return e;if("after"===e.phase){"function"==typeof e.onComplete&&e.onComplete.call(this,e);for(var l=0;l<e.doneHandlers.length;l++)"function"==typeof e.doneHandlers[l]&&e.doneHandlers[l].call(this,e)}return e}},$=jQuery,$.fn.w2render=function(e){$(this).length>0&&("string"==typeof e&&w2ui[e]&&w2ui[e].render($(this)[0]),"object"==typeof e&&e.render($(this)[0]))},$.fn.w2destroy=function(e){!e&&this.length>0&&(e=this.attr("name")),"string"==typeof e&&w2ui[e]&&w2ui[e].destroy(),"object"==typeof e&&e.destroy()},$.fn.w2marker=function(){var e=Array.prototype.slice.call(arguments,0);return Array.isArray(e[0])&&(e=e[0]),0!==e.length&&e[0]?$(this).each((function(i,n){t(0,n);for(var r=0;r<e.length;r++){var s=e[r];"string"!=typeof s&&(s=String(s)),s=s.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&").replace(/&/g,"&amp;").replace(/</g,"&gt;").replace(/>/g,"&lt;");var o=new RegExp(s+"(?!([^<]+)?>)","gi");n.innerHTML=n.innerHTML.replace(o,a)}function a(e){return'<span class="w2ui-marker">'+e+"</span>"}})):$(this).each(t);function t(e,t){for(;-1!==t.innerHTML.indexOf('<span class="w2ui-marker">');)t.innerHTML=t.innerHTML.replace(/\<span class=\"w2ui\-marker\"\>((.|\n|\r)*)\<\/span\>/gi,"$1")}},$.fn.w2tag=function(e,t){if(1===arguments.length&&"object"==typeof e&&null!=(t=e).html&&(e=t.html),null!=(t=$.extend({id:null,auto:null,html:e,position:"right|top",align:"none",left:0,top:0,maxWidth:null,style:"",css:{},className:"",inputClass:"",onShow:null,onHide:null,hideOnKeyPress:!0,hideOnFocus:!1,hideOnBlur:!1,hideOnClick:!1,hideOnChange:!0},t)).name&&null==t.id&&(t.id=t.name),""!==t.class&&""===t.inputClass&&(t.inputClass=t.class),0!==$(this).length)return!0===t.auto||null!=t.showOn||null!=t.hideOn?0!=arguments.length&&e?$(this).each((function(i,n){var r="mouseenter",s="mouseleave";t.showOn&&(r=String(t.showOn).toLowerCase(),delete t.showOn),t.hideOn&&(s=String(t.hideOn).toLowerCase(),delete t.hideOn),t.potision||(t.position="top|bottom"),$(n).off(".w2tooltip").on(r+".w2tooltip",(function(){t.auto=!1,$(this).w2tag(e,t)})).on(s+".w2tooltip",(function(){$(this).w2tag()}))})):$(this).each((function(e,t){$(t).off(".w2tooltip")})):$(this).each((function(i,n){var r,s=t.id?t.id:n.id;""==s&&(s=$(n).find("input").attr("id")),s||(s="noid");var o=w2utils.escapeId(s);if(null!=$(this).data("w2tag")?(r=$(this).data("w2tag"),$.extend(r.options,t)):r={id:s,attachedTo:n,box:$("#w2ui-tag-"+o),options:$.extend({},t),init:l,hide:function(){r.box.length<=0||(r.tmp.timer&&clearTimeout(r.tmp.timer),r.box.remove(),r.options.hideOnClick&&$("body").off(".w2tag"+(r.id||"")),$(r.attachedTo).off(".w2tag").removeClass(r.options.inputClass).removeData("w2tag"),$(r.attachedTo).length>0&&($(r.attachedTo)[0].style.cssText=r.tmp.originalCSS),"function"==typeof r.options.onHide&&r.options.onHide())},getPos:c,isMoved:u,tmp:{}},""===e||null==e)r.hide();else if(0!==r.box.length)r.box.find(".w2ui-tag-body").css(r.options.css).attr("style",r.options.style).addClass(r.options.className).html(r.options.html);else{r.tmp.originalCSS="",$(r.attachedTo).length>0&&(r.tmp.originalCSS=$(r.attachedTo)[0].style.cssText);var a="white-space: nowrap;";r.options.maxWidth&&w2utils.getStrWidth(e)>r.options.maxWidth&&(a="width: "+r.options.maxWidth+"px"),$("body").append('<div onclick="event.stopPropagation()" style="display: none;" id="w2ui-tag-'+r.id+'"        class="w2ui-tag '+($(r.attachedTo).parents(".w2ui-popup, .w2ui-overlay-popup, .w2ui-message").length>0?"w2ui-tag-popup":"")+'">   <div style="margin: -2px 0px 0px -2px; '+a+'">      <div class="w2ui-tag-body '+r.options.className+'" style="'+(r.options.style||"")+'">'+e+"</div>   </div></div>"),r.box=$("#w2ui-tag-"+o),$(r.attachedTo).data("w2tag",r),setTimeout(l,1)}return;function l(){if(r.box.css("display","block"),r&&r.box&&$(r.attachedTo).offset()){var e=r.getPos();r.box.css({opacity:"1",left:e.left+"px",top:e.top+"px"}).data("w2tag",r).find(".w2ui-tag-body").addClass(e.posClass),r.tmp.pos=e.left+"x"+e.top,$(r.attachedTo).off(".w2tag").css(r.options.css).addClass(r.options.inputClass),r.options.hideOnKeyPress&&$(r.attachedTo).on("keypress.w2tag",r.hide),r.options.hideOnFocus&&$(r.attachedTo).on("focus.w2tag",r.hide),t.hideOnChange&&("INPUT"===n.nodeName?$(n).on("change.w2tag",r.hide):$(n).find("input").on("change.w2tag",r.hide)),r.options.hideOnBlur&&$(r.attachedTo).on("blur.w2tag",r.hide),r.options.hideOnClick&&$("body").on("click.w2tag"+(r.id||""),r.hide),"function"==typeof r.options.onShow&&r.options.onShow(),u()}}function u(e){var t=$(r.attachedTo).offset();if(0===$(r.attachedTo).length||0===t.left&&0===t.top||0===r.box.find(".w2ui-tag-body").length)r.hide();else{var i=c();r.tmp.pos!==i.left+"x"+i.top&&(r.box.css(w2utils.cssPrefix({transition:e?"0s":".2s"})).css({left:i.left+"px",top:i.top+"px"}),r.tmp.pos=i.left+"x"+i.top),r.tmp.timer&&clearTimeout(r.tmp.timer),r.tmp.timer=setTimeout(u,100)}}function c(){var e=$(r.attachedTo).offset(),t="w2ui-tag-right",i=parseInt(e.left+r.attachedTo.offsetWidth+(r.options.left?r.options.left:0)),n=parseInt(e.top+(r.options.top?r.options.top:0)),s=r.box.find(".w2ui-tag-body"),o=s[0].offsetWidth,a=s[0].offsetHeight;if("string"==typeof r.options.position&&-1!==r.options.position.indexOf("|")&&(r.options.position=r.options.position.split("|")),"top"===r.options.position)t="w2ui-tag-top",i=parseInt(e.left+(r.options.left?r.options.left:0))-14,n=parseInt(e.top+(r.options.top?r.options.top:0))-a-10;else if("bottom"===r.options.position)t="w2ui-tag-bottom",i=parseInt(e.left+(r.options.left?r.options.left:0))-14,n=parseInt(e.top+r.attachedTo.offsetHeight+(r.options.top?r.options.top:0))+10;else if("left"===r.options.position)t="w2ui-tag-left",i=parseInt(e.left+(r.options.left?r.options.left:0))-o-20,n=parseInt(e.top+(r.options.top?r.options.top:0));else if(Array.isArray(r.options.position)){for(var l=window.innerWidth,u=window.innerHeight,c=0;c<r.options.position.length;c++){var d=r.options.position[c];if("right"===d){if(t="w2ui-tag-right",i=parseInt(e.left+r.attachedTo.offsetWidth+(r.options.left?r.options.left:0)),n=parseInt(e.top+(r.options.top?r.options.top:0)),i+o<=l)break}else if("left"===d){if(t="w2ui-tag-left",i=parseInt(e.left+(r.options.left?r.options.left:0))-o-20,n=parseInt(e.top+(r.options.top?r.options.top:0)),i>=0)break}else if("top"===d){if(t="w2ui-tag-top",i=parseInt(e.left+(r.options.left?r.options.left:0))-14,n=parseInt(e.top+(r.options.top?r.options.top:0))-a-10,i+o<=l&&n>=0)break}else if("bottom"===d&&(t="w2ui-tag-bottom",i=parseInt(e.left+(r.options.left?r.options.left:0))-14,n=parseInt(e.top+r.attachedTo.offsetHeight+(r.options.top?r.options.top:0))+10,i+o<=l&&n+a<=u))break}s.data("posClass")!==t&&s.removeClass("w2ui-tag-right w2ui-tag-left w2ui-tag-top w2ui-tag-bottom").addClass(t).data("posClass",t)}return{left:i,top:n,posClass:t}}}));$(".w2ui-tag").each((function(e,t){var i=$(t).data("w2tag");i&&i.hide()}))},$.fn.w2overlay=function(e,t){var i,n=this,r="",s={name:null,html:"",align:"none",left:0,top:0,tipLeft:30,noTip:!1,selectable:!1,width:0,height:0,maxWidth:null,maxHeight:null,contextMenu:!1,pageX:null,pageY:null,originalEvent:null,style:"",class:"",overlayStyle:"",onShow:null,onHide:null,openAbove:null,tmp:{}};if(1===arguments.length&&(t="object"==typeof e?e:{html:e}),2===arguments.length&&(t.html=e),$.isPlainObject(t)||(t={}),(t=$.extend({},s,t)).name&&(r="-"+t.name),0===this.length||""===t.html||null==t.html)return $("#w2ui-overlay"+r).length>0?"function"==typeof(i=$("#w2ui-overlay"+r)[0].hide)&&i():$("#w2ui-overlay"+r).remove(),$(this);$("#w2ui-overlay"+r).length>0&&(i=$("#w2ui-overlay"+r)[0].hide,$(document).off(".w2overlay"+r),"function"==typeof i&&i()),n.length>0&&(null==n[0].tagName||"BODY"===n[0].tagName.toUpperCase())&&(t.contextMenu=!0),t.contextMenu&&t.originalEvent&&(t.pageX=t.originalEvent.pageX,t.pageY=t.originalEvent.pageY),!t.contextMenu||null!=t.pageX&&null!=t.pageY||console.log("ERROR: to display menu at mouse location, pass options.pageX and options.pageY.");var o="";t.data&&Object.keys(t.data).forEach((function(e){o+="data-"+e+'="'+t.data[e]+'"'})),$("body").append('<div id="w2ui-overlay'+r+'" style="display: none; left: 0px; top: 0px; '+t.overlayStyle+'" '+o+'        class="w2ui-reset w2ui-overlay '+($(this).parents(".w2ui-popup, .w2ui-overlay-popup, .w2ui-message").length>0?"w2ui-overlay-popup":"")+'">    <style></style>    <div style="min-width: 100%; '+t.style+'" class="'+t.class+'"></div></div>');var a=$("#w2ui-overlay"+r),l=a.find(" > div");l.html(t.html);var u=l.css("background-color");null!=u&&"rgba(0, 0, 0, 0)"!==u&&"transparent"!==u&&a.css({"background-color":u,"border-color":u});var c=$(n).offset()||{};return a.data("element",n.length>0?n[0]:null).data("options",t).data("position",c.left+"x"+c.top).fadeIn("fast").on("click",(function(e){$("#w2ui-overlay"+r).data("keepOpen",!0),"LABEL"===e.target.tagName.toUpperCase()&&e.stopPropagation()})).on("mousedown",(function(e){var i=e.target.tagName.toUpperCase();-1!==["INPUT","TEXTAREA","SELECT"].indexOf(i)||t.selectable||e.preventDefault()})),a[0].hide=h,a[0].resize=p,setTimeout((function(){$(document).off(".w2overlay"+r).on("click.w2overlay"+r,h),"function"==typeof t.onShow&&t.onShow(),p()}),10),d(),$(this);function d(){var e=$("#w2ui-overlay"+r);if(e.data("element")===n[0]&&0!==e.length){var t=$(n).offset()||{},i=t.left+"x"+t.top;e.data("position")!==i?h():setTimeout(d,250)}}function h(e){if(!e||0===e.button){var i,n=$("#w2ui-overlay"+r);e&&$($(e.target).closest(".w2ui-overlay").data("element")).closest(".w2ui-overlay")[0]===n[0]||(!0!==n.data("keepOpen")?("function"==typeof t.onHide&&(i=t.onHide()),!1!==i&&(n.remove(),$(document).off(".w2overlay"+r),clearInterval(n.data("timer")))):n.removeData("keepOpen"))}}function p(){var e=$("#w2ui-overlay"+r),i=e.find(" > div"),s=$("#w2ui-overlay"+r+" div.w2ui-menu"),o={};if(s.length>0&&(s.css("overflow-y","hidden"),o.scrollTop=s.scrollTop(),o.scrollLeft=s.scrollLeft()),e.length>0){i.height("auto").width("auto");var a=!1,l=i.height(),u=i.width();t.width&&t.width<u&&(u=t.width),u<30&&(u=30),t.tmp.contentHeight&&(l=parseInt(t.tmp.contentHeight),i.height(l),setTimeout((function(){var e=i.find("div.w2ui-menu");l>e.height()&&i.find("div.w2ui-menu").css("overflow-y","hidden")}),1),setTimeout((function(){var e=i.find("div.w2ui-menu");"auto"!==e.css("overflow-y")&&e.css("overflow-y","auto")}),10)),t.tmp.contentWidth&&"both"!==t.align?(u=parseInt(t.tmp.contentWidth),i.width(u),setTimeout((function(){u>i.find("div.w2ui-menu > table").width()&&i.find("div.w2ui-menu > table").css("overflow-x","hidden")}),1),setTimeout((function(){i.find("div.w2ui-menu > table").css("overflow-x","auto")}),10)):i.find("div.w2ui-menu").css("width","100%");var c=t.left,d=t.width,h=t.tipLeft;switch(t.align){case"both":c=17,0===t.width&&(t.width=w2utils.getSize($(n),"width")),t.maxWidth&&t.width>t.maxWidth&&(t.width=t.maxWidth);break;case"left":c=17;break;case"right":c=w2utils.getSize($(n),"width")-u+10,h=u-40}d=30!==u||d?t.width?t.width:"auto":30;var f,g,m,v=(u-17)/2;"auto"!==d&&(v=(d-17)/2),v<25&&(c=25-v,h=Math.floor(v)),t.contextMenu?(f=t.pageX+8,g=t.pageY-0,m=t.pageY):(f=((w=n.offset()||{}).left>25?w.left:25)+c,g=w.top+w2utils.getSize(n,"height")+t.top+7,m=w.top),e.css({left:f+"px",top:g+"px","min-width":d,"min-height":t.height?t.height:"auto"});var y,w=i.offset()||{},b=window.innerHeight+$(document).scrollTop()-w.top-7,x=window.innerWidth+$(document).scrollLeft()-w.left-7;t.contextMenu&&(b=window.innerHeight+$(document).scrollTop()-t.pageY-15,x=window.innerWidth+$(document).scrollLeft()-t.pageX),(b>-50&&b<210||!0===t.openAbove)&&!1!==t.openAbove?(t.contextMenu?(b=t.pageY-7,y=5):(b=w.top-$(document).scrollTop()-7,y=24),t.maxHeight&&b>t.maxHeight&&(b=t.maxHeight),l>b&&(a=!0,i.height(b).width(u).css({"overflow-y":"auto"}),l=b),e.addClass("bottom-arrow"),e.css("top",m-l-y+t.top+"px"),e.find(">style").html("#w2ui-overlay"+r+":before { margin-left: "+parseInt(h)+"px; }#w2ui-overlay"+r+":after { margin-left: "+parseInt(h)+"px; }")):(t.maxHeight&&b>t.maxHeight&&(b=t.maxHeight),l>b&&(a=!0,i.height(b).width(u).css({"overflow-y":"auto"})),e.addClass("top-arrow"),e.find(">style").html("#w2ui-overlay"+r+":before { margin-left: "+parseInt(h)+"px; }#w2ui-overlay"+r+":after { margin-left: "+parseInt(h)+"px; }")),u=i.width(),x=window.innerWidth+$(document).scrollLeft()-w.left-7,t.maxWidth&&x>t.maxWidth&&(x=t.maxWidth),u>x&&"both"!==t.align&&(t.align="right",setTimeout((function(){p()}),1)),(t.contextMenu||t.noTip)&&e.find(">style").html("#w2ui-overlay"+r+":before { display: none; }#w2ui-overlay"+r+":after { display: none; }"),a&&"both"!==t.align&&i.width(u+w2utils.scrollBarSize()+2)}s.length>0&&(s.css("overflow-y","auto"),s.scrollTop(o.scrollTop),s.scrollLeft(o.scrollLeft))}},$.fn.w2menu=function(e,t){t&&"function"==typeof t.items&&(t.items=t.items());var i,n={type:"normal",index:null,items:[],render:null,msgNoItems:"No items",onSelect:null,hideOnRemove:!1,tmp:{}},r=this,s="";if("refresh"===e)if($.fn.w2menuOptions&&$.fn.w2menuOptions.name&&(s="-"+$.fn.w2menuOptions.name),t.name&&(s="-"+t.name),$("#w2ui-overlay"+s).length>0){t=$.extend($.fn.w2menuOptions,t);var o=$("#w2ui-overlay"+s+" div.w2ui-menu").scrollTop();$("#w2ui-overlay"+s+" div.w2ui-menu").html(m()),$("#w2ui-overlay"+s+" div.w2ui-menu").scrollTop(o),f()}else $(this).w2menu(t);else if("refresh-index"===e){var a=$("#w2ui-overlay"+s+" div.w2ui-menu"),l=a.find("tr[index="+t.index+"]");if(o=a.scrollTop(),a.find("tr.w2ui-selected").removeClass("w2ui-selected"),l.addClass("w2ui-selected"),l.length>0){var u=l[0].offsetTop-5,c=a.height();a.scrollTop(o),(u<o||u+l.height()>o+c)&&a.animate({scrollTop:u-(c-2*l.height())/2},200,"linear")}f()}else{1===arguments.length?t=e:t.items=e,"object"!=typeof t&&(t={}),t=$.extend({},n,t),$.fn.w2menuOptions=t,t.name&&(s="-"+t.name),"function"==typeof t.select&&"function"!=typeof t.onSelect&&(t.onSelect=t.select),"function"==typeof t.remove&&"function"!=typeof t.onRemove&&(t.onRemove=t.remove),"function"==typeof t.onRender&&"function"!=typeof t.render&&(t.render=t.onRender),$.fn.w2menuClick=function(e,i,n){var r=!1,o=$(e.target).closest("tr");if((e.shiftKey||e.metaKey||e.ctrlKey)&&(r=!0),items=null==n?t.items:t.items[n].items,$(e.target).hasClass("remove"))"function"==typeof t.onRemove&&t.onRemove({index:i,parentIndex:n,item:items[i],keepOpen:r,originalEvent:e}),r=!t.hideOnRemove,$(e.target).closest("tr").remove(),f();else if(o.hasClass("has-sub-menu"))r=!0,o.hasClass("expanded")?(items[i].expanded=!1,o.removeClass("expanded").addClass("collapsed").next().hide()):(items[i].expanded=!0,o.addClass("expanded").removeClass("collapsed").next().show()),f();else if("function"==typeof t.onSelect){var a=items;"function"==typeof items&&(a=items(t.items[n])),null!=a[i].keepOpen&&(r=a[i].keepOpen),t.onSelect({index:i,parentIndex:n,item:a[i],keepOpen:r,originalEvent:e})}if(null==items[i]||!0!==items[i].keepOpen){var l=$("#w2ui-overlay"+s);l.removeData("keepOpen"),l.length>0&&"function"==typeof l[0].hide&&!r&&l[0].hide()}},$.fn.w2menuDown=function(e,i,n){var r,s=$(e.target).closest("tr"),o=$(s.get(0)).find(".w2ui-icon"),a=(r=null==n?t.items:t.items[n].items)[i];"check"!==t.type&&"radio"!==t.type||!1===a.group||$(e.target).hasClass("remove")||$(e.target).closest("tr").hasClass("has-sub-menu")||(a.checked=!a.checked,a.checked?("radio"===t.type&&o.parents("table").find(".w2ui-icon").removeClass("w2ui-icon-check").addClass("w2ui-icon-empty"),"check"===t.type&&null!=a.group&&r.forEach((function(e,t){e.id!=a.id&&e.group===a.group&&e.checked&&(o.closest("table").find("tr[index="+t+"] .w2ui-icon").removeClass("w2ui-icon-check").addClass("w2ui-icon-empty"),r[t].checked=!1)})),o.removeClass("w2ui-icon-empty").addClass("w2ui-icon-check")):"check"===t.type&&null==a.group&&!1!==a.group&&o.removeClass("w2ui-icon-check").addClass("w2ui-icon-empty")),s.parent().find("tr").removeClass("w2ui-selected"),s.addClass("w2ui-selected")};var d="";if(t.search){d+='<div style="position: absolute; top: 0px; height: 40px; left: 0px; right: 0px; border-bottom: 1px solid silver; background-color: #ECECEC; padding: 8px 5px;">    <div class="w2ui-icon icon-search" style="position: absolute; margin-top: 4px; margin-left: 6px; width: 11px; background-position: left !important;"></div>    <input id="menu-search" type="text" style="width: 100%; outline: none; padding-left: 20px;" onclick="event.stopPropagation();"/></div>',t.style+=";background-color: #ECECEC",t.index=0;for(var h=0;h<t.items.length;h++)t.items[h].hidden=!1}d+=(t.topHTML||"")+'<div class="w2ui-menu" style="top: '+(t.search?40:0)+"px;"+(t.menuStyle||"")+'">'+m()+"</div>",i=$(this).w2overlay(d,t),setTimeout((function(){if($("#w2ui-overlay"+s+" #menu-search").on("keyup",g).on("keydown",(function(e){9===e.keyCode&&(e.stopPropagation(),e.preventDefault())})),t.search){if(-1!==["text","password"].indexOf($(r)[0].type)||"TEXTAREA"===$(r)[0].tagName.toUpperCase())return;$("#w2ui-overlay"+s+" #menu-search").focus()}f()}),250),f();var p=$("#w2ui-overlay"+s);p.length>0&&(p[0].mresize=f,p[0].change=g)}return i;function f(){setTimeout((function(){$("#w2ui-overlay"+s+" tr.w2ui-selected").removeClass("w2ui-selected");var e=$("#w2ui-overlay"+s+" tr[index="+t.index+"]"),i=$("#w2ui-overlay"+s+" div.w2ui-menu").scrollTop();if(e.addClass("w2ui-selected"),t.tmp&&(t.tmp.contentHeight=$("#w2ui-overlay"+s+" table").height()+(t.search?50:10)+(parseInt($("#w2ui-overlay"+s+" .w2ui-menu").css("top"))||0)+(parseInt($("#w2ui-overlay"+s+" .w2ui-menu").css("bottom"))||0),t.tmp.contentWidth=$("#w2ui-overlay"+s+" table").width()),$("#w2ui-overlay"+s).length>0&&$("#w2ui-overlay"+s)[0].resize(),e.length>0){var n=e[0].offsetTop-5,r=$("#w2ui-overlay"+s+" div.w2ui-menu").height();$("#w2ui-overlay"+s+" div.w2ui-menu").scrollTop(i),(n<i||n+e.height()>i+r)&&$("#w2ui-overlay"+s+" div.w2ui-menu").animate({scrollTop:n-(r-2*e.height())/2},200,"linear")}}),1)}function g(e){var i=this.value,n=!1;switch(e.keyCode){case 13:$("#w2ui-overlay"+s).remove(),$.fn.w2menuClick(e,t.index);break;case 9:case 27:$("#w2ui-overlay"+s).remove(),$.fn.w2menuClick(e,-1);break;case 38:for(t.index=w2utils.isInt(t.index)?parseInt(t.index):0,t.index--;t.index>0&&t.items[t.index].hidden;)t.index--;if(0===t.index&&t.items[t.index].hidden)for(;t.items[t.index]&&t.items[t.index].hidden;)t.index++;t.index<0&&(t.index=0),n=!0;break;case 40:for(t.index=w2utils.isInt(t.index)?parseInt(t.index):0,t.index++;t.index<t.items.length-1&&t.items[t.index].hidden;)t.index++;if(t.index===t.items.length-1&&t.items[t.index].hidden)for(;t.items[t.index]&&t.items[t.index].hidden;)t.index--;t.index>=t.items.length&&(t.index=t.items.length-1),n=!0}if(!n){for(var o=0,a=0;a<t.items.length;a++){var l=t.items[a],u="",c="";-1!==["is","begins with"].indexOf(t.match)&&(u="^"),-1!==["is","ends with"].indexOf(t.match)&&(c="$");try{new RegExp(u+i+c,"i").test(l.text)||"..."===l.text?l.hidden=!1:l.hidden=!0}catch(e){}"enum"===r.type&&-1!==$.inArray(l.id,ids)&&(l.hidden=!0),!0!==l.hidden&&o++}for(t.index=0;t.index<t.items.length-1&&t.items[t.index].hidden;)t.index++;o<=0&&(t.index=-1)}$(r).w2menu("refresh",t),f()}function m(e,i,n,r){if(t.spinner)return'<table><tbody><tr><td style="padding: 5px 10px 13px 10px; text-align: center">    <div class="w2ui-spinner" style="width: 18px; height: 18px; position: relative; top: 5px;"></div>     <div style="display: inline-block; padding: 3px; color: #999;">'+w2utils.lang("Loading...")+"</div></td></tr></tbody></table>";var s=0,o='<table cellspacing="0" cellpadding="0" class="'+(i?" sub-menu":"")+'"><tbody>',a=null,l=null;null==e&&(e=t.items),Array.isArray(e)||(e=[]);for(var u=0;u<e.length;u++){var c=e[u];if("string"==typeof c?c={id:c,text:c}:(null!=c.text&&null==c.id&&(c.id=c.text),null==c.text&&null!=c.id&&(c.text=c.id),null!=c.caption&&(c.text=c.caption),null==(a=c.img)&&(a=null),null==(l=c.icon)&&(l=null)),-1==["radio","check"].indexOf(t.type)||Array.isArray(c.items)||!1===c.group||(l=!0===c.checked?"w2ui-icon-check":"w2ui-icon-empty"),!0!==c.hidden){var d="",h=c.text,p="";if("function"==typeof t.render&&(h=t.render(c,t)),"function"==typeof h&&(h=h(c,t)),a&&(d='<td class="menu-icon"><div class="w2ui-tb-image w2ui-icon '+a+'"></div></td>'),l&&(d='<td class="menu-icon" align="center"><span class="w2ui-icon '+l+'"></span></td>'),"break"!==c.type&&null!=h&&""!==h&&"--"!=String(h).substr(0,2)){var f=s%2==0?"w2ui-item-even":"w2ui-item-odd";!0!==t.altRows&&(f="");var g=1;""===d&&g++,null==c.count&&null==c.hotkey&&!0!==c.remove&&null==c.items&&g++,null==c.tooltip&&null!=c.hint&&(c.tooltip=c.hint);var v="";if(!0===c.remove)v='<span class="remove">X</span>';else if(null!=c.items){var y=[];"function"==typeof c.items?y=c.items(c):Array.isArray(c.items)&&(y=c.items),v="<span></span>",p='<tr style="'+(c.expanded?"":"display: none")+'">     <td colspan="3">'+m(y,!0,c.expanded,u)+"</td><tr>"}else null!=c.count&&(v+="<span>"+c.count+"</span>"),null!=c.hotkey&&(v+='<span class="hotkey">'+c.hotkey+"</span>");o+='<tr index="'+u+'" style="'+(c.style?c.style:"")+'" '+(c.tooltip?'title="'+w2utils.lang(c.tooltip)+'"':"")+' class="'+f+(t.index===u?" w2ui-selected":"")+(!0===c.disabled?" w2ui-disabled":"")+(""!==p?" has-sub-menu"+(c.expanded?" expanded":" collapsed"):"")+'"        onmousedown="if ('+(!0===c.disabled?"true":"false")+") return;               jQuery.fn.w2menuDown(event, "+u+",  "+r+');"        onclick="event.stopPropagation();                if ('+(!0===c.disabled?"true":"false")+") return;               jQuery.fn.w2menuClick(event, "+u+",  "+r+');">'+(i?"<td></td>":"")+d+'   <td class="menu-text" colspan="'+g+'">'+w2utils.lang(h)+'</td>   <td class="menu-count">'+v+"</td></tr>"+p,s++}else{var w=h.replace(/^-+/g,"");o+='<tr><td colspan="3" class="menu-divider '+(""!=w?"divider-text":"")+'">   <div class="line">'+w+'</div>   <div class="text">'+w+"</div></td></tr>"}}e[u]=c}return 0===s&&t.msgNoItems&&(o+='<tr><td style="padding: 13px; color: #999; text-align: center">'+t.msgNoItems+"</div></td></tr>"),o+"</tbody></table>"}},$.fn.w2color=function(e,t){var i=$(this),n=i[0];if(i.data("skipInit"))i.removeData("skipInit");else{var r=[-1,-1];null==$.fn.w2colorPalette&&($.fn.w2colorPalette=[["000000","333333","555555","777777","888888","999999","AAAAAA","CCCCCC","DDDDDD","EEEEEE","F7F7F7","FFFFFF"],["FF011B","FF9838","FFC300","FFFD59","86FF14","14FF7A","2EFFFC","2693FF","006CE7","9B24F4","FF21F5","FF0099"],["FFEAEA","FCEFE1","FCF4DC","FFFECF","EBFFD9","D9FFE9","E0FFFF","E8F4FF","ECF4FC","EAE6F4","FFF5FE","FCF0F7"],["F4CCCC","FCE5CD","FFF1C2","FFFDA1","D5FCB1","B5F7D0","BFFFFF","D6ECFF","CFE2F3","D9D1E9","FFE3FD","FFD9F0"],["EA9899","F9CB9C","FFE48C","F7F56F","B9F77E","84F0B1","83F7F7","B5DAFF","9FC5E8","B4A7D6","FAB9F6","FFADDE"],["E06666","F6B26B","DEB737","E0DE51","8FDB48","52D189","4EDEDB","76ACE3","6FA8DC","8E7CC3","E07EDA","F26DBD"],["CC0814","E69138","AB8816","B5B20E","6BAB30","27A85F","1BA8A6","3C81C7","3D85C6","674EA7","A14F9D","BF4990"],["99050C","B45F17","80650E","737103","395E14","10783D","13615E","094785","0A5394","351C75","780172","782C5A"]]);var s,o=$.fn.w2colorPalette;"string"==typeof e&&(e={color:e,transparent:!0}),null==e.onSelect&&null!=t&&(e.onSelect=t),e.transparent&&"333333"==o[0][1]&&(o[0].splice(1,1),o[0].push("")),e.transparent||"333333"==o[0][1]||(o[0].splice(1,0,"333333"),o[0].pop()),e.color&&(e.color=String(e.color).toUpperCase()),"string"==typeof e.color&&"#"===e.color.substr(0,1)&&(e.color=e.color.substr(1)),null==e.fireChange&&(e.fireChange=!0),0===$("#w2ui-overlay").length?$(n).w2overlay(v(e),e):($("#w2ui-overlay .w2ui-colors").parent().html(v(e)),$("#w2ui-overlay").show()),$("#w2ui-overlay .w2ui-color").off(".w2color").on("mousedown.w2color",(function(t){var i=$(t.originalEvent.target).attr("name");r=$(t.originalEvent.target).attr("index").split(":"),"INPUT"===n.tagName.toUpperCase()?(e.fireChange&&$(n).change(),$(n).next().find(">div").css("background-color",i)):$(n).data("_color",i),"function"==typeof e.onSelect&&e.onSelect(i)})).on("mouseup.w2color",(function(){setTimeout((function(){$("#w2ui-overlay").length>0&&$("#w2ui-overlay").removeData("keepOpen")[0].hide()}),10)})),$("#w2ui-overlay .color-original").off(".w2color").on("click.w2color",(function(e){var t=w2utils.parseColor($(e.target).css("background-color"));null!=t&&(l=t,a=w2utils.rgb2hsv(l),u(a),c(),d())})),$("#w2ui-overlay input").off(".w2color").on("mousedown.w2color",(function(e){$("#w2ui-overlay").data("keepOpen",!0),setTimeout((function(){$("#w2ui-overlay").data("keepOpen",!0)}),10),e.stopPropagation()})).on("change.w2color",(function(){var e=$(this),t=parseFloat(e.val()),i=parseFloat(e.attr("max"));isNaN(t)&&(t=0),i>1&&(t=parseInt(t)),i>0&&t>i&&(e.val(i),t=i),t<0&&(e.val(0),t=0);var n=e.attr("name"),r={};-1!==["r","g","b","a"].indexOf(n)?(l[n]=t,a=w2utils.rgb2hsv(l)):-1!==["h","s","v"].indexOf(n)&&(r[n]=t),u(r),c(),d()}));var a,l=w2utils.parseColor(e.color);null==l&&(l={r:140,g:150,b:160,a:1},a=w2utils.rgb2hsv(l)),a=w2utils.rgb2hsv(l);var u=function(t,i){null!=t.h&&(a.h=t.h),null!=t.s&&(a.s=t.s),null!=t.v&&(a.v=t.v),null!=t.a&&(l.a=t.a,a.a=t.a);var r="rgba("+(l=w2utils.hsv2rgb(a)).r+","+l.g+","+l.b+","+l.a+")",s=[Number(l.r).toString(16).toUpperCase(),Number(l.g).toString(16).toUpperCase(),Number(l.b).toString(16).toUpperCase(),Math.round(255*Number(l.a)).toString(16).toUpperCase()];s.forEach((function(e,t){1===e.length&&(s[t]="0"+e)})),r=s[0]+s[1]+s[2]+s[3],1===l.a&&(r=s[0]+s[1]+s[2]),$("#w2ui-overlay .color-preview").css("background-color","#"+r),$("#w2ui-overlay input").each((function(e,t){t.name&&(null!=l[t.name]&&(t.value=l[t.name]),null!=a[t.name]&&(t.value=a[t.name]),"a"===t.name&&(t.value=l.a))})),i?$("#w2ui-overlay .color-original").css("background-color","#"+r):("INPUT"===n.tagName.toUpperCase()?($(n).val(r).data("skipInit",!0),e.fireChange&&$(n).change(),$(n).next().find(">div").css("background-color","#"+r)):$(n).data("_color",r),"function"==typeof e.onSelect&&e.onSelect(r))},c=function(){var e=$("#w2ui-overlay .palette .value1"),t=$("#w2ui-overlay .rainbow .value2"),i=$("#w2ui-overlay .alpha .value2"),n=parseInt(e.width())/2,r=parseInt(t.width())/2;e.css({left:150*a.s/100-n,top:125*(100-a.v)/100-n}),t.css("left",a.h/2.4-r),i.css("left",150*l.a-r)},d=function(){var e=w2utils.hsv2rgb(a.h,100,100),t=e.r+","+e.g+","+e.b;$("#w2ui-overlay .palette").css("background-image","linear-gradient(90deg, rgba("+t+",0) 0%, rgba("+t+",1) 100%)")},h=function(e){var t=$(this).find(".value1, .value2"),i=parseInt(t.width())/2;t.hasClass("move-x")&&t.css({left:e.offsetX-i+"px"}),t.hasClass("move-y")&&t.css({top:e.offsetY-i+"px"}),s={$el:t,x:e.pageX,y:e.pageY,width:t.parent().width(),height:t.parent().height(),left:parseInt(t.css("left")),top:parseInt(t.css("top"))},f(e),$("body").off(".w2color").on(m,f).on(g,p)},p=function(e){$("body").off(".w2color")},f=function(e){var t=s.$el,i=e.pageX-s.x,n=e.pageY-s.y,r=s.left+i,o=s.top+n,a=parseInt(t.width())/2;r<-a&&(r=-a),o<-a&&(o=-a),r>s.width-a&&(r=s.width-a),o>s.height-a&&(o=s.height-a),t.hasClass("move-x")&&t.css({left:r+"px"}),t.hasClass("move-y")&&t.css({top:o+"px"});var l=t.parent().attr("name"),c=parseInt(t.css("left"))+a,h=parseInt(t.css("top"))+a;if("palette"===l&&u({s:Math.round(c/s.width*100),v:Math.round(100-h/s.height*100)}),"rainbow"===l){var p=Math.round(2.4*c);u({h:p}),d()}"alpha"===l&&u({a:parseFloat(Number(c/150).toFixed(2))})};!0!==$.fn._colorAdvanced&&!0!==e.advanced||($("#w2ui-overlay .w2ui-color-tabs :nth-child(2)").click(),$("#w2ui-overlay").removeData("keepOpen")),u({},!0),d(),c();var g="mouseup.w2color",m="mousemove.w2color";w2utils.isIOS&&(g="touchend.w2color",m="touchmove.w2color  "),$("#w2ui-overlay .palette").off(".w2color").on("mousedown.w2color",h),$("#w2ui-overlay .rainbow").off(".w2color").on("mousedown.w2color",h),$("#w2ui-overlay .alpha").off(".w2color").on("mousedown.w2color",h),n.nav=function(e){switch(e){case"up":r[0]--;break;case"down":r[0]++;break;case"right":r[1]++;break;case"left":r[1]--}return r[0]<0&&(r[0]=0),r[0]>o.length-2&&(r[0]=o.length-2),r[1]<0&&(r[1]=0),r[1]>o[0].length-1&&(r[1]=o[0].length-1),color=o[r[0]][r[1]],$(n).data("_color",color),color}}function v(e){e.color;for(var t,i='<div class="w2ui-colors" onmousedown="jQuery(this).parents(\'.w2ui-overlay\').data(\'keepOpen\', true)"><div class="w2ui-color-palette"><table cellspacing="5"><tbody>',n=0;n<o.length;n++){i+="<tr>";for(var s=0;s<o[n].length;s++)t="FFFFFF"===o[n][s]?";border: 1px solid #efefef":"",i+='<td>    <div class="w2ui-color '+(""===o[n][s]?"w2ui-no-color":"")+'" style="background-color: #'+o[n][s]+t+';"        name="'+o[n][s]+'" index="'+n+":"+s+'">'+(e.color==o[n][s]?"&#149;":"&#160;")+"    </div></td>",e.color==o[n][s]&&(r=[n,s]);i+="</tr>",n<2&&(i+='<tr><td style="height: 8px" colspan="8"></td></tr>')}return i+="</tbody></table></div>",(i+='<div class="w2ui-color-advanced" style="display: none">   <div class="color-info">       <div class="color-preview-bg"><div class="color-preview"></div><div class="color-original"></div></div>       <div class="color-part">           <span>H</span> <input name="h" maxlength="3" max="360" tabindex="101">           <span>R</span> <input name="r" maxlength="3" max="255" tabindex="104">       </div>       <div class="color-part">           <span>S</span> <input name="s" maxlength="3" max="100" tabindex="102">           <span>G</span> <input name="g" maxlength="3" max="255" tabindex="105">       </div>       <div class="color-part">           <span>V</span> <input name="v" maxlength="3" max="100" tabindex="103">           <span>B</span> <input name="b" maxlength="3" max="255" tabindex="106">       </div>       <div class="color-part" style="margin: 30px 0px 0px 2px">           <span style="width: 40px">Opacity</span>            <input name="a" maxlength="5" max="1" style="width: 32px !important" tabindex="107">       </div>   </div>   <div class="palette" name="palette">       <div class="palette-bg"></div>       <div class="value1 move-x move-y"></div>   </div>   <div class="rainbow" name="rainbow">       <div class="value2 move-x"></div>   </div>   <div class="alpha" name="alpha">       <div class="alpha-bg"></div>       <div class="value2 move-x"></div>   </div></div>')+"<div class=\"w2ui-color-tabs\">   <div class=\"w2ui-color-tab selected\" onclick=\"jQuery(this).addClass('selected').next().removeClass('selected').parents('.w2ui-overlay').find('.w2ui-color-advanced').hide().parent().find('.w2ui-color-palette').show(); jQuery.fn._colorAdvanced = false; jQuery('#w2ui-overlay')[0].resize()\"><span class=\"w2ui-icon w2ui-icon-colors\"></span></div>   <div class=\"w2ui-color-tab\" onclick=\"jQuery(this).addClass('selected').prev().removeClass('selected').parents('.w2ui-overlay').find('.w2ui-color-advanced').show().parent().find('.w2ui-color-palette').hide(); jQuery.fn._colorAdvanced = true; jQuery('#w2ui-overlay')[0].resize()\"><span class=\"w2ui-icon w2ui-icon-settings\"></span></div>   <div style=\"padding: 8px; text-align: right;\">"+("string"==typeof e.html?e.html:"")+'</div></div></div><div style="clear: both; height: 0"></div>'}},function($){var w2grid=function(e){this.name=null,this.box=null,this.columns=[],this.columnGroups=[],this.records=[],this.summary=[],this.searches=[],this.sortMap={},this.toolbar={},this.ranges=[],this.menu=[],this.searchData=[],this.sortData=[],this.total=0,this.recid=null,this.last={field:"",label:"",logic:"OR",search:"",searchIds:[],selection:{indexes:[],columns:{}},multi:!1,scrollTop:0,scrollLeft:0,colStart:0,colEnd:0,sortData:null,sortCount:0,xhr:null,loaded:!1,range_start:null,range_end:null,sel_ind:null,sel_col:null,sel_type:null,edit_col:null,isSafari:/^((?!chrome|android).)*safari/i.test(navigator.userAgent)},$.extend(!0,this,w2obj.grid),this.show=$.extend(!0,{},w2grid.prototype.show),this.postData=$.extend(!0,{},w2grid.prototype.postData),this.routeData=$.extend(!0,{},w2grid.prototype.routeData),this.httpHeaders=$.extend(!0,{},w2grid.prototype.httpHeaders),this.buttons=$.extend(!0,{},w2grid.prototype.buttons),this.operators=$.extend(!0,{},w2grid.prototype.operators),this.operatorsMap=$.extend(!0,{},w2grid.prototype.operatorsMap),this.stateColProps=$.extend(!0,{},w2grid.prototype.stateColProps),this.stateColDefaults=$.extend(!0,{},w2grid.prototype.stateColDefaults),$.extend(!0,this,e)};$.fn.w2grid=function(e){if($.isPlainObject(e)){if(!w2utils.checkName(e,"w2grid"))return;var t,i=e.columns,n=e.columnGroups,r=e.records,s=e.searches,o=e.searchData,a=e.sortData,l=new w2grid(e);if($.extend(l,{records:[],columns:[],searches:[],sortData:[],searchData:[],handlers:[]}),i)for(t=0;t<i.length;t++)l.columns[t]=$.extend(!0,{},i[t]);if(n)for(t=0;t<n.length;t++)l.columnGroups[t]=$.extend(!0,{},n[t]);if(s)for(t=0;t<s.length;t++)l.searches[t]=$.extend(!0,{},s[t]);if(o)for(t=0;t<o.length;t++)l.searchData[t]=$.extend(!0,{},o[t]);if(a)for(t=0;t<a.length;t++)l.sortData[t]=$.extend(!0,{},a[t]);if(r)for(var u=0;u<r.length;u++){if(null!=r[u][l.recid]&&(r[u].recid=r[u][l.recid]),null==r[u].recid)return void console.log("ERROR: Cannot add records without recid. (obj: "+l.name+")");l.records[u]=$.extend(!0,{},r[u])}for(var c=0;c<l.columns.length;c++){var d=l.columns[c],h=d.searchable;if(null!=h&&!1!==h&&null==l.getSearch(d.field))if($.isPlainObject(h))l.addSearch($.extend({field:d.field,label:d.text,type:"text"},h));else{var p=d.searchable,f="";!0===d.searchable&&(p="text",f='size="20"'),l.addSearch({field:d.field,label:d.text,type:p,attr:f})}}return w2ui[l.name]=l,l.initToolbar(),l.updateToolbar(),0!==$(this).length&&l.render($(this)[0]),l}var g=w2ui[$(this).attr("name")];return g?arguments.length>0?(g[e]&&g[e].apply(g,Array.prototype.slice.call(arguments,1)),this):g:null},w2grid.prototype={header:"",url:"",limit:100,offset:0,postData:{},routeData:{},httpHeaders:{},show:{header:!1,toolbar:!1,footer:!1,columnHeaders:!0,lineNumbers:!1,orderColumn:!1,expandColumn:!1,selectColumn:!1,emptyRecords:!0,toolbarReload:!0,toolbarColumns:!0,toolbarSearch:!0,toolbarInput:!0,toolbarAdd:!1,toolbarEdit:!1,toolbarDelete:!1,toolbarSave:!1,searchAll:!0,searchHiddenMsg:!1,statusRange:!0,statusBuffered:!1,statusRecordID:!0,statusSelection:!0,statusResponse:!0,statusSort:!1,statusSearch:!1,recordTitles:!0,selectionBorder:!0,skipRecords:!0,saveRestoreState:!0},stateId:null,hasFocus:!1,autoLoad:!0,fixedBody:!0,recordHeight:24,lineNumberWidth:null,keyboard:!0,selectType:"row",multiSearch:!0,multiSelect:!0,multiSort:!0,reorderColumns:!1,reorderRows:!1,showExtraOnSearch:0,markSearch:!0,columnTooltip:"top|bottom",disableCVS:!1,textSearch:"begins",nestedFields:!0,vs_start:150,vs_extra:15,style:"",method:null,dataType:null,parser:null,stateColProps:{text:!1,field:!0,size:!0,min:!1,max:!1,gridMinWidth:!1,sizeCorrected:!1,sizeCalculated:!0,sizeOriginal:!0,sizeType:!0,hidden:!0,sortable:!1,searchable:!1,clipboardCopy:!1,resizable:!1,hideable:!1,attr:!1,style:!1,render:!1,title:!1,editable:!1,frozen:!0,info:!1},stateColDefaults:{text:"",field:"",size:null,min:20,max:null,gridMinWidth:null,sizeCorrected:null,sizeCalculated:null,sizeOriginal:null,sizeType:null,hidden:!1,sortable:!1,searchable:!1,clipboardCopy:!1,resizable:!0,hideable:!0,attr:"",style:"",render:null,title:null,editable:{},frozen:!1,info:null},msgDelete:"Are you sure you want to delete NN records?",msgDeleteBtn:"Delete",msgNotJSON:"Returned data is not in valid JSON format.",msgAJAXerror:"AJAX error. See console for more details.",msgRefresh:"Refreshing...",msgNeedReload:"Your remote data source record count has changed, reloading from the first record.",msgEmpty:"",buttons:{reload:{type:"button",id:"w2ui-reload",icon:"w2ui-icon-reload",tooltip:"Reload data in the list"},columns:{type:"drop",id:"w2ui-column-on-off",icon:"w2ui-icon-columns",tooltip:"Show/hide columns",arrow:!1,html:""},search:{type:"html",id:"w2ui-search",html:"<div class=\"w2ui-icon icon-search-down w2ui-search-down\" onclick=\"var grid = w2ui[jQuery(this).parents('div.w2ui-grid').attr('name')]; grid.searchShowFields()\"></div>"},"search-go":{type:"drop",id:"w2ui-search-advanced",icon:"w2ui-icon-search",text:"Search",tooltip:"Open Search Fields"},add:{type:"button",id:"w2ui-add",text:"Add New",tooltip:"Add new record",icon:"w2ui-icon-plus"},edit:{type:"button",id:"w2ui-edit",text:"Edit",tooltip:"Edit selected record",icon:"w2ui-icon-pencil",disabled:!0},delete:{type:"button",id:"w2ui-delete",text:"Delete",tooltip:"Delete selected records",icon:"w2ui-icon-cross",disabled:!0},save:{type:"button",id:"w2ui-save",text:"Save",tooltip:"Save changed records",icon:"w2ui-icon-check"}},operators:{text:["is","begins","contains","ends"],number:["=","between",">","<",">=","<="],date:["is","between",{oper:"less",text:"before"},{oper:"more",text:"after"}],list:["is"],hex:["is","between"],color:["is","begins","contains","ends"],enum:["in","not in"]},operatorsMap:{text:"text",int:"number",float:"number",money:"number",currency:"number",percent:"number",hex:"hex",alphanumeric:"text",color:"color",date:"date",time:"date",datetime:"date",list:"list",combo:"text",enum:"enum",file:"enum",select:"list",radio:"list",checkbox:"list",toggle:"list"},onAdd:null,onEdit:null,onRequest:null,onLoad:null,onDelete:null,onSave:null,onSelect:null,onUnselect:null,onClick:null,onDblClick:null,onContextMenu:null,onMenuClick:null,onColumnClick:null,onColumnDblClick:null,onColumnResize:null,onColumnAutoResize:null,onSort:null,onSearch:null,onSearchOpen:null,onChange:null,onRestore:null,onExpand:null,onCollapse:null,onError:null,onKeydown:null,onToolbar:null,onColumnOnOff:null,onCopy:null,onPaste:null,onSelectionExtend:null,onEditField:null,onRender:null,onRefresh:null,onReload:null,onResize:null,onDestroy:null,onStateSave:null,onStateRestore:null,onFocus:null,onBlur:null,onReorderRow:null,add:function(e,t){$.isArray(e)||(e=[e]);for(var i=0,n=0;n<e.length;n++){var r=e[n];null!=r[this.recid]&&(r.recid=r[this.recid]),null!=r.recid?(r.w2ui&&!0===r.w2ui.summary?t?this.summary.unshift(r):this.summary.push(r):t?this.records.unshift(r):this.records.push(r),i++):console.log("ERROR: Cannot add record without recid. (obj: "+this.name+")")}return("object"!=typeof this.url?this.url:this.url.get)?(this.refresh(),i):(this.total=this.records.length,this.localSort(!1,!0),this.localSearch(),this.refreshBody(),this.resizeRecords(),i)},find:function(e,t){null==e&&(e={});var i=[],n=!1;for(var r in e)-1!=String(r).indexOf(".")&&(n=!0);for(var s=0;s<this.records.length;s++){var o=!0;for(var r in e){var a=this.records[s][r];n&&-1!=String(r).indexOf(".")&&(a=this.parseField(this.records[s],r)),"not-null"==e[r]?null!=a&&""!==a||(o=!1):e[r]!=a&&(o=!1)}o&&!0!==t&&i.push(this.records[s].recid),o&&!0===t&&i.push(s)}return i},set:function(e,t,i){if("object"==typeof e&&null!==e&&(i=t,t=e,e=null),null==e){for(var n=0;n<this.records.length;n++)$.extend(!0,this.records[n],t);!0!==i&&this.refresh()}else{var r=this.get(e,!0);if(null==r)return!1;this.records[r]&&this.records[r].recid==e?$.extend(!0,this.records[r],t):$.extend(!0,this.summary[r],t),!0!==i&&this.refreshRow(e,r)}return!0},get:function(e,t){if($.isArray(e)){for(var i=[],n=0;n<e.length;n++){var r=this.get(e[n],t);null!==r&&i.push(r)}return i}var s=this.last.idCache;if(s||(this.last.idCache=s={}),"number"==typeof(n=s[e])){if(n>=0&&n<this.records.length&&this.records[n].recid==e)return!0===t?n:this.records[n];if((n=~n)>=0&&n<this.summary.length&&this.summary[n].recid==e)return!0===t?n:this.summary[n];this.last.idCache=s={}}for(n=0;n<this.records.length;n++)if(this.records[n].recid==e)return s[e]=n,!0===t?n:this.records[n];for(n=0;n<this.summary.length;n++)if(this.summary[n].recid==e)return s[e]=~n,!0===t?n:this.summary[n];return null},getFirst:function(){if(0==this.records.length)return null;var e=this.records[0].recid,t=this.last.searchIds;return this.searchData.length>0&&(e=Array.isArray(t)&&t.length>0?this.records[t[0]].recid:null),e},remove:function(){for(var e=0,t=0;t<arguments.length;t++){for(var i=this.records.length-1;i>=0;i--)this.records[i].recid==arguments[t]&&(this.records.splice(i,1),e++);for(i=this.summary.length-1;i>=0;i--)this.summary[i].recid==arguments[t]&&(this.summary.splice(i,1),e++)}var n="object"!=typeof this.url?this.url:this.url.get;return n||(this.localSort(!1,!0),this.localSearch()),this.refresh(),e},addColumn:function(e,t){var i=0;1==arguments.length?(t=e,e=this.columns.length):("string"==typeof e&&(e=this.getColumn(e,!0)),null==e&&(e=this.columns.length)),$.isArray(t)||(t=[t]);for(var n=0;n<t.length;n++){if(this.columns.splice(e,0,t[n]),t[n].searchable){var r=t[n].searchable,s="";!0===t[n].searchable&&(r="text",s='size="20"'),this.addSearch({field:t[n].field,label:t[n].label,type:r,attr:s})}e++,i++}return this.refresh(),i},removeColumn:function(){for(var e=0,t=0;t<arguments.length;t++)for(var i=this.columns.length-1;i>=0;i--)this.columns[i].field==arguments[t]&&(this.columns[i].searchable&&this.removeSearch(arguments[t]),this.columns.splice(i,1),e++);return this.refresh(),e},getColumn:function(e,t){if(0===arguments.length){for(var i=[],n=0;n<this.columns.length;n++)i.push(this.columns[n].field);return i}for(n=0;n<this.columns.length;n++)if(this.columns[n].field==e)return!0===t?n:this.columns[n];return null},updateColumn:function(e,t){var i=this,n=0;return(e=Array.isArray(e)?e:[e]).forEach((function(e){i.columns.forEach((function(i){if(i.field==e){var r=$.extend(!0,{},t);Object.keys(r).forEach((function(e){"function"==typeof r[e]&&(r[e]=r[e](i)),i[e]!=r[e]&&n++})),$.extend(!0,i,r)}}))})),n>0&&this.refresh(),n},toggleColumn:function(){return this.updateColumn(Array.from(arguments),{hidden:function(e){return!e.hidden}})},showColumn:function(){return this.updateColumn(Array.from(arguments),{hidden:!1})},hideColumn:function(){return this.updateColumn(Array.from(arguments),{hidden:!0})},addSearch:function(e,t){var i=0;1==arguments.length?(t=e,e=this.searches.length):("string"==typeof e&&(e=this.getSearch(e,!0)),null==e&&(e=this.searches.length)),$.isArray(t)||(t=[t]);for(var n=0;n<t.length;n++)this.searches.splice(e,0,t[n]),e++,i++;return this.searchClose(),i},removeSearch:function(){for(var e=0,t=0;t<arguments.length;t++)for(var i=this.searches.length-1;i>=0;i--)this.searches[i].field==arguments[t]&&(this.searches.splice(i,1),e++);return this.searchClose(),e},getSearch:function(e,t){if(0===arguments.length){for(var i=[],n=0;n<this.searches.length;n++)i.push(this.searches[n].field);return i}for(n=0;n<this.searches.length;n++)if(this.searches[n].field==e)return!0===t?n:this.searches[n];return null},toggleSearch:function(){for(var e=0,t=0;t<arguments.length;t++)for(var i=this.searches.length-1;i>=0;i--)this.searches[i].field==arguments[t]&&(this.searches[i].hidden=!this.searches[i].hidden,e++);return this.searchClose(),e},showSearch:function(){for(var e=0,t=0;t<arguments.length;t++)for(var i=this.searches.length-1;i>=0;i--)this.searches[i].field==arguments[t]&&!1!==this.searches[i].hidden&&(this.searches[i].hidden=!1,e++);return this.searchClose(),e},hideSearch:function(){for(var e=0,t=0;t<arguments.length;t++)for(var i=this.searches.length-1;i>=0;i--)this.searches[i].field==arguments[t]&&!0!==this.searches[i].hidden&&(this.searches[i].hidden=!0,e++);return this.searchClose(),e},getSearchData:function(e){for(var t=0;t<this.searchData.length;t++)if(this.searchData[t].field==e)return this.searchData[t];return null},localSort:function(e,t){if("object"!=typeof this.url?this.url:this.url.get)console.log("ERROR: grid.localSort can only be used on local data source, grid.url should be empty.");else if(!$.isEmptyObject(this.sortData)){var i=(new Date).getTime(),n=this;n.selectionSave(),n.prepareData(),t||n.reset();for(var r=0;r<this.sortData.length;r++){var s=this.getColumn(this.sortData[r].field);if(!s)return;"string"==typeof s.render&&(-1!=["date","age"].indexOf(s.render.split(":")[0])&&(this.sortData[r].field_=s.field+"_"),-1!=["time"].indexOf(s.render.split(":")[0])&&(this.sortData[r].field_=s.field+"_"))}return function(){for(var e=0;e<n.records.length;e++){var t=n.records[e];t.w2ui&&null!=t.w2ui.parent_recid&&(t.w2ui._path=o(t))}}(),this.records.sort((function(e,t){return function(e,t){if(!(e.w2ui&&null!=e.w2ui.parent_recid||t.w2ui&&null!=t.w2ui.parent_recid))return a(e,t);for(var i=o(e),n=o(t),r=0;r<Math.min(i.length,n.length);r++){var s=a(i[r],n[r]);if(0!==s)return s}return i.length>n.length?1:i.length<n.length?-1:(console.log("ERROR: two paths should not be equal."),0)}(e,t)})),function(){for(var e=0;e<n.records.length;e++){var t=n.records[e];t.w2ui&&null!=t.w2ui.parent_recid&&(t.w2ui._path=null)}}(),n.selectionRestore(t),i=(new Date).getTime()-i,!0!==e&&n.show.statusSort&&setTimeout((function(){n.status(w2utils.lang("Sorting took")+" "+i/1e3+" "+w2utils.lang("sec"))}),10),i}function o(e){if(!e.w2ui||null==e.w2ui.parent_recid)return[e];if(e.w2ui._path)return e.w2ui._path;var t=n.get(e.w2ui.parent_recid);return t?o(t).concat(e):(console.log("ERROR: no parent record: "+e.w2ui.parent_recid),[e])}function a(e,t){if(e===t)return 0;for(var i=0;i<n.sortData.length;i++){var r=n.sortData[i].field,s=n.sortData[i].field_?n.sortData[i].field_:r,o=e[s],a=t[s];-1!=String(r).indexOf(".")&&(o=n.parseField(e,s),a=n.parseField(t,s));var u=n.getColumn(r);if(u&&null!=u.editable&&($.isPlainObject(o)&&o.text&&(o=o.text),$.isPlainObject(a)&&a.text&&(a=a.text)),0!==(c=l(o,a,0,n.sortData[i].direction,u.sortMode||"default")))return c}var c;return l(e.recid,t.recid,0,"asc")}function l(e,t,i,n,r){if(e===t)return 0;if((null==e||""===e)&&null!=t&&""!==t)return 1;if(null!=e&&""!==e&&(null==t||""===t))return-1;var s="asc"===n.toLowerCase()?1:-1;if(typeof e!=typeof t)return typeof e>typeof t?s:-s;if(e.constructor.name!=t.constructor.name)return e.constructor.name>t.constructor.name?s:-s;e&&"object"==typeof e&&(e=e.valueOf()),t&&"object"==typeof t&&(t=t.valueOf());var o={}.toString;return e&&"object"==typeof e&&e.toString!=o&&(e=String(e)),t&&"object"==typeof t&&t.toString!=o&&(t=String(t)),"string"==typeof e&&(e=$.trim(e.toLowerCase())),"string"==typeof t&&(t=$.trim(t.toLowerCase())),"natural"===r&&(r=w2utils.naturalCompare),"function"==typeof r?r(e,t)*s:e>t?s:e<t?-s:0}},localSearch:function(e){var t="object"!=typeof this.url?this.url:this.url.get;if(!t){var i=(new Date).getTime(),n=this,r={}.toString,s={};if(this.total=this.records.length,this.last.searchIds=[],this.prepareData(),this.searchData.length>0&&!t){this.total=0;for(var o=0;o<this.records.length;o++){var a=this.records[o];if(d(a))if(a&&a.w2ui&&h(a.w2ui.parent_recid),this.showExtraOnSearch>0){var l=this.showExtraOnSearch,u=this.showExtraOnSearch;if(o<l&&(l=o),o+u>this.records.length&&(u=this.records.length-o),l>0)for(var c=o-l;c<o;c++)this.last.searchIds.indexOf(c)<0&&this.last.searchIds.push(c);if(this.last.searchIds.indexOf(o)<0&&this.last.searchIds.push(o),u>0)for(c=o+1;c<=o+u;c++)this.last.searchIds.indexOf(c)<0&&this.last.searchIds.push(c)}else this.last.searchIds.push(o)}this.total=this.last.searchIds.length}return i=(new Date).getTime()-i,!0!==e&&n.show.statusSearch&&setTimeout((function(){n.status(w2utils.lang("Search took")+" "+i/1e3+" "+w2utils.lang("sec"))}),10),i}function d(e){for(var t=0,i=!1,s=0;s<n.searchData.length;s++){var o=n.searchData[s],a=n.getSearch(o.field);if(null!=o){null==a&&(a={field:o.field,type:o.type});var l=n.parseField(e,a.field),u=null==l||"object"==typeof l&&l.toString==r?"":String(l).toLowerCase();if(null!=o.value)if($.isArray(o.value)){h=o.value[0];var c=o.value[1]}else var h=String(o.value).toLowerCase();switch(o.operator){case"=":case"is":if(n.parseField(e,a.field)==o.value)t++;else if("date"==a.type){var p=n.parseField(e,a.field+"_")instanceof Date?n.parseField(e,a.field+"_"):n.parseField(e,a.field);(u=w2utils.formatDate(p,"yyyy-mm-dd"))==(h=w2utils.formatDate(w2utils.isDate(h,w2utils.settings.dateFormat,!0),"yyyy-mm-dd"))&&t++}else"time"==a.type?(p=n.parseField(e,a.field+"_")instanceof Date?n.parseField(e,a.field+"_"):n.parseField(e,a.field),(u=w2utils.formatTime(p,"hh24:mi"))==(h=w2utils.formatTime(h,"hh24:mi"))&&t++):"datetime"==a.type&&(p=n.parseField(e,a.field+"_")instanceof Date?n.parseField(e,a.field+"_"):n.parseField(e,a.field),(u=w2utils.formatDateTime(p,"yyyy-mm-dd|hh24:mm:ss"))==(h=w2utils.formatDateTime(w2utils.isDateTime(h,w2utils.settings.datetimeFormat,!0),"yyyy-mm-dd|hh24:mm:ss"))&&t++);break;case"between":-1!=["int","float","money","currency","percent"].indexOf(a.type)?parseFloat(n.parseField(e,a.field))>=parseFloat(h)&&parseFloat(n.parseField(e,a.field))<=parseFloat(c)&&t++:"date"==a.type?(p=n.parseField(e,a.field+"_")instanceof Date?n.parseField(e,a.field+"_"):n.parseField(e,a.field),u=w2utils.isDate(p,w2utils.settings.dateFormat,!0),h=w2utils.isDate(h,w2utils.settings.dateFormat,!0),null!=(c=w2utils.isDate(c,w2utils.settings.dateFormat,!0))&&(c=new Date(c.getTime()+864e5)),u>=h&&u<c&&t++):"time"==a.type?(u=n.parseField(e,a.field+"_")instanceof Date?n.parseField(e,a.field+"_"):n.parseField(e,a.field),h=w2utils.isTime(h,!0),c=w2utils.isTime(c,!0),h=(new Date).setHours(h.hours,h.minutes,h.seconds?h.seconds:0,0),c=(new Date).setHours(c.hours,c.minutes,c.seconds?c.seconds:0,0),u>=h&&u<c&&t++):"datetime"==a.type&&(u=n.parseField(e,a.field+"_")instanceof Date?n.parseField(e,a.field+"_"):n.parseField(e,a.field),h=w2utils.isDateTime(h,w2utils.settings.datetimeFormat,!0),(c=w2utils.isDateTime(c,w2utils.settings.datetimeFormat,!0))&&(c=new Date(c.getTime()+864e5)),u>=h&&u<c&&t++);break;case"<=":i=!0;case"<":case"less":-1!=["int","float","money","currency","percent"].indexOf(a.type)?((u=parseFloat(n.parseField(e,a.field)))<(h=parseFloat(o.value))||i&&u===h)&&t++:"date"==a.type?(p=n.parseField(e,a.field+"_")instanceof Date?n.parseField(e,a.field+"_"):n.parseField(e,a.field),((u=w2utils.isDate(p,w2utils.settings.dateFormat,!0))<(h=w2utils.isDate(h,w2utils.settings.dateFormat,!0))||i&&u===h)&&t++):"time"==a.type?(p=n.parseField(e,a.field+"_")instanceof Date?n.parseField(e,a.field+"_"):n.parseField(e,a.field),((u=w2utils.formatTime(p,"hh24:mi"))<(h=w2utils.formatTime(h,"hh24:mi"))||i&&u===h)&&t++):"datetime"==a.type&&(p=n.parseField(e,a.field+"_")instanceof Date?n.parseField(e,a.field+"_"):n.parseField(e,a.field),u=w2utils.formatDateTime(p,"yyyy-mm-dd|hh24:mm:ss"),h=w2utils.formatDateTime(w2utils.isDateTime(h,w2utils.settings.datetimeFormat,!0),"yyyy-mm-dd|hh24:mm:ss"),u.length==h.length&&(u<h||i&&u===h)&&t++);break;case">=":i=!0;case">":case"more":-1!=["int","float","money","currency","percent"].indexOf(a.type)?((u=parseFloat(n.parseField(e,a.field)))>(h=parseFloat(o.value))||i&&u===h)&&t++:"date"==a.type?(p=n.parseField(e,a.field+"_")instanceof Date?n.parseField(e,a.field+"_"):n.parseField(e,a.field),((u=w2utils.isDate(p,w2utils.settings.dateFormat,!0))>(h=w2utils.isDate(h,w2utils.settings.dateFormat,!0))||i&&u===h)&&t++):"time"==a.type?(p=n.parseField(e,a.field+"_")instanceof Date?n.parseField(e,a.field+"_"):n.parseField(e,a.field),((u=w2utils.formatTime(p,"hh24:mi"))>(h=w2utils.formatTime(h,"hh24:mi"))||i&&u===h)&&t++):"datetime"==a.type&&(p=n.parseField(e,a.field+"_")instanceof Date?n.parseField(e,a.field+"_"):n.parseField(e,a.field),u=w2utils.formatDateTime(p,"yyyy-mm-dd|hh24:mm:ss"),h=w2utils.formatDateTime(w2utils.isDateTime(h,w2utils.settings.datetimeFormat,!0),"yyyy-mm-dd|hh24:mm:ss"),u.length==h.length&&(u>h||i&&u===h)&&t++);break;case"in":p=o.value,o.svalue&&(p=o.svalue),-1===p.indexOf(w2utils.isFloat(l)?parseFloat(l):l)&&-1===p.indexOf(u)||t++;break;case"not in":p=o.value,o.svalue&&(p=o.svalue),-1===p.indexOf(w2utils.isFloat(l)?parseFloat(l):l)&&-1===p.indexOf(u)&&t++;break;case"begins":case"begins with":0===u.indexOf(h)&&t++;break;case"contains":u.indexOf(h)>=0&&t++;break;case"null":null==n.parseField(e,a.field)&&t++;break;case"not null":null!=n.parseField(e,a.field)&&t++;break;case"ends":case"ends with":var f=u.lastIndexOf(h);-1!==f&&f==u.length-h.length&&t++}}}if("OR"==n.last.logic&&0!==t||"AND"==n.last.logic&&t==n.searchData.length)return!0;if(e.w2ui&&e.w2ui.children&&!0!==e.w2ui.expanded)for(var g=0;g<e.w2ui.children.length;g++)if(d(e.w2ui.children[g]))return!0;return!1}function h(e){if(void 0!==e&&!s[e]){s[e]=!0;var t=n.get(e,!0);if(null!=t&&-1==$.inArray(t,n.last.searchIds)){var i=n.records[t];i&&i.w2ui&&h(i.w2ui.parent_recid),n.last.searchIds.push(t)}}}console.log("ERROR: grid.localSearch can only be used on local data source, grid.url should be empty.")},getRangeData:function(e,t){var i=this.get(e[0].recid,!0),n=this.get(e[1].recid,!0),r=e[0].column,s=e[1].column,o=[];if(r==s)for(var a=i;a<=n;a++){var l=(u=this.records[a])[this.columns[r].field]||null;!0!==t?o.push(l):o.push({data:l,column:r,index:a,record:u})}else if(i==n)for(var u=this.records[i],c=r;c<=s;c++)l=u[this.columns[c].field]||null,!0!==t?o.push(l):o.push({data:l,column:c,index:i,record:u});else for(a=i;a<=n;a++)for(u=this.records[a],o.push([]),c=r;c<=s;c++)l=u[this.columns[c].field],!0!==t?o[o.length-1].push(l):o[o.length-1].push({data:l,column:c,index:a,record:u});return o},addRange:function(e){var t=0;if("row"==this.selectType)return t;$.isArray(e)||(e=[e]);for(var i=0;i<e.length;i++){if("object"!=typeof e[i]&&(e[i]={name:"selection"}),"selection"==e[i].name){if(!1===this.show.selectionBorder)continue;var n=this.getSelection();if(0===n.length){this.removeRange("selection");continue}var r=n[0],s=n[n.length-1]}else r=e[i].range[0],s=e[i].range[1];if(r){for(var o={name:e[i].name,range:[{recid:r.recid,column:r.column},{recid:s.recid,column:s.column}],style:e[i].style||""},a=!1,l=0;l<this.ranges.length;l++)if(this.ranges[l].name==e[i].name){a=l;break}!1!==a?this.ranges[a]=o:this.ranges.push(o),t++}}return this.refreshRanges(),t},removeRange:function(){for(var e=0,t=0;t<arguments.length;t++){var i=arguments[t];$("#grid_"+this.name+"_"+i).remove(),$("#grid_"+this.name+"_f"+i).remove();for(var n=this.ranges.length-1;n>=0;n--)this.ranges[n].name==i&&(this.ranges.splice(n,1),e++)}return e},refreshRanges:function(){if(0!==this.ranges.length){for(var e=this,t=(new Date).getTime(),i=$("#grid_"+this.name+"_frecords"),n=$("#grid_"+this.name+"_records"),r=0;r<this.ranges.length;r++){var s=this.ranges[r],o=s.range[0],a=s.range[1];null==o.index&&(o.index=this.get(o.recid,!0)),null==a.index&&(a.index=this.get(a.recid,!0));var l=$("#grid_"+this.name+"_rec_"+w2utils.escapeId(o.recid)+' td[col="'+o.column+'"]'),u=$("#grid_"+this.name+"_rec_"+w2utils.escapeId(a.recid)+' td[col="'+a.column+'"]'),c=$("#grid_"+this.name+"_frec_"+w2utils.escapeId(o.recid)+' td[col="'+o.column+'"]'),d=$("#grid_"+this.name+"_frec_"+w2utils.escapeId(a.recid)+' td[col="'+a.column+'"]'),h=a.column;o.column<this.last.colStart&&a.column>this.last.colStart&&(l=$("#grid_"+this.name+"_rec_"+w2utils.escapeId(o.recid)+' td[col="start"]')),o.column<this.last.colEnd&&a.column>this.last.colEnd&&(h='"end"',u=$("#grid_"+this.name+"_rec_"+w2utils.escapeId(a.recid)+' td[col="end"]'));var p=parseInt($("#grid_"+this.name+"_rec_top").next().attr("index")),f=parseInt($("#grid_"+this.name+"_rec_bottom").prev().attr("index")),g=parseInt($("#grid_"+this.name+"_frec_top").next().attr("index")),m=parseInt($("#grid_"+this.name+"_frec_bottom").prev().attr("index"));0===l.length&&o.index<p&&a.index>p&&(l=$("#grid_"+this.name+"_rec_top").next().find("td[col="+o.column+"]")),0===u.length&&a.index>f&&o.index<f&&(u=$("#grid_"+this.name+"_rec_bottom").prev().find("td[col="+h+"]")),0===c.length&&o.index<g&&a.index>g&&(c=$("#grid_"+this.name+"_frec_top").next().find("td[col="+o.column+"]")),0===d.length&&a.index>m&&o.index<m&&(d=$("#grid_"+this.name+"_frec_bottom").prev().find("td[col="+a.column+"]"));var v=$(this.box).find("#grid_"+this.name+"_editable").find(".w2ui-input"),y=v.attr("recid"),w=v.attr("column");if("selection"!=s.name||s.range[0].recid!=y||s.range[0].column!=w){var b=$("#grid_"+this.name+"_f"+s.name);if(c.length>0||d.length>0)if(0===b.length?(i.append('<div id="grid_'+this.name+"_f"+s.name+'" class="w2ui-selection" style="'+s.style+'">'+("selection"==s.name?'<div id="grid_'+this.name+'_resizer" class="w2ui-selection-resizer"></div>':"")+"</div>"),b=$("#grid_"+this.name+"_f"+s.name)):(b.attr("style",s.style),b.find(".w2ui-selection-resizer").show()),0===d.length&&(0===(d=$("#grid_"+this.name+"_frec_"+w2utils.escapeId(a.recid)+" td:last-child")).length&&(d=$("#grid_"+this.name+"_frec_bottom td:first-child")),b.css("border-right","0px"),b.find(".w2ui-selection-resizer").hide()),null!=o.recid&&null!=a.recid&&c.length>0&&d.length>0){var x=c.position().left-0+i.scrollLeft(),_=c.position().top-0+i.scrollTop();b.show().css({left:(x>0?x:0)+"px",top:(_>0?_:0)+"px",width:d.position().left-c.position().left+d.width()+2+"px",height:d.position().top-c.position().top+d.height()+1+"px"})}else b.hide();else b.hide();b=$("#grid_"+this.name+"_"+s.name),l.length>0||u.length>0?(0===b.length?(n.append('<div id="grid_'+this.name+"_"+s.name+'" class="w2ui-selection" style="'+s.style+'">'+("selection"==s.name?'<div id="grid_'+this.name+'_resizer" class="w2ui-selection-resizer"></div>':"")+"</div>"),b=$("#grid_"+this.name+"_"+s.name)):b.attr("style",s.style),0===l.length&&0===(l=$("#grid_"+this.name+"_rec_"+w2utils.escapeId(o.recid)+" td:first-child")).length&&(l=$("#grid_"+this.name+"_rec_top td:first-child")),0!==d.length&&b.css("border-left","0px"),null!=o.recid&&null!=a.recid&&l.length>0&&u.length>0?(x=l.position().left-0+n.scrollLeft(),_=l.position().top-0+n.scrollTop(),b.show().css({left:(x>0?x:0)+"px",top:(_>0?_:0)+"px",width:u.position().left-l.position().left+u.width()+2+"px",height:u.position().top-l.position().top+u.height()+1+"px"})):b.hide()):b.hide()}}$(this.box).find(".w2ui-selection-resizer").off("mousedown").on("mousedown",(function(t){var i=e.getSelection();e.last.move={type:"expand",x:t.screenX,y:t.screenY,divX:0,divY:0,recid:i[0].recid,column:i[0].column,originalRange:[{recid:i[0].recid,column:i[0].column},{recid:i[i.length-1].recid,column:i[i.length-1].column}],newRange:[{recid:i[0].recid,column:i[0].column},{recid:i[i.length-1].recid,column:i[i.length-1].column}]},$(document).off(".w2ui-"+e.name).on("mousemove.w2ui-"+e.name,C).on("mouseup.w2ui-"+e.name,T),t.preventDefault()})).off("dblclick").on("dblclick",(function(t){var i=e.trigger({phase:"before",type:"resizerDblClick",target:e.name,originalEvent:t});!0!==i.isCancelled&&e.trigger($.extend(i,{phase:"after"}))}));var k={phase:"before",type:"selectionExtend",target:e.name,originalRange:null,newRange:null};return(new Date).getTime()-t}function C(t){var i=e.last.move;if(i&&"expand"==i.type){var n,r;i.divX=t.screenX-i.x,i.divY=t.screenY-i.y;var s=t.originalEvent.target;if("TD"!=s.tagName.toUpperCase()&&(s=$(s).parents("td")[0]),null!=$(s).attr("col")&&(r=parseInt($(s).attr("col"))),s=$(s).parents("tr")[0],n=$(s).attr("recid"),i.newRange[1].recid!=n||i.newRange[1].column!=r){var o=$.extend({},i.newRange);if(i.newRange=[{recid:i.recid,column:i.column},{recid:n,column:r}],!0===(k=e.trigger($.extend(k,{originalRange:i.originalRange,newRange:i.newRange}))).isCancelled)return i.newRange=o,void(k.newRange=o);e.removeRange("grid-selection-expand"),e.addRange({name:"grid-selection-expand",range:k.newRange,style:"background-color: rgba(100,100,100,0.1); border: 2px dotted rgba(100,100,100,0.5);"})}}}function T(t){e.removeRange("grid-selection-expand"),delete e.last.move,$(document).off(".w2ui-"+e.name),e.trigger($.extend(k,{phase:"after"}))}},select:function(){if(0===arguments.length)return 0;(new Date).getTime();var e=0,t=this.last.selection;this.multiSelect||this.selectNone();var i=Array.prototype.slice.call(arguments);Array.isArray(i[0])&&(i=i[0]);var n={phase:"before",type:"select",target:this.name};1==i.length?(n.multiple=!1,$.isPlainObject(i[0])?(n.recid=i[0].recid,n.column=i[0].column):n.recid=i[0]):(n.multiple=!0,n.recids=i);var r=this.trigger(n);if(!0===r.isCancelled)return 0;if("row"==this.selectType)for(var s=0;s<i.length;s++){var o="object"==typeof i[s]?i[s].recid:i[s];if(null!=(p=this.get(o,!0))){var a=null,l=null;if((0!==this.searchData.length||p+1>=this.last.range_start&&p+1<=this.last.range_end)&&(a=$("#grid_"+this.name+"_frec_"+w2utils.escapeId(o)),l=$("#grid_"+this.name+"_rec_"+w2utils.escapeId(o))),"row"==this.selectType){if(-1!=t.indexes.indexOf(p))continue;t.indexes.push(p),a&&l&&(a.addClass("w2ui-selected").data("selected","yes").find(".w2ui-col-number").addClass("w2ui-row-selected"),l.addClass("w2ui-selected").data("selected","yes").find(".w2ui-col-number").addClass("w2ui-row-selected"),a.find(".w2ui-grid-select-check").prop("checked",!0)),e++}}}else{var u={};for(s=0;s<i.length;s++){o="object"==typeof i[s]?i[s].recid:i[s];var c="object"==typeof i[s]?i[s].column:null;if(u[o]=u[o]||[],$.isArray(c))u[o]=c;else if(w2utils.isInt(c))u[o].push(c);else for(var d=0;d<this.columns.length;d++)this.columns[d].hidden||u[o].push(parseInt(d))}var h=[];for(var o in u){var p;if(null!=(p=this.get(o,!0))){a=null,l=null,p+1>=this.last.range_start&&p+1<=this.last.range_end&&(a=$("#grid_"+this.name+"_rec_"+w2utils.escapeId(o)),l=$("#grid_"+this.name+"_frec_"+w2utils.escapeId(o)));var f=t.columns[p]||[];-1==t.indexes.indexOf(p)&&t.indexes.push(p);for(var g=0;g<u[o].length;g++)-1==f.indexOf(u[o][g])&&f.push(u[o][g]);for(f.sort((function(e,t){return e-t})),g=0;g<u[o].length;g++){var m=u[o][g];-1==h.indexOf(m)&&h.push(m),a&&(a.find("#grid_"+this.name+"_data_"+p+"_"+m).addClass("w2ui-selected"),a.find(".w2ui-col-number").addClass("w2ui-row-selected"),a.data("selected","yes"),a.find(".w2ui-grid-select-check").prop("checked",!0)),l&&(l.find("#grid_"+this.name+"_data_"+p+"_"+m).addClass("w2ui-selected"),l.find(".w2ui-col-number").addClass("w2ui-row-selected"),l.data("selected","yes"),l.find(".w2ui-grid-select-check").prop("checked",!0)),e++}t.columns[p]=f}}for(var v=0;v<h.length;v++)$(this.box).find("#grid_"+this.name+"_column_"+h[v]+" .w2ui-col-header").addClass("w2ui-col-selected")}t.indexes.sort((function(e,t){return e-t}));var y=this.records.length>0&&t.indexes.length==this.records.length,w=t.indexes.length>0&&0!==this.searchData.length&&t.indexes.length==this.last.searchIds.length;return y||w?$("#grid_"+this.name+"_check_all").prop("checked",!0):$("#grid_"+this.name+"_check_all").prop("checked",!1),this.status(),this.addRange("selection"),this.updateToolbar(t,y),this.trigger($.extend(r,{phase:"after"})),e},unselect:function(){var e=0,t=this.last.selection,i=Array.prototype.slice.call(arguments);Array.isArray(i[0])&&(i=i[0]);var n={phase:"before",type:"unselect",target:this.name};1==i.length?(n.multiple=!1,$.isPlainObject(i[0])?(n.recid=i[0].recid,n.column=i[0].column):n.recid=i[0]):(n.multiple=!0,n.recids=i);var r=this.trigger(n);if(!0===r.isCancelled)return 0;for(var s=0;s<i.length;s++){var o="object"==typeof i[s]?i[s].recid:i[s],a=this.get(o);if(null!=a){var l=this.get(a.recid,!0),u=$("#grid_"+this.name+"_frec_"+w2utils.escapeId(o)),c=$("#grid_"+this.name+"_rec_"+w2utils.escapeId(o));if("row"==this.selectType){if(-1==t.indexes.indexOf(l))continue;t.indexes.splice(t.indexes.indexOf(l),1),u.removeClass("w2ui-selected w2ui-inactive").removeData("selected").find(".w2ui-col-number").removeClass("w2ui-row-selected"),c.removeClass("w2ui-selected w2ui-inactive").removeData("selected").find(".w2ui-col-number").removeClass("w2ui-row-selected"),0!=u.length&&(u[0].style.cssText="height: "+this.recordHeight+"px; "+u.attr("custom_style"),c[0].style.cssText="height: "+this.recordHeight+"px; "+c.attr("custom_style")),u.find(".w2ui-grid-select-check").prop("checked",!1),e++}else{var d=i[s].column;if(!w2utils.isInt(d)){for(var h=[],p=0;p<this.columns.length;p++)this.columns[p].hidden||h.push({recid:o,column:p});return this.unselect(h)}var f=t.columns[l];if(!$.isArray(f)||-1==f.indexOf(d))continue;f.splice(f.indexOf(d),1),$("#grid_"+this.name+"_rec_"+w2utils.escapeId(o)).find(" > td[col="+d+"]").removeClass("w2ui-selected w2ui-inactive"),$("#grid_"+this.name+"_frec_"+w2utils.escapeId(o)).find(" > td[col="+d+"]").removeClass("w2ui-selected w2ui-inactive");var g=!1,m=!1;for(n=this.getSelection(),p=0;p<n.length;p++)n[p].column==d&&(g=!0),n[p].recid==o&&(m=!0);g||$(this.box).find(".w2ui-grid-columns td[col="+d+"] .w2ui-col-header, .w2ui-grid-fcolumns td[col="+d+"] .w2ui-col-header").removeClass("w2ui-col-selected"),m||$("#grid_"+this.name+"_frec_"+w2utils.escapeId(o)).find(".w2ui-col-number").removeClass("w2ui-row-selected"),e++,0===f.length&&(delete t.columns[l],t.indexes.splice(t.indexes.indexOf(l),1),u.removeData("selected"),u.find(".w2ui-grid-select-check").prop("checked",!1),c.removeData("selected"))}}}var v=this.records.length>0&&t.indexes.length==this.records.length,y=t.indexes.length>0&&0!==this.searchData.length&&t.indexes.length==this.last.searchIds.length;return v||y?$("#grid_"+this.name+"_check_all").prop("checked",!0):$("#grid_"+this.name+"_check_all").prop("checked",!1),this.status(),this.addRange("selection"),this.updateToolbar(t,v),this.trigger($.extend(r,{phase:"after"})),e},selectAll:function(){var e=(new Date).getTime();if(!1!==this.multiSelect){var t=this.trigger({phase:"before",type:"select",target:this.name,all:!0});if(!0!==t.isCancelled){for(var i="object"!=typeof this.url?this.url:this.url.get,n=this.last.selection,r=[],s=0;s<this.columns.length;s++)r.push(s);if(n.indexes=[],i||0===this.searchData.length){var o=this.records.length;for(0==this.searchData.length||i||(o=this.last.searchIds.length),s=0;s<o;s++)n.indexes.push(s),"row"!=this.selectType&&(n.columns[s]=r.slice())}else for(s=0;s<this.last.searchIds.length;s++)n.indexes.push(this.last.searchIds[s]),"row"!=this.selectType&&(n.columns[this.last.searchIds[s]]=r.slice());return"row"==this.selectType?($(this.box).find(".w2ui-grid-records tr").not(".w2ui-empty-record").addClass("w2ui-selected").data("selected","yes").find(".w2ui-col-number").addClass("w2ui-row-selected"),$(this.box).find(".w2ui-grid-frecords tr").not(".w2ui-empty-record").addClass("w2ui-selected").data("selected","yes").find(".w2ui-col-number").addClass("w2ui-row-selected"),$(this.box).find("input.w2ui-grid-select-check").prop("checked",!0)):($(this.box).find(".w2ui-grid-columns td .w2ui-col-header, .w2ui-grid-fcolumns td .w2ui-col-header").addClass("w2ui-col-selected"),$(this.box).find(".w2ui-grid-records tr .w2ui-col-number").addClass("w2ui-row-selected"),$(this.box).find(".w2ui-grid-records tr").not(".w2ui-empty-record").find(".w2ui-grid-data").not(".w2ui-col-select").addClass("w2ui-selected").data("selected","yes"),$(this.box).find(".w2ui-grid-frecords tr .w2ui-col-number").addClass("w2ui-row-selected"),$(this.box).find(".w2ui-grid-frecords tr").not(".w2ui-empty-record").find(".w2ui-grid-data").not(".w2ui-col-select").addClass("w2ui-selected").data("selected","yes"),$(this.box).find("input.w2ui-grid-select-check").prop("checked",!0)),1==(n=this.getSelection(!0)).length?this.toolbar.enable("w2ui-edit"):this.toolbar.disable("w2ui-edit"),n.length>=1?this.toolbar.enable("w2ui-delete"):this.toolbar.disable("w2ui-delete"),this.addRange("selection"),$("#grid_"+this.name+"_check_all").prop("checked",!0),this.status(),this.updateToolbar({indexes:n},!0),this.trigger($.extend(t,{phase:"after"})),(new Date).getTime()-e}}},selectNone:function(){var e=(new Date).getTime(),t=this.trigger({phase:"before",type:"unselect",target:this.name,all:!0});if(!0!==t.isCancelled){var i=this.last.selection;return"row"==this.selectType?($(this.box).find(".w2ui-grid-records tr.w2ui-selected").removeClass("w2ui-selected w2ui-inactive").removeData("selected").find(".w2ui-col-number").removeClass("w2ui-row-selected"),$(this.box).find(".w2ui-grid-frecords tr.w2ui-selected").removeClass("w2ui-selected w2ui-inactive").removeData("selected").find(".w2ui-col-number").removeClass("w2ui-row-selected"),$(this.box).find("input.w2ui-grid-select-check").prop("checked",!1)):($(this.box).find(".w2ui-grid-columns td .w2ui-col-header, .w2ui-grid-fcolumns td .w2ui-col-header").removeClass("w2ui-col-selected"),$(this.box).find(".w2ui-grid-records tr .w2ui-col-number").removeClass("w2ui-row-selected"),$(this.box).find(".w2ui-grid-frecords tr .w2ui-col-number").removeClass("w2ui-row-selected"),$(this.box).find(".w2ui-grid-data.w2ui-selected").removeClass("w2ui-selected w2ui-inactive").removeData("selected"),$(this.box).find("input.w2ui-grid-select-check").prop("checked",!1)),i.indexes=[],i.columns={},this.toolbar.disable("w2ui-edit","w2ui-delete"),this.removeRange("selection"),$("#grid_"+this.name+"_check_all").prop("checked",!1),this.status(),this.updateToolbar(i,!1),this.trigger($.extend(t,{phase:"after"})),(new Date).getTime()-e}},updateToolbar:function(e,t){var i=this,n=e&&e.indexes?e.indexes.length:0;function r(t,r){0===t.batch&&(n>0?i.toolbar.enable(r+t.id):i.toolbar.disable(r+t.id)),null!=t.batch&&!isNaN(t.batch)&&t.batch>0&&(n==t.batch?i.toolbar.enable(r+t.id):i.toolbar.disable(r+t.id)),"function"==typeof t.batch&&t.batch("cell"==i.selectType?e:e?e.indexes:null)}this.toolbar.items.forEach((function(e){r(e,""),Array.isArray(e.items)&&e.items.forEach((function(t){r(t,e.id+":")}))}))},getSelection:function(e){var t=[],i=this.last.selection;if("row"==this.selectType){for(var n=0;n<i.indexes.length;n++)this.records[i.indexes[n]]&&(!0===e?t.push(i.indexes[n]):t.push(this.records[i.indexes[n]].recid));return t}for(n=0;n<i.indexes.length;n++){var r=i.columns[i.indexes[n]];if(this.records[i.indexes[n]])for(var s=0;s<r.length;s++)t.push({recid:this.records[i.indexes[n]].recid,index:parseInt(i.indexes[n]),column:r[s]})}return t},search:function(e,t){for(var i="object"!=typeof this.url?this.url:this.url.get,n=[],r=this.last.multi,s=this.last.logic,o=this.last.field,a=this.last.search,l=!1,u=0;u<this.searches.length;u++)this.searches[u].hidden&&null!=this.searches[u].value&&(n.push({field:this.searches[u].field,operator:this.searches[u].operator||"is",type:this.searches[u].type,value:this.searches[u].value||""}),l=!0);if(0===arguments.length){for(a="",u=0;u<this.searches.length;u++){var c=this.searches[u],d=$("#grid_"+this.name+"_operator_"+u).val(),h=$("#grid_"+this.name+"_field_"+u),p=$("#grid_"+this.name+"_field2_"+u),f=h.val(),g=p.val(),m=null,v=null;if(-1!=["int","float","money","currency","percent"].indexOf(c.type)){var y=h.data("w2field"),w=p.data("w2field");y&&(f=y.clean(f)),w&&(g=w.clean(g))}if(-1!=["list","enum"].indexOf(c.type))if(f=h.data("selected")||{},$.isArray(f)){m=[];for(var b=0;b<f.length;b++)m.push(w2utils.isFloat(f[b].id)?parseFloat(f[b].id):String(f[b].id).toLowerCase()),delete f[b].hidden;$.isEmptyObject(f)&&(f="")}else v=f.text||"",f=f.id||"";if(""!==f&&null!=f||null!=g&&""!==g){var x={field:c.field,type:c.type,operator:d};"between"==d?$.extend(x,{value:[f,g]}):"in"==d&&"string"==typeof f||"not in"==d&&"string"==typeof f?$.extend(x,{value:f.split(",")}):$.extend(x,{value:f}),m&&$.extend(x,{svalue:m}),v&&$.extend(x,{text:v});try{"date"==c.type&&"between"==d&&(x.value[0]=f,x.value[1]=g),"date"==c.type&&"is"==d&&(x.value=f)}catch(e){}n.push(x),r=!0}}s="AND"}if("string"==typeof e&&(1==arguments.length&&(t=e,e="all"),o=e,a=t,r=!1,s=l?"AND":"OR",null!=t))if("all"==e.toLowerCase())if(this.searches.length>0)for(u=0;u<this.searches.length;u++){if(("text"==(c=this.searches[u]).type||"alphanumeric"==c.type&&w2utils.isAlphaNumeric(t)||"int"==c.type&&w2utils.isInt(t)||"float"==c.type&&w2utils.isFloat(t)||"percent"==c.type&&w2utils.isFloat(t)||("hex"==c.type||"color"==c.type)&&w2utils.isHex(t)||"currency"==c.type&&w2utils.isMoney(t)||"money"==c.type&&w2utils.isMoney(t)||"date"==c.type&&w2utils.isDate(t)||"time"==c.type&&w2utils.isTime(t)||"datetime"==c.type&&w2utils.isDateTime(t)||"datetime"==c.type&&w2utils.isDate(t)||"enum"==c.type&&w2utils.isAlphaNumeric(t)||"list"==c.type&&w2utils.isAlphaNumeric(t))&&(x={field:c.field,type:c.type,operator:null!=c.operator?c.operator:"text"==c.type?this.textSearch:"is",value:t},""!=$.trim(t)&&n.push(x)),-1!=["int","float","money","currency","percent"].indexOf(c.type)&&2==$.trim(String(t)).split("-").length){var _=$.trim(String(t)).split("-");x={field:c.field,type:c.type,operator:null!=c.operator?c.operator:"between",value:[_[0],_[1]]},n.push(x)}if(-1!=["list","enum"].indexOf(c.type)){var k=[];for(null==c.options&&(c.options={}),Array.isArray(c.options.items)||(c.options.items=[]),b=0;b<c.options.items;b++){x=c.options.items[b];try{var C=new RegExp(t,"i");C.test(x)&&k.push(b),x.text&&C.test(x.text)&&k.push(x.id)}catch(e){}}k.length>0&&(x={field:c.field,type:c.type,operator:null!=c.operator?c.operator:"in",value:k},n.push(x))}}else for(u=0;u<this.columns.length;u++)x={field:this.columns[u].field,type:"text",operator:this.textSearch,value:t},n.push(x);else{var T=$("#grid_"+this.name+"_search_all");if(null==(c=this.getSearch(e))&&(c={field:e,type:"text"}),c.field==e&&(this.last.label=c.label),""!==t){var S=this.textSearch,O=t;if(-1!=["date","time","datetime"].indexOf(c.type)&&(S="is"),-1!=["list","enum"].indexOf(c.type)&&(S="is",O=(x=T.data("selected"))&&!$.isEmptyObject(x)?x.id:""),"int"==c.type&&""!==t&&(S="is",-1!=String(t).indexOf("-")&&2==(x=t.split("-")).length&&(S="between",O=[parseInt(x[0]),parseInt(x[1])]),-1!=String(t).indexOf(",")))for(x=t.split(","),S="in",O=[],u=0;u<x.length;u++)O.push(x[u]);null!=c.operator&&(S=c.operator),x={field:c.field,type:c.type,operator:S,value:O},n.push(x)}}if($.isArray(e)){var E="AND";for("string"==typeof t&&"OR"!=(E=t.toUpperCase())&&"AND"!=E&&(E="AND"),a="",r=!0,s=E,u=0;u<e.length;u++){var I=e[u];"number"==typeof I.value&&(I.operator="is"),"string"==typeof I.value&&(I.operator=this.textSearch),$.isArray(I.value)&&(I.operator="in"),n.push(I)}}var D=this.trigger({phase:"before",type:"search",target:this.name,multi:0===arguments.length,searchField:e||"multi",searchValue:e?t:"multi",searchData:n,searchLogic:s});!0!==D.isCancelled&&(this.searchData=D.searchData,this.last.field=o,this.last.search=a,this.last.multi=r,this.last.logic=D.searchLogic,this.last.scrollTop=0,this.last.scrollLeft=0,this.last.selection.indexes=[],this.last.selection.columns={},this.searchClose(),i?(this.last.xhr_offset=0,this.reload()):(this.localSearch(),this.refresh()),this.trigger($.extend(D,{phase:"after"})))},searchOpen:function(){if(this.box&&0!==this.searches.length){var e=this,t=e.toolbar.get("w2ui-search-advanced"),i="#tb_"+e.toolbar.name+"_item_"+w2utils.escapeId(t.id)+" table.w2ui-button",n=this.trigger({phase:"before",type:"searchOpen",target:this.name});!0!==n.isCancelled?$("#tb_"+this.name+"_toolbar_item_w2ui-search-advanced").w2overlay({html:this.getSearchesHTML(),name:this.name+"-searchOverlay",left:-10,class:"w2ui-grid-searches",onShow:function(){e.initSearches(),$("#w2ui-overlay-"+e.name+"-searchOverlay .w2ui-grid-searches").data("grid-name",e.name);var r=$("#w2ui-overlay-"+this.name+"-searchOverlay .w2ui-grid-searches *[rel=search]");r.length>0&&r[0].focus(),t.checked||(t.checked=!0,$(i).addClass("checked")),e.trigger($.extend(n,{phase:"after"}))},onHide:function(){t.checked=!1,$(i).removeClass("checked")}}):setTimeout((function(){e.toolbar.uncheck("w2ui-search-advanced")}),1)}},searchClose:function(){this.box&&0!==this.searches.length&&(this.toolbar&&this.toolbar.uncheck("w2ui-search-advanced","w2ui-column-on-off"),$().w2overlay({name:this.name+"-searchOverlay"}))},searchReset:function(e){for(var t=[],i=!1,n=0;n<this.searches.length;n++)this.searches[n].hidden&&null!=this.searches[n].value&&(t.push({field:this.searches[n].field,operator:this.searches[n].operator||"is",type:this.searches[n].type,value:this.searches[n].value||""}),i=!0);var r=this.trigger({phase:"before",type:"search",reset:!0,target:this.name,searchData:t});if(!0!==r.isCancelled){if(this.searchData=r.searchData,this.last.search="",this.last.logic=i?"AND":"OR",this.searches.length>0)if(this.multiSearch&&this.show.searchAll)this.last.field="all",this.last.label=w2utils.lang("All Fields");else{for(var s=0;s<this.searches.length&&(this.searches[s].hidden||!1===this.searches[s].simple);)s++;s>=this.searches.length?(this.last.field="",this.last.label=""):(this.last.field=this.searches[s].field,this.last.label=this.searches[s].label)}this.last.multi=!1,this.last.xhr_offset=0,this.last.scrollTop=0,this.last.scrollLeft=0,this.last.selection.indexes=[],this.last.selection.columns={},this.searchClose(),$("#grid_"+this.name+"_search_all").val("").removeData("selected"),e||this.reload(),this.trigger($.extend(r,{phase:"after"}))}},searchShowFields:function(e){var t=$("#grid_"+this.name+"_search_all");if(!0!==e){for(var i='<div class="w2ui-select-field"><table><tbody>',n=-1;n<this.searches.length;n++){var r=this.searches[n],s=r?r.field:null,o=this.getColumn(s),a=!1,l="This column is hidden";if(1==this.show.searchHiddenMsg&&-1!=n&&(null==o||!0===o.hidden&&!1!==o.hideable)&&(a=!0,null==o&&(l="This column does not exist")),-1==n){if(!this.multiSearch||!this.show.searchAll)continue;r={field:"all",label:w2utils.lang("All Fields")}}else{if(null!=o&&!1===o.hideable)continue;if(!0===this.searches[n].hidden||!1===this.searches[n].simple)continue}null==r.label&&null!=r.caption&&(console.log("NOTICE: grid search.caption property is deprecated, please use search.label. Search ->",r),r.label=r.caption),i+='<tr style="'+(a?"color: silver":"")+'" '+(a?"onmouseenter=\"jQuery(this).w2tag({ top: 4, html: '"+l+'\' })" onmouseleave="jQuery(this).w2tag()"':"")+(w2utils.isIOS?"onTouchStart":"onClick")+"=\"event.stopPropagation();            w2ui['"+this.name+"'].initAllField('"+r.field+"');           jQuery('#grid_"+this.name+"_search_all').w2overlay({ name: '"+this.name+"-searchFields' });\"           jQuery(this).addClass('w2ui-selected');      onmousedown=\"jQuery(this).parent().find('tr').removeClass('w2ui-selected'); jQuery(this).addClass('w2ui-selected')\"       onmouseup=\"jQuery(this).removeClass('w2ui-selected')\"    >   <td>       <span class=\"w2ui-column-check w2ui-icon-"+(r.field==this.last.field?"check":"empty")+'"></span>   </td>   <td>'+r.label+"</td></tr>"}i+="</tbody></table></div>";var u=this.name+"-searchFields";1==$("#w2ui-overlay-"+u).length&&(i=""),setTimeout((function(){$(t).w2overlay({html:i,name:u,left:-10})}),1)}else $(t).w2overlay({name:this.name+"-searchFields"})},initAllField:function(e,t){var i=$("#grid_"+this.name+"_search_all");if("all"==e){var n={field:"all",label:w2utils.lang("All Fields")};i.w2field("clear")}else{if(null==(n=this.getSearch(e)))return;var r=n.type;-1!=["enum","select"].indexOf(r)&&(r="list"),i.w2field(r,$.extend({},n.options,{suffix:"",autoFormat:!1,selected:t})),-1!=["list","enum","date","time","datetime"].indexOf(n.type)&&(this.last.search="",this.last.item="",i.val(""),$("#grid_"+this.name+"_searchClear").hide())}""!=this.last.search?(this.last.label=n.label,this.search(n.field,this.last.search)):(this.last.field=n.field,this.last.label=n.label),i.attr("placeholder",w2utils.lang(n.label||n.caption||n.field)),$().w2overlay({name:this.name+"-searchFields"})},clear:function(e){this.total=0,this.records=[],this.summary=[],this.last.xhr_offset=0,this.last.idCache={},this.reset(!0),e||this.refresh()},reset:function(e){this.last.scrollTop=0,this.last.scrollLeft=0,this.last.selection={indexes:[],columns:{}},this.last.range_start=null,this.last.range_end=null,$("#grid_"+this.name+"_records").prop("scrollTop",0),e||this.refresh()},skip:function(e,t){("object"!=typeof this.url?this.url:this.url.get)?(this.offset=parseInt(e),this.offset>this.total&&(this.offset=this.total-this.limit),(this.offset<0||!w2utils.isInt(this.offset))&&(this.offset=0),this.clear(!0),this.reload(t)):console.log("ERROR: grid.skip() can only be called when you have remote data source.")},load:function(e,t){null!=e?(this.clear(!0),this.request("get",{},e,t)):console.log('ERROR: You need to provide url argument when calling .load() method of "'+this.name+'" object.')},reload:function(e){var t=this,i="object"!=typeof this.url?this.url:this.url.get;t.selectionSave(),i?this.load(i,(function(){t.selectionRestore(),"function"==typeof e&&e()})):(this.reset(!0),this.localSearch(),this.selectionRestore(),"function"==typeof e&&e({status:"success"}))},request:function(e,t,i,n){if(null==t&&(t={}),""!=i&&null!=i||(i=this.url),""!=i&&null!=i){w2utils.isInt(this.offset)||(this.offset=0),w2utils.isInt(this.last.xhr_offset)||(this.last.xhr_offset=0);var r={limit:this.limit,offset:parseInt(this.offset)+parseInt(this.last.xhr_offset),searchLogic:this.last.logic,search:this.searchData.map(function(e){var t=$.extend({},e);return this.searchMap&&this.searchMap[t.field]&&(t.field=this.searchMap[t.field]),t}.bind(this)),sort:this.sortData.map(function(e){var t=$.extend({},e);return this.sortMap&&this.sortMap[t.field]&&(t.field=this.sortMap[t.field]),t}.bind(this))};if(0===this.searchData.length&&(delete r.search,delete r.searchLogic),0===this.sortData.length&&delete r.sort,$.extend(r,this.postData),$.extend(r,t),"delete"!=e&&"save"!=e||(delete r.limit,delete r.offset,r.action=e,"delete"==e&&(r[this.recid||"recid"]=this.getSelection())),"get"==e){if(!0===(s=this.trigger({phase:"before",type:"request",target:this.name,url:i,postData:r,httpHeaders:this.httpHeaders})).isCancelled)return void("function"==typeof n&&n({status:"error",message:"Request aborted."}))}else var s={url:i,postData:r,httpHeaders:this.httpHeaders};var o=this;if(0===this.last.xhr_offset&&this.lock(w2utils.lang(this.msgRefresh),!0),this.last.xhr)try{this.last.xhr.abort()}catch(e){}if(i="object"!=typeof s.url?s.url:s.url.get,"save"==e&&"object"==typeof s.url&&(i=s.url.save),"delete"==e&&"object"==typeof s.url&&(i=s.url.remove),!$.isEmptyObject(o.routeData)){var a=w2utils.parseRoute(i);if(a.keys.length>0)for(var l=0;l<a.keys.length;l++)null!=o.routeData[a.keys[l].name]&&(i=i.replace(new RegExp(":"+a.keys[l].name,"g"),o.routeData[a.keys[l].name]))}var u={type:"GET",url:i,data:s.postData,headers:s.httpHeaders,dataType:"json"};switch(this.dataType||w2utils.settings.dataType){case"HTTP":u.data="object"==typeof u.data?String($.param(u.data,!1)).replace(/%5B/g,"[").replace(/%5D/g,"]"):u.data;break;case"HTTPJSON":u.data={request:JSON.stringify(u.data)};break;case"RESTFULL":u.type="GET","save"==e&&(u.type="PUT"),"delete"==e&&(u.type="DELETE"),u.data="object"==typeof u.data?String($.param(u.data,!1)).replace(/%5B/g,"[").replace(/%5D/g,"]"):u.data;break;case"RESTFULLJSON":u.type="GET","save"==e&&(u.type="PUT"),"delete"==e&&(u.type="DELETE"),u.data=JSON.stringify(u.data),u.contentType="application/json";break;case"JSON":u.type="POST",u.data=JSON.stringify(u.data),u.contentType="application/json"}this.method&&(u.type=this.method),this.last.xhr_cmd=e,this.last.xhr_start=(new Date).getTime(),this.last.loaded=!1,this.last.xhr=$.ajax(u).done((function(t,i,r){o.requestComplete(i,r,e,n)})).fail((function(t,i,r){var s={status:i,error:r,rawResponseText:t.responseText},a=o.trigger({phase:"before",type:"error",error:s,xhr:t});if(!0!==a.isCancelled){if("abort"!=i){var l;try{l="object"==typeof t.responseJSON?t.responseJSON:$.parseJSON(t.responseText)}catch(e){}console.log("ERROR: Server communication failed.","\n   EXPECTED:",{status:"success",total:5,records:[{recid:1,field:"value"}]},"\n         OR:",{status:"error",message:"error message"},"\n   RECEIVED:","object"==typeof l?l:t.responseText),o.requestComplete("error",t,e,n)}o.trigger($.extend(a,{phase:"after"}))}})),"get"==e&&this.trigger($.extend(s,{phase:"after"}))}},requestComplete:function(e,t,i,n){var r=this;this.unlock(),setTimeout((function(){r.show.statusResponse&&r.status(w2utils.lang("Server Response")+" "+((new Date).getTime()-r.last.xhr_start)/1e3+" "+w2utils.lang("sec"))}),10),this.last.pull_more=!1,this.last.pull_refresh=!0;var s="load";"save"==this.last.xhr_cmd&&(s="save"),"delete"==this.last.xhr_cmd&&(s="delete");var o=this.trigger({phase:"before",target:this.name,type:s,xhr:t,status:e});if(!0!==o.isCancelled){var a;if("error"!=e)if("function"==typeof r.parser?"object"!=typeof(a=r.parser(t.responseJSON))&&console.log("ERROR: Your parser did not return proper object"):null==(a=t.responseJSON)?a={status:"error",message:w2utils.lang(this.msgNotJSON),responseText:t.responseText}:Array.isArray(a)&&(a={status:"success",records:a,total:a.length}),Array.isArray(a.records)&&a.records.forEach((function(e,t){r.recid&&(e.recid=r.parseField(e,r.recid)),null==e.recid&&(e.recid="recid-"+t)})),"error"==a.status)r.error(a.message);else{if("get"==i){if(null==a.total&&(a.total=-1),null==a.records&&(a.records=[]),a.records.length==this.limit){var l=this.records.length+a.records.length;this.last.xhr_hasMore=l!=this.total}else this.last.xhr_hasMore=!1,this.total=this.offset+this.last.xhr_offset+a.records.length;if(this.last.xhr_hasMore||$("#grid_"+this.name+"_rec_more, #grid_"+this.name+"_frec_more").hide(),0===this.last.xhr_offset)this.records=[],this.summary=[],w2utils.isInt(a.total)&&(this.total=parseInt(a.total));else if(-1!=a.total&&parseInt(a.total)!=parseInt(this.total))return void this.message(w2utils.lang(this.msgNeedReload),function(){delete this.last.xhr_offset,this.reload()}.bind(this));if(a.records)for(var u=0;u<a.records.length;u++)this.records.push(a.records[u]);if(a.summary)for(this.summary=[],u=0;u<a.summary.length;u++)this.summary.push(a.summary[u])}if("delete"==i)return this.reset(),void this.reload()}else a={status:"error",message:w2utils.lang(this.msgAJAXerror),responseText:t.responseText},r.error(w2utils.lang(this.msgAJAXerror));("object"!=typeof this.url?this.url:this.url.get)||(this.localSort(),this.localSearch()),this.total=parseInt(this.total),0===this.last.xhr_offset?this.refresh():(this.scroll(),this.resize()),"function"==typeof n&&n(a),this.trigger($.extend(o,{phase:"after"})),this.last.loaded=!0}else"function"==typeof n&&n({status:"error",message:"Request aborted."})},error:function(e){var t=this.trigger({target:this.name,type:"error",message:e,xhr:this.last.xhr});!0!==t.isCancelled?(this.message(e),this.trigger($.extend(t,{phase:"after"}))):"function"==typeof callBack&&callBack({status:"error",message:"Request aborted."})},getChanges:function(e){var t=[];void 0===e&&(e=this.records);for(var i=0;i<e.length;i++){var n=e[i];if(n.w2ui){if(null!=n.w2ui.changes){var r={};r[this.recid||"recid"]=n.recid,t.push($.extend(!0,r,n.w2ui.changes))}!0!==n.w2ui.expanded&&n.w2ui.children&&n.w2ui.children.length&&$.merge(t,this.getChanges(n.w2ui.children))}}return t},mergeChanges:function(){for(var changes=this.getChanges(),c=0;c<changes.length;c++){var record=this.get(changes[c].recid);for(var s in changes[c])if("recid"!=s){"object"==typeof changes[c][s]&&(changes[c][s]=changes[c][s].text);try{-1!=s.indexOf(".")?eval("record['"+s.replace(/\./g,"']['")+"'] = changes[c][s]"):record[s]=changes[c][s]}catch(e){console.log("ERROR: Cannot merge. ",e.message||"",e)}record.w2ui&&delete record.w2ui.changes}}this.refresh()},save:function(e){var t=this,i=this.getChanges(),n="object"!=typeof this.url?this.url:this.url.save,r=this.trigger({phase:"before",target:this.name,type:"save",changes:i});!0!==r.isCancelled?n?this.request("save",{changes:r.changes},null,(function(i){"error"!==i.status&&t.mergeChanges(),t.trigger($.extend(r,{phase:"after"})),"function"==typeof e&&e(i)})):(this.mergeChanges(),this.trigger($.extend(r,{phase:"after"}))):n&&"function"==typeof e&&e({status:"error",message:"Request aborted."})},editField:function(e,t,i,n){var r=this;if(!0!==this.last.inEditMode){b=r.get(e,!0);var s=r.getCellEditable(b,t);if(s){var o=r.records[b],a=r.columns[t],l=!0===a.frozen?"_f":"_";if(-1==["enum","file"].indexOf(s.type)){var u=r.trigger({phase:"before",type:"editField",target:r.name,recid:e,column:t,value:i,index:b,originalEvent:n});if(!0!==u.isCancelled&&(i=u.value,this.last.inEditMode=!0,this.last._edit={value:i,index:b,column:t,recid:e},this.selectNone(),this.select({recid:e,column:t}),-1==["checkbox","check"].indexOf(s.type))){var c=$("#grid_"+r.name+l+"rec_"+w2utils.escapeId(e)),d=c.find("[col="+t+"] > div");$(this.box).find("div.w2ui-edit-box").remove(),"row"!=this.selectType&&($("#grid_"+this.name+l+"selection").attr("id","grid_"+this.name+"_editable").removeClass("w2ui-selection").addClass("w2ui-edit-box").prepend('<div style="position: absolute; top: 0px; bottom: 0px; left: 0px; right: 0px;"></div>').find(".w2ui-selection-resizer").remove(),d=$("#grid_"+this.name+"_editable >div:first-child")),null==s.inTag&&(s.inTag=""),null==s.outTag&&(s.outTag=""),null==s.style&&(s.style=""),null==s.items&&(s.items=[]);var h=o.w2ui&&o.w2ui.changes&&null!=o.w2ui.changes[a.field]?w2utils.stripTags(o.w2ui.changes[a.field]):w2utils.stripTags(o[a.field]);null==h&&(h="");var p="object"!=typeof h?h:"";null!=u.old_value&&(p=u.old_value),null!=i&&(h=i);var f=null!=a.style?a.style+";":"";switch("string"==typeof a.render&&-1!=["number","int","float","money","percent","size"].indexOf(a.render.split(":")[0])&&(f+="text-align: right;"),s.items.length>0&&!$.isPlainObject(s.items[0])&&(s.items=w2obj.field.prototype.normMenu(s.items)),s.type){case"select":for(var g="",m=0;m<s.items.length;m++)g+='<option value="'+s.items[m].id+'"'+(s.items[m].id==h?' selected="selected"':"")+">"+s.items[m].text+"</option>";d.addClass("w2ui-editable").html('<select id="grid_'+r.name+"_edit_"+e+"_"+t+'" column="'+t+'" class="w2ui-input"    style="width: 100%; pointer-events: auto; padding: 0 0 0 3px; margin: 0px; border-left: 0; border-right: 0; border-radius: 0px;            outline: none; font-family: inherit;'+f+s.style+'"     field="'+a.field+'" recid="'+e+'"     '+s.inTag+">"+g+"</select>"+s.outTag),setTimeout((function(){d.find("select").on("change",(function(e){delete r.last.move})).on("blur",(function(e){1!=$(this).data("keep-open")&&r.editChange.call(r,this,b,t,e)}))}),10);break;case"div":var v="font-family: "+(w=c.find("[col="+t+"] > div")).css("font-family")+"; font-size: "+w.css("font-size")+";";d.addClass("w2ui-editable").html('<div id="grid_'+r.name+"_edit_"+e+"_"+t+'" class="w2ui-input"    contenteditable style="'+v+f+s.style+'" autocorrect="off" autocomplete="off" spellcheck="false"     field="'+a.field+'" recid="'+e+'" column="'+t+'" '+s.inTag+"></div>"+s.outTag),null==i&&d.find("div.w2ui-input").text("object"!=typeof h?h:"");var y=d.find("div.w2ui-input").get(0);setTimeout((function(){var e=y;$(e).on("blur",(function(i){1!=$(this).data("keep-open")&&r.editChange.call(r,e,b,t,i)}))}),10),null!=i&&$(y).text("object"!=typeof h?h:"");break;default:var w;v="font-family: "+(w=c.find("[col="+t+"] > div")).css("font-family")+"; font-size: "+w.css("font-size"),d.addClass("w2ui-editable").html('<input id="grid_'+r.name+"_edit_"+e+"_"+t+'" autocorrect="off" autocomplete="off" spellcheck="false" type="text"     style="'+v+"; width: 100%; height: 100%; padding: 3px; border-color: transparent; outline: none; border-radius: 0;        pointer-events: auto; "+f+s.style+'"     field="'+a.field+'" recid="'+e+'" column="'+t+'" class="w2ui-input"'+s.inTag+"/>"+s.outTag),"number"==s.type&&(h=w2utils.formatNumber(h)),"date"==s.type&&(h=w2utils.formatDate(w2utils.isDate(h,s.format,!0)||new Date,s.format)),null==i&&d.find("input").val("object"!=typeof h?h:""),y=d.find("input").get(0),$(y).w2field(s.type,$.extend(s,{selected:h})),setTimeout((function(){var e=y;"list"==s.type&&(e=$($(y).data("w2field").helpers.focus).find("input"),"object"!=typeof h&&""!=h&&e.val(h).css({opacity:1}).prev().css({opacity:1}),d.find("input").on("change",(function(e){r.editChange.call(r,y,b,t,e)}))),$(e).on("blur",(function(e){1!=$(this).data("keep-open")&&r.editChange.call(r,y,b,t,e)}))}),10),null!=i&&$(y).val("object"!=typeof h?h:"")}return void setTimeout((function(){r.last.inEditMode&&(d.find("input, select, div.w2ui-input").data("old_value",p).on("mousedown",(function(e){e.stopPropagation()})).on("click",(function(e){"div"==s.type?k.call(d.find("div.w2ui-input")[0],null):k.call(d.find("input, select")[0],null)})).on("paste",(function(e){var t=e.originalEvent;e.preventDefault();var i=t.clipboardData.getData("text/plain");document.execCommand("insertHTML",!1,i)})).on("keydown",(function(i){var n=this,l="DIV"==n.tagName.toUpperCase()?$(n).text():$(n).val();switch(i.keyCode){case 8:"list"!=s.type||$(y).data("w2field")||i.preventDefault();break;case 9:case 13:i.preventDefault();break;case 37:0===w2utils.getCursorPosition(n)&&i.preventDefault();break;case 39:w2utils.getCursorPosition(n)==l.length&&(w2utils.setCursorPosition(n,l.length),i.preventDefault())}setTimeout((function(){switch(i.keyCode){case 9:var s=e,l=i.shiftKey?r.prevCell(b,t,!0):r.nextCell(b,t,!0);if(null==l){var u=i.shiftKey?r.prevRow(b,t):r.nextRow(b,t);if(null!=u&&u!=b){s=r.records[u].recid;for(var c=0;c<r.columns.length;c++){var d=r.getCellEditable(b,c);if(null!=d&&-1==["checkbox","check"].indexOf(d.type)&&(l=parseInt(c),!i.shiftKey))break}}}!1===s&&(s=e),null==l&&(l=t),n.blur(),setTimeout((function(){"row"!=r.selectType?(r.selectNone(),r.select({recid:s,column:l})):r.editField(s,l,null,i)}),1),i.preventDefault&&i.preventDefault();break;case 13:n.blur();var h=i.shiftKey?r.prevRow(b,t):r.nextRow(b,t);null!=h&&h!=b&&setTimeout((function(){"row"!=r.selectType?(r.selectNone(),r.select({recid:r.records[h].recid,column:t})):r.editField(r.records[h].recid,t,null,i)}),1),"DIV"==n.tagName.toUpperCase()&&i.preventDefault();break;case 27:var p=r.parseField(o,a.field);o.w2ui&&o.w2ui.changes&&null!=o.w2ui.changes[a.field]&&(p=o.w2ui.changes[a.field]),null!=$(n).data("old_value")&&(p=$(n).data("old_value")),"DIV"==n.tagName.toUpperCase()?$(n).text(null!=p?p:""):n.value=null!=p?p:"",n.blur(),setTimeout((function(){r.select({recid:e,column:t})}),1)}k.call(n,i)}),1)})).on("keyup",(function(e){k.call(this,e)})),setTimeout((function(){if(r.last.inEditMode){var e=d.find(".w2ui-input"),t=null!=$(e).val()?$(e).val().length:0;"div"==s.type&&(t=$(e).text().length),e.length>0&&(e.focus(),clearTimeout(r.last.kbd_timer),"SELECT"!=e[0].tagName.toUpperCase()&&w2utils.setCursorPosition(e[0],t),e[0].resize=k,k.call(e[0],null))}}),50),r.trigger($.extend(u,{phase:"after",input:d.find("input, select, div.w2ui-input")})))}),5)}}else console.log('ERROR: input types "enum" and "file" are not supported in inline editing.')}}else if(13==n.keyCode){var b=this.last._edit.index;t=this.last._edit.column,e=this.last._edit.recid,this.editChange({type:"custom",value:this.last._edit.value},this.get(e,!0),t,n);var x=n.shiftKey?this.prevRow(b,t):this.nextRow(b,t);null!=x&&x!=b&&setTimeout((function(){"row"!=r.selectType?(r.selectNone(),r.select({recid:r.records[x].recid,column:t})):r.editField(r.records[x].recid,t,null,n)}),1),this.last.inEditMode=!1}else{var _=$(this.box).find("div.w2ui-edit-box .w2ui-input");_.length>0&&"DIV"==_[0].tagName&&(_.text(_.text()+i),w2utils.setCursorPosition(_[0],_.text().length))}function k(e){try{var t="DIV"==this.tagName.toUpperCase()?$(this).text():this.value,i=$("#grid_"+r.name+"_editable"),n="font-family: "+$(this).css("font-family")+"; font-size: "+$(this).css("font-size")+"; white-space: pre;",s=w2utils.getStrWidth(t,n);s+20>i.width()&&i.width(s+20)}catch(e){}}},editChange:function(e,t,i,n){var r=this;setTimeout((function(){var e=$(r.box).find("#grid_"+r.name+"_focus");e.is(":focus")||e.focus()}),10);var s=t<0;t=t<0?-t-1:t;var o=(s?this.summary:this.records)[t],a=this.columns[i],l=$("#grid_"+this.name+(!0===a.frozen?"_frec_":"_rec_")+w2utils.escapeId(o.recid)),u=e.tagName&&"DIV"==e.tagName.toUpperCase()?$(e).text():e.value,c=this.parseField(o,a.field),d=$(e).data("w2field");d&&("list"==d.type&&(u=$(e).data("selected")),($.isEmptyObject(u)||null==u)&&(u=""),$.isPlainObject(u)||(u=d.clean(u))),"checkbox"==e.type&&(o.w2ui&&!1===o.w2ui.editable&&(e.checked=!e.checked),u=e.checked);var h={phase:"before",type:"change",target:this.name,input_id:e.id,recid:o.recid,index:t,column:i,originalEvent:n.originalEvent?n.originalEvent:n,value_new:u,value_previous:o.w2ui&&o.w2ui.changes&&o.w2ui.changes.hasOwnProperty(a.field)?o.w2ui.changes[a.field]:c,value_original:c};for(null!=$(n.target).data("old_value")&&(h.value_previous=$(n.target).data("old_value"));;){if("object"!=typeof(u=h.value_new)&&String(c)!=String(u)||"object"==typeof u&&u&&u.id!=c&&("object"!=typeof c||null==c||u.id!=c.id)){if(!0!==(h=this.trigger($.extend(h,{type:"change",phase:"before"}))).isCancelled){if(u!==h.value_new)continue;o.w2ui=o.w2ui||{},o.w2ui.changes=o.w2ui.changes||{},o.w2ui.changes[a.field]=h.value_new,this.trigger($.extend(h,{phase:"after"}))}}else if(!0!==(h=this.trigger($.extend(h,{type:"restore",phase:"before"}))).isCancelled){if(u!==h.value_new)continue;o.w2ui&&o.w2ui.changes&&delete o.w2ui.changes[a.field],o.w2ui&&$.isEmptyObject(o.w2ui.changes)&&delete o.w2ui.changes,this.trigger($.extend(h,{phase:"after"}))}break}var p=$(l).find("[col="+i+"]");s||(o.w2ui&&o.w2ui.changes&&null!=o.w2ui.changes[a.field]?p.addClass("w2ui-changed"):p.removeClass("w2ui-changed"),p.replaceWith(this.getCellHTML(t,i,s))),$(this.box).find("div.w2ui-edit-box").remove(),this.show.toolbarSave&&(this.getChanges().length>0?this.toolbar.enable("w2ui-save"):this.toolbar.disable("w2ui-save")),r.last.inEditMode=!1},delete:function(e){(new Date).getTime();var t=this,i=this.trigger({phase:"before",target:this.name,type:"delete",force:e});if(e&&this.message(),!0!==i.isCancelled){e=i.force,setTimeout((function(){$().w2tag()}),20);var n=this.getSelection();if(0!==n.length)if(""==this.msgDelete||e){if("object"!=typeof this.url?this.url:this.url.remove)this.request("delete");else if("object"!=typeof n[0])this.selectNone(),this.remove.apply(this,n);else{for(var r=0;r<n.length;r++){var s=this.columns[n[r].column].field,o=this.get(n[r].recid,!0),a=this.records[o];null!=o&&"recid"!=s&&(this.records[o][s]="",a.w2ui&&a.w2ui.changes&&delete a.w2ui.changes[s])}this.update()}this.trigger($.extend(i,{phase:"after"}))}else this.message({width:380,height:170,body:'<div class="w2ui-centered">'+w2utils.lang(t.msgDelete).replace("NN",n.length).replace("records",1==n.length?"record":"records")+"</div>",buttons:w2utils.settings.macButtonOrder?'<button type="button" class="w2ui-btn btn-default" onclick="w2ui[\''+this.name+"'].message()\">"+w2utils.lang("Cancel")+'</button><button type="button" class="w2ui-btn" onclick="w2ui[\''+this.name+"'].delete(true)\">"+w2utils.lang(this.msgDeleteBtn)+"</button>":'<button type="button" class="w2ui-btn" onclick="w2ui[\''+this.name+"'].delete(true)\">"+w2utils.lang(this.msgDeleteBtn)+'</button><button type="button" class="w2ui-btn btn-default" onclick="w2ui[\''+this.name+"'].message()\">"+w2utils.lang("Cancel")+"</button>",onOpen:function(e){var i=$(this.box).find("input, textarea, select, button");i.off(".message").on("blur.message",(function(e){i.index(e.target)+1===i.length&&(i.get(0).focus(),e.preventDefault())})).on("keydown.message",(function(e){27==e.keyCode&&t.message()})),setTimeout(function(){$(this.box).find(".w2ui-btn.btn-default").focus(),clearTimeout(t.last.kbd_timer)}.bind(this),50)}})}},click:function(e,t){var i=(new Date).getTime(),n=null;if(!(1==this.last.cancelClick||t&&t.altKey))if("object"==typeof e&&null!==e&&(n=e.column,e=e.recid),null==t&&(t={}),i-parseInt(this.last.click_time)<350&&this.last.click_recid==e&&"click"==t.type)this.dblClick(e,t);else{this.last.bubbleEl&&($(this.last.bubbleEl).w2tag(),this.last.bubbleEl=null),this.last.click_time=i;var r=this.last.click_recid;this.last.click_recid=e,null==n&&t.target&&("TD"!=(m=t.target).tagName.toUpperCase()&&(m=$(m).parents("td")[0]),null!=$(m).attr("col")&&(n=parseInt($(m).attr("col"))));var s=this.trigger({phase:"before",target:this.name,type:"click",recid:e,column:n,originalEvent:t});if(!0!==s.isCancelled){var o=this,a=this.getSelection();$("#grid_"+this.name+"_check_all").prop("checked",!1);var l=this.get(e,!0),u=(this.records[l],[]);if(o.last.sel_ind=l,o.last.sel_col=n,o.last.sel_recid=e,o.last.sel_type="click",t.shiftKey&&a.length>0&&o.multiSelect){if(a[0].recid){var c=this.get(a[0].recid,!0),d=this.get(e,!0);if(n>a[0].column)var h=a[0].column,p=n;else h=n,p=a[0].column;for(var f=h;f<=p;f++)u.push(f)}else c=this.get(r,!0),d=this.get(e,!0);var g=[];if(c>d){var m=c;c=d,d=m}for(var v="object"!=typeof this.url?this.url:this.url.get,y=c;y<=d;y++)if(!(this.searchData.length>0)||v||-1!=$.inArray(y,this.last.searchIds))if("row"==this.selectType)g.push(this.records[y].recid);else for(var w=0;w<u.length;w++)g.push({recid:this.records[y].recid,column:u[w]});this.select(g)}else{var b=this.last.selection,x=-1!=b.indexes.indexOf(l),_=!1;if($(t.target).parents("td").hasClass("w2ui-col-select")&&(_=!0),(t.ctrlKey||t.shiftKey||t.metaKey||_)&&this.multiSelect||this.showSelectColumn){var k=$(t.target).parents("tr").find(".w2ui-grid-select-check").is(":checked");"row"==this.selectType||-1!=$.inArray(n,b.columns[l])||k||(x=!1),!0===x?this.unselect({recid:e,column:n}):this.select({recid:e,column:n})}else"row"!=this.selectType&&-1==$.inArray(n,b.columns[l])&&(x=!1),a.length>300?this.selectNone():this.unselect(a),!0===x&&1==a.length?this.unselect({recid:e,column:n}):this.select({recid:e,column:n})}this.status(),o.initResize(),this.trigger($.extend(s,{phase:"after"}))}}},columnClick:function(e,t){if(!0!==(i=this.trigger({phase:"before",type:"columnClick",target:this.name,field:e,originalEvent:t})).isCancelled){if("row"==this.selectType)(r=this.getColumn(e))&&r.sortable&&this.sort(e,null,!(!t||!t.ctrlKey&&!t.metaKey)),"line-number"==i.field&&(this.getSelection().length>=this.records.length?this.selectNone():this.selectAll());else if(t.altKey&&(r=this.getColumn(e))&&r.sortable&&this.sort(e,null,!(!t||!t.ctrlKey&&!t.metaKey)),"line-number"==i.field)this.getSelection().length>=this.records.length?this.selectNone():this.selectAll();else{t.shiftKey||t.metaKey||t.ctrlKey||this.selectNone();var i,n=this.getSelection(),r=this.getColumn(i.field,!0),s=[],o=[];if(0!=n.length&&t.shiftKey){var a=r,l=n[0].column;a>l&&(a=n[0].column,l=r);for(var u=a;u<=l;u++)o.push(u)}else o.push(r);if(!0!==(i=this.trigger({phase:"before",type:"columnSelect",target:this.name,columns:o})).isCancelled){for(u=0;u<this.records.length;u++)s.push({recid:this.records[u].recid,column:o});this.select(s)}this.trigger($.extend(i,{phase:"after"}))}this.trigger($.extend(i,{phase:"after"}))}},columnDblClick:function(e,t){var i=this.trigger({phase:"before",type:"columnDblClick",target:this.name,field:e,originalEvent:t});!0!==i.isCancelled&&this.trigger($.extend(i,{phase:"after"}))},focus:function(e){var t=this,i=this.trigger({phase:"before",type:"focus",target:this.name,originalEvent:e});if(!0===i.isCancelled)return!1;this.hasFocus=!0,$(this.box).removeClass("w2ui-inactive").find(".w2ui-inactive").removeClass("w2ui-inactive"),setTimeout((function(){var e=$(t.box).find("#grid_"+t.name+"_focus");e.is(":focus")||e.focus()}),10),this.trigger($.extend(i,{phase:"after"}))},blur:function(e){var t=this.trigger({phase:"before",type:"blur",target:this.name,originalEvent:e});if(!0===t.isCancelled)return!1;this.hasFocus=!1,$(this.box).addClass("w2ui-inactive").find(".w2ui-selected").addClass("w2ui-inactive"),$(this.box).find(".w2ui-selection").addClass("w2ui-inactive"),this.trigger($.extend(t,{phase:"after"}))},keydown:function(e){var t=this,i="object"!=typeof this.url?this.url:this.url.get;if(!0===t.keyboard){var n=t.trigger({phase:"before",type:"keydown",target:t.name,originalEvent:e});if(!0!==n.isCancelled)if($(this.box).find(">.w2ui-message").length>0)27==e.keyCode&&this.message();else{var r=!1,s=$("#grid_"+t.name+"_records"),o=t.getSelection();0===o.length&&(r=!0);var a=o[0]||null,l=[],u=o[o.length-1];if("object"==typeof a&&null!=a){a=o[0].recid,l=[];for(var c=0;o[c]&&o[c].recid==a;)l.push(o[c].column),c++;u=o[o.length-1].recid}var d=t.get(a,!0),h=t.get(u,!0),p=(t.get(a),$("#grid_"+t.name+"_rec_"+(null!=d?w2utils.escapeId(t.records[d].recid):"none"))),f=!1,g=e.keyCode,m=e.shiftKey;switch(g){case 8:case 46:t.delete(),f=!0,e.stopPropagation();break;case 27:t.selectNone(),f=!0;break;case 65:if(!e.metaKey&&!e.ctrlKey)break;t.selectAll(),f=!0;break;case 13:if("row"==this.selectType&&!0===t.show.expandColumn){if(p.length<=0)break;t.toggle(a,e),f=!0}else{for(var v=0;v<this.columns.length;v++)if(this.getCellEditable(d,v)){l.push(parseInt(v));break}"row"==this.selectType&&this.last._edit&&this.last._edit.column&&(l=[this.last._edit.column]),l.length>0&&(t.editField(a,l[0],null,e),f=!0)}break;case 37:if(r){T();break}if("row"==this.selectType){if(p.length<=0)break;!(w=this.records[d].w2ui||{})||null==w.parent_recid||Array.isArray(w.children)&&0!==w.children.length&&w.expanded?t.collapse(a,e):(t.unselect(a),t.collapse(w.parent_recid,e),t.select(w.parent_recid))}else{var y=t.prevCell(d,l[0]);if(m||null!=y||(this.selectNone(),y=0),null!=y)if(m&&t.multiSelect){if(S())return;var w=[],b=[],x=[];if(0===l.indexOf(this.last.sel_col)&&l.length>1){for(var _=0;_<o.length;_++)-1==w.indexOf(o[_].recid)&&w.push(o[_].recid),x.push({recid:o[_].recid,column:l[l.length-1]});t.unselect(x),t.scrollIntoView(d,l[l.length-1],!0)}else{for(_=0;_<o.length;_++)-1==w.indexOf(o[_].recid)&&w.push(o[_].recid),b.push({recid:o[_].recid,column:y});t.select(b),t.scrollIntoView(d,y,!0)}}else e.metaKey=!1,t.click({recid:a,column:y},e),t.scrollIntoView(d,y,!0);else if(!m)if(o.length>1)t.selectNone();else for(var k=1;k<o.length;k++)t.unselect(o[k])}f=!0;break;case 39:if(r){T();break}if("row"==this.selectType){if(p.length<=0)break;t.expand(a,e)}else{var C=t.nextCell(d,l[l.length-1]);if(m||null!=C||(this.selectNone(),C=this.columns.length-1),null!=C)if(m&&39==g&&t.multiSelect){if(S())return;if(w=[],b=[],x=[],l.indexOf(this.last.sel_col)==l.length-1&&l.length>1){for(_=0;_<o.length;_++)-1==w.indexOf(o[_].recid)&&w.push(o[_].recid),x.push({recid:o[_].recid,column:l[0]});t.unselect(x),t.scrollIntoView(d,l[0],!0)}else{for(_=0;_<o.length;_++)-1==w.indexOf(o[_].recid)&&w.push(o[_].recid),b.push({recid:o[_].recid,column:C});t.select(b),t.scrollIntoView(d,C,!0)}}else e.metaKey=!1,t.click({recid:a,column:C},e),t.scrollIntoView(d,C,!0);else if(!m)if(o.length>1)t.selectNone();else for(k=0;k<o.length-1;k++)t.unselect(o[k])}f=!0;break;case 38:if(r&&T(),p.length<=0)break;if(y=t.prevRow(d,l[0]),m||null!=y||(y=0==this.searchData.length||i?0:this.last.searchIds[0]),null!=y){if(m&&t.multiSelect){if(S())return;if("row"==t.selectType)t.last.sel_ind>y&&t.last.sel_ind!=h?t.unselect(t.records[h].recid):t.select(t.records[y].recid);else if(t.last.sel_ind>y&&t.last.sel_ind!=h){for(y=h,w=[],v=0;v<l.length;v++)w.push({recid:t.records[y].recid,column:l[v]});t.unselect(w)}else{for(w=[],v=0;v<l.length;v++)w.push({recid:t.records[y].recid,column:l[v]});t.select(w)}}else o.length>300?this.selectNone():this.unselect(o),t.click({recid:t.records[y].recid,column:l[0]},e);t.scrollIntoView(y),e.preventDefault&&e.preventDefault()}else if(!m)if(o.length>1)t.selectNone();else for(k=1;k<o.length;k++)t.unselect(o[k]);break;case 40:if(r&&T(),p.length<=0)break;if(C=t.nextRow(h,l[0]),m||null!=C||(C=0==this.searchData.length||i?this.records.length-1:this.last.searchIds[this.last.searchIds.length-1]),null!=C){if(m&&t.multiSelect){if(S())return;if("row"==t.selectType)this.last.sel_ind<C&&this.last.sel_ind!=d?t.unselect(t.records[d].recid):t.select(t.records[C].recid);else if(this.last.sel_ind<C&&this.last.sel_ind!=d){for(C=d,w=[],v=0;v<l.length;v++)w.push({recid:t.records[C].recid,column:l[v]});t.unselect(w)}else{for(w=[],v=0;v<l.length;v++)w.push({recid:t.records[C].recid,column:l[v]});t.select(w)}}else o.length>300?this.selectNone():this.unselect(o),t.click({recid:t.records[C].recid,column:l[0]},e);t.scrollIntoView(C),f=!0}else if(!m)if(o.length>1)t.selectNone();else for(k=0;k<o.length-1;k++)t.unselect(o[k]);break;case 17:case 91:if(r)break;t.last.isSafari&&(t.last.copy_event=t.copy(!1,e),$("#grid_"+t.name+"_focus").val(t.last.copy_event.text).select());break;case 67:(e.metaKey||e.ctrlKey)&&(t.last.isSafari||(t.last.copy_event=t.copy(!1,e),$("#grid_"+t.name+"_focus").val(t.last.copy_event.text).select()),t.copy(t.last.copy_event,e));break;case 88:if(r)break;(e.ctrlKey||e.metaKey)&&(t.last.isSafari||(t.last.copy_event=t.copy(!1,e),$("#grid_"+t.name+"_focus").val(t.last.copy_event.text).select()),t.copy(t.last.copy_event,e))}for(w=[32,187,189,192,219,220,221,186,222,188,190,191],_=48;_<=111;_++)w.push(_);-1==w.indexOf(g)||e.ctrlKey||e.metaKey||f||(0===l.length&&l.push(0),f=!1,setTimeout((function(){var i=$("#grid_"+t.name+"_focus"),n=i.val();i.val(""),t.editField(a,l[0],n,e)}),1)),f&&e.preventDefault&&e.preventDefault(),t.trigger($.extend(n,{phase:"after"}))}}function T(){var e=Math.floor(s[0].scrollTop/t.recordHeight)+1;(!t.records[e]||e<2)&&(e=0),t.select({recid:t.records[e].recid,column:0})}function S(){if("click"!=t.last.sel_type)return!1;if("row"!=t.selectType){if(t.last.sel_type="key",o.length>1){for(var e=0;e<o.length;e++)if(o[e].recid==t.last.sel_recid&&o[e].column==t.last.sel_col){o.splice(e,1);break}return t.unselect(o),!0}return!1}return t.last.sel_type="key",o.length>1&&(o.splice(o.indexOf(t.records[t.last.sel_ind].recid),1),t.unselect(o),!0)}},scrollIntoView:function(e,t,i){var n=this.records.length;if(0==this.searchData.length||this.url||(n=this.last.searchIds.length),0!==n){if(null==e){var r=this.getSelection();if(0===r.length)return;$.isPlainObject(r[0])?(e=r[0].index,t=r[0].column):e=this.get(r[0],!0)}var s=$("#grid_"+this.name+"_records"),o=this.last.searchIds.length;if(o>0&&(e=this.last.searchIds.indexOf(e)),s.height()<this.recordHeight*(o>0?o:n)&&s.length>0){var a=Math.floor(s[0].scrollTop/this.recordHeight),l=a+Math.floor(s.height()/this.recordHeight);e==a&&(!0===i?s.prop({scrollTop:s.scrollTop()-s.height()/1.3}):(s.stop(),s.animate({scrollTop:s.scrollTop()-s.height()/1.3},250,"linear"))),e==l&&(!0===i?s.prop({scrollTop:s.scrollTop()+s.height()/1.3}):(s.stop(),s.animate({scrollTop:s.scrollTop()+s.height()/1.3},250,"linear"))),(e<a||e>l)&&(!0===i?s.prop({scrollTop:(e-1)*this.recordHeight}):(s.stop(),s.animate({scrollTop:(e-1)*this.recordHeight},250,"linear")))}if(null!=t){for(var u=0,c=0,d=w2utils.scrollBarSize(),h=0;h<=t;h++){var p=this.columns[h];p.frozen||p.hidden||(u=c,c+=parseInt(p.sizeCalculated))}s.width()<c-s.scrollLeft()?!0===i?s.prop({scrollLeft:u-d}):s.animate({scrollLeft:u-d},250,"linear"):u<s.scrollLeft()&&(!0===i?s.prop({scrollLeft:c-s.width()+2*d}):s.animate({scrollLeft:c-s.width()+2*d},250,"linear"))}}},dblClick:function(e,t){var i=null;if("object"==typeof e&&null!==e&&(i=e.column,e=e.recid),null==t&&(t={}),null==i&&t.target){var n=t.target;"TD"!=n.tagName.toUpperCase()&&(n=$(n).parents("td")[0]),i=parseInt($(n).attr("col"))}var r=this.get(e,!0),s=this.records[r],o=this.trigger({phase:"before",target:this.name,type:"dblClick",recid:e,column:i,originalEvent:t});!0!==o.isCancelled&&(this.selectNone(),this.getCellEditable(r,i)?this.editField(e,i,null,t):(this.select({recid:e,column:i}),(this.show.expandColumn||s.w2ui&&Array.isArray(s.w2ui.children))&&this.toggle(e)),this.trigger($.extend(o,{phase:"after"})))},contextMenu:function(e,t,i){var n=this;if("text"!=n.last.userSelect){null==i&&(i={offsetX:0,offsetY:0,target:$("#grid_"+n.name+"_rec_"+e)[0]}),null==i.offsetX&&(i.offsetX=i.layerX-i.target.offsetLeft,i.offsetY=i.layerY-i.target.offsetTop),w2utils.isFloat(e)&&(e=parseFloat(e));var r=this.getSelection();if("row"==this.selectType)-1==r.indexOf(e)&&n.click(e);else{var s=$(i.target);"TD"!=s[0].tagName.toUpperCase()&&(s=$(i.target).parents("td"));var o=!1;t=s.attr("col");for(var a=0;a<r.length;a++)r[a].recid!=e&&r[a].column!=t||(o=!0);o||null==e||n.click({recid:e,column:t}),o||null==t||n.columnClick(this.columns[t].field,i)}var l=n.trigger({phase:"before",type:"contextMenu",target:n.name,originalEvent:i,recid:e,column:t});!0!==l.isCancelled&&(n.menu.length>0&&$(n.box).find(i.target).w2menu(n.menu,{originalEvent:i,contextMenu:!0,onSelect:function(t){n.menuClick(e,t)}}),i.preventDefault&&i.preventDefault(),n.trigger($.extend(l,{phase:"after"})))}},menuClick:function(e,t){var i=this,n=i.trigger({phase:"before",type:"menuClick",target:i.name,originalEvent:t.originalEvent,menuEvent:t,recid:e,menuIndex:t.index,menuItem:t.item});!0!==n.isCancelled&&i.trigger($.extend(n,{phase:"after"}))},toggle:function(e){var t=this.get(e);return t.w2ui=t.w2ui||{},!0===t.w2ui.expanded?this.collapse(e):this.expand(e)},expand:function(e){var t=this.get(e,!0),i=this.records[t];i.w2ui=i.w2ui||{};var n=w2utils.escapeId(e),r=i.w2ui.children;if(Array.isArray(r)){if(!0===i.w2ui.expanded||0===r.length)return!1;if(!0===(s=this.trigger({phase:"before",type:"expand",target:this.name,recid:e})).isCancelled)return!1;i.w2ui.expanded=!0,r.forEach((function(e){e.w2ui=e.w2ui||{},e.w2ui.parent_recid=i.recid,null==e.w2ui.children&&(e.w2ui.children=[])})),this.records.splice.apply(this.records,[t+1,0].concat(r)),this.total+=r.length,("object"!=typeof this.url?this.url:this.url.get)||(this.localSort(!0,!0),this.searchData.length>0&&this.localSearch(!0)),this.refresh(),this.trigger($.extend(s,{phase:"after"}))}else{if($("#grid_"+this.name+"_rec_"+n+"_expanded_row").length>0||!0!==this.show.expandColumn)return!1;if("none"==i.w2ui.expanded)return!1;var s;if($("#grid_"+this.name+"_rec_"+n).after('<tr id="grid_'+this.name+"_rec_"+e+'_expanded_row" class="w2ui-expanded-row">    <td colspan="100" class="w2ui-expanded2">        <div id="grid_'+this.name+"_rec_"+e+'_expanded"></div>    </td>    <td class="w2ui-grid-data-last"></td></tr>'),$("#grid_"+this.name+"_frec_"+n).after('<tr id="grid_'+this.name+"_frec_"+e+'_expanded_row" class="w2ui-expanded-row">'+(this.show.lineNumbers?'<td class="w2ui-col-number"></td>':"")+'    <td class="w2ui-grid-data w2ui-expanded1" colspan="100">       <div id="grid_'+this.name+"_frec_"+e+'_expanded"></div>   </td></tr>'),!0===(s=this.trigger({phase:"before",type:"expand",target:this.name,recid:e,box_id:"grid_"+this.name+"_rec_"+e+"_expanded",fbox_id:"grid_"+this.name+"_frec_"+n+"_expanded"})).isCancelled)return $("#grid_"+this.name+"_rec_"+n+"_expanded_row").remove(),$("#grid_"+this.name+"_frec_"+n+"_expanded_row").remove(),!1;var o=$(this.box).find("#grid_"+this.name+"_rec_"+e+"_expanded"),a=$(this.box).find("#grid_"+this.name+"_frec_"+e+"_expanded"),l=o.find("> div:first-child").height();o.height()<l&&o.css({height:l+"px"}),a.height()<l&&a.css({height:l+"px"}),$("#grid_"+this.name+"_rec_"+n).attr("expanded","yes").addClass("w2ui-expanded"),$("#grid_"+this.name+"_frec_"+n).attr("expanded","yes").addClass("w2ui-expanded"),$("#grid_"+this.name+"_cell_"+this.get(e,!0)+"_expand div").html("-"),i.w2ui.expanded=!0,this.trigger($.extend(s,{phase:"after"})),this.resizeRecords()}return!0},collapse:function(e){var t=this,i=this.get(e,!0),n=this.records[i];n.w2ui=n.w2ui||{};var r=w2utils.escapeId(e),s=n.w2ui.children;if(Array.isArray(s)){if(!0!==n.w2ui.expanded)return!1;if(!0===(c=this.trigger({phase:"before",type:"collapse",target:this.name,recid:e})).isCancelled)return!1;!function e(t){t.w2ui.expanded=!1;for(var i=0;i<t.w2ui.children.length;i++){var n=t.w2ui.children[i];n.w2ui.expanded&&e(n)}}(n);for(var o=[],a=n;null!=a;a=this.get(a.w2ui.parent_recid))o.push(a.w2ui.parent_recid);for(var l=i+1,u=l;!(this.records.length<=u+1||null==this.records[u+1].w2ui||o.indexOf(this.records[u+1].w2ui.parent_recid)>=0);)u++;this.records.splice(l,u-l+1),this.total-=u-l+1,("object"!=typeof this.url?this.url:this.url.get)||this.searchData.length>0&&this.localSearch(!0),this.refresh(),t.trigger($.extend(c,{phase:"after"}))}else{if(0===$("#grid_"+this.name+"_rec_"+r+"_expanded_row").length||!0!==this.show.expandColumn)return!1;var c;if(!0===(c=this.trigger({phase:"before",type:"collapse",target:this.name,recid:e,box_id:"grid_"+this.name+"_rec_"+r+"_expanded",fbox_id:"grid_"+this.name+"_frec_"+r+"_expanded"})).isCancelled)return!1;$("#grid_"+this.name+"_rec_"+r).removeAttr("expanded").removeClass("w2ui-expanded"),$("#grid_"+this.name+"_frec_"+r).removeAttr("expanded").removeClass("w2ui-expanded"),$("#grid_"+this.name+"_cell_"+this.get(e,!0)+"_expand div").html("+"),$("#grid_"+t.name+"_rec_"+r+"_expanded").css("height","0px"),$("#grid_"+t.name+"_frec_"+r+"_expanded").css("height","0px"),setTimeout((function(){$("#grid_"+t.name+"_rec_"+r+"_expanded_row").remove(),$("#grid_"+t.name+"_frec_"+r+"_expanded_row").remove(),n.w2ui.expanded=!1,t.trigger($.extend(c,{phase:"after"})),t.resizeRecords()}),300)}return!0},sort:function(e,t,i){var n=this.trigger({phase:"before",type:"sort",target:this.name,field:e,direction:t,multiField:i});if(!0!==n.isCancelled){if(null!=e){for(var r=this.sortData.length,s=0;s<this.sortData.length;s++)if(this.sortData[s].field==e){r=s;break}null==t&&(null==this.sortData[r]?t="asc":(null==this.sortData[r].direction&&(this.sortData[r].direction=""),t="asc"===this.sortData[r].direction.toLowerCase()?"desc":"asc")),!1===this.multiSort&&(this.sortData=[],r=0),1!=i&&(this.sortData=[],r=0),null==this.sortData[r]&&(this.sortData[r]={}),this.sortData[r].field=e,this.sortData[r].direction=t}else this.sortData=[];("object"!=typeof this.url?this.url:this.url.get)?(this.trigger($.extend(n,{phase:"after",direction:t})),this.last.xhr_offset=0,this.reload()):(this.localSort(!0,!0),this.searchData.length>0&&this.localSearch(!0),this.last.scrollTop=0,$("#grid_"+this.name+"_records").prop("scrollTop",0),this.trigger($.extend(n,{phase:"after",direction:t})),this.refresh())}},copy:function(e,t){if($.isPlainObject(e))return this.trigger($.extend(e,{phase:"after"})),e.text;var i=this.getSelection();if(0===i.length)return"";var n,r="";if("object"==typeof i[0]){for(var s=i[0].column,o=i[0].column,a=[],l=0;l<i.length;l++)i[l].column<s&&(s=i[l].column),i[l].column>o&&(o=i[l].column),-1==a.indexOf(i[l].index)&&a.push(i[l].index);a.sort((function(e,t){return e-t}));for(var u=0;u<a.length;u++){for(var c=a[u],d=s;d<=o;d++)!0!==(p=this.columns[d]).hidden&&(r+=this.getCellCopy(c,d)+"\t");r=r.substr(0,r.length-1),r+="\n"}}else{for(d=0;d<this.columns.length;d++)if(!0!==(p=this.columns[d]).hidden){var h=p.text?p.text:p.field;p.text&&p.text.length<3&&p.tooltip&&(h=p.tooltip),r+='"'+w2utils.stripTags(h)+'"\t'}for(r=r.substr(0,r.length-1),r+="\n",l=0;l<i.length;l++){for(c=this.get(i[l],!0),d=0;d<this.columns.length;d++){var p;!0!==(p=this.columns[d]).hidden&&(r+='"'+this.getCellCopy(c,d)+'"\t')}r=r.substr(0,r.length-1),r+="\n"}}return r=r.substr(0,r.length-1),null==e?!0===(n=this.trigger({phase:"before",type:"copy",target:this.name,text:r,cut:88==t.keyCode,originalEvent:t})).isCancelled?"":(r=n.text,this.trigger($.extend(n,{phase:"after"})),r):!1===e?!0===(n=this.trigger({phase:"before",type:"copy",target:this.name,text:r,cut:88==t.keyCode,originalEvent:t})).isCancelled?"":(r=n.text,n):void 0},getCellCopy:function(e,t){return w2utils.stripTags(this.getCellHTML(e,t))},paste:function(e){var t=this.getSelection(),i=this.get(t[0].recid,!0),n=t[0].column,r=this.trigger({phase:"before",type:"paste",target:this.name,text:e,index:i,column:n});if(!0!==r.isCancelled){if(e=r.text,"row"==this.selectType||0===t.length)return console.log("ERROR: You can paste only if grid.selectType = 'cell' and when at least one cell selected."),void this.trigger($.extend(r,{phase:"after"}));for(var s=[],o=(e=e.split("\n"),0);o<e.length;o++){var a=e[o].split("\t"),l=0,u=this.records[i],c=[];if(null!=u){for(var d=0;d<a.length;d++)this.columns[n+l]&&(this.setCellPaste(u,n+l,a[d]),c.push(n+l),l++);for(var h=0;h<c.length;h++)s.push({recid:u.recid,column:c[h]});i++}}this.selectNone(),this.select(s),this.refresh(),this.trigger($.extend(r,{phase:"after"}))}},setCellPaste:function(e,t,i){var n=this.columns[t].field;e.w2ui=e.w2ui||{},e.w2ui.changes=e.w2ui.changes||{},e.w2ui.changes[n]=i},resize:function(){var e=this,t=(new Date).getTime();if(this.box&&$(this.box).attr("name")==this.name){$(this.box).find("> div.w2ui-grid-box").css("width",$(this.box).width()).css("height",$(this.box).height());var i=this.trigger({phase:"before",type:"resize",target:this.name});if(!0!==i.isCancelled)return e.resizeBoxes(),e.resizeRecords(),e.toolbar&&e.toolbar.resize&&e.toolbar.resize(),this.trigger($.extend(i,{phase:"after"})),(new Date).getTime()-t}},update:function(e){var t=(new Date).getTime();if(null==this.box)return 0;if(null==e){for(var i=this.last.range_start-1;i<=this.last.range_end-1;i++)if(!(i<0)){(o=this.records[i]||{}).w2ui||(o.w2ui={});for(var n=0;n<this.columns.length;n++){var r=$(this.box).find("#grid_"+this.name+"_rec_"+w2utils.escapeId(o.recid));(a=$(this.box).find("#grid_"+this.name+"_data_"+i+"_"+n)).replaceWith(this.getCellHTML(i,n,!1)),a=$(this.box).find("#grid_"+this.name+"_data_"+i+"_"+n),null==o.w2ui.style||$.isEmptyObject(o.w2ui.style)?a.attr("style",""):("string"==typeof o.w2ui.style&&r.attr("style",o.w2ui.style),$.isPlainObject(o.w2ui.style)&&"string"==typeof o.w2ui.style[n]&&a.attr("style",o.w2ui.style[n])),null==o.w2ui.class||$.isEmptyObject(o.w2ui.class)||("string"==typeof o.w2ui.class&&r.addClass(o.w2ui.class),$.isPlainObject(o.w2ui.class)&&"string"==typeof o.w2ui.class[n]&&a.addClass(o.w2ui.class[n]))}}}else for(var s=0;s<e.length;s++)if(i=e[s].index,n=e[s].column,!(i<0))if(null!=i&&null!=n){var o=this.records[i]||{},a=(r=$(this.box).find("#grid_"+this.name+"_rec_"+w2utils.escapeId(o.recid)),$(this.box).find("#grid_"+this.name+"_data_"+i+"_"+n));o.w2ui||(o.w2ui={}),a.replaceWith(this.getCellHTML(i,n,!1)),a=$(this.box).find("#grid_"+this.name+"_data_"+i+"_"+n),null==o.w2ui.style||$.isEmptyObject(o.w2ui.style)?a.attr("style",""):("string"==typeof o.w2ui.style&&r.attr("style",o.w2ui.style),$.isPlainObject(o.w2ui.style)&&"string"==typeof o.w2ui.style[n]&&a.attr("style",o.w2ui.style[n])),null==o.w2ui.class||$.isEmptyObject(o.w2ui.class)||("string"==typeof o.w2ui.class&&r.addClass(o.w2ui.class),$.isPlainObject(o.w2ui.class)&&"string"==typeof o.w2ui.class[n]&&a.addClass(o.w2ui.class[n]))}else console.log("ERROR: Wrong argument for grid.update(cells), cells should be [{ index: X, column: Y }, ...]");return(new Date).getTime()-t},refreshCell:function(e,t){var i=this.get(e,!0),n=this.getColumn(t,!0),r=!this.records[i]||this.records[i].recid!=e,s=$(this.box).find((r?".w2ui-grid-summary ":"")+"#grid_"+this.name+"_data_"+i+"_"+n);if(0==s.length)return!1;s.replaceWith(this.getCellHTML(i,n,r))},refreshRow:function(e,t){var i=$(this.box).find("#grid_"+this.name+"_frec_"+w2utils.escapeId(e)),n=$(this.box).find("#grid_"+this.name+"_rec_"+w2utils.escapeId(e));if(i.length>0){null==t&&(t=this.get(e,!0));var r=i.attr("line"),s=!this.records[t]||this.records[t].recid!=e,o="object"!=typeof this.url?this.url:this.url.get;if(this.searchData.length>0&&!o)for(var a=0;a<this.last.searchIds.length;a++)this.last.searchIds[a]==t&&(t=a);var l=this.getRecordHTML(t,r,s);$(i).replaceWith(l[0]),$(n).replaceWith(l[1]);var u=this.records[t].w2ui?this.records[t].w2ui.style:"";"string"==typeof u&&(i=$(this.box).find("#grid_"+this.name+"_frec_"+w2utils.escapeId(e)),n=$(this.box).find("#grid_"+this.name+"_rec_"+w2utils.escapeId(e)),i.attr("custom_style",u),n.attr("custom_style",u),i.hasClass("w2ui-selected")&&(u=u.replace("background-color","none")),i[0].style.cssText="height: "+this.recordHeight+"px;"+u,n[0].style.cssText="height: "+this.recordHeight+"px;"+u),s&&this.resize()}},refresh:function(){var e=this,t=(new Date).getTime(),i="object"!=typeof this.url?this.url:this.url.get;if(this.total<=0&&!i&&0===this.searchData.length&&(this.total=this.records.length),this.toolbar.disable("w2ui-edit","w2ui-delete"),this.box){var n=this.trigger({phase:"before",target:this.name,type:"refresh"});if(!0!==n.isCancelled){if(this.show.header?$("#grid_"+this.name+"_header").html(this.header+"&#160;").show():$("#grid_"+this.name+"_header").hide(),this.show.toolbar){if(this.toolbar&&this.toolbar.get("w2ui-column-on-off")&&this.toolbar.get("w2ui-column-on-off").checked);else if($("#grid_"+this.name+"_toolbar").show(),"object"==typeof this.toolbar)for(var r=this.toolbar.items,s=0;s<r.length;s++)"w2ui-search"!=r[s].id&&"break"!=r[s].type&&this.toolbar.refresh(r[s].id)}else $("#grid_"+this.name+"_toolbar").hide();this.searchClose();var o=$("#grid_"+e.name+"_search_all");!this.multiSearch&&"all"==this.last.field&&this.searches.length>0&&(this.last.field=this.searches[0].field,this.last.label=this.searches[0].label);for(var a=0;a<this.searches.length;a++)this.searches[a].field==this.last.field&&(this.last.label=this.searches[a].label);if(this.last.multi?(o.attr("placeholder","["+w2utils.lang("Multiple Fields")+"]"),o.w2field("clear")):o.attr("placeholder",w2utils.lang(this.last.label)),o.val()!=this.last.search){var l=this.last.search;(r=o.data("w2field"))&&(l=r.format(l)),o.val(l)}e.refreshBody(),this.show.footer?$("#grid_"+this.name+"_footer").html(this.getFooterHTML()).show():$("#grid_"+this.name+"_footer").hide();var u=$("#grid_"+this.name+"_searchClear");u.hide(),this.searchData.some((function(t){var i=e.getSearch(t.field);if(e.last.multi||i&&!i.hidden&&-1==["list","enum"].indexOf(i.type))return u.show(),!0}));var c=this.last.selection,d=this.records.length>0&&c.indexes.length==this.records.length,h=c.indexes.length>0&&0!==this.searchData.length&&c.indexes.length==this.last.searchIds.length;d||h?$("#grid_"+this.name+"_check_all").prop("checked",!0):$("#grid_"+this.name+"_check_all").prop("checked",!1),this.status();for(var p=e.find({"w2ui.expanded":!0},!0),f=0;f<p.length;f++)(r=e.records[p[f]].w2ui)&&!Array.isArray(r.children)&&(r.expanded=!1);return e.markSearch&&setTimeout((function(){for(var t=[],i=0;i<e.searchData.length;i++){var n=e.searchData[i],r=e.getSearch(n.field);if(r&&!r.hidden){var s=e.getColumn(n.field,!0);t.push({field:n.field,search:n.value,col:s})}}t.length>0&&t.forEach((function(t){$(e.box).find('td[col="'+t.col+'"]').not(".w2ui-head").w2marker(t.search)}))}),50),this.show.toolbarSave&&(this.getChanges().length>0?this.toolbar.enable("w2ui-save"):this.toolbar.disable("w2ui-save")),this.trigger($.extend(n,{phase:"after"})),e.resize(),e.addRange("selection"),setTimeout((function(){e.resize(),e.scroll()}),1),e.reorderColumns&&!e.last.columnDrag?e.last.columnDrag=e.initColumnDrag():!e.reorderColumns&&e.last.columnDrag&&e.last.columnDrag.remove(),(new Date).getTime()-t}}},refreshBody:function(){var e=this,t=this.find({"w2ui.summary":!0},!0);if(t.length>0){for(var i=0;i<t.length;i++)this.summary.push(this.records[t[i]]);for(i=t.length-1;i>=0;i--)this.records.splice(t[i],1)}this.scroll();var n=this.getRecordsHTML(),r=this.getColumnsHTML(),s='<div id="grid_'+this.name+'_frecords" class="w2ui-grid-frecords" style="margin-bottom: '+(w2utils.scrollBarSize()-1)+'px;">'+n[0]+'</div><div id="grid_'+this.name+'_records" class="w2ui-grid-records" onscroll="w2ui[\''+this.name+"'].scroll(event);\">"+n[1]+'</div><div id="grid_'+this.name+'_scroll1" class="w2ui-grid-scroll1" style="height: '+w2utils.scrollBarSize()+'px"></div><div id="grid_'+this.name+'_fcolumns" class="w2ui-grid-fcolumns">    <table><tbody>'+r[0]+'</tbody></table></div><div id="grid_'+this.name+'_columns" class="w2ui-grid-columns">    <table><tbody>'+r[1]+"</tbody></table></div>",o=$("#grid_"+this.name+"_body",e.box).html(s),a=$("#grid_"+this.name+"_records",e.box),l=$("#grid_"+this.name+"_frecords",e.box),u=this;if("row"==this.selectType&&(a.on("mouseover mouseout","tr",(function(e){$("#grid_"+u.name+"_frec_"+w2utils.escapeId($(this).attr("recid"))).toggleClass("w2ui-record-hover","mouseover"==e.type)})),l.on("mouseover mouseout","tr",(function(e){$("#grid_"+u.name+"_rec_"+w2utils.escapeId($(this).attr("recid"))).toggleClass("w2ui-record-hover","mouseover"==e.type)}))),w2utils.isIOS?a.add(l).on("click","tr",(function(e){u.dblClick($(this).attr("recid"),e)})):a.add(l).on("click","tr",(function(e){u.click($(this).attr("recid"),e)})).on("contextmenu","tr",(function(e){u.contextMenu($(this).attr("recid"),null,e)})),o.data("scrolldata",{lastTime:0,lastDelta:0,time:0}).find(".w2ui-grid-frecords").on("mousewheel DOMMouseScroll ",(function(t){t.preventDefault();var i=t.originalEvent,n=o.data("scrolldata"),r=$(this).siblings(".w2ui-grid-records").addBack().filter(".w2ui-grid-records"),s=null!=typeof i.wheelDelta?-1*i.wheelDelta/120:(i.detail||i.deltaY)/3,l=r.scrollTop();n.time=+new Date,n.lastTime<n.time-150&&(n.lastDelta=0),n.lastTime=n.time,n.lastDelta+=s,s=Math.abs(n.lastDelta)<1?0:Math.round(n.lastDelta),o.data("scrolldata",n),s*=(Math.round(a.height()/e.recordHeight)-1)*e.recordHeight/4,r.stop().animate({scrollTop:l+s},250,"linear")})),0===this.records.length&&this.msgEmpty?$("#grid_"+this.name+"_body").append('<div id="grid_'+this.name+'_empty_msg" class="w2ui-grid-empty-msg"><div>'+this.msgEmpty+"</div></div>"):$("#grid_"+this.name+"_empty_msg").length>0&&$("#grid_"+this.name+"_empty_msg").remove(),this.summary.length>0){var c=this.getSummaryHTML();$("#grid_"+this.name+"_fsummary").html(c[0]).show(),$("#grid_"+this.name+"_summary").html(c[1]).show()}else $("#grid_"+this.name+"_fsummary").hide(),$("#grid_"+this.name+"_summary").hide()},render:function(e){var t=this,i=(new Date).getTime();if(null!=e&&($(this.box).find("#grid_"+this.name+"_body").length>0&&$(this.box).removeAttr("name").removeClass("w2ui-reset w2ui-grid w2ui-inactive").html(""),this.box=e),this.box){var n="object"!=typeof this.url?this.url:this.url.get,r=this.trigger({phase:"before",target:this.name,type:"render",box:e});if(!0!==r.isCancelled){if(this.reset(!0),!this.last.field)if(this.multiSearch&&this.show.searchAll)this.last.field="all",this.last.label=w2utils.lang("All Fields");else{for(var s=0;s<this.searches.length&&(this.searches[s].hidden||!1===this.searches[s].simple);)s++;s>=this.searches.length?(this.last.field="",this.last.label=""):(this.last.field=this.searches[s].field,this.last.label=this.searches[s].label)}if($(this.box).attr("name",this.name).addClass("w2ui-reset w2ui-grid w2ui-inactive").html('<div class="w2ui-grid-box">    <div id="grid_'+this.name+'_header" class="w2ui-grid-header"></div>    <div id="grid_'+this.name+'_toolbar" class="w2ui-grid-toolbar"></div>    <div id="grid_'+this.name+'_body" class="w2ui-grid-body"></div>    <div id="grid_'+this.name+'_fsummary" class="w2ui-grid-body w2ui-grid-summary"></div>    <div id="grid_'+this.name+'_summary" class="w2ui-grid-body w2ui-grid-summary"></div>    <div id="grid_'+this.name+'_footer" class="w2ui-grid-footer"></div>    <textarea id="grid_'+this.name+'_focus" class="w2ui-grid-focus-input" '+(w2utils.isIOS?"readonly":"")+"></textarea></div>"),"row"!=this.selectType&&$(this.box).addClass("w2ui-ss"),$(this.box).length>0&&($(this.box)[0].style.cssText+=this.style),this.initToolbar(),null!=this.toolbar&&this.toolbar.render($("#grid_"+this.name+"_toolbar")[0]),this.last.field&&"all"!=this.last.field){var o=this.searchData;setTimeout((function(){t.initAllField(t.last.field,1==o.length?o[0].value:null)}),1)}$("#grid_"+this.name+"_footer").html(this.getFooterHTML()),this.last.state||(this.last.state=this.stateSave(!0)),this.stateRestore(),n&&(this.clear(),this.refresh());for(var a,l=!1,u=0;u<this.searches.length;u++)if(this.searches[u].hidden){l=!0;break}return l?(this.searchReset(!1),n||setTimeout((function(){t.searchReset()}),1)):this.reload(),$(this.box).find("#grid_"+this.name+"_focus").on("focus",(function(e){clearTimeout(t.last.kbd_timer),t.hasFocus||t.focus()})).on("blur",(function(e){clearTimeout(t.last.kbd_timer),t.last.kbd_timer=setTimeout((function(){t.hasFocus&&t.blur()}),100)})).on("paste",(function(e){var i=e.originalEvent.clipboardData?e.originalEvent.clipboardData:null;if(i&&i.types&&-1!=i.types.indexOf("text/plain")){e.preventDefault();var n=i.getData("text/plain");-1!=n.indexOf("\r")&&-1==n.indexOf("\n")&&(n=n.replace(/\r/g,"\n")),w2ui[t.name].paste(n)}else{var r=this;setTimeout((function(){w2ui[t.name].paste(r.value),r.value=""}),1)}})).on("keydown",(function(e){w2ui[t.name].keydown.call(w2ui[t.name],e)})),$(this.box).off("mousedown").on("mousedown",(function(e){if(1==e.which&&("text"==t.last.userSelect&&(delete t.last.userSelect,$(t.box).find(".w2ui-grid-body").css(w2utils.cssPrefix("user-select","none"))),!("row"==t.selectType&&($(e.target).parents().hasClass("w2ui-head")||$(e.target).hasClass("w2ui-head"))||t.last.move&&"expand"==t.last.move.type))){if(e.altKey)$(t.box).find(".w2ui-grid-body").css(w2utils.cssPrefix("user-select","text")),t.selectNone(),t.last.move={type:"text-select"},t.last.userSelect="text";else{for(var i=e.target,n={x:e.offsetX-10,y:e.offsetY-10},r=!1;i&&(!i.classList||!i.classList.contains("w2ui-grid"));)i.tagName&&"TD"==i.tagName.toUpperCase()&&(r=!0),i.tagName&&"TR"!=i.tagName.toUpperCase()&&1==r&&(n.x+=i.offsetLeft,n.y+=i.offsetTop),i=i.parentNode;t.last.move={x:e.screenX,y:e.screenY,divX:0,divY:0,focusX:n.x,focusY:n.y,recid:$(e.target).parents("tr").attr("recid"),column:parseInt("TD"==e.target.tagName.toUpperCase()?$(e.target).attr("col"):$(e.target).parents("td").attr("col")),type:"select",ghost:!1,start:!0},null==t.last.move.recid&&(t.last.move.type="select-column");var s=e.target,o=$(t.box).find("#grid_"+t.name+"_focus");if(t.last.move){var a=t.last.move.focusX,l=t.last.move.focusY,u=$(s).parents("table").parent();(u.hasClass("w2ui-grid-records")||u.hasClass("w2ui-grid-frecords")||u.hasClass("w2ui-grid-columns")||u.hasClass("w2ui-grid-fcolumns")||u.hasClass("w2ui-grid-summary"))&&(a=t.last.move.focusX-$(t.box).find("#grid_"+t.name+"_records").scrollLeft(),l=t.last.move.focusY-$(t.box).find("#grid_"+t.name+"_records").scrollTop()),($(s).hasClass("w2ui-grid-footer")||$(s).parents("div.w2ui-grid-footer").length>0)&&(l=$(t.box).find("#grid_"+t.name+"_footer").position().top),u.hasClass("w2ui-scroll-wrapper")&&u.parent().hasClass("w2ui-toolbar")&&(a=t.last.move.focusX-u.scrollLeft()),o.css({left:a-10,top:l})}setTimeout((function(){-1!=["INPUT","TEXTAREA","SELECT"].indexOf(s.tagName.toUpperCase())?$(s).focus():o.is(":focus")||o.focus()}),50),t.multiSelect||t.reorderRows||"drag"!=t.last.move.type||delete t.last.move}if(1==t.reorderRows){var h=e.target;if("TD"!=h.tagName.toUpperCase()&&(h=$(h).parents("td")[0]),$(h).hasClass("w2ui-col-number")||$(h).hasClass("w2ui-col-order")){t.selectNone(),t.last.move.reorder=!0;var p=$(t.box).find(".w2ui-even.w2ui-empty-record").css("background-color"),f=$(t.box).find(".w2ui-odd.w2ui-empty-record").css("background-color");$(t.box).find(".w2ui-even td").not(".w2ui-col-number").css("background-color",p),$(t.box).find(".w2ui-odd td").not(".w2ui-col-number").css("background-color",f);var g=t.last.move;if(!g.ghost){var m=$("#grid_"+t.name+"_rec_"+g.recid);i=m.parents("table").find("tr:first-child").clone(),g.offsetY=e.offsetY,g.from=g.recid,g.pos=m.position(),g.ghost=$(m).clone(!0),g.ghost.removeAttr("id"),m.find("td").remove(),m.append('<td colspan="1000"><div style="height: '+t.recordHeight+'px; background-color: #eee; border-bottom: 1px dashed #aaa; border-top: 1px dashed #aaa;"></div></td>'),(y=$(t.box).find(".w2ui-grid-records")).append('<div id="grid_'+t.name+'_ghost_line" style="position: absolute; z-index: 999999; pointer-events: none; width: 100%;"></div>'),y.append('<table id="grid_'+t.name+'_ghost" style="position: absolute; z-index: 999998; opacity: 0.9; pointer-events: none;"></table>'),$("#grid_"+t.name+"_ghost").append(i).append(g.ghost)}var v=$("#grid_"+t.name+"_ghost"),y=$(t.box).find(".w2ui-grid-records");v.css({top:g.pos.top+y.scrollTop(),left:g.pos.left,"border-top":"1px solid #aaa","border-bottom":"1px solid #aaa"})}else t.last.move.reorder=!1}$(document).on("mousemove.w2ui-"+t.name,c).on("mouseup.w2ui-"+t.name,d),e.stopPropagation()}})),this.updateToolbar(),this.trigger($.extend(r,{phase:"after"})),0===$(".w2ui-layout").length&&$(window).off("resize.w2ui-"+t.name).on("resize.w2ui-"+t.name,(function(e){null==w2ui[t.name]?$(window).off("resize.w2ui-"+t.name):w2ui[t.name].resize()})),(new Date).getTime()-i}}function c(e){var i=t.last.move;if(i&&-1!=["select","select-column"].indexOf(i.type)&&(i.divX=e.screenX-i.x,i.divY=e.screenY-i.y,!(Math.abs(i.divX)<=1&&Math.abs(i.divY)<=1)))if(t.last.cancelClick=!0,1==t.reorderRows&&t.last.move.reorder){var n=$(t.box).find(".w2ui-grid-records");if("-none-"==(l=(p=$(e.target).parents("tr")).attr("recid"))&&(l="bottom"),l!=i.from){$("#grid_"+t.name+"_rec_"+i.recid);var r=$("#grid_"+t.name+"_rec_"+l);$(t.box).find(".insert-before"),r.addClass("insert-before"),i.lastY=e.screenY,i.to=l;var s=r.position(),o=$("#grid_"+t.name+"_ghost_line");s?o.css({top:s.top+n.scrollTop(),left:i.pos.left,"border-top":"2px solid #769EFC"}):o.css({"border-top":"2px solid transparent"})}$("#grid_"+t.name+"_ghost").css({top:i.pos.top+i.divY+n.scrollTop(),left:i.pos.left})}else{i.start&&i.recid&&(t.selectNone(),i.start=!1);var l,u=[];if(null==(l="TR"==e.target.tagName.toUpperCase()?$(e.target).attr("recid"):$(e.target).parents("tr").attr("recid"))){if("row"==t.selectType)return;if(t.last.move&&"select"==t.last.move.type)return;var c=parseInt($(e.target).parents("td").attr("col"));if(isNaN(c))t.removeRange("column-selection"),$(t.box).find(".w2ui-grid-columns .w2ui-col-header, .w2ui-grid-fcolumns .w2ui-col-header").removeClass("w2ui-col-selected"),$(t.box).find(".w2ui-col-number").removeClass("w2ui-row-selected"),delete i.colRange;else{var d=c+"-"+c;i.column<c&&(d=i.column+"-"+c),i.column>c&&(d=c+"-"+i.column);for(var h=[],p=d.split("-"),f=parseInt(p[0]);f<=parseInt(p[1]);f++)h.push(f);if(i.colRange!=d&&!0!==(a=t.trigger({phase:"before",type:"columnSelect",target:t.name,columns:h,isCancelled:!1})).isCancelled){null==i.colRange&&t.selectNone(),p=d.split("-"),$(t.box).find(".w2ui-grid-columns .w2ui-col-header, .w2ui-grid-fcolumns .w2ui-col-header").removeClass("w2ui-col-selected");for(var g=parseInt(p[0]);g<=parseInt(p[1]);g++)$(t.box).find("#grid_"+t.name+"_column_"+g+" .w2ui-col-header").addClass("w2ui-col-selected");$(t.box).find(".w2ui-col-number").not(".w2ui-head").addClass("w2ui-row-selected"),i.colRange=d,t.removeRange("column-selection"),t.addRange({name:"column-selection",range:[{recid:t.records[0].recid,column:p[0]},{recid:t.records[t.records.length-1].recid,column:p[1]}],style:"background-color: rgba(90, 145, 234, 0.1)"})}}}else{var m=t.get(i.recid,!0);if(null==m||t.records[m]&&t.records[m].recid!=i.recid)return;var v=t.get(l,!0);if(null==v)return;var y=parseInt(i.column),w=parseInt("TD"==e.target.tagName.toUpperCase()?$(e.target).attr("col"):$(e.target).parents("td").attr("col"));if(isNaN(y)&&isNaN(w)&&(y=0,w=t.columns.length-1),m>v&&(p=m,m=v,v=p),p="ind1:"+m+",ind2;"+v+",col1:"+y+",col2:"+w,i.range==p)return;i.range=p;for(var b=m;b<=v;b++)if(!(t.last.searchIds.length>0&&-1==t.last.searchIds.indexOf(b)))if("row"!=t.selectType){y>w&&(p=y,y=w,w=p),p=[];for(var x=y;x<=w;x++)t.columns[x].hidden||u.push({recid:t.records[b].recid,column:parseInt(x)})}else u.push(t.records[b].recid);if("row"!=t.selectType){for(var _=t.getSelection(),k=(p=[],0);k<u.length;k++){for(var C=!1,T=0;T<_.length;T++)u[k].recid==_[T].recid&&u[k].column==_[T].column&&(C=!0);C||p.push({recid:u[k].recid,column:u[k].column})}for(t.select(p),p=[],T=0;T<_.length;T++){for(C=!1,k=0;k<u.length;k++)u[k].recid==_[T].recid&&u[k].column==_[T].column&&(C=!0);C||p.push({recid:_[T].recid,column:_[T].column})}t.unselect(p)}else if(t.multiSelect){for(_=t.getSelection(),k=0;k<u.length;k++)-1==_.indexOf(u[k])&&t.select(u[k]);for(T=0;T<_.length;T++)-1==u.indexOf(_[T])&&t.unselect(_[T])}}}}function d(e){var i=t.last.move;if(setTimeout((function(){delete t.last.cancelClick}),1),!$(e.target).parents().hasClass(".w2ui-head")&&!$(e.target).hasClass(".w2ui-head")){if(i&&-1!=["select","select-column"].indexOf(i.type)){if(null!=i.colRange&&!0!==a.isCancelled){for(var n=i.colRange.split("-"),r=[],s=0;s<t.records.length;s++){for(var o=[],l=parseInt(n[0]);l<=parseInt(n[1]);l++)o.push(l);r.push({recid:t.records[s].recid,column:o})}t.removeRange("column-selection"),t.trigger($.extend(a,{phase:"after"})),t.select(r)}if(1==t.reorderRows&&t.last.move.reorder){var u=t.trigger({phase:"before",target:t.name,type:"reorderRow",recid:i.from,moveAfter:i.to});if(!0===u.isCancelled)return $("#grid_"+t.name+"_ghost").remove(),$("#grid_"+t.name+"_ghost_line").remove(),t.refresh(),void delete t.last.move;var c=t.get(i.from,!0),d=t.get(i.to,!0);"bottom"==i.to&&(d=t.records.length),n=t.records[c],null!=c&&null!=d&&(t.records.splice(c,1),c>d?t.records.splice(d,0,n):t.records.splice(d-1,0,n)),$("#grid_"+t.name+"_ghost").remove(),$("#grid_"+t.name+"_ghost_line").remove(),t.refresh(),t.trigger($.extend(u,{phase:"after"}))}}delete t.last.move,$(document).off(".w2ui-"+t.name)}}},destroy:function(){var e=this.trigger({phase:"before",target:this.name,type:"destroy"});!0!==e.isCancelled&&($(this.box).off(),"object"==typeof this.toolbar&&this.toolbar.destroy&&this.toolbar.destroy(),$(this.box).find("#grid_"+this.name+"_body").length>0&&$(this.box).removeAttr("name").removeClass("w2ui-reset w2ui-grid w2ui-inactive").html(""),delete w2ui[this.name],this.trigger($.extend(e,{phase:"after"})))},initColumnOnOff:function(){if(this.show.toolbarColumns){for(var e=this,t='<div class="w2ui-col-on-off"><table><tbody><tr id="grid_'+this.name+'_column_ln_check" onclick="w2ui[\''+e.name+'\'].columnOnOff(event, \'line-numbers\'); event.stopPropagation();">   <td style="width: 30px; text-align: center; padding-right: 3px; color: #888;">      <span class="w2ui-column-check w2ui-icon-'+(e.show.lineNumbers?"check":"empty")+'"></span>   </td>   <td>      <label>'+w2utils.lang("Line #")+"</label>   </td></tr>",i=0;i<this.columns.length;i++){var n=this.columns[i],r=this.columns[i].text;!1!==n.hideable&&(!r&&this.columns[i].tooltip&&(r=this.columns[i].tooltip),r||(r="- column "+(parseInt(i)+1)+" -"),t+='<tr id="grid_'+this.name+"_column_"+i+'_check"        onclick="w2ui[\''+e.name+"'].columnOnOff(event, '"+n.field+'\'); event.stopPropagation();">   <td style="width: 30px; text-align: center; padding-right: 3px; color: #888;">      <span class="w2ui-column-check w2ui-icon-'+(n.hidden?"empty":"check")+'"></span>   </td>   <td>       <label>'+w2utils.stripTags(r)+"</label>   </td></tr>")}var s="object"!=typeof this.url?this.url:this.url.get;(s&&e.show.skipRecords||e.show.saveRestoreState)&&(t+='<tr style="pointer-events: none"><td colspan="2"><div style="border-top: 1px solid #ddd;"></div></td></tr>'),s&&e.show.skipRecords&&(t+='<tr><td colspan="2" style="padding: 0px">    <div style="cursor: pointer; padding: 2px 8px; cursor: default">'+w2utils.lang("Skip")+'        <input type="text" style="width: 60px" value="'+this.offset+'"             onkeydown="if ([48,49,50,51,52,53,54,55,56,57,58,13,8,46,37,39].indexOf(event.keyCode) == -1) { event.preventDefault() }"            onkeypress="if (event.keyCode == 13) {                w2ui[\''+e.name+"'].skip(this.value);                jQuery('.w2ui-overlay')[0].hide();             }\"/> "+w2utils.lang("Records")+"    </div></td></tr>"),e.show.saveRestoreState&&(t+='<tr><td colspan="2" onclick="var obj = w2ui[\''+e.name+"']; obj.toolbar.uncheck('w2ui-column-on-off'); obj.stateSave();\">    <div style=\"cursor: pointer; padding: 4px 8px; cursor: default\">"+w2utils.lang("Save Grid State")+'</div></td></tr><tr><td colspan="2" onclick="var obj = w2ui[\''+e.name+"']; obj.toolbar.uncheck('w2ui-column-on-off'); obj.stateReset();\">    <div style=\"cursor: pointer; padding: 4px 8px; cursor: default\">"+w2utils.lang("Restore Default State")+"</div></td></tr>"),t+="</tbody></table></div>",this.toolbar.get("w2ui-column-on-off").html=t}},initColumnDrag:function(e){if(this.columnGroups&&this.columnGroups.length)throw"Draggable columns are not currently supported with column groups.";var t=this,i={};function n(){i.pressed=!1,clearTimeout(i.timeout)}function r(e){i.timeout&&clearTimeout(i.timeout);var n=this;i.pressed=!0,i.timeout=setTimeout((function(){if(i.pressed&&0!==i.numberPreColumnsPresent){var r,a,l,u,c,d=["w2ui-col-number","w2ui-col-expand","w2ui-col-select"].concat(["w2ui-head-last"]);if($(e.originalEvent.target).parents().hasClass("w2ui-head")){for(var h=0,p=d.length;h<p;h++)if($(e.originalEvent.target).parents().hasClass(d[h]))return;if(i.numberPreColumnsPresent=$(t.box).find(".w2ui-head.w2ui-col-number, .w2ui-head.w2ui-col-expand, .w2ui-head.w2ui-col-select").length,i.columnHead=u=$(e.originalEvent.target).parents(".w2ui-head"),i.originalPos=c=parseInt(u.attr("col"),10),!0===(r=t.trigger({type:"columnDragStart",phase:"before",originalEvent:e,origColumnNumber:c,target:u[0]})).isCancelled)return!1;for(a=i.columns=$(t.box).find(".w2ui-head:not(.w2ui-head-last)"),$(document).on("mouseup",o),$(document).on("mousemove",s),i.ghost=$(n).clone(!0),$(i.ghost).find('[col]:not([col="'+i.originalPos+'"]), .w2ui-toolbar, .w2ui-grid-header').remove(),$(i.ghost).find(".w2ui-col-number, .w2ui-col-expand, .w2ui-col-select").remove(),$(i.ghost).find(".w2ui-grid-body").css({top:0}),l=$(i.ghost).find('[col="'+i.originalPos+'"]'),$(document.body).append(i.ghost),$(i.ghost).css({width:0,height:0,margin:0,position:"fixed",zIndex:999999,opacity:0}).addClass(".w2ui-grid-ghost").animate({width:l.width(),height:$(t.box).find(".w2ui-grid-body:first").height(),left:e.pageX,top:e.pageY,opacity:.8},0),i.offsets=[],h=0,p=a.length;h<p;h++)i.offsets.push($(a[h]).offset().left);t.trigger($.extend(r,{phase:"after"}))}}}),150)}function s(e){if(i.pressed){var t=e.originalEvent.pageX,n=e.originalEvent.pageY,r=i.offsets,s=$(".w2ui-head:not(.w2ui-head-last)").width();i.targetInt=Math.max(i.numberPreColumnsPresent,function(e,t,i){if(e<=t[0])return 0;if(e>=t[t.length-1]+i)return t.length;for(var n=0,r=t.length;n<r;n++){var s=t[n],o=t[n+1]||t[n]+i,a=(o-t[n])/2+t[n];if(e>s&&e<=a)return n;if(e>a&&e<=o)return n+1}return intersection}(t,r,s)),function(e){i.marker||i.markerLeft||(i.marker=$('<div class="col-intersection-marker"><div class="top-marker"></div><div class="bottom-marker"></div></div>'),i.markerLeft=$('<div class="col-intersection-marker"><div class="top-marker"></div><div class="bottom-marker"></div></div>')),i.lastInt&&i.lastInt===e||(i.lastInt=e,i.marker.remove(),i.markerLeft.remove(),$(".w2ui-head").removeClass("w2ui-col-intersection"),e>=i.columns.length?($(i.columns[i.columns.length-1]).children("div:last").append(i.marker.addClass("right").removeClass("left")),$(i.columns[i.columns.length-1]).addClass("w2ui-col-intersection")):e<=i.numberPreColumnsPresent?($(i.columns[i.numberPreColumnsPresent]).prepend(i.marker.addClass("left").removeClass("right")).css({position:"relative"}),$(i.columns[i.numberPreColumnsPresent]).prev().addClass("w2ui-col-intersection")):($(i.columns[e]).children("div:last").prepend(i.marker.addClass("left").removeClass("right")),$(i.columns[e]).prev().children("div:last").append(i.markerLeft.addClass("right").removeClass("left")).css({position:"relative"}),$(i.columns[e-1]).addClass("w2ui-col-intersection")))}(i.targetInt),function(e,t){$(i.ghost).css({left:e-10,top:t-10})}(t,n)}}function o(e){i.pressed=!1;var n,r,a,l,u,c=$(".w2ui-grid-ghost");if(!0===(n=t.trigger({type:"columnDragEnd",phase:"before",originalEvent:e,target:i.columnHead[0]})).isCancelled)return!1;a=t.columns[i.originalPos],l=t.columns,u=$(i.columns[Math.min(i.lastInt,i.columns.length-1)]),(r=i.lastInt<i.columns.length?parseInt(u.attr("col")):l.length)!==i.originalPos+1&&r!==i.originalPos&&u&&u.length?($(i.ghost).animate({top:$(t.box).offset().top,left:u.offset().left,width:0,height:0,opacity:.2},300,(function(){$(this).remove(),c.remove()})),l.splice(r,0,$.extend({},a)),l.splice(l.indexOf(a),1)):($(i.ghost).remove(),c.remove()),$(document).off("mouseup",o),$(document).off("mousemove",s),i.marker&&i.marker.remove(),i={},t.refresh(),t.trigger($.extend(n,{phase:"after",targetColumnNumber:r-1}))}return i.lastInt=null,i.pressed=!1,i.timeout=null,i.columnHead=null,$(t.box).on("mousedown",r),$(t.box).on("mouseup",n),{remove:function(){$(t.box).off("mousedown",r),$(t.box).off("mouseup",n),$(t.box).find(".w2ui-head").removeAttr("draggable"),t.last.columnDrag=!1}}},columnOnOff:function(e,t){var i=$(e.target).parents("tr").find(".w2ui-column-check"),n=this.trigger({phase:"before",target:this.name,type:"columnOnOff",field:t,originalEvent:e});if(!0!==n.isCancelled){for(var r=this,s=!(e.shiftKey||e.metaKey||e.ctrlKey||$(e.target).hasClass("w2ui-column-check")),o=r.find({"w2ui.expanded":!0},!0),a=0;a<o.length;a++){var l=this.records[a].w2ui;l&&!Array.isArray(l.children)&&(this.records[a].w2ui.expanded=!1)}if("line-numbers"==t)this.show.lineNumbers=!this.show.lineNumbers,this.show.lineNumbers?i.addClass("w2ui-icon-check").removeClass("w2ui-icon-empty"):i.addClass("w2ui-icon-empty").removeClass("w2ui-icon-check"),this.refreshBody(),this.resizeRecords();else{var u=this.getColumn(t);u.hidden?(i.addClass("w2ui-icon-check").removeClass("w2ui-icon-empty"),setTimeout((function(){r.showColumn(u.field)}),s?0:50)):(i.addClass("w2ui-icon-empty").removeClass("w2ui-icon-check"),setTimeout((function(){r.hideColumn(u.field)}),s?0:50))}s&&setTimeout((function(){$().w2overlay({name:r.name+"_toolbar"})}),40),this.trigger($.extend(n,{phase:"after"}))}},scrollToColumn:function(e){if(null!=e){for(var t=0,i=!1,n=0;n<this.columns.length;n++){var r=this.columns[n];if(r.field==e){i=!0;break}r.frozen||r.hidden||(t+=parseInt(r.sizeCalculated?r.sizeCalculated:r.size))}i&&(this.last.scrollLeft=t+1,this.scroll())}},initToolbar:function(){var e=this;if(null==this.toolbar.render){var t=this.toolbar.items||[];if(this.toolbar.items=[],this.toolbar=$().w2toolbar($.extend(!0,{},this.toolbar,{name:this.name+"_toolbar",owner:this})),this.show.toolbarReload&&this.toolbar.items.push($.extend(!0,{},this.buttons.reload)),this.show.toolbarColumns&&this.toolbar.items.push($.extend(!0,{},this.buttons.columns)),(this.show.toolbarReload||this.show.toolbarColumns)&&this.toolbar.items.push({type:"break",id:"w2ui-break0"}),this.show.toolbarInput){var i='<div class="w2ui-toolbar-search"><table cellpadding="0" cellspacing="0"><tbody><tr>    <td>'+this.buttons.search.html+'</td>    <td>        <input type="text" id="grid_'+this.name+'_search_all" class="w2ui-search-all" tabindex="-1"             autocapitalize="off" autocomplete="off" autocorrect="off" spellcheck="false"            placeholder="'+w2utils.lang(this.last.label)+'" value="'+this.last.search+'"            onfocus="var grid = w2ui[\''+this.name+'\']; clearTimeout(grid.last.kbd_timer); grid.searchShowFields(true); grid.searchClose()"            onkeydown="if (event.keyCode == 13 &amp;&amp; w2utils.isIE) this.onchange();"            onchange="                var grid = w2ui[\''+this.name+"'];                 var val = this.value;                 var sel = jQuery(this).data('selected');                var fld = jQuery(this).data('w2field');                 if (fld) val = fld.clean(val);                if (fld &amp;&amp; fld.type == 'list' &amp;&amp; sel &amp;&amp; typeof sel.id == 'undefined') {                   grid.searchReset();                } else {                   grid.search(grid.last.field, val);                }            \"/>    </td>    <td>        <div class=\"w2ui-search-clear\" id=\"grid_"+this.name+'_searchClear"               onclick="var obj = w2ui[\''+this.name+'\']; obj.searchReset();" style="display: none"        >&#160;&#160;</div>    </td></tr></tbody></table></div>';this.toolbar.items.push({type:"html",id:"w2ui-search",html:i})}if(this.show.toolbarSearch&&this.multiSearch&&this.searches.length>0&&this.toolbar.items.push($.extend(!0,{},this.buttons["search-go"])),(this.show.toolbarSearch||this.show.toolbarInput)&&(this.show.toolbarAdd||this.show.toolbarEdit||this.show.toolbarDelete||this.show.toolbarSave)&&this.toolbar.items.push({type:"break",id:"w2ui-break1"}),this.show.toolbarAdd&&Array.isArray(t)&&-1==t.map((function(e){return e.id})).indexOf(this.buttons.add.id)&&this.toolbar.items.push($.extend(!0,{},this.buttons.add)),this.show.toolbarEdit&&Array.isArray(t)&&-1==t.map((function(e){return e.id})).indexOf(this.buttons.edit.id)&&this.toolbar.items.push($.extend(!0,{},this.buttons.edit)),this.show.toolbarDelete&&Array.isArray(t)&&-1==t.map((function(e){return e.id})).indexOf(this.buttons.delete.id)&&this.toolbar.items.push($.extend(!0,{},this.buttons.delete)),this.show.toolbarSave&&Array.isArray(t)&&-1==t.map((function(e){return e.id})).indexOf(this.buttons.save.id)&&((this.show.toolbarAdd||this.show.toolbarDelete||this.show.toolbarEdit)&&this.toolbar.items.push({type:"break",id:"w2ui-break2"}),this.toolbar.items.push($.extend(!0,{},this.buttons.save))),t)for(var n=0;n<t.length;n++)this.toolbar.items.push(t[n]);e=this,this.toolbar.on("click",(function(t){var i=e.trigger({phase:"before",type:"toolbar",target:t.target,originalEvent:t});if(!0!==i.isCancelled){var n=t.target;switch(n){case"w2ui-reload":if(!0===(r=e.trigger({phase:"before",type:"reload",target:e.name})).isCancelled)return!1;e.reload(),e.trigger($.extend(r,{phase:"after"}));break;case"w2ui-column-on-off":e.initColumnOnOff(),e.initResize(),e.resize();break;case"w2ui-search-advanced":this.get(n).checked?e.searchClose():e.searchOpen(),e.toolbar.tooltipHide("w2ui-search-advanced"),t.preventDefault();break;case"w2ui-add":if(!0===(r=e.trigger({phase:"before",target:e.name,type:"add",recid:null})).isCancelled)return!1;e.trigger($.extend(r,{phase:"after"})),setTimeout((function(){$().w2tag()}),20);break;case"w2ui-edit":var r,s=e.getSelection(),o=null;if(1==s.length&&(o=s[0]),!0===(r=e.trigger({phase:"before",target:e.name,type:"edit",recid:o})).isCancelled)return!1;e.trigger($.extend(r,{phase:"after"})),setTimeout((function(){$().w2tag()}),20);break;case"w2ui-delete":e.delete();break;case"w2ui-save":e.save()}e.trigger($.extend(i,{phase:"after"}))}})),this.toolbar.on("refresh",(function(t){if("w2ui-search"==t.target){var i=e.searchData;setTimeout((function(){e.initAllField(e.last.field,1==i.length?i[0].value:null)}),1)}}))}},initResize:function(){var e=this;$(this.box).find(".w2ui-resizer").off(".grid-col-resize").on("click.grid-col-resize",(function(e){e.stopPropagation?e.stopPropagation():e.cancelBubble=!0,e.preventDefault&&e.preventDefault()})).on("mousedown.grid-col-resize",(function(t){t||(t=window.event),e.resizing=!0,e.last.tmp={x:t.screenX,y:t.screenY,gx:t.screenX,gy:t.screenY,col:parseInt($(this).attr("name"))},e.last.tmp.tds=$("#grid_"+e.name+"_body table tr:first-child td[col="+e.last.tmp.col+"]"),t.stopPropagation?t.stopPropagation():t.cancelBubble=!0,t.preventDefault&&t.preventDefault();for(var i=0;i<e.columns.length;i++)e.columns[i].hidden||(null==e.columns[i].sizeOriginal&&(e.columns[i].sizeOriginal=e.columns[i].size),e.columns[i].size=e.columns[i].sizeCalculated);var n,r={phase:"before",type:"columnResize",target:e.name,column:e.last.tmp.col,field:e.columns[e.last.tmp.col].field};r=e.trigger($.extend(r,{resizeBy:0,originalEvent:t})),$(document).off(".grid-col-resize").on("mousemove.grid-col-resize",(function(t){if(1==e.resizing)if(t||(t=window.event),!0!==(r=e.trigger($.extend(r,{resizeBy:t.screenX-e.last.tmp.gx,originalEvent:t}))).isCancelled){e.last.tmp.x=t.screenX-e.last.tmp.x,e.last.tmp.y=t.screenY-e.last.tmp.y;var i=parseInt(e.columns[e.last.tmp.col].size)+e.last.tmp.x+"px";e.columns[e.last.tmp.col].size=i,n&&clearTimeout(n),n=setTimeout((function(){e.resizeRecords(),e.scroll()}),100),e.last.tmp.tds.css({width:i}),e.last.tmp.x=t.screenX,e.last.tmp.y=t.screenY}else r.isCancelled=!1})).on("mouseup.grid-col-resize",(function(t){delete e.resizing,$(document).off(".grid-col-resize"),e.resizeRecords(),e.scroll(),e.trigger($.extend(r,{phase:"after",originalEvent:t}))}))})).on("dblclick.grid-col-resize",(function(t){var i=parseInt($(this).attr("name")),n=e.columns[i],r=0;if(!1===n.autoResize)return!0;t.stopPropagation?t.stopPropagation():t.cancelBubble=!0,t.preventDefault&&t.preventDefault(),$('.w2ui-grid-records td[col="'+i+'"] > div',e.box).each((function(){var e=this.offsetWidth-this.scrollWidth;e<r&&(r=e-3)}));var s={phase:"before",type:"columnAutoResize",target:e.name,column:n,field:n.field};!0!==(s=e.trigger($.extend(s,{resizeBy:Math.abs(r),originalEvent:t}))).isCancelled?(r<0&&(n.size=Math.min(parseInt(n.size)+Math.abs(r),n.max||1/0)+"px",e.resizeRecords(),e.resizeRecords(),e.scroll()),e.trigger($.extend(s,{phase:"after",originalEvent:t}))):s.isCancelled=!1})).each((function(e,t){var i=$(t).parent();$(t).css({height:i.height(),"margin-left":i.width()-3+"px"})}))},resizeBoxes:function(){var e=$("#grid_"+this.name+"_header"),t=$("#grid_"+this.name+"_toolbar"),i=$("#grid_"+this.name+"_fsummary"),n=$("#grid_"+this.name+"_summary"),r=$("#grid_"+this.name+"_footer"),s=$("#grid_"+this.name+"_body");this.show.header&&e.css({top:"0px",left:"0px",right:"0px"}),this.show.toolbar&&t.css({top:0+(this.show.header?w2utils.getSize(e,"height"):0)+"px",left:"0px",right:"0px"}),this.summary.length>0&&(i.css({bottom:0+(this.show.footer?w2utils.getSize(r,"height"):0)+"px"}),n.css({bottom:0+(this.show.footer?w2utils.getSize(r,"height"):0)+"px",right:"0px"})),this.show.footer&&r.css({bottom:"0px",left:"0px",right:"0px"}),s.css({top:0+(this.show.header?w2utils.getSize(e,"height"):0)+(this.show.toolbar?w2utils.getSize(t,"height"):0)+"px",bottom:0+(this.show.footer?w2utils.getSize(r,"height"):0)+(this.summary.length>0?w2utils.getSize(n,"height"):0)+"px",left:"0px",right:"0px"})},resizeRecords:function(){var e=this;$(this.box).find(".w2ui-empty-record").remove();var t=$(this.box),i=$(this.box).find("> div.w2ui-grid-box"),n=$("#grid_"+this.name+"_header"),r=$("#grid_"+this.name+"_toolbar"),s=$("#grid_"+this.name+"_summary"),o=$("#grid_"+this.name+"_fsummary"),a=$("#grid_"+this.name+"_footer"),l=$("#grid_"+this.name+"_body"),u=$("#grid_"+this.name+"_columns"),c=$("#grid_"+this.name+"_fcolumns"),d=$("#grid_"+this.name+"_records"),h=$("#grid_"+this.name+"_frecords"),p=$("#grid_"+this.name+"_scroll1"),f=8*String(this.total).length+10;f<34&&(f=34),null!=this.lineNumberWidth&&(f=this.lineNumberWidth);for(var g=!1,m=!1,v=0,y=0;y<e.columns.length;y++)e.columns[y].frozen||e.columns[y].hidden||(v+=parseInt(e.columns[y].sizeCalculated?e.columns[y].sizeCalculated:e.columns[y].size));if(d.width()<v&&(g=!0),l.height()-u.height()<$(d).find(">table").height()+(g?w2utils.scrollBarSize():0)&&(m=!0),this.fixedBody)w=i.height()-(this.show.header?w2utils.getSize(n,"height"):0)-(this.show.toolbar?w2utils.getSize(r,"height"):0)-("none"!=s.css("display")?w2utils.getSize(s,"height"):0)-(this.show.footer?w2utils.getSize(a,"height"):0),l.css("height",w);else{var w=w2utils.getSize(u,"height")+w2utils.getSize($("#grid_"+e.name+"_records table"),"height")+(g?w2utils.scrollBarSize():0);e.height=w+w2utils.getSize(i,"+height")+(e.show.header?w2utils.getSize(n,"height"):0)+(e.show.toolbar?w2utils.getSize(r,"height"):0)+("none"!=s.css("display")?w2utils.getSize(s,"height"):0)+(e.show.footer?w2utils.getSize(a,"height"):0),i.css("height",e.height),l.css("height",w),t.css("height",w2utils.getSize(i,"height")+w2utils.getSize(t,"+height"))}var b=this.records.length,x="object"!=typeof this.url?this.url:this.url.get;if(0==this.searchData.length||x||(b=this.last.searchIds.length),this.fixedBody||(m=!1),g||m?(u.find("> table > tbody > tr:nth-child(1) td.w2ui-head-last").css("width",w2utils.scrollBarSize()).show(),d.css({top:(this.columnGroups.length>0&&this.show.columns?1:0)+w2utils.getSize(u,"height")+"px","-webkit-overflow-scrolling":"touch","overflow-x":g?"auto":"hidden","overflow-y":m?"auto":"hidden"})):(u.find("> table > tbody > tr:nth-child(1) td.w2ui-head-last").hide(),d.css({top:(this.columnGroups.length>0&&this.show.columns?1:0)+w2utils.getSize(u,"height")+"px",overflow:"hidden"}),d.length>0&&(this.last.scrollTop=0,this.last.scrollLeft=0)),g?(h.css("margin-bottom",w2utils.scrollBarSize()),p.show()):(h.css("margin-bottom",0),p.hide()),h.css({overflow:"hidden",top:d.css("top")}),this.show.emptyRecords&&!m){var _=Math.floor(d.height()/this.recordHeight)-1,k=0;if(d[0]&&(k=d[0].scrollHeight-_*this.recordHeight),k>=this.recordHeight&&(k-=this.recordHeight,_++),this.fixedBody){for(var C=b;C<_;C++)T(C,this.recordHeight,this);T(_,k,this)}}function T(e,t,i){var n="",r="",s="";n+='<tr class="'+(e%2?"w2ui-even":"w2ui-odd")+' w2ui-empty-record" recid="-none-" style="height: '+t+'px">',r+='<tr class="'+(e%2?"w2ui-even":"w2ui-odd")+' w2ui-empty-record" recid="-none-" style="height: '+t+'px">',i.show.lineNumbers&&(n+='<td class="w2ui-col-number"></td>'),i.show.selectColumn&&(n+='<td class="w2ui-grid-data w2ui-col-select"></td>'),i.show.expandColumn&&(n+='<td class="w2ui-grid-data w2ui-col-expand"></td>'),r+='<td class="w2ui-grid-data-spacer" col="start" style="border-right: 0"></td>',i.show.orderColumn&&(r+='<td class="w2ui-grid-data w2ui-col-order" col="order"></td>');for(var o=0;o<i.columns.length;o++){var a=i.columns[o];(a.hidden||o<i.last.colStart||o>i.last.colEnd)&&!a.frozen||(s='<td class="w2ui-grid-data" '+(null!=a.attr?a.attr:"")+' col="'+o+'"></td>',a.frozen?n+=s:r+=s)}n+='<td class="w2ui-grid-data-last"></td> </tr>',r+='<td class="w2ui-grid-data-last" col="end"></td> </tr>',$("#grid_"+i.name+"_frecords > table").append(n),$("#grid_"+i.name+"_records > table").append(r)}if(l.length>0){var S=parseInt(l.width())-(m?w2utils.scrollBarSize():0)-(this.show.lineNumbers?f:0)-(this.show.selectColumn?26:0)-(this.show.expandColumn?26:0)-1,O=S,E=0,I=!1;for(y=0;y<this.columns.length;y++)(A=this.columns[y]).gridMinWidth>0&&(A.gridMinWidth>O&&!0!==A.hidden&&(A.hidden=!0,I=!0),A.gridMinWidth<O&&!0===A.hidden&&(A.hidden=!1,I=!0));if(!0===I)return void this.refresh();for(y=0;y<this.columns.length;y++)(A=this.columns[y]).hidden||("px"==String(A.size).substr(String(A.size).length-2).toLowerCase()?(S-=parseFloat(A.size),this.columns[y].sizeCalculated=A.size,this.columns[y].sizeType="px"):(E+=parseFloat(A.size),this.columns[y].sizeType="%",delete A.sizeCorrected));if(100!=E&&E>0)for(y=0;y<this.columns.length;y++)(A=this.columns[y]).hidden||"%"==A.sizeType&&(A.sizeCorrected=Math.round(100*parseFloat(A.size)*100/E)/100+"%");for(y=0;y<this.columns.length;y++)(A=this.columns[y]).hidden||"%"==A.sizeType&&(null!=this.columns[y].sizeCorrected?this.columns[y].sizeCalculated=Math.floor(S*parseFloat(A.sizeCorrected)/100)-1+"px":this.columns[y].sizeCalculated=Math.floor(S*parseFloat(A.size)/100)-1+"px")}var D=0;for(y=0;y<this.columns.length;y++)(A=this.columns[y]).hidden||(null==A.min&&(A.min=20),parseInt(A.sizeCalculated)<parseInt(A.min)&&(A.sizeCalculated=A.min+"px"),parseInt(A.sizeCalculated)>parseInt(A.max)&&(A.sizeCalculated=A.max+"px"),D+=parseInt(A.sizeCalculated));var z=parseInt(O)-parseInt(D);if(z>0&&E>0)for(y=0;;){var A;if(null!=(A=this.columns[y]))if(A.hidden||"px"==A.sizeType)y++;else{if(A.sizeCalculated=parseInt(A.sizeCalculated)+1+"px",0==--z)break;y++}else y=0}else z>0&&u.find("> table > tbody > tr:nth-child(1) td.w2ui-head-last").css("width",w2utils.scrollBarSize()).show();var P=1;for(this.show.lineNumbers&&(P+=f),this.show.selectColumn&&(P+=26),this.show.expandColumn&&(P+=26),y=0;y<this.columns.length;y++)this.columns[y].hidden||this.columns[y].frozen&&(P+=parseInt(this.columns[y].sizeCalculated));c.css("width",P),h.css("width",P),o.css("width",P),p.css("width",P),u.css("left",P),d.css("left",P),s.css("left",P),u.find("> table > tbody > tr:nth-child(1) td").add(c.find("> table > tbody > tr:nth-child(1) td")).each((function(t,i){$(i).hasClass("w2ui-col-number")&&$(i).css("width",f);var n=$(i).attr("col");if(null!=n){if("start"==n){for(var r=0,s=0;s<e.last.colStart;s++)!e.columns[s]||e.columns[s].frozen||e.columns[s].hidden||(r+=parseInt(e.columns[s].sizeCalculated));$(i).css("width",r+"px")}e.columns[n]&&$(i).css("width",e.columns[n].sizeCalculated)}if($(i).hasClass("w2ui-head-last"))if(e.last.colEnd+1<e.columns.length){for(r=0,s=e.last.colEnd+1;s<e.columns.length;s++)!e.columns[s]||e.columns[s].frozen||e.columns[s].hidden||(r+=parseInt(e.columns[s].sizeCalculated));$(i).css("width",r+"px")}else $(i).css("width",w2utils.scrollBarSize()+(z>0&&0===E?z:0)+"px")})),3==u.find("> table > tbody > tr").length&&u.find("> table > tbody > tr:nth-child(1) td").add(c.find("> table > tbody > tr:nth-child(1) td")).html("").css({height:"0px",border:"0px",padding:"0px",margin:"0px"}),d.find("> table > tbody > tr:nth-child(1) td").add(h.find("> table > tbody > tr:nth-child(1) td")).each((function(t,i){$(i).hasClass("w2ui-col-number")&&$(i).css("width",f);var n=$(i).attr("col");if(null!=n){if("start"==n){for(var r=0,s=0;s<e.last.colStart;s++)!e.columns[s]||e.columns[s].frozen||e.columns[s].hidden||(r+=parseInt(e.columns[s].sizeCalculated));$(i).css("width",r+"px")}e.columns[n]&&$(i).css("width",e.columns[n].sizeCalculated)}if($(i).hasClass("w2ui-grid-data-last")&&0===$(i).parents(".w2ui-grid-frecords").length)if(e.last.colEnd+1<e.columns.length){for(r=0,s=e.last.colEnd+1;s<e.columns.length;s++)!e.columns[s]||e.columns[s].frozen||e.columns[s].hidden||(r+=parseInt(e.columns[s].sizeCalculated));$(i).css("width",r+"px")}else $(i).css("width",(z>0&&0===E?z:0)+"px")})),s.find("> table > tbody > tr:nth-child(1) td").add(o.find("> table > tbody > tr:nth-child(1) td")).each((function(t,i){$(i).hasClass("w2ui-col-number")&&$(i).css("width",f);var n=$(i).attr("col");if(null!=n){if("start"==n){for(var r=0,s=0;s<e.last.colStart;s++)!e.columns[s]||e.columns[s].frozen||e.columns[s].hidden||(r+=parseInt(e.columns[s].sizeCalculated));$(i).css("width",r+"px")}e.columns[n]&&$(i).css("width",e.columns[n].sizeCalculated)}$(i).hasClass("w2ui-grid-data-last")&&0===$(i).parents(".w2ui-grid-frecords").length&&$(i).css("width",w2utils.scrollBarSize()+(z>0&&0===E?z:0)+"px")})),this.initResize(),this.refreshRanges(),(this.last.scrollTop||this.last.scrollLeft)&&d.length>0&&(u.prop("scrollLeft",this.last.scrollLeft),d.prop("scrollTop",this.last.scrollTop),d.prop("scrollLeft",this.last.scrollLeft))},getSearchesHTML:function(){for(var e=this,t='<table cellspacing="0"><tbody>',i=!1,n=0;n<this.searches.length;n++){var r=this.searches[n];if(r.type=String(r.type).toLowerCase(),!r.hidden){var s="";0==i&&(s='<button type="button" class="w2ui-btn close-btn" onclick="obj = w2ui[\''+this.name+"']; if (obj) obj.searchClose()\">X</button>",i=!0),null==r.inTag&&(r.inTag=""),null==r.outTag&&(r.outTag=""),null==r.style&&(r.style=""),null==r.type&&(r.type="text"),null==r.label&&null!=r.caption&&(console.log("NOTICE: grid search.caption property is deprecated, please use search.label. Search ->",r),r.label=r.caption);var o='<select id="grid_'+this.name+"_operator_"+n+'" class="w2ui-input"    onchange="w2ui[\''+this.name+"'].initOperator(this, "+n+')">'+l(r.type,r.operators)+"</select>";switch(t+='<tr>    <td class="close-btn">'+s+'</td>    <td class="caption">'+(r.label||"")+'</td>    <td class="operator">'+o+'</td>    <td class="value">',r.type){case"text":case"alphanumeric":case"hex":case"color":case"list":case"combo":case"enum":var a="width: 250px;";-1!=["hex","color"].indexOf(r.type)&&(a="width: 90px;"),t+='<input rel="search" type="text" id="grid_'+this.name+"_field_"+n+'" name="'+r.field+'"    class="w2ui-input" style="'+a+r.style+'" '+r.inTag+"/>";break;case"int":case"float":case"money":case"currency":case"percent":case"date":case"time":case"datetime":a="width: 90px;","datetime"==r.type&&(a="width: 140px;"),t+='<input rel="search" type="text" class="w2ui-input" style="'+a+r.style+'" id="grid_'+this.name+"_field_"+n+'" name="'+r.field+'" '+r.inTag+'/><span id="grid_'+this.name+"_range_"+n+'" style="display: none">&#160;-&#160;&#160;<input rel="search" type="text" class="w2ui-input" style="'+a+r.style+'" id="grid_'+this.name+"_field2_"+n+'" name="'+r.field+'" '+r.inTag+"/></span>";break;case"select":t+='<select rel="search" class="w2ui-input" style="'+r.style+'" id="grid_'+this.name+"_field_"+n+'"  name="'+r.field+'" '+r.inTag+"></select>"}t+=r.outTag+"    </td></tr>"}}return t+'<tr>    <td colspan="4" class="actions">        <div>        <button type="button" class="w2ui-btn" onclick="obj = w2ui[\''+this.name+"']; if (obj) { obj.searchReset(); }\">"+w2utils.lang("Reset")+'</button>        <button type="button" class="w2ui-btn w2ui-btn-blue" onclick="obj = w2ui[\''+this.name+"']; if (obj) { obj.search(); }\">"+w2utils.lang("Search")+"</button>        </div>    </td></tr></tbody></table>";function l(t,i){var n="",r=e.operators[e.operatorsMap[t]];null!=i&&(r=i);for(var s=0;s<r.length;s++){var o=r[s],a=o;Array.isArray(o)?(a=o[1],o=o[0],null==a&&(a=o)):$.isPlainObject(o)&&(a=o.text,o=o.oper),n+='<option value="'+o+'">'+w2utils.lang(a)+"</option>\n"}return n}},initOperator:function(e,t){var i=this,n=i.searches[t],r=$("#grid_"+i.name+"_range_"+t),s=$("#grid_"+i.name+"_field_"+t),o=s.parent().find("span input");switch(s.show(),r.hide(),$(e).val()){case"between":r.show(),o.w2field(n.type,n.options);break;case"not null":case"null":s.hide(),s.val("1"),s.change()}},initSearches:function(){for(var e=this,t=0;t<this.searches.length;t++){var i=this.searches[t],n=this.getSearchData(i.field);i.type=String(i.type).toLowerCase();var r=e.operators[e.operatorsMap[i.type]];i.operators&&(r=i.operators);var s=r[0];$.isPlainObject(s)&&(s=s.oper),"object"!=typeof i.options&&(i.options={}),"text"==i.type&&(s=this.textSearch);for(var o=0;o<r.length;o++){var a=r[o];if($.isPlainObject(a)&&(a=a.oper),i.operator==a){s=i.operator;break}}switch(i.type){case"text":case"alphanumeric":$("#grid_"+this.name+"_field_"+t).w2field(i.type,i.options);break;case"int":case"float":case"hex":case"color":case"money":case"currency":case"percent":case"date":case"time":case"datetime":$("#grid_"+this.name+"_field_"+t).w2field(i.type,i.options),$("#grid_"+this.name+"_field2_"+t).w2field(i.type,i.options),setTimeout((function(){$("#grid_"+e.name+"_field_"+t).keydown(),$("#grid_"+e.name+"_field2_"+t).keydown()}),1);break;case"list":case"combo":case"enum":var l=i.options;"list"==i.type&&(l.selected={}),"enum"==i.type&&(l.selected=[]),n&&(l.selected=n.value),$("#grid_"+this.name+"_field_"+t).w2field(i.type,$.extend({openOnFocus:!0},l)),n&&null!=n.text&&$("#grid_"+this.name+"_field_"+t).data("selected",{id:n.value,text:n.text});break;case"select":for(l='<option value="">--</option>',o=0;o<i.options.items.length;o++){var u=i.options.items[o];if($.isPlainObject(i.options.items[o])){var c=u.id,d=u.text;null==c&&null!=u.value&&(c=u.value),null==d&&null!=u.text&&(d=u.text),null==c&&(c=""),l+='<option value="'+c+'">'+d+"</option>"}else l+='<option value="'+u+'">'+u+"</option>"}$("#grid_"+this.name+"_field_"+t).html(l)}null!=n?("int"==n.type&&-1!=["in","not in"].indexOf(n.operator)&&$("#grid_"+this.name+"_field_"+t).w2field("clear").val(n.value),$("#grid_"+this.name+"_operator_"+t).val(n.operator).trigger("change"),$.isArray(n.value)?-1!=["in","not in"].indexOf(n.operator)?$("#grid_"+this.name+"_field_"+t).val(n.value).trigger("change"):($("#grid_"+this.name+"_field_"+t).val(n.value[0]).trigger("change"),$("#grid_"+this.name+"_field2_"+t).val(n.value[1]).trigger("change")):null!=n.value&&$("#grid_"+this.name+"_field_"+t).val(n.value).trigger("change")):$("#grid_"+this.name+"_operator_"+t).val(s).trigger("change")}$("#w2ui-overlay-"+this.name+"-searchOverlay .w2ui-grid-searches *[rel=search]").on("keypress",(function(t){13==t.keyCode&&(e.search(),$().w2overlay({name:e.name+"-searchOverlay"}))}))},getColumnsHTML:function(){var e=this,t="",i="";if(this.show.columnHeaders)if(this.columnGroups.length>0){var n=a(!0),r=function(){var t="<tr>",i="<tr>",n="",r=e.columnGroups.length-1;null==e.columnGroups[r].text&&null!=e.columnGroups[r].caption&&(console.log("NOTICE: grid columnGroup.caption property is deprecated, please use columnGroup.text. Group -> ",e.columnGroups[r]),e.columnGroups[r].text=e.columnGroups[r].caption),""!=e.columnGroups[e.columnGroups.length-1].text&&e.columnGroups.push({text:""}),e.show.lineNumbers&&(t+='<td class="w2ui-head w2ui-col-number">    <div style="height: '+(e.recordHeight+1)+'px">&#160;</div></td>'),e.show.selectColumn&&(t+='<td class="w2ui-head w2ui-col-select">    <div style="height: 25px">&#160;</div></td>'),e.show.expandColumn&&(t+='<td class="w2ui-head w2ui-col-expand">    <div style="height: 25px">&#160;</div></td>');var s=0;i+='<td id="grid_'+e.name+'_column_start" class="w2ui-head" col="start" style="border-right: 0"></td>',e.show.orderColumn&&(i+='<td class="w2ui-head w2ui-col-order" col="order">    <div style="height: 25px">&#160;</div></td>');for(var o=0;o<e.columnGroups.length;o++){var a=e.columnGroups[o],l=e.columns[s];null!=a.colspan&&(a.span=a.colspan),null!=a.span&&a.span==parseInt(a.span)||(a.span=1),null==l.text&&null!=l.caption&&(console.log("NOTICE: grid column.caption property is deprecated, please use column.text. Column ->",l),l.text=l.caption);for(var u=0,c=s;c<s+a.span;c++)e.columns[c]&&!e.columns[c].hidden&&u++;if(o==e.columnGroups.length-1&&(u=100),u<=0);else if(!0===a.master){for(var d="",h=0;h<e.sortData.length;h++)e.sortData[h].field==l.field&&("asc"===(e.sortData[h].direction||"").toLowerCase()&&(d="w2ui-sort-up"),"desc"===(e.sortData[h].direction||"").toLowerCase()&&(d="w2ui-sort-down"));var p="";!1!==l.resizable&&(p='<div class="w2ui-resizer" name="'+s+'"></div>');var f="function"==typeof l.text?l.text(l):l.text;n='<td id="grid_'+e.name+"_column_"+s+'" class="w2ui-head '+d+'" col="'+s+'"     rowspan="2" colspan="'+u+'"     oncontextmenu = "w2ui[\''+e.name+"'].contextMenu(null, "+s+', event);"    onclick="w2ui[\''+e.name+"'].columnClick('"+l.field+"', event);\"    ondblclick=\"w2ui['"+e.name+"'].columnDblClick('"+l.field+"', event);\">"+p+'    <div class="w2ui-col-group w2ui-col-header '+(d?"w2ui-col-sorted":"")+'">        <div class="'+d+'"></div>'+(f||"&#160;")+"    </div></td>",l&&l.frozen?t+=n:i+=n}else{var g="function"==typeof a.text?a.text(a):a.text;n='<td id="grid_'+e.name+"_column_"+s+'" class="w2ui-head" col="'+s+'"         colspan="'+u+'">    <div class="w2ui-col-group">'+(g||"&#160;")+"    </div></td>",l&&l.frozen?t+=n:i+=n}s+=a.span}return[t+="<td></td></tr>",i+='<td id="grid_'+e.name+'_column_end" class="w2ui-head" col="end"></td></tr>']}(),s=a(!1);t=n[0]+r[0]+s[0],i=n[1]+r[1]+s[1]}else{var o=a(!0);t=o[0],i=o[1]}return[t,i];function a(t){var i="<tr>",n="<tr>";e.show.lineNumbers&&(i+='<td class="w2ui-head w2ui-col-number"        onclick="w2ui[\''+e.name+"'].columnClick('line-number', event);\"       ondblclick=\"w2ui['"+e.name+"'].columnDblClick('line-number', event);\">    <div>#</div></td>"),e.show.selectColumn&&(i+='<td class="w2ui-head w2ui-col-select"       onclick="if (event.stopPropagation) event.stopPropagation(); else event.cancelBubble = true;">    <div>        <input type="checkbox" id="grid_'+e.name+'_check_all" tabindex="-1"            style="'+(0==e.multiSelect?"display: none;":"")+'"            onmousedown="if (event.stopPropagation) event.stopPropagation(); else event.cancelBubble = true;"            onclick="var grid = w2ui[\''+e.name+"'];               if (this.checked) grid.selectAll(); else grid.selectNone();               if (event.stopPropagation) event.stopPropagation(); else event.cancelBubble = true;               clearTimeout(grid.last.kbd_timer); /* keep focus */            \"/>    </div></td>"),e.show.expandColumn&&(i+='<td class="w2ui-head w2ui-col-expand">    <div>&#160;</div></td>');var r,s=0,o=0;n+='<td id="grid_'+e.name+'_column_start" class="w2ui-head" col="start" style="border-right: 0"></td>',e.show.orderColumn&&(n+='<td class="w2ui-head w2ui-col-order" col="order">    <div>&#160;</div></td>');for(var a=0;a<e.columns.length;a++){var l=e.columns[a];if(null==l.text&&null!=l.caption&&(console.log("NOTICE: grid column.caption property is deprecated, please use column.text. Column -> ",l),l.text=l.caption),null==l.size&&(l.size="100%"),a==o&&(o+=(r=e.columnGroups[s++]||{}).span),(!(a<e.last.colStart||a>e.last.colEnd)||l.frozen)&&!l.hidden&&(!0!==r.master||t)){var u=e.getColumnCellHTML(a);l&&l.frozen?i+=u:n+=u}}return i+='<td class="w2ui-head w2ui-head-last"><div>&#160;</div></td>',n+='<td class="w2ui-head w2ui-head-last" col="end"><div>&#160;</div></td>',[i+="</tr>",n+="</tr>"]}},getColumnCellHTML:function(e){var t=this.columns[e];if(null==t)return"";for(var i=!this.reorderColumns||this.columnGroups&&this.columnGroups.length?"":" w2ui-reorder-cols-head ",n="",r=0;r<this.sortData.length;r++)this.sortData[r].field==t.field&&("asc"===(this.sortData[r].direction||"").toLowerCase()&&(n="w2ui-sort-up"),"desc"===(this.sortData[r].direction||"").toLowerCase()&&(n="w2ui-sort-down"));var s=this.last.selection.columns,o=!1;for(var a in s)for(r=0;r<s[a].length;r++)s[a][r]==e&&(o=!0);var l="function"==typeof t.text?t.text(t):t.text;return'<td id="grid_'+this.name+"_column_"+e+'" col="'+e+'" class="w2ui-head '+n+i+'" '+("normal"==this.columnTooltip&&t.tooltip?'title="'+t.tooltip+'" ':"")+"    onmouseEnter = \"w2ui['"+this.name+"'].columnTooltipShow('"+e+"', event);\"    onmouseLeave  = \"w2ui['"+this.name+"'].columnTooltipHide('"+e+"', event);\"    oncontextmenu = \"w2ui['"+this.name+"'].contextMenu(null, "+e+', event);"    onclick="w2ui[\''+this.name+"'].columnClick('"+t.field+"', event);\"    ondblclick=\"w2ui['"+this.name+"'].columnDblClick('"+t.field+"', event);\">"+(!1!==t.resizable?'<div class="w2ui-resizer" name="'+e+'"></div>':"")+'    <div class="w2ui-col-header '+(n?"w2ui-col-sorted":"")+" "+(o?"w2ui-col-selected":"")+'">        <div class="'+n+'"></div>'+(l||"&#160;")+"    </div></td>"},columnTooltipShow:function(e){if("normal"!=this.columnTooltip){var t=$(this.box).find("#grid_"+this.name+"_column_"+e),i=this.columns[e],n=this.columnTooltip;t.prop("_mouse_over",!0),setTimeout((function(){!0===t.prop("_mouse_over")&&!0!==t.prop("_mouse_tooltip")&&(t.prop("_mouse_tooltip",!0),t.w2tag(i.tooltip,{position:n,top:5}))}),1)}},columnTooltipHide:function(e){if("normal"!=this.columnTooltip){var t=$(this.box).find("#grid_"+this.name+"_column_"+e);this.columns[e],t.removeProp("_mouse_over"),setTimeout((function(){!0!==t.prop("_mouse_over")&&!0===t.prop("_mouse_tooltip")&&(t.removeProp("_mouse_tooltip"),t.w2tag())}),1)}},getRecordsHTML:function(){var e=this.records.length,t="object"!=typeof this.url?this.url:this.url.get;0==this.searchData.length||t||(e=this.last.searchIds.length),e>this.vs_start?this.last.show_extra=this.vs_extra:this.last.show_extra=this.vs_start;var i=$("#grid_"+this.name+"_records"),n=Math.floor((i.height()||0)/this.recordHeight)+this.last.show_extra+1;(!this.fixedBody||n>e)&&(n=e);var r=this.getRecordHTML(-1,0),s="<table><tbody>"+r[0],o="<table><tbody>"+r[1];s+='<tr id="grid_'+this.name+'_frec_top" line="top" style="height: 0px">    <td colspan="2000"></td></tr>',o+='<tr id="grid_'+this.name+'_rec_top" line="top" style="height: 0px">    <td colspan="2000"></td></tr>';for(var a=0;a<n;a++)s+=(r=this.getRecordHTML(a,a+1))[0],o+=r[1];var l=(e-n)*this.recordHeight;return s+='<tr id="grid_'+this.name+'_frec_bottom" rec="bottom" line="bottom" style="height: '+l+'px; vertical-align: top">    <td colspan="2000" style="border-right: 1px solid #D6D5D7;"></td></tr><tr id="grid_'+this.name+'_frec_more" style="display: none; ">    <td colspan="2000" class="w2ui-load-more"></td></tr></tbody></table>',o+='<tr id="grid_'+this.name+'_rec_bottom" rec="bottom" line="bottom" style="height: '+l+'px; vertical-align: top">    <td colspan="2000" style="border: 0"></td></tr><tr id="grid_'+this.name+'_rec_more" style="display: none">    <td colspan="2000" class="w2ui-load-more"></td></tr></tbody></table>',this.last.range_start=0,this.last.range_end=n,[s,o]},getSummaryHTML:function(){if(0!==this.summary.length){for(var e=this.getRecordHTML(-1,0),t="<table><tbody>"+e[0],i="<table><tbody>"+e[1],n=0;n<this.summary.length;n++)t+=(e=this.getRecordHTML(n,n+1,!0))[0],i+=e[1];return[t+="</tbody></table>",i+="</tbody></table>"]}},scroll:function(e){(new Date).getTime();var t=this,i="object"!=typeof this.url?this.url:this.url.get,n=$("#grid_"+this.name+"_records"),r=$("#grid_"+this.name+"_frecords");if(e){var s=e.target.scrollTop,o=e.target.scrollLeft;t.last.scrollTop=s,t.last.scrollLeft=o,$("#grid_"+t.name+"_columns")[0].scrollLeft=o,$("#grid_"+t.name+"_summary")[0].scrollLeft=o,r[0].scrollTop=s}this.last.bubbleEl&&($(this.last.bubbleEl).w2tag(),this.last.bubbleEl=null);var a=null,l=null;if(t.disableCVS||t.columnGroups.length>0)a=0,l=t.columns.length-1;else{for(var u=n.width(),c=0,d=0;d<t.columns.length;d++)if(!t.columns[d].frozen&&!t.columns[d].hidden){var h=parseInt(t.columns[d].sizeCalculated?t.columns[d].sizeCalculated:t.columns[d].size);c+h+30>t.last.scrollLeft&&null==a&&(a=d),c+h-30>t.last.scrollLeft+u&&null==l&&(l=d),c+=h}null==l&&(l=t.columns.length-1)}if(null!=a&&(a<0&&(a=0),l<0&&(l=0),a==l&&(a>0?a--:l++),a!=t.last.colStart||l!=t.last.colEnd)){var p=$(t.box),f=Math.abs(a-t.last.colStart),g=Math.abs(l-t.last.colEnd);if(f<5&&g<5){var m=p.find(".w2ui-grid-columns #grid_"+t.name+"_column_start"),v=p.find(".w2ui-grid-columns .w2ui-head-last"),y=p.find("#grid_"+t.name+"_records .w2ui-grid-data-spacer"),w=p.find("#grid_"+t.name+"_records .w2ui-grid-data-last"),b=p.find("#grid_"+t.name+"_summary .w2ui-grid-data-spacer"),x=p.find("#grid_"+t.name+"_summary .w2ui-grid-data-last");if(a>t.last.colStart)for(d=t.last.colStart;d<a;d++)p.find("#grid_"+t.name+"_columns #grid_"+t.name+"_column_"+d).remove(),p.find("#grid_"+t.name+'_records td[col="'+d+'"]').remove(),p.find("#grid_"+t.name+'_summary td[col="'+d+'"]').remove();if(l<t.last.colEnd)for(d=t.last.colEnd;d>l;d--)p.find("#grid_"+t.name+"_columns #grid_"+t.name+"_column_"+d).remove(),p.find("#grid_"+t.name+'_records td[col="'+d+'"]').remove(),p.find("#grid_"+t.name+'_summary td[col="'+d+'"]').remove();if(a<t.last.colStart)for(d=t.last.colStart-1;d>=a;d--)t.columns[d]&&(t.columns[d].frozen||t.columns[d].hidden)||(m.after(t.getColumnCellHTML(d)),y.each((function(e,i){var n=$(i).parent().attr("index"),r='<td class="w2ui-grid-data" col="'+d+'" style="height: 0px"></td>';null!=n&&(r=t.getCellHTML(parseInt(n),d,!1)),$(i).after(r)})),b.each((function(e,i){var n=$(i).parent().attr("index"),r='<td class="w2ui-grid-data" col="'+d+'" style="height: 0px"></td>';null!=n&&(r=t.getCellHTML(parseInt(n),d,!0)),$(i).after(r)})));if(l>t.last.colEnd)for(d=t.last.colEnd+1;d<=l;d++)t.columns[d]&&(t.columns[d].frozen||t.columns[d].hidden)||(v.before(t.getColumnCellHTML(d)),w.each((function(e,i){var n=$(i).parent().attr("index"),r='<td class="w2ui-grid-data" col="'+d+'" style="height: 0px"></td>';null!=n&&(r=t.getCellHTML(parseInt(n),d,!1)),$(i).before(r)})),x.each((function(e,i){var n=$(i).parent().attr("index")||-1,r=t.getCellHTML(parseInt(n),d,!0);$(i).before(r)})));t.last.colStart=a,t.last.colEnd=l,t.resizeRecords()}else{t.last.colStart=a,t.last.colEnd=l;var _=this.getColumnsHTML(),k=this.getRecordsHTML(),C=this.getSummaryHTML(),T=p.find("#grid_"+this.name+"_columns"),S=p.find("#grid_"+this.name+"_records"),O=p.find("#grid_"+this.name+"_frecords"),E=p.find("#grid_"+this.name+"_summary");T.find("tbody").html(_[1]),O.html(k[0]),S.prepend(k[1]),null!=C&&E.html(C[1]),setTimeout((function(){S.find("> table").not("table:first-child").remove(),E[0]&&(E[0].scrollLeft=t.last.scrollLeft)}),1),t.resizeRecords()}}var I=this.records.length;if(I>this.total&&-1!==this.total&&(I=this.total),0==this.searchData.length||i||(I=this.last.searchIds.length),0!==I&&0!==n.length&&0!==n.height()){I>this.vs_start?this.last.show_extra=this.vs_extra:this.last.show_extra=this.vs_start;var D=Math.round(n[0].scrollTop/this.recordHeight+1),z=D+(Math.round(n.height()/this.recordHeight)-1);if(D>I&&(D=I),z>=I-1&&(z=I),$("#grid_"+this.name+"_footer .w2ui-footer-right").html((t.show.statusRange?w2utils.formatNumber(this.offset+D)+"-"+w2utils.formatNumber(this.offset+z)+(-1!=this.total?" "+w2utils.lang("of")+" "+w2utils.formatNumber(this.total):""):"")+(i&&t.show.statusBuffered?" ("+w2utils.lang("buffered")+" "+w2utils.formatNumber(I)+(this.offset>0?", skip "+w2utils.formatNumber(this.offset):"")+")":"")),i||this.fixedBody&&!(-1!=this.total&&this.total<=this.vs_start)){var A=Math.floor(n[0].scrollTop/this.recordHeight)-this.last.show_extra,P=A+Math.floor(n.height()/this.recordHeight)+2*this.last.show_extra+1;A<1&&(A=1),P>this.total&&-1!=this.total&&(P=this.total);var R=n.find("#grid_"+this.name+"_rec_top"),j=n.find("#grid_"+this.name+"_rec_bottom"),M=r.find("#grid_"+this.name+"_frec_top"),L=r.find("#grid_"+this.name+"_frec_bottom");-1!=String(R.next().prop("id")).indexOf("_expanded_row")&&(R.next().remove(),M.next().remove()),this.total>P&&-1!=String(j.prev().prop("id")).indexOf("_expanded_row")&&(j.prev().remove(),L.prev().remove());var F=parseInt(R.next().attr("line")),N=parseInt(j.prev().attr("line"));if(F<A||1==F||this.last.pull_refresh){if(P<=N+this.last.show_extra-2&&P!=this.total)return;for(this.last.pull_refresh=!1;;){var B=r.find("#grid_"+this.name+"_frec_top").next();if("bottom"==(U=n.find("#grid_"+this.name+"_rec_top").next()).attr("line"))break;if(!(parseInt(U.attr("line"))<A))break;B.remove(),U.remove()}for("top"==(W=n.find("#grid_"+this.name+"_rec_bottom").prev().attr("line"))&&(W=A),d=parseInt(W)+1;d<=P;d++)if(this.records[d-1]){(U=this.records[d-1].w2ui)&&!Array.isArray(U.children)&&(U.expanded=!1);var H=this.getRecordHTML(d-1,d);j.before(H[1]),L.before(H[0])}Y(),setTimeout((function(){t.refreshRanges()}),0)}else{if(A>=F-this.last.show_extra+2&&A>1)return;for(;(B=r.find("#grid_"+this.name+"_frec_bottom").prev(),"top"!=(U=n.find("#grid_"+this.name+"_rec_bottom").prev()).attr("line"))&&parseInt(U.attr("line"))>P;)B.remove(),U.remove();var W;for("bottom"==(W=n.find("#grid_"+this.name+"_rec_top").next().attr("line"))&&(W=P),d=parseInt(W)-1;d>=A;d--)if(this.records[d-1]){var U;(U=this.records[d-1].w2ui)&&!Array.isArray(U.children)&&(U.expanded=!1),H=this.getRecordHTML(d-1,d),R.after(H[1]),M.after(H[0])}Y(),setTimeout((function(){t.refreshRanges()}),0)}var G=(A-1)*t.recordHeight,q=(I-P)*this.recordHeight;q<0&&(q=0),R.css("height",G+"px"),M.css("height",G+"px"),j.css("height",q+"px"),L.css("height",q+"px"),t.last.range_start=A,t.last.range_end=P,Math.floor(n[0].scrollTop/this.recordHeight)+Math.floor(n.height()/this.recordHeight)+10>I&&!0!==this.last.pull_more&&(I<this.total-this.offset||-1==this.total&&this.last.xhr_hasMore)&&(!0===this.autoLoad&&(this.last.pull_more=!0,this.last.xhr_offset+=this.limit,this.request("get")),$("#grid_"+this.name+"_rec_more, #grid_"+this.name+"_frec_more").show().eq(1).off(".load-more").on("click.load-more",(function(){$(this).find("td").html('<div><div style="width: 20px; height: 20px;" class="w2ui-spinner"></div></div>'),t.last.pull_more=!0,t.last.xhr_offset+=t.limit,t.request("get")})).find("td").html(t.autoLoad?'<div><div style="width: 20px; height: 20px;" class="w2ui-spinner"></div></div>':'<div style="padding-top: 15px">'+w2utils.lang("Load")+" "+t.limit+" "+w2utils.lang("More")+"...</div>"))}}function Y(){t.markSearch&&(clearTimeout(t.last.marker_timer),t.last.marker_timer=setTimeout((function(){for(var e=[],i=0;i<t.searchData.length;i++){var n=t.searchData[i],r=t.getSearch(n.field);if(r&&!r.hidden){var s=t.getColumn(n.field,!0);e.push({field:n.field,search:n.value,col:s})}}e.length>0&&e.forEach((function(e){$(t.box).find('td[col="'+e.col+'"]').not(".w2ui-head").w2marker(e.search)}))}),50))}},getRecordHTML:function(e,t,i){var n,r="",s="",o="",a=this.last.selection;if(-1==e){s+='<tr line="0">',o+='<tr line="0">',this.show.lineNumbers&&(s+='<td class="w2ui-col-number" style="height: 0px;"></td>'),this.show.selectColumn&&(s+='<td class="w2ui-col-select" style="height: 0px;"></td>'),this.show.expandColumn&&(s+='<td class="w2ui-col-expand" style="height: 0px;"></td>'),o+='<td class="w2ui-grid-data w2ui-grid-data-spacer" col="start" style="height: 0px; width: 0px;"></td>',this.show.orderColumn&&(o+='<td class="w2ui-col-order" style="height: 0px;" col="order"></td>');for(var l=0;l<this.columns.length;l++)if(r='<td class="w2ui-grid-data" col="'+l+'" style="height: 0px;"></td>',(v=this.columns[l]).frozen&&!v.hidden)s+=r;else{if(v.hidden||l<this.last.colStart||l>this.last.colEnd)continue;o+=r}return s+='<td class="w2ui-grid-data-last" style="height: 0px"></td>',o+='<td class="w2ui-grid-data-last" col="end" style="height: 0px"></td>',[s+="</tr>",o+="</tr>"]}var u="object"!=typeof this.url?this.url:this.url.get;if(!0!==i)if(this.searchData.length>0&&!u){if(e>=this.last.searchIds.length)return"";e=this.last.searchIds[e],n=this.records[e]}else{if(e>=this.records.length)return"";n=this.records[e]}else{if(e>=this.summary.length)return"";n=this.summary[e]}if(!n)return"";if(null==n.recid&&null!=this.recid){var c=this.parseField(n,this.recid);null!=c&&(n.recid=c)}w2utils.escapeId(n.recid);var d=!1;-1!=a.indexes.indexOf(e)&&(d=!0);var h=n.w2ui?n.w2ui.style:"";null!=h&&"string"==typeof h||(h="");var p=n.w2ui?n.w2ui.class:"";if(null!=p&&"string"==typeof p||(p=""),s+='<tr id="grid_'+this.name+"_frec_"+n.recid+'" recid="'+n.recid+'" line="'+t+'" index="'+e+'"  class="'+(t%2==0?"w2ui-even":"w2ui-odd")+" w2ui-record "+p+(d&&"row"==this.selectType?" w2ui-selected":"")+(n.w2ui&&!1===n.w2ui.editable?" w2ui-no-edit":"")+(n.w2ui&&!0===n.w2ui.expanded?" w2ui-expanded":"")+'"  style="height: '+this.recordHeight+"px; "+(d||""==h?h.replace("background-color","none"):h)+'" '+(""!=h?'custom_style="'+h+'"':"")+">",o+='<tr id="grid_'+this.name+"_rec_"+n.recid+'" recid="'+n.recid+'" line="'+t+'" index="'+e+'"  class="'+(t%2==0?"w2ui-even":"w2ui-odd")+" w2ui-record "+p+(d&&"row"==this.selectType?" w2ui-selected":"")+(n.w2ui&&!1===n.w2ui.editable?" w2ui-no-edit":"")+(n.w2ui&&!0===n.w2ui.expanded?" w2ui-expanded":"")+'"  style="height: '+this.recordHeight+"px; "+(d||""==h?h.replace("background-color","none"):h)+'" '+(""!=h?'custom_style="'+h+'"':"")+">",this.show.lineNumbers&&(s+='<td id="grid_'+this.name+"_cell_"+e+"_number"+(i?"_s":"")+'"    class="w2ui-col-number '+(d?" w2ui-row-selected":"")+'"'+(this.reorderRows?' style="cursor: move"':"")+">"+(!0!==i?this.getLineHTML(t,n):"")+"</td>"),this.show.selectColumn&&(n&&n.w2ui&&n.w2ui.hideCheckBox,s+='<td id="grid_'+this.name+"_cell_"+e+"_select"+(i?"_s":"")+'" class="w2ui-grid-data w2ui-col-select">'+(!0===i||n.w2ui&&!0===n.w2ui.hideCheckBox?"":'    <div>        <input class="w2ui-grid-select-check" type="checkbox" tabindex="-1" '+(d?'checked="checked"':"")+' style="pointer-events: none"/>    </div>')+"</td>"),this.show.expandColumn){var f="";f=n.w2ui&&!0===n.w2ui.expanded?"-":"+",n.w2ui&&"none"==n.w2ui.expanded&&(f=""),n.w2ui&&"spinner"==n.w2ui.expanded&&(f='<div class="w2ui-spinner" style="width: 16px; margin: -2px 2px;"></div>'),s+='<td id="grid_'+this.name+"_cell_"+e+"_expand"+(i?"_s":"")+'" class="w2ui-grid-data w2ui-col-expand">'+(!0!==i?'    <div ondblclick="if (event.stopPropagation) event.stopPropagation(); else event.cancelBubble = true;"             onclick="w2ui[\''+this.name+"'].toggle(jQuery(this).parents('tr').attr('recid'));                 if (event.stopPropagation) event.stopPropagation(); else event.cancelBubble = true;\">        "+f+" </div>":"")+"</td>"}o+='<td class="w2ui-grid-data-spacer" col="start" style="border-right: 0"></td>',this.show.orderColumn&&(o+='<td id="grid_'+this.name+"_cell_"+e+"_order"+(i?"_s":"")+'" class="w2ui-grid-data w2ui-col-order" col="order">'+(!0!==i?'<div title="Drag to reorder">&nbsp;</div>':"")+"</td>");for(var g=0,m=0;;){var v,y=1;if(null==(v=this.columns[g]))break;if(v.hidden)g++,m>0&&m--;else if(m>0){if(g++,null==this.columns[g])break;n.w2ui.colspan[this.columns[g-1].field]=0,m--}else{if(n.w2ui){var w=n.w2ui.colspan,b=this.columns[g].field;w&&0===w[b]&&delete w[b]}if(!(g<this.last.colStart||g>this.last.colEnd)||v.frozen){if(n.w2ui&&"object"==typeof n.w2ui.colspan){var x=parseInt(n.w2ui.colspan[v.field])||null;if(x>1){var _=0;for(l=g;l<g+x&&!(l>=this.columns.length);l++)this.columns[l].hidden&&_++;y=x-_,m=x-1}}var k=this.getCellHTML(e,g,i,y);v.frozen?s+=k:o+=k,g++}else g++}}return s+='<td class="w2ui-grid-data-last"></td>',o+='<td class="w2ui-grid-data-last" col="end"></td>',[s+="</tr>",o+="</tr>"]},getLineHTML:function(e){return"<div>"+e+"</div>"},getCellHTML:function(e,t,i,n){var r=this,s=this.columns[t];if(null==s)return"";var o=!0!==i?this.records[e]:this.summary[e],a=-1!==e?this.getCellValue(e,t,i):"",l=-1!==e?this.getCellEditable(e,t):"",u="max-height: "+parseInt(this.recordHeight)+"px;"+(s.clipboardCopy?"margin-right: 20px":""),c=!i&&o&&o.w2ui&&o.w2ui.changes&&null!=o.w2ui.changes[s.field],d="",h="",p=this.last.selection,f=!1,g="";if(-1!=p.indexes.indexOf(e)&&(f=!0),null==n&&(n=o&&o.w2ui&&o.w2ui.colspan&&o.w2ui.colspan[s.field]?o.w2ui.colspan[s.field]:1),0===t&&o&&o.w2ui&&Array.isArray(o.w2ui.children)){for(var m=0,v=this.get(o.w2ui.parent_recid,!0);null!=v&&(m++,null!=(C=this.records[v].w2ui)&&null!=C.parent_recid);)v=this.get(C.parent_recid,!0);if(o.w2ui.parent_recid)for(var y=0;y<m;y++)g+='<span class="w2ui-show-children w2ui-icon-empty"></span>';g+='<span class="w2ui-show-children '+(o.w2ui.children.length>0?o.w2ui.expanded?"w2ui-icon-collapse":"w2ui-icon-expand":"w2ui-icon-empty")+'"  onclick="event.stopPropagation(); w2ui[\''+this.name+"'].toggle(jQuery(this).parents('tr').attr('recid'))\"></span>"}if(!0===s.info&&(s.info={}),null!=s.info){var w="w2ui-icon-info";"function"==typeof s.info.icon?w=s.info.icon(o):"object"==typeof s.info.icon?w=s.info.icon[this.parseField(o,s.field)]||"":"string"==typeof s.info.icon&&(w=s.info.icon);var b=s.info.style||"";"function"==typeof s.info.style?b=s.info.style(o):"object"==typeof s.info.style?b=s.info.style[this.parseField(o,s.field)]||"":"string"==typeof s.info.style&&(b=s.info.style),g+='<span class="w2ui-info '+w+'" style="'+b+'" '+(null!=s.info.showOn?"on"+s.info.showOn:"onclick")+"=\"event.stopPropagation(); w2ui['"+this.name+"'].showBubble("+e+", "+t+')"'+(null!=s.info.hideOn?"on"+s.info.hideOn:"")+"=\"var grid = w2ui['"+this.name+"']; if (grid.last.bubbleEl) { $(grid.last.bubbleEl).w2tag() } grid.last.bubbleEl = null;\"></span>"}if(null!=s.render&&-1!==e){if("function"==typeof s.render){var x=s.render.call(this,o,e,t,a);null!=x&&"object"==typeof x?(a=$.trim(x.html||""),h=x.class||"",d=x.style||""):a=$.trim(x),(a.length<4||"<div"!=a.substr(0,4).toLowerCase())&&(a='<div style="'+u+'" title="'+D(a)+'">'+g+String(a)+"</div>")}if("object"==typeof s.render){var _=s.render[a];null!=_&&""!==_||(_=a),a='<div style="'+u+'" title="'+D(_)+'">'+g+String(_)+"</div>"}if("string"==typeof s.render){var k=s.render.toLowerCase().indexOf(":"),C=[];-1==k?(C[0]=s.render.toLowerCase(),C[1]=""):(C[0]=s.render.toLowerCase().substr(0,k),C[1]=s.render.toLowerCase().substr(k+1));var T=w2utils.formatters[C[0]];s.options&&!1===s.options.autoFormat&&(T=null),a='<div style="'+u+'" title="'+D(a="function"==typeof T?T(a,C[1],o):"")+'">'+g+String(a)+"</div>"}}else{if(l&&-1!=["checkbox","check"].indexOf(l.type)){var S=i?-(e+1):e;u+="text-align: center;",a='<input tabindex="-1" type="checkbox" '+(a?'checked="checked"':"")+" onclick=\"    var obj = w2ui['"+this.name+"'];     obj.editChange.call(obj, this, "+S+", "+t+', event); "/>',g=""}a='<div style="'+u+'" title="'+D(a)+'">'+g+String(a)+"</div>"}null==a&&(a=""),"string"==typeof s.render&&(C=s.render.toLowerCase().split(":"),-1!=["number","int","float","money","currency","percent","size"].indexOf(C[0])&&(d+="text-align: right;")),o&&o.w2ui&&("object"==typeof o.w2ui.style&&("string"==typeof o.w2ui.style[t]&&(d+=o.w2ui.style[t]+";"),"string"==typeof o.w2ui.style[s.field]&&(d+=o.w2ui.style[s.field]+";")),"object"==typeof o.w2ui.class&&("string"==typeof o.w2ui.class[t]&&(h+=o.w2ui.class[t]+" "),"string"==typeof o.w2ui.class[s.field]&&(h+=o.w2ui.class[s.field]+" ")));var O=!1;f&&-1!=$.inArray(t,p.columns[e])&&(O=!0);var E="string"==typeof s.clipboardCopy?s.clipboardCopy:"Copy to clipboard",I="<span onmouseEnter=\"jQuery(this).w2tag('"+E+"', { position: 'top|bottom' })\"onclick=\"w2ui['"+this.name+"'].clipboardCopy("+e+", "+t+'); jQuery(this).w2tag(\'Copied\', { position: \'top|bottom\' }); event.stopPropagation();" onmouseLeave="jQuery(this).w2tag()" class="w2ui-clipboard-copy w2ui-icon-paste"></span>';return a='<td class="w2ui-grid-data'+(O?" w2ui-selected":"")+" "+h+(c?" w2ui-changed":"")+'"    id="grid_'+this.name+"_data_"+e+"_"+t+'" col="'+t+'"    style="'+d+(null!=s.style?s.style:"")+'" '+(null!=s.attr?s.attr:"")+(n>1?'colspan="'+n+'"':"")+">"+a+(""!=w2utils.stripTags(a)&&s.clipboardCopy&&E?I:"")+"</td>",-1===e&&!0===i&&(a='<td class="w2ui-grid-data" col="'+t+'" style="height: 0px; '+d+'" '+(n>1?'colspan="'+n+'"':"")+"></td>"),a;function D(i){var n="";return r.show.recordTitles&&(null!=s.title?("function"==typeof s.title&&(n=s.title.call(r,o,e,t)),"string"==typeof s.title&&(n=s.title)):n=w2utils.stripTags(String(i).replace(/"/g,"''"))),null!=n?String(n):""}},clipboardCopy:function(e,t){var i=this.records[e],n=this.columns[t],r=n?this.parseField(i,n.field):"";"function"==typeof n.clipboardCopy&&(r=n.clipboardCopy(i)),$("#grid_"+this.name+"_focus").text(r).select(),document.execCommand("copy")},showBubble:function(e,t){var i="",n=this.columns[t].info,r=this.records[e],s=$(this.box).find("#grid_"+this.name+"_data_"+e+"_"+t+" .w2ui-info");if(this.last.bubbleEl&&$(this.last.bubbleEl).w2tag(),this.last.bubbleEl=s,null==n.fields){n.fields=[];for(var o=0;o<this.columns.length;o++){var a=this.columns[o];n.fields.push(a.field+("string"==typeof a.render?":"+a.render:""))}}var l=n.fields;if("function"==typeof l&&(l=l(r,e,t)),"function"==typeof n.render)i=n.render(r,e,t);else if($.isArray(l)){for(i='<table cellpadding="0" cellspacing="0">',o=0;o<l.length;o++)if(""!=(h=String(l[o]).split(":"))[0]&&"-"!=h[0]&&"--"!=h[0]&&"---"!=h[0]){null==(a=this.getColumn(h[0]))&&(a={field:h[0],caption:h[0]});var u=a?this.parseField(r,a.field):"";h.length>1&&(w2utils.formatters[h[1]]?u=w2utils.formatters[h[1]](u,h[2]||null,r):console.log('ERROR: w2utils.formatters["'+h[1]+'"] does not exists.')),(!0===n.showEmpty||null!=u&&""!=u)&&(null!=n.maxLength&&"string"==typeof u&&u.length>n.maxLength&&(u=u.substr(0,n.maxLength)+"..."),i+="<tr><td>"+a.text+"</td><td>"+((0===u?"0":u)||"")+"</td></tr>")}else i+='<tr><td colspan=2><div style="border-top: '+(""==h[0]?"0":"1")+'px solid #C1BEBE; margin: 6px 0px;"></div></td></tr>';i+="</table>"}else if($.isPlainObject(l)){for(var c in i='<table cellpadding="0" cellspacing="0">',l){var d=l[c];if(""!=d&&"-"!=d&&"--"!=d&&"---"!=d){var h=String(d).split(":");null==(a=this.getColumn(h[0]))&&(a={field:h[0],caption:h[0]}),u=a?this.parseField(r,a.field):"",h.length>1&&(w2utils.formatters[h[1]]?u=w2utils.formatters[h[1]](u,h[2]||null,r):console.log('ERROR: w2utils.formatters["'+h[1]+'"] does not exists.')),"function"==typeof d&&(u=d(r,e,t)),(!0===n.showEmpty||null!=u&&""!=u)&&(null!=n.maxLength&&"string"==typeof u&&u.length>n.maxLength&&(u=u.substr(0,n.maxLength)+"..."),i+="<tr><td>"+c+"</td><td>"+(u||"")+"</td></tr>")}else i+='<tr><td colspan=2><div style="border-top: '+(""==d?"0":"1")+'px solid #C1BEBE; margin: 6px 0px;"></div></td></tr>'}i+="</table>"}$(s).w2tag($.extend({html:i,left:-4,position:"bottom|top",className:"w2ui-info-bubble",style:"",hideOnClick:!0},n.options||{}))},getCellEditable:function(e,t){var i=this.columns[t],n=this.records[e];if(!n||!i)return null;var r=n.w2ui?n.w2ui.editable:null;if(!1===r)return null;if((null==r||!0===r)&&"function"==typeof(r=i?i.editable:null)){var s=this.getCellValue(e,t,!1);r=r.call(this,n,e,t,s)}return r},getCellValue:function(e,t,i){var n=this.columns[t],r=!0!==i?this.records[e]:this.summary[e],s=this.parseField(r,n.field);return r&&r.w2ui&&r.w2ui.changes&&null!=r.w2ui.changes[n.field]&&(s=r.w2ui.changes[n.field]),$.isPlainObject(s)&&(n.options&&n.options.items?(val=n.options.items.find((function(e){return e.id==s.id})),s=val?val.text:s.id):(null!=s.text&&(s=s.text),null!=s.id&&(s=s.id))),null==s&&(s=""),s},getFooterHTML:function(){return'<div>    <div class="w2ui-footer-left"></div>    <div class="w2ui-footer-right"></div>    <div class="w2ui-footer-center"></div></div>'},status:function(e){if(null!=e)$("#grid_"+this.name+"_footer").find(".w2ui-footer-left").html(e);else{var t="",i=this.getSelection();if(i.length>0&&(this.show.statusSelection&&i.length>1&&(t=String(i.length).replace(/(\d)(?=(\d\d\d)+(?!\d))/g,"$1,")+" "+w2utils.lang("selected")),this.show.statusRecordID&&1==i.length)){var n=i[0];"object"==typeof n&&(n=n.recid+", "+w2utils.lang("Column")+": "+n.column),t=w2utils.lang("Record ID")+": "+n+" "}$("#grid_"+this.name+"_footer .w2ui-footer-left").html(t),1==i.length?this.toolbar.enable("w2ui-edit"):this.toolbar.disable("w2ui-edit"),i.length>=1?this.toolbar.enable("w2ui-delete"):this.toolbar.disable("w2ui-delete")}},lock:function(e,t){var i=this,n=Array.prototype.slice.call(arguments,0);n.unshift(this.box),setTimeout((function(){$(i.box).find("#grid_"+i.name+"_empty_msg").remove(),w2utils.lock.apply(window,n)}),10)},unlock:function(e){var t=this.box;setTimeout((function(){$(t).find(".w2ui-message").not(".w2ui-closing").length>0||w2utils.unlock(t,e)}),25)},stateSave:function(e){var t=this;if(!w2utils.hasLocalStorage)return null;for(var i,n={columns:[],show:$.extend({},this.show),last:{search:this.last.search,multi:this.last.multi,logic:this.last.logic,label:this.last.label,field:this.last.field,scrollTop:this.last.scrollTop,scrollLeft:this.last.scrollLeft},sortData:[],searchData:[]},r=0;r<this.columns.length;r++){var s=t.columns[r],o={};Object.keys(t.stateColProps).forEach((function(e,n){t.stateColProps[e]&&(i=void 0!==s[e]?s[e]:t.stateColDefaults[e]||null,o[e]=i)})),n.columns.push(o)}for(r=0;r<this.sortData.length;r++)n.sortData.push($.extend({},this.sortData[r]));for(r=0;r<this.searchData.length;r++)n.searchData.push($.extend({},this.searchData[r]));if(!0!==e){var a=this.trigger({phase:"before",type:"stateSave",target:this.name,state:n});if(!0===a.isCancelled)return void("function"==typeof callBack&&callBack({status:"error",message:"Request aborted."}));try{var l=$.parseJSON(localStorage.w2ui||"{}");l||(l={}),l.states||(l.states={}),l.states[this.stateId||this.name]=n,localStorage.w2ui=JSON.stringify(l)}catch(e){return delete localStorage.w2ui,null}this.trigger($.extend(a,{phase:"after"}))}return n},stateRestore:function(e){var t=this,i="object"!=typeof this.url?this.url:this.url.get;if(!e)try{if(!w2utils.hasLocalStorage)return!1;(a=$.parseJSON(localStorage.w2ui||"{}"))||(a={}),a.states||(a.states={}),e=a.states[this.stateId||this.name]}catch(e){return delete localStorage.w2ui,null}var n=this.trigger({phase:"before",type:"stateRestore",target:this.name,state:e});if(!0!==n.isCancelled){if($.isPlainObject(e)){$.extend(this.show,e.show),$.extend(this.last,e.last);for(var r=this.last.scrollTop,s=this.last.scrollLeft,o=0;o<e.columns.length;o++){var a=e.columns[o],l=this.getColumn(a.field,!0);null!==l&&($.extend(this.columns[l],a),o!==l&&this.columns.splice(o,0,this.columns.splice(l,1)[0]))}for(this.sortData.splice(0,this.sortData.length),o=0;o<e.sortData.length;o++)this.sortData.push(e.sortData[o]);for(this.searchData.splice(0,this.searchData.length),o=0;o<e.searchData.length;o++)this.searchData.push(e.searchData[o]);setTimeout((function(){i||(t.sortData.length>0&&t.localSort(),t.searchData.length>0&&t.localSearch()),t.last.scrollTop=r,t.last.scrollLeft=s,t.refresh()}),1)}return this.trigger($.extend(n,{phase:"after"})),!0}"function"==typeof callBack&&callBack({status:"error",message:"Request aborted."})},stateReset:function(){if(this.stateRestore(this.last.state),w2utils.hasLocalStorage)try{var e=$.parseJSON(localStorage.w2ui||"{}");e.states&&e.states[this.stateId||this.name]&&delete e.states[this.stateId||this.name],localStorage.w2ui=JSON.stringify(e)}catch(e){return delete localStorage.w2ui,null}},parseField:function(e,t){if(this.nestedFields){var i="";try{i=e;for(var n=String(t).split("."),r=0;r<n.length;r++)i=i[n[r]]}catch(e){i=""}return i}return e?e[t]:""},prepareData:function(){for(var e=this,t=0;t<this.records.length;t++)i(this.records[t]);function i(t){for(var n=0;n<e.columns.length;n++){var r=e.columns[n];if(null!=t[r.field]&&"string"==typeof r.render){if(-1!=["number","int","float","money","currency","percent"].indexOf(r.render.split(":")[0])&&"number"!=typeof t[r.field]&&(t[r.field]=parseFloat(t[r.field])),-1!=["date","age"].indexOf(r.render.split(":")[0])&&!t[r.field+"_"]){var s=t[r.field];w2utils.isInt(s)&&(s=parseInt(s)),t[r.field+"_"]=new Date(s)}if(-1!=["time"].indexOf(r.render))if(w2utils.isTime(t[r.field])){var o=w2utils.isTime(t[r.field],!0);(s=new Date).setHours(o.hours,o.minutes,o.seconds?o.seconds:0,0),t[r.field+"_"]||(t[r.field+"_"]=s)}else o=t[r.field],w2utils.isInt(o)&&(o=parseInt(o)),o=null!=o?new Date(o):new Date,(s=new Date).setHours(o.getHours(),o.getMinutes(),o.getSeconds(),0),t[r.field+"_"]||(t[r.field+"_"]=s)}}if(t.w2ui&&t.w2ui.children&&!0!==t.w2ui.expanded)for(var a=0;a<t.w2ui.children.length;a++)i(t.w2ui.children[a])}},nextCell:function(e,t,i){var n=t+1;if(n>=this.columns.length)return null;var r=this.records[e].w2ui,s=(this.columns[t],this.columns[n]),o=r&&r.colspan&&!isNaN(r.colspan[s.field])?parseInt(r.colspan[s.field]):1;if(null==s)return null;if(s&&s.hidden||0===o)return this.nextCell(e,n,i);if(i){var a=this.getCellEditable(e,t);if(null==a||-1!=["checkbox","check"].indexOf(a.type))return this.nextCell(e,n,i)}return n},prevCell:function(e,t,i){var n=t-1;if(n<0)return null;var r=this.records[e].w2ui,s=this.columns[n],o=r&&r.colspan&&!isNaN(r.colspan[s.field])?parseInt(r.colspan[s.field]):1;if(null==s)return null;if(s&&s.hidden||0===o)return this.prevCell(e,n,i);if(i){var a=this.getCellEditable(e,t);if(null==a||-1!=["checkbox","check"].indexOf(a.type))return this.prevCell(e,n,i)}return n},nextRow:function(e,t){var i=this.last.searchIds,n=null;if(e+1<this.records.length&&0===i.length||i.length>0&&e<i[i.length-1]){if(e++,i.length>0)for(;!(-1!=$.inArray(e,i)||e>this.records.length);)e++;var r=this.records[e].w2ui,s=this.columns[t];n=0===(r&&r.colspan&&null!=s&&!isNaN(r.colspan[s.field])?parseInt(r.colspan[s.field]):1)?this.nextRow(e,t):e}return n},prevRow:function(e,t){var i=this.last.searchIds,n=null;if(e>0&&0===i.length||i.length>0&&e>i[0]){if(e--,i.length>0)for(;!(-1!=$.inArray(e,i)||e<0);)e--;var r=this.records[e].w2ui,s=this.columns[t];n=0===(r&&r.colspan&&null!=s&&!isNaN(r.colspan[s.field])?parseInt(r.colspan[s.field]):1)?this.prevRow(e,t):e}return n},selectionSave:function(){return this.last._selection=this.getSelection(),this.last._selection},selectionRestore:function(e){var t=(new Date).getTime();this.last.selection={indexes:[],columns:{}};var i=this.last.selection,n=this.last._selection;if(n)for(var r=0;r<n.length;r++){var s;$.isPlainObject(n[r])?null!=(s=this.get(n[r].recid,!0))&&(-1==i.indexes.indexOf(s)&&i.indexes.push(s),i.columns[s]||(i.columns[s]=[]),i.columns[s].push(n[r].column)):null!=(s=this.get(n[r],!0))&&i.indexes.push(s)}return delete this.last._selection,!0!==e&&this.refresh(),(new Date).getTime()-t},message:function(e,t){"string"==typeof e&&(e={width:e.length<300?350:550,height:e.length<300?170:250,body:'<div class="w2ui-centered">'+e+"</div>",buttons:'<button type="button" class="w2ui-btn" onclick="w2ui[\''+this.name+"'].message()\">Ok</button>",onOpen:function(e){setTimeout((function(){$(this.box).find(".w2ui-btn").focus()}),25)},onClose:function(e){"function"==typeof t&&t()}}),w2utils.message.call(this,{box:this.box,path:"w2ui."+this.name,title:".w2ui-grid-header:visible",body:".w2ui-grid-box"},e)}},$.extend(w2grid.prototype,w2utils.event),w2obj.grid=w2grid}(jQuery),function(e){var t=function(t){this.box=null,this.name=null,this.panels=[],this.tmp={},this.padding=1,this.resizer=4,this.style="",e.extend(!0,this,w2obj.layout,t)},i=["top","left","main","preview","right","bottom"];e.fn.w2layout=function(n){if(w2utils.checkName(n,"w2layout")){var r=n.panels||[],s=new t(n);e.extend(s,{handlers:[],panels:[]});for(var o=0,a=r.length;o<a;o++)s.panels[o]=e.extend(!0,{},t.prototype.panel,r[o]),(e.isPlainObject(s.panels[o].tabs)||Array.isArray(s.panels[o].tabs))&&u(s,r[o].type),(e.isPlainObject(s.panels[o].toolbar)||Array.isArray(s.panels[o].toolbar))&&c(s,r[o].type);for(var l=0;l<i.length;l++)null==s.get(i[l])&&s.panels.push(e.extend(!0,{},t.prototype.panel,{type:i[l],hidden:"main"!==i[l],size:50}));return w2ui[s.name]=s,e(this).length>0&&s.render(e(this)[0]),s}function u(t,i,n){var r=t.get(i);return console.log(i,"!!!!!!!!!!!!!!!!"),null!=r&&null==n&&(n=r.tabs),null!=r&&null!=n&&(e.isArray(n)&&(n={tabs:n}),e().w2destroy(t.name+"_"+i+"_tabs"),r.tabs=e().w2tabs(e.extend({},n,{owner:t,name:t.name+"_"+i+"_tabs"})),r.show.tabs=!0,!0)}function c(t,i,n){var r=t.get(i);return null!=r&&null==n&&(n=r.toolbar),null!=r&&null!=n&&(e.isArray(n)&&(n={items:n}),e().w2destroy(t.name+"_"+i+"_toolbar"),r.toolbar=e().w2toolbar(e.extend({},n,{owner:t,name:t.name+"_"+i+"_toolbar"})),r.show.toolbar=!0,!0)}},t.prototype={onShow:null,onHide:null,onResizing:null,onResizerClick:null,onRender:null,onRefresh:null,onContent:null,onResize:null,onDestroy:null,panel:{type:null,title:"",size:100,minSize:20,maxSize:!1,hidden:!1,resizable:!1,overflow:"auto",flex:!1,zIndex:1,style:"",content:"",tabs:null,toolbar:null,width:null,height:null,show:{toolbar:!1,tabs:!1},callBack:null,onRefresh:null,onShow:null,onHide:null},content:function(e,t,i){return console.log("NOTICE: layout.content method is deprecated, please use layout.html() instead"),this.html(e,t,i)},html:function(t,i,n){var r=this,s=this.get(t),o={panel:t,html:s.content,error:!1,cancelled:!1,removed:function(e){"function"==typeof e&&(s.callBack=e)}};if("function"==typeof s.callBack&&(s.callBack({panel:t,content:s.content,new_content:i,transition:n||"none"}),s.callBack=null),"css"==t)return e("#layout_"+r.name+"_panel_css").html("<style>"+i+"</style>"),o.status=!0,o;if(null==s)return console.log("ERROR: incorrect panel name. Panel name can be main, left, right, top, bottom, preview or css"),o.error=!0,o;if(null==i)return o;var a=this.trigger({phase:"before",type:"content",target:t,object:s,content:i,transition:n});if(!0===a.isCancelled)return o.cancelled=!0,o;if(i instanceof jQuery)return console.log("ERROR: You can not pass jQuery object to w2layout.content() method"),o;var l="#layout_"+this.name+"_panel_"+s.type,u=e(l+"> .w2ui-panel-content"),c=0;if(u.length>0&&(e(l).scrollTop(0),c=e(u).position().top),""===s.content)s.content=i,this.refresh(t);else{if(s.content=i,!s.hidden&&null!=n&&""!==n){var d=e(l+"> .w2ui-panel-content");d.after('<div class="w2ui-panel-content new-panel" style="'+d[0].style.cssText+'"></div>');var h=e(l+"> .w2ui-panel-content.new-panel");d.css("top",c),h.css("top",c),"object"==typeof i?(i.box=h[0],i.render()):h.html(i),w2utils.transition(d[0],h[0],n,(function(){d.remove(),h.removeClass("new-panel"),h.css("overflow",s.overflow),e(l+"> .w2ui-panel-content").slice(1).remove(),r.resize(),-1!=window.navigator.userAgent.indexOf("MSIE")&&setTimeout((function(){r.resize()}),100)}))}this.refresh(t)}return r.trigger(e.extend(a,{phase:"after"})),r.resize(),-1!=window.navigator.userAgent.indexOf("MSIE")&&setTimeout((function(){r.resize()}),100),o},message:function(t,i){var n=this;"string"==typeof i&&(i={width:i.length<300?350:550,height:i.length<300?170:250,body:'<div class="w2ui-centered">'+i+"</div>",buttons:'<button class="w2ui-btn" onclick="w2ui[\''+this.name+"'].message('"+t+"')\">Ok</button>",onOpen:function(t){setTimeout((function(){e(this.box).find(".w2ui-btn").focus()}),25)}});var r,s=this.get(t),o=e("#layout_"+this.name+"_panel_"+s.type).css("overflow");i&&(i.onClose&&(r=i.onClose),i.onClose=function(t){"function"==typeof r&&r(t),t.done((function(){e("#layout_"+n.name+"_panel_"+s.type).css("overflow",o)}))}),e("#layout_"+this.name+"_panel_"+s.type).css("overflow","hidden"),w2utils.message.call(this,{box:e("#layout_"+this.name+"_panel_"+s.type),param:t,path:"w2ui."+this.name,title:".w2ui-panel-title:visible",body:".w2ui-panel-content"},i)},load:function(t,i,n,r){var s=this;return"css"==t?(e.get(i,(function(e,i,n){s.html(t,n.responseText),r&&r()})),!0):null!=this.get(t)&&(e.get(i,(function(e,i,o){s.html(t,o.responseText,n),r&&r(),s.resize(),-1!=window.navigator.userAgent.indexOf("MSIE")&&setTimeout((function(){s.resize()}),100)})),!0)},sizeTo:function(t,i,n){var r=this;return null!=r.get(t)&&(e(r.box).find(" > div > .w2ui-panel").css(w2utils.cssPrefix("transition",!0!==n?".2s":"0s")),setTimeout((function(){r.set(t,{size:i})}),1),setTimeout((function(){e(r.box).find(" > div > .w2ui-panel").css(w2utils.cssPrefix("transition","0s")),r.resize()}),500),!0)},show:function(t,i){var n=this,r=this.trigger({phase:"before",type:"show",target:t,object:this.get(t),immediate:i});if(!0!==r.isCancelled){var s=n.get(t);return null!=s&&(s.hidden=!1,!0===i?(e("#layout_"+n.name+"_panel_"+t).css({opacity:"1"}),n.trigger(e.extend(r,{phase:"after"})),n.resize()):(e("#layout_"+n.name+"_panel_"+t).css({opacity:"0"}),e(n.box).find(" > div > .w2ui-panel").css(w2utils.cssPrefix("transition",".2s")),setTimeout((function(){n.resize()}),1),setTimeout((function(){e("#layout_"+n.name+"_panel_"+t).css({opacity:"1"})}),250),setTimeout((function(){e(n.box).find(" > div > .w2ui-panel").css(w2utils.cssPrefix("transition","0s")),n.trigger(e.extend(r,{phase:"after"})),n.resize()}),500)),!0)}},hide:function(t,i){var n=this,r=this.trigger({phase:"before",type:"hide",target:t,object:this.get(t),immediate:i});if(!0!==r.isCancelled){var s=n.get(t);return null!=s&&(s.hidden=!0,!0===i?(e("#layout_"+n.name+"_panel_"+t).css({opacity:"0"}),n.trigger(e.extend(r,{phase:"after"})),n.resize()):(e(n.box).find(" > div > .w2ui-panel").css(w2utils.cssPrefix("transition",".2s")),e("#layout_"+n.name+"_panel_"+t).css({opacity:"0"}),setTimeout((function(){n.resize()}),1),setTimeout((function(){e(n.box).find(" > div > .w2ui-panel").css(w2utils.cssPrefix("transition","0s")),n.trigger(e.extend(r,{phase:"after"})),n.resize()}),500)),!0)}},toggle:function(e,t){var i=this.get(e);return null!=i&&(i.hidden?this.show(e,t):this.hide(e,t))},set:function(t,i){var n=this.get(t,!0);return null!=n&&(e.extend(this.panels[n],i),null==i.content&&null==i.resizable||this.refresh(t),this.resize(),!0)},get:function(e,t){for(var i=0;i<this.panels.length;i++)if(this.panels[i].type==e)return!0===t?i:this.panels[i];return null},el:function(t){var i=e("#layout_"+this.name+"_panel_"+t+"> .w2ui-panel-content");return 1!=i.length?null:i[0]},hideToolbar:function(t){var i=this.get(t);i&&(i.show.toolbar=!1,e("#layout_"+this.name+"_panel_"+t+"> .w2ui-panel-toolbar").hide(),this.resize())},showToolbar:function(t){var i=this.get(t);i&&(i.show.toolbar=!0,e("#layout_"+this.name+"_panel_"+t+"> .w2ui-panel-toolbar").show(),this.resize())},toggleToolbar:function(e){var t=this.get(e);t&&(t.show.toolbar?this.hideToolbar(e):this.showToolbar(e))},assignToolbar:function(t,i){"string"==typeof i&&null!=w2ui[i]&&(i=w2ui[i]);var n=this.get(t);n.toolbar=i;var r=e(this.box).find(t+"> .w2ui-panel-toolbar");null!=n.toolbar?(0===r.find("[name="+n.toolbar.name+"]").length?r.w2render(n.toolbar):null!=n.toolbar&&n.toolbar.refresh(),i.owner=this,this.showToolbar(t),this.refresh(t)):(r.html(""),this.hideToolbar(t))},assignTabs:function(t,i){"string"==typeof i&&null!=w2ui[i]&&(i=w2ui[i]);var n=this.get(t);n.tabs=i;var r=e(this.box).find(t+"> .w2ui-panel-tabs");null!=n.tabs?(0===r.find("[name="+n.tabs.name+"]").length?r.w2render(n.tabs):null!=n.tabs&&n.tabs.refresh(),i.owner=this,this.showTabs(t),this.refresh(t)):(r.html(""),this.hideTabs(t))},hideTabs:function(t){var i=this.get(t);i&&(i.show.tabs=!1,e("#layout_"+this.name+"_panel_"+t+"> .w2ui-panel-tabs").hide(),this.resize())},showTabs:function(t){var i=this.get(t);i&&(i.show.tabs=!0,e("#layout_"+this.name+"_panel_"+t+"> .w2ui-panel-tabs").show(),this.resize())},toggleTabs:function(e){var t=this.get(e);t&&(t.show.tabs?this.hideTabs(e):this.showTabs(e))},render:function(t){var n=this,r=(new Date).getTime(),s=n.trigger({phase:"before",type:"render",target:n.name,box:t});if(!0!==s.isCancelled){if(null!=t&&(e(n.box).find("#layout_"+n.name+"_panel_main").length>0&&e(n.box).removeAttr("name").removeClass("w2ui-layout").html(""),n.box=t),!n.box)return!1;e(n.box).attr("name",n.name).addClass("w2ui-layout").html("<div></div>"),e(n.box).length>0&&(e(n.box)[0].style.cssText+=n.style);for(var o=0;o<i.length;o++){n.get(i[o]);var a='<div id="layout_'+n.name+"_panel_"+i[o]+'" class="w2ui-panel">    <div class="w2ui-panel-title"></div>    <div class="w2ui-panel-tabs"></div>    <div class="w2ui-panel-toolbar"></div>    <div class="w2ui-panel-content"></div></div><div id="layout_'+n.name+"_resizer_"+i[o]+'" class="w2ui-resizer"></div>';e(n.box).find(" > div").append(a)}return e(n.box).find(" > div").append('<div id="layout_'+n.name+'_panel_css" style="position: absolute; top: 10000px;"></div>'),n.refresh(),n.trigger(e.extend(s,{phase:"after"})),setTimeout((function(){n.tmp.events={resize:function(t){null==w2ui[n.name]?e(window).off("resize.w2ui-"+n.name):w2ui[n.name].resize()},resizeStart:l,mouseMove:d,mouseUp:c},e(window).on("resize.w2ui-"+n.name,n.tmp.events.resize),n.resize()}),0),(new Date).getTime()-r}function l(t,r){if(n.box){r||(r=window.event),e(document).off("mousemove",n.tmp.events.mouseMove).on("mousemove",n.tmp.events.mouseMove),e(document).off("mouseup",n.tmp.events.mouseUp).on("mouseup",n.tmp.events.mouseUp),n.tmp.resize={type:t,x:r.screenX,y:r.screenY,diff_x:0,diff_y:0,value:0};for(var s=0;s<i.length;s++){var o=e(n.el(i[s])).parent().find(".w2ui-lock");o.length>0?o.attr("locked","previous"):n.lock(i[s],{opacity:0})}"left"!=t&&"right"!=t||(n.tmp.resize.value=parseInt(e("#layout_"+n.name+"_resizer_"+t)[0].style.left)),"top"!=t&&"preview"!=t&&"bottom"!=t||(n.tmp.resize.value=parseInt(e("#layout_"+n.name+"_resizer_"+t)[0].style.top))}}function u(t){if(0!==n.tmp.diff_x||0!==n.tmp.resize.diff_y){var i,r,s=n.get("top"),o=n.get("bottom"),a=n.get(n.tmp.resize.type),l=parseInt(e(n.box).height()),u=parseInt(e(n.box).width()),c=String(a.size);switch(n.tmp.resize.type){case"top":i=parseInt(a.sizeCalculated)+n.tmp.resize.diff_y,r=0;break;case"bottom":i=parseInt(a.sizeCalculated)-n.tmp.resize.diff_y,r=0;break;case"preview":i=parseInt(a.sizeCalculated)-n.tmp.resize.diff_y,r=(s&&!s.hidden?s.sizeCalculated:0)+(o&&!o.hidden?o.sizeCalculated:0);break;case"left":i=parseInt(a.sizeCalculated)+n.tmp.resize.diff_x,r=0;break;case"right":i=parseInt(a.sizeCalculated)-n.tmp.resize.diff_x,r=0}"%"==c.substr(c.length-1)?a.size=Math.floor(100*i/("left"==a.type||"right"==a.type?u:l-r)*100)/100+"%":"-"==String(a.size).substr(0,1)?a.size=parseInt(a.size)-a.sizeCalculated+i:a.size=i,n.resize()}}function c(t){if(n.box&&(t||(t=window.event),e(document).off("mousemove",n.tmp.events.mouseMove),e(document).off("mouseup",n.tmp.events.mouseUp),null!=n.tmp.resize)){for(var r=0;r<i.length;r++){var s=e(n.el(i[r])).parent().find(".w2ui-lock");"previous"==s.attr("locked")?s.removeAttr("locked"):n.unlock(i[r])}u(),e("#layout_"+n.name+"_resizer_"+n.tmp.resize.type).removeClass("active"),delete n.tmp.resize}}function d(t){if(n.box&&(t||(t=window.event),null!=n.tmp.resize)){var i=n.get(n.tmp.resize.type),r=n.tmp.resize,s=n.trigger({phase:"before",type:"resizing",target:n.name,object:i,originalEvent:t,panel:r?r.type:"all",diff_x:r?r.diff_x:0,diff_y:r?r.diff_y:0});if(!0!==s.isCancelled){var o=e("#layout_"+n.name+"_panel_"+r.type).offset(),a=e("#layout_"+n.name+"_resizer_"+r.type),l=t.pageX-o.left+("left"==r.type?-i.width:0),c=t.pageY-o.top+("top"==r.type?-i.height:0),d=n.get("main");switch(a.hasClass("active")||a.addClass("active"),r.type){case"left":i.minSize-l>i.width&&(l=i.minSize-i.width),i.maxSize&&i.width+l>i.maxSize&&(l=i.maxSize-i.width),d.minSize+l>d.width&&(l=d.width-d.minSize);break;case"right":i.minSize+l>i.width&&(l=i.width-i.minSize),i.maxSize&&i.width-l>i.maxSize&&(l=i.width-i.maxSize),d.minSize-l>d.width&&(l=d.minSize-d.width);break;case"top":i.minSize-c>i.height&&(c=i.minSize-i.height),i.maxSize&&i.height+c>i.maxSize&&(c=i.maxSize-i.height),d.minSize+c>d.height&&(c=d.height-d.minSize);break;case"preview":case"bottom":i.minSize+c>i.height&&(c=i.height-i.minSize),i.maxSize&&i.height-c>i.maxSize&&(c=i.height-i.maxSize),d.minSize-c>d.height&&(c=d.minSize-d.height)}switch(r.diff_x=l,r.diff_y=c,r.type){case"top":case"preview":case"bottom":r.diff_x=0,a.length>0&&(a[0].style.top=r.value+r.diff_y+"px");break;case"left":case"right":r.diff_y=0,a.length>0&&(a[0].style.left=r.value+r.diff_x+"px")}n.trigger(e.extend(s,{phase:"after"})),u()}}}},refresh:function(t){var i=this;null==t&&(t=null);var n=(new Date).getTime(),r=i.trigger({phase:"before",type:"refresh",target:null!=t?t:i.name,object:i.get(t)});if(!0!==r.isCancelled){if("string"==typeof t){var s=i.get(t);if(null==s)return;var o="#layout_"+i.name+"_panel_"+s.type,a="#layout_"+i.name+"_resizer_"+s.type;e(o).css({display:s.hidden?"none":"block"}),e(o).css({zIndex:s.zIndex}),s.resizable?e(a).show():e(a).hide(),"object"==typeof s.content&&"function"==typeof s.content.render?(s.content.box=e(o+"> .w2ui-panel-content")[0],setTimeout((function(){e(o+"> .w2ui-panel-content").length>0&&(e(o+"> .w2ui-panel-content").removeClass().removeAttr("name").addClass("w2ui-panel-content").css("overflow",s.overflow)[0].style.cssText+=";"+s.style),s.content&&"function"==typeof s.content.render&&s.content.render()}),1)):e(o+"> .w2ui-panel-content").length>0&&(e(o+"> .w2ui-panel-content").removeClass().removeAttr("name").addClass("w2ui-panel-content").html(s.content).css("overflow",s.overflow)[0].style.cssText+=";"+s.style);var l=e(i.box).find(o+"> .w2ui-panel-tabs");s.show.tabs&&null!=s.tabs?0===l.find("[name="+s.tabs.name+"]").length&&null!=s.tabs?l.w2render(s.tabs):s.tabs.refresh():l.html("").removeClass("w2ui-tabs").hide(),l=e(i.box).find(o+"> .w2ui-panel-toolbar"),s.show.toolbar?0===l.find("[name="+s.toolbar.name+"]").length&&null!=s.toolbar?l.w2render(s.toolbar):s.toolbar.refresh():l.html("").removeClass("w2ui-toolbar").hide(),l=e(i.box).find(o+"> .w2ui-panel-title"),s.title?l.html(s.title).show():l.html("").hide()}else{i.resize();for(var u=0;u<this.panels.length;u++)i.refresh(this.panels[u].type)}return i.trigger(e.extend(r,{phase:"after"})),(new Date).getTime()-n}},resize:function(){if(!this.box)return!1;var t=(new Date).getTime(),n=this.tmp.resize,r=this.trigger({phase:"before",type:"resize",target:this.name,panel:n?n.type:"all",diff_x:n?n.diff_x:0,diff_y:n?n.diff_y:0});if(!0!==r.isCancelled){this.padding<0&&(this.padding=0);var s=parseInt(e(this.box).width()),o=parseInt(e(this.box).height());0==o&&(s=parseInt(e(this.box).parent().width()),o=parseInt(e(this.box).parent().height())),e(this.box).find(" > div").css({width:s+"px",height:o+"px"});for(var a,l,u,c,d=this,h=this.get("main"),p=this.get("preview"),f=this.get("left"),g=this.get("right"),m=this.get("top"),v=this.get("bottom"),y=null!=p&&!0!==p.hidden,w=null!=f&&!0!==f.hidden,b=null!=g&&!0!==g.hidden,x=null!=m&&!0!==m.hidden,_=null!=v&&!0!==v.hidden,k=0;k<i.length;k++)if("main"!==i[k]&&(n=this.get(i[k]))){var C=String(n.size||0);if("%"==C.substr(C.length-1)){var T=o;"preview"==n.type&&(T=T-(m&&!m.hidden?m.sizeCalculated:0)-(v&&!v.hidden?v.sizeCalculated:0)),n.sizeCalculated=parseInt(("left"==n.type||"right"==n.type?s:T)*parseFloat(n.size)/100)}else n.sizeCalculated=parseInt(n.size);n.sizeCalculated=Math.max(n.sizeCalculated,parseInt(n.minSize))}"-"==String(g.size).substr(0,1)&&(w&&"-"==String(f.size).substr(0,1)?console.log("ERROR: you cannot have both left panel.size and right panel.size be negative."):g.sizeCalculated=s-(w?f.sizeCalculated:0)+parseInt(g.size)),"-"==String(f.size).substr(0,1)&&(b&&"-"==g.size.substr(0,1)?console.log("ERROR: you cannot have both left panel.size and right panel.size be negative."):f.sizeCalculated=s-(b?g.sizeCalculated:0)+parseInt(f.size)),null!=m&&!0!==m.hidden?(a=0,l=0,u=s,c=m.sizeCalculated,e("#layout_"+this.name+"_panel_top").css({display:"block",left:a+"px",top:l+"px",width:u+"px",height:c+"px"}).show(),m.width=u,m.height=c,m.resizable&&(l=m.sizeCalculated-(0===this.padding?this.resizer:0),c=this.resizer>this.padding?this.resizer:this.padding,e("#layout_"+this.name+"_resizer_top").show().css({display:"block",left:a+"px",top:l+"px",width:u+"px",height:c+"px",cursor:"ns-resize"}).off("mousedown").on("mousedown",(function(t){var i=d.trigger({phase:"before",type:"resizerClick",target:"top",originalEvent:t});if(!0!==i.isCancelled)return w2ui[d.name].tmp.events.resizeStart("top",t),d.trigger(e.extend(i,{phase:"after"})),!1})))):(e("#layout_"+this.name+"_panel_top").hide(),e("#layout_"+this.name+"_resizer_top").hide()),null!=f&&!0!==f.hidden?(a=0,l=0+(x?m.sizeCalculated+this.padding:0),u=f.sizeCalculated,c=o-(x?m.sizeCalculated+this.padding:0)-(_?v.sizeCalculated+this.padding:0),D=e("#layout_"+this.name+"_panel_left"),-1!=window.navigator.userAgent.indexOf("MSIE")&&D.length>0&&D[0].clientHeight<D[0].scrollHeight&&(u+=17),D.css({display:"block",left:a+"px",top:l+"px",width:u+"px",height:c+"px"}).show(),f.width=u,f.height=c,f.resizable&&(a=f.sizeCalculated-(0===this.padding?this.resizer:0),u=this.resizer>this.padding?this.resizer:this.padding,e("#layout_"+this.name+"_resizer_left").show().css({display:"block",left:a+"px",top:l+"px",width:u+"px",height:c+"px",cursor:"ew-resize"}).off("mousedown").on("mousedown",(function(t){var i=d.trigger({phase:"before",type:"resizerClick",target:"left",originalEvent:t});if(!0!==i.isCancelled)return w2ui[d.name].tmp.events.resizeStart("left",t),d.trigger(e.extend(i,{phase:"after"})),!1})))):(e("#layout_"+this.name+"_panel_left").hide(),e("#layout_"+this.name+"_resizer_left").hide()),null!=g&&!0!==g.hidden?(a=s-g.sizeCalculated,l=0+(x?m.sizeCalculated+this.padding:0),u=g.sizeCalculated,c=o-(x?m.sizeCalculated+this.padding:0)-(_?v.sizeCalculated+this.padding:0),e("#layout_"+this.name+"_panel_right").css({display:"block",left:a+"px",top:l+"px",width:u+"px",height:c+"px"}).show(),g.width=u,g.height=c,g.resizable&&(a-=this.padding,u=this.resizer>this.padding?this.resizer:this.padding,e("#layout_"+this.name+"_resizer_right").show().css({display:"block",left:a+"px",top:l+"px",width:u+"px",height:c+"px",cursor:"ew-resize"}).off("mousedown").on("mousedown",(function(t){var i=d.trigger({phase:"before",type:"resizerClick",target:"right",originalEvent:t});if(!0!==i.isCancelled)return w2ui[d.name].tmp.events.resizeStart("right",t),d.trigger(e.extend(i,{phase:"after"})),!1})))):(e("#layout_"+this.name+"_panel_right").hide(),e("#layout_"+this.name+"_resizer_right").hide()),null!=v&&!0!==v.hidden?(a=0,l=o-v.sizeCalculated,u=s,c=v.sizeCalculated,e("#layout_"+this.name+"_panel_bottom").css({display:"block",left:a+"px",top:l+"px",width:u+"px",height:c+"px"}).show(),v.width=u,v.height=c,v.resizable&&(l-=0===this.padding?0:this.padding,c=this.resizer>this.padding?this.resizer:this.padding,e("#layout_"+this.name+"_resizer_bottom").show().css({display:"block",left:a+"px",top:l+"px",width:u+"px",height:c+"px",cursor:"ns-resize"}).off("mousedown").on("mousedown",(function(t){var i=d.trigger({phase:"before",type:"resizerClick",target:"bottom",originalEvent:t});if(!0!==i.isCancelled)return w2ui[d.name].tmp.events.resizeStart("bottom",t),d.trigger(e.extend(i,{phase:"after"})),!1})))):(e("#layout_"+this.name+"_panel_bottom").hide(),e("#layout_"+this.name+"_resizer_bottom").hide()),a=0+(w?f.sizeCalculated+this.padding:0),l=0+(x?m.sizeCalculated+this.padding:0),u=s-(w?f.sizeCalculated+this.padding:0)-(b?g.sizeCalculated+this.padding:0),c=o-(x?m.sizeCalculated+this.padding:0)-(_?v.sizeCalculated+this.padding:0)-(y?p.sizeCalculated+this.padding:0),D=e("#layout_"+this.name+"_panel_main"),-1!=window.navigator.userAgent.indexOf("MSIE")&&D.length>0&&D[0].clientHeight<D[0].scrollHeight&&(u+=17),D.css({display:"block",left:a+"px",top:l+"px",width:u+"px",height:c+"px"}),h.width=u,h.height=c,null!=p&&!0!==p.hidden?(a=0+(w?f.sizeCalculated+this.padding:0),l=o-(_?v.sizeCalculated+this.padding:0)-p.sizeCalculated,u=s-(w?f.sizeCalculated+this.padding:0)-(b?g.sizeCalculated+this.padding:0),c=p.sizeCalculated,D=e("#layout_"+this.name+"_panel_preview"),-1!=window.navigator.userAgent.indexOf("MSIE")&&D.length>0&&D[0].clientHeight<D[0].scrollHeight&&(u+=17),D.css({display:"block",left:a+"px",top:l+"px",width:u+"px",height:c+"px"}).show(),p.width=u,p.height=c,p.resizable&&(l-=0===this.padding?0:this.padding,c=this.resizer>this.padding?this.resizer:this.padding,e("#layout_"+this.name+"_resizer_preview").show().css({display:"block",left:a+"px",top:l+"px",width:u+"px",height:c+"px",cursor:"ns-resize"}).off("mousedown").on("mousedown",(function(t){var i=d.trigger({phase:"before",type:"resizerClick",target:"preview",originalEvent:t});if(!0!==i.isCancelled)return w2ui[d.name].tmp.events.resizeStart("preview",t),d.trigger(e.extend(i,{phase:"after"})),!1})))):(e("#layout_"+this.name+"_panel_preview").hide(),e("#layout_"+this.name+"_resizer_preview").hide());for(var S=0;S<i.length;S++){var O=this.get(i[S]),E="#layout_"+this.name+"_panel_"+i[S]+" > .w2ui-panel-",I=0;O&&(O.title&&(I+=w2utils.getSize(e(E+"title").css({top:I+"px",display:"block"}),"height")),O.show.tabs&&(null!=O.tabs&&w2ui[this.name+"_"+i[S]+"_tabs"]&&w2ui[this.name+"_"+i[S]+"_tabs"].resize(),I+=w2utils.getSize(e(E+"tabs").css({top:I+"px",display:"block"}),"height")),O.show.toolbar&&(null!=O.toolbar&&w2ui[this.name+"_"+i[S]+"_toolbar"]&&w2ui[this.name+"_"+i[S]+"_toolbar"].resize(),I+=w2utils.getSize(e(E+"toolbar").css({top:I+"px",display:"block"}),"height"))),e(E+"content").css({display:O.flex?"flex":"block"}).css({top:I+"px"})}for(var D in w2ui)if("function"==typeof w2ui[D].resize){null==w2ui[D].panels&&w2ui[D].resize();var z=e(w2ui[D].box).parents(".w2ui-layout");z.length>0&&z.attr("name")==d.name&&w2ui[D].resize()}return this.trigger(e.extend(r,{phase:"after"})),(new Date).getTime()-t}},destroy:function(){var t=this.trigger({phase:"before",type:"destroy",target:this.name});if(!0!==t.isCancelled)return null!=w2ui[this.name]&&(e(this.box).find("#layout_"+this.name+"_panel_main").length>0&&e(this.box).removeAttr("name").removeClass("w2ui-layout").html(""),delete w2ui[this.name],this.trigger(e.extend(t,{phase:"after"})),this.tmp.events&&this.tmp.events.resize&&e(window).off("resize",this.tmp.events.resize),!0)},lock:function(e,t,n){if(-1!=i.indexOf(e)){var r=Array.prototype.slice.call(arguments,0);r[0]="#layout_"+this.name+"_panel_"+e,w2utils.lock.apply(window,r)}else console.log("ERROR: First parameter needs to be the a valid panel name.")},unlock:function(e,t){if(-1!=i.indexOf(e)){var n="#layout_"+this.name+"_panel_"+e;w2utils.unlock(n,t)}else console.log("ERROR: First parameter needs to be the a valid panel name.")}},e.extend(t.prototype,w2utils.event),w2obj.layout=t}(jQuery);var w2popup={};!function(e){e.fn.w2popup=function(t,i){null==t&&(i={},t="open"),e.isPlainObject(t)&&(i=t,t="open"),"load"===(t=t.toLowerCase())&&"string"==typeof i&&(i=e.extend({url:i},arguments.length>2?arguments[2]:{})),"open"===t&&null!=i.url&&(t="load"),i=i||{};var n={};if(e(this).length>0&&"open"==t){if(e(this).find("div[rel=title], div[rel=body], div[rel=buttons]").length>0){if(e("#w2ui-popup").length>0){var r=e("#w2ui-popup").data("options");w2popup._prev={template:w2popup._template,title:r.title,body:r.body,buttons:r.buttons}}w2popup._template=this,e(this).find("div[rel=title]").length>0&&(n.title=e(this).find("div[rel=title]")),e(this).find("div[rel=body]").length>0&&(n.body=e(this).find("div[rel=body]"),n.style=e(this).find("div[rel=body]")[0].style.cssText),e(this).find("div[rel=buttons]").length>0&&(n.buttons=e(this).find("div[rel=buttons]"))}else n.title="&#160;",n.body=e(this).html();0!==parseInt(e(this).css("width"))&&(n.width=parseInt(e(this).css("width")));var s=i.title||i.showClose||void 0===i.showClose||i.showMax||void 0===i.showMax;0!==parseInt(e(this).css("height"))&&(n.height=parseInt(e(this).css("height"))+(s?32:0))}return w2popup[t](e.extend({},n,i))},w2popup={defaults:{title:"",body:"",buttons:[],style:"",color:"#000",opacity:.4,speed:.3,modal:!1,maximized:!1,keyboard:!0,width:500,height:300,showClose:!0,showMax:!1,transition:null,multiple:!1},status:"closed",handlers:[],onOpen:null,onClose:null,onMax:null,onMin:null,onToggle:null,onKeydown:null,open:function(t){var i=this,n=e.extend(!0,{},t);if("closing"!=w2popup.status){var r,s,o=e("#w2ui-popup").data("options");t=e.extend({},this.defaults,o,{title:"",body:"",buttons:[]},t,{maximized:!1}),setTimeout((function(){e("#w2ui-popup").data("options",t)}),100),0===e("#w2ui-popup").length&&(w2popup.onMax=null,w2popup.onMin=null,w2popup.onToggle=null,w2popup.onOpen=null,w2popup.onClose=null,w2popup.onKeydown=null,w2popup.onAction=null),t.onOpen&&(w2popup.onOpen=t.onOpen),t.onClose&&(w2popup.onClose=t.onClose),t.onMax&&(w2popup.onMax=t.onMax),t.onMin&&(w2popup.onMin=t.onMin),t.onToggle&&(w2popup.onToggle=t.onToggle),t.onKeydown&&(w2popup.onKeydown=t.onKeydown),t.onAction&&(w2popup.onAction=t.onAction),t.width=parseInt(t.width),t.height=parseInt(t.height),null==window.innerHeight?(r=parseInt(document.documentElement.offsetWidth),s=parseInt(document.documentElement.offsetHeight),"IE7"===w2utils.engine&&(r+=21,s+=4)):(r=parseInt(window.innerWidth),s=parseInt(window.innerHeight)),r-10<t.width&&(t.width=r-10),s-10<t.height&&(t.height=s-10);var a=(s-t.height)/2*.6,l=(r-t.width)/2;if(null!=t.actions&&(t.buttons=[],Object.keys(t.actions).forEach((function(e){var i,n=t.actions[e];"function"==typeof n&&((i=document.createElement("button")).classList.add("w2ui-btn"),i.onclick=n,i.innerHTML=e,t.buttons.push(i)),"object"==typeof n&&((i=document.createElement("button")).classList.add("w2ui-btn"),i.classList.add(n.class||""),i.style.cssText=n.style||"",i.onclick=n.handler||function(){},i.innerHTML=n.text||e,t.buttons.push(i)),"string"==typeof n&&t.buttons.push(n)}))),0===e("#w2ui-popup").length){if(!0===(d=this.trigger({phase:"before",type:"open",target:"popup",options:t,present:!1})).isCancelled)return;w2popup.status="opening",w2popup.lockScreen(t);var u=[];if(t.showClose){const e=document.createElement("div");e.classList.add("w2ui-popup-button","w2ui-popup-close"),e.onmousedown=function(e){e.stopPropagation()},e.onclick=function(){w2popup.close()},e.innerHTML="Close",u.push(e)}if(t.showMax){const e=document.createElement("div");e.classList.add("w2ui-popup-button","w2ui-popup-max"),e.onmousedown=function(e){e.stopPropagation()},e.onclick=function(){w2popup.toggle()},e.innerHTML="Max",u.push(e)}var c='<div id="w2ui-popup" class="w2ui-popup w2ui-popup-opening" style="left: '+l+"px; top: "+a+"px;     width: "+parseInt(t.width)+"px; height: "+parseInt(t.height)+'px;"></div>';e("body").append(c),c='<div class="w2ui-popup-title" style="'+(t.title?"":"display: none")+'"></div><div class="w2ui-box" style="'+(t.title?"":"top: 0px !important;")+(t.buttons?"":"bottom: 0px !important;")+'">    <div class="w2ui-popup-body'+(t.title?"":" w2ui-popup-no-title")+(t.buttons?"":" w2ui-popup-no-buttons")+'" style="'+t.style+'">    </div></div><div class="w2ui-popup-buttons" style="'+(t.buttons?"":"display: none")+'"></div><input class="w2ui-popup-hidden" style="position: absolute; top: -100px"/>',e("#w2ui-popup").html(c),e("#w2ui-popup .w2ui-popup-title").append(u),t.title&&e("#w2ui-popup .w2ui-popup-title").append(t.title),t.buttons&&e("#w2ui-popup .w2ui-popup-buttons").append(t.buttons),t.body&&e("#w2ui-popup .w2ui-popup-body").append(t.body),setTimeout((function(){e("#w2ui-popup").css(w2utils.cssPrefix({transition:t.speed+"s opacity, "+t.speed+"s -webkit-transform"})).removeClass("w2ui-popup-opening"),i.focus()}),1),setTimeout((function(){e("#w2ui-popup").css(w2utils.cssPrefix("transform",""))}),1e3*t.speed),w2popup.status="open",i.trigger(e.extend(d,{phase:"after"}))}else if(!0===t.multiple)w2popup.message(n);else{var d;if(null==w2popup._prev&&null!=w2popup._template&&i.restoreTemplate(),!0===(d=this.trigger({phase:"before",type:"open",target:"popup",options:t,present:!0})).isCancelled)return;w2popup.status="opening",null!=o&&(o.maximized||o.width==t.width&&o.height==t.height||w2popup.resize(t.width,t.height),t.prevSize=t.width+"px:"+t.height+"px",t.maximized=o.maximized);var h=e("#w2ui-popup .w2ui-box").clone();if(h.removeClass("w2ui-box").addClass("w2ui-box-temp").find(".w2ui-popup-body").empty().append(t.body),e("#w2ui-popup .w2ui-box").after(h),t.buttons?(e("#w2ui-popup .w2ui-popup-buttons").show().html("").append(t.buttons),e("#w2ui-popup .w2ui-popup-body").removeClass("w2ui-popup-no-buttons"),e("#w2ui-popup .w2ui-box, #w2ui-popup .w2ui-box-temp").css("bottom","")):(e("#w2ui-popup .w2ui-popup-buttons").hide().html(""),e("#w2ui-popup .w2ui-popup-body").addClass("w2ui-popup-no-buttons"),e("#w2ui-popup .w2ui-box, #w2ui-popup .w2ui-box-temp").css("bottom","0px")),t.title){if(u=[],t.showClose){const e=document.createElement("div");e.classList.add("w2ui-popup-button","w2ui-popup-close"),e.onmousedown=function(e){e.stopPropagation()},e.onclick=function(){w2popup.close()},e.innerHTML="Close",u.push(e)}if(t.showMax){const e=document.createElement("div");e.classList.add("w2ui-popup-button","w2ui-popup-max"),e.onmousedown=function(e){e.stopPropagation()},e.onclick=function(){w2popup.toggle()},e.innerHTML="Max",u.push(e)}e("#w2ui-popup .w2ui-popup-title").show().append(u).append(t.title),e("#w2ui-popup .w2ui-popup-body").removeClass("w2ui-popup-no-title"),e("#w2ui-popup .w2ui-box, #w2ui-popup .w2ui-box-temp").css("top","")}else e("#w2ui-popup .w2ui-popup-title").hide().html(""),e("#w2ui-popup .w2ui-popup-body").addClass("w2ui-popup-no-title"),e("#w2ui-popup .w2ui-box, #w2ui-popup .w2ui-box-temp").css("top","0px");var p=e("#w2ui-popup .w2ui-box")[0],f=e("#w2ui-popup .w2ui-box-temp")[0];w2utils.transition(p,f,t.transition,(function(){i.restoreTemplate(),e(p).remove(),e(f).removeClass("w2ui-box-temp").addClass("w2ui-box");var n=e(f).find(".w2ui-popup-body");1==n.length&&(n[0].style.cssText=t.style),e("#w2ui-popup").data("prev-size",null),i.focus()})),w2popup.status="open",i.trigger(e.extend(d,{phase:"after"}))}t._last_focus=e(":focus"),t.keyboard&&e(document).on("keydown",this.keydown);var g={resizing:!1,mvMove:function(t){if(1==g.resizing){t||(t=window.event),g.div_x=t.pageX-g.x,g.div_y=t.pageY-g.y;var i=w2popup.trigger({phase:"before",type:"move",target:"popup",div_x:g.div_x,div_y:g.div_y});!0!==i.isCancelled&&(e("#w2ui-popup").css(w2utils.cssPrefix({transition:"none",transform:"translate3d("+g.div_x+"px, "+g.div_y+"px, 0px)"})),w2popup.trigger(e.extend(i,{phase:"after"})))}},mvStop:function(t){1==g.resizing&&(t||(t=window.event),w2popup.status="open",g.div_x=t.pageX-g.x,g.div_y=t.pageY-g.y,e("#w2ui-popup").css({left:g.pos_x+g.div_x+"px",top:g.pos_y+g.div_y+"px"}).css(w2utils.cssPrefix({transition:"none",transform:"translate3d(0px, 0px, 0px)"})),g.resizing=!1,e(document).off("mousemove",g.mvMove),e(document).off("mouseup",g.mvStop),g.isLocked||w2popup.unlock())}};return e("#w2ui-popup .w2ui-popup-title").on("mousedown",(function(t){w2popup.get().maximized||function(t){if(t||(t=window.event),w2popup.status="moving",g.resizing=!0,g.isLocked=1==e("#w2ui-popup > .w2ui-lock").length,g.x=t.pageX,g.y=t.pageY,g.pos_x=e("#w2ui-popup").position().left,g.pos_y=e("#w2ui-popup").position().top,g.isLocked||w2popup.lock({opacity:0}),e(document).on("mousemove",g.mvMove),e(document).on("mouseup",g.mvStop),t.stopPropagation?t.stopPropagation():t.cancelBubble=!0,!t.preventDefault)return!1;t.preventDefault()}(t)})),this}setTimeout((function(){i.open.call(i,t)}),100)},action:function(t,i){var n=this,r=e("#w2ui-popup").data("options");null!=i&&(n={parent:this,options:r=e("#w2ui-message"+i).data("options"),close:function(){w2popup.message({msgId:i})}});var s=r.actions[t];console.log(s,r.actions);var o=s;e.isPlainObject(s)&&s.onClick&&(o=s.onClick);var a=this.trigger({phase:"before",target:t,msgId:i,type:"action",action:s,originalEvent:event});!0!==a.isCancelled&&("function"==typeof o&&o.call(n,event),this.trigger(e.extend(a,{phase:"after"})))},keydown:function(t){var i=e("#w2ui-popup").data("options");if(!i||i.keyboard){var n=w2popup.trigger({phase:"before",type:"keydown",target:"popup",options:i,originalEvent:t});!0!==n.isCancelled&&(27===t.keyCode&&(t.preventDefault(),e("#w2ui-popup .w2ui-message").length>0?w2popup.message():w2popup.close()),w2popup.trigger(e.extend(n,{phase:"after"})))}},close:function(t){var i=this;if(t=e.extend({},e("#w2ui-popup").data("options"),t),0!==e("#w2ui-popup").length&&"closed"!=this.status)if("opening"!=this.status){var n=this.trigger({phase:"before",type:"close",target:"popup",options:t});!0!==n.isCancelled&&(w2popup.status="closing",e("#w2ui-popup").css(w2utils.cssPrefix({transition:t.speed+"s opacity, "+t.speed+"s -webkit-transform"})).addClass("w2ui-popup-closing"),w2popup.unlockScreen(t),setTimeout((function(){i.restoreTemplate(),e("#w2ui-popup").remove(),w2popup.status="closed",t._last_focus&&t._last_focus.length>0&&t._last_focus.focus(),i.trigger(e.extend(n,{phase:"after"}))}),1e3*t.speed),t.keyboard&&e(document).off("keydown",this.keydown))}else setTimeout((function(){w2popup.close()}),100)},toggle:function(){var t=this,i=e("#w2ui-popup").data("options"),n=this.trigger({phase:"before",type:"toggle",target:"popup",options:i});!0!==n.isCancelled&&(!0===i.maximized?w2popup.min():w2popup.max(),setTimeout((function(){t.trigger(e.extend(n,{phase:"after"}))}),1e3*i.speed+50))},max:function(){var t=this,i=e("#w2ui-popup").data("options");if(!0!==i.maximized){var n=this.trigger({phase:"before",type:"max",target:"popup",options:i});!0!==n.isCancelled&&(w2popup.status="resizing",i.prevSize=e("#w2ui-popup").css("width")+":"+e("#w2ui-popup").css("height"),w2popup.resize(1e4,1e4,(function(){w2popup.status="open",i.maximized=!0,t.trigger(e.extend(n,{phase:"after"})),e("#w2ui-popup .w2ui-grid, #w2ui-popup .w2ui-form, #w2ui-popup .w2ui-layout").each((function(){var t=e(this).attr("name");w2ui[t]&&w2ui[t].resize&&w2ui[t].resize()}))})))}},min:function(){var t=this,i=e("#w2ui-popup").data("options");if(!0===i.maximized){var n=i.prevSize.split(":"),r=this.trigger({phase:"before",type:"min",target:"popup",options:i});!0!==r.isCancelled&&(w2popup.status="resizing",w2popup.resize(parseInt(n[0]),parseInt(n[1]),(function(){w2popup.status="open",i.maximized=!1,i.prevSize=null,t.trigger(e.extend(r,{phase:"after"})),e("#w2ui-popup .w2ui-grid, #w2ui-popup .w2ui-form, #w2ui-popup .w2ui-layout").each((function(){var t=e(this).attr("name");w2ui[t]&&w2ui[t].resize&&w2ui[t].resize()}))})))}},get:function(){return e("#w2ui-popup").data("options")},set:function(e){w2popup.open(e)},clear:function(){e("#w2ui-popup .w2ui-popup-title").html(""),e("#w2ui-popup .w2ui-popup-body").html(""),e("#w2ui-popup .w2ui-popup-buttons").html("")},reset:function(){w2popup.open(w2popup.defaults)},load:function(t){if(w2popup.status="loading",null!=t.url){var i=String(t.url).split("#"),n=i[0],r=i[1];null==t&&(t={});var s=e("#w2ui-popup").data(n);null!=s?o(s,r):e.get(n,(function(t,i,s){o(s.responseText,r),e("#w2ui-popup").data(n,s.responseText)}))}else console.log("ERROR: The url parameter is empty.");function o(i,n){if(delete t.url,e("body").append('<div id="w2ui-tmp" style="display: none">'+i+"</div>"),null!=n&&e("#w2ui-tmp #"+n).length>0?e("#w2ui-tmp #"+n).w2popup(t):e("#w2ui-tmp > div").w2popup(t),e("#w2ui-tmp > style").length>0){var r=e("<div>").append(e("#w2ui-tmp > style").clone()).html();0===e("#w2ui-popup #div-style").length&&e("#w2ui-popup").append('<div id="div-style" style="position: absolute; left: -100; width: 1px"></div>'),e("#w2ui-popup #div-style").html(r)}e("#w2ui-tmp").remove()}},message:function(t){var i=this;e().w2tag(),t||(t={width:200,height:100});var n=parseInt(e("#w2ui-popup").width()),r=parseInt(e("#w2ui-popup").height());t.originalWidth=t.width,t.originalHeight=t.height,parseInt(t.width)<10&&(t.width=10),parseInt(t.height)<10&&(t.height=10),null==t.hideOnClick&&(t.hideOnClick=!1);var s=e("#w2ui-popup").data("options")||{},o=parseInt(e("#w2ui-popup > .w2ui-popup-title").css("height"));(null==t.width||t.width>s.width-10)&&(t.width=s.width-10),(null==t.height||t.height>s.height-o-5)&&(t.height=s.height-o-5),t.originalHeight<0&&(t.height=r+t.originalHeight-o),t.originalWidth<0&&(t.width=n+2*t.originalWidth);var a=e("#w2ui-popup .w2ui-popup-title"),l=e("#w2ui-popup .w2ui-message").length;if(null!=t.actions&&(t.buttons="",Object.keys(t.actions).forEach((function(e){var i=t.actions[e];"function"==typeof i&&(t.buttons+='<button class="w2ui-btn" onclick="w2popup.action(\''+e+"', "+l+')">'+e+"</button>"),"object"==typeof i&&(t.buttons+='<button class="w2ui-btn '+(i.class||"")+'" style="'+(i.style||"")+'"onclick="w2popup.action(\''+e+"', "+l+')">'+(i.text||e)+"</button>"),"string"==typeof i&&(t.buttons+=i)}))),""===e.trim(t.html)&&""===e.trim(t.body)&&""===e.trim(t.buttons)){var u=e("#w2ui-popup .w2ui-message").last();if(null!=t.msgId&&(u=e("#w2ui-message"+t.msgId)),t=u.data("options")||{},!0===(h=i.trigger({phase:"before",type:"msgClose",msgId:u.attr("data-msgId"),target:"popup",options:t})).isCancelled)return;u.css(w2utils.cssPrefix({transition:"0.15s",transform:"translateY(-"+t.height+"px)"}));var c=e("#w2ui-popup .w2ui-message");(c=e(c[c.length-2]).css("z-index",1500).data("msg-focus"))&&c.length>0?c.focus():i.focus(),1==l&&w2popup.unlock(150),setTimeout((function(){u.remove(),"function"==typeof t.onClose&&t.onClose(h),i.trigger(e.extend(h,{phase:"after"}))}),150)}else{""===e.trim(t.body)&&""===e.trim(t.buttons)||(t.html='<div class="w2ui-message-body">'+t.body+'</div><div class="w2ui-message-buttons">'+t.buttons+"</div>"),e("#w2ui-popup .w2ui-message").css("z-index",1390).data("msg-focus",e(":focus")),a.css("z-index",1501),null==t.close&&(t.close=function(){w2popup.message({msgId:l})}),e("#w2ui-popup .w2ui-box").before('<div id="w2ui-message'+l+'" class="w2ui-message" style="display: none; z-index: 1500; '+(0===a.length?"top: 0px;":"top: "+w2utils.getSize(a,"height")+"px;")+(null!=t.width?"width: "+t.width+"px; left: "+(n-t.width)/2+"px;":"left: 10px; right: 10px;")+(null!=t.height?"height: "+t.height+"px;":"bottom: 6px;")+w2utils.cssPrefix("transition","0s",!0)+'" data-msgId="'+l+'" '+(!0===t.hideOnClick?'onclick="w2popup.message();"':"")+"></div>"),e("#w2ui-popup #w2ui-message"+l).data("options",t);var d=e("#w2ui-popup #w2ui-message"+l).css("display");if(e("#w2ui-popup #w2ui-message"+l).css(w2utils.cssPrefix({transform:"none"==d?"translateY(-"+t.height+"px)":"translateY(0px)"})),"none"==d){var h;if(e("#w2ui-popup #w2ui-message"+l).show().html(t.html),setTimeout((function(){e("#w2ui-popup #w2ui-message"+l).css(e.extend(w2utils.cssPrefix("transition",".3s",!1),w2utils.cssPrefix({transform:"none"==d?"translateY(0px)":"translateY(-"+t.height+"px)"})))}),1),0===l&&w2popup.lock(),!0===(h=i.trigger({phase:"before",type:"msgOpen",msgId:l,target:"popup",options:t})).isCancelled)return;setTimeout((function(){i.focus(),e("#w2ui-popup #w2ui-message"+l).css(w2utils.cssPrefix({transition:"0s"})),"function"==typeof t.onOpen&&t.onOpen(h),i.trigger(e.extend(h,{phase:"after"}))}),350)}}},focus:function(){var t=null,i=e("#w2ui-popup"),n="input:visible, button:visible, select:visible, textarea:visible, [contentEditable], .w2ui-input";e(i).find(n).off(".keep-focus");var r=e("#w2ui-popup .w2ui-message").length-1,s=e("#w2ui-popup #w2ui-message"+r);if(s.length>0)(o=e(s[s.length-1]).find("button")).length>0&&o[0].focus(),t=s;else if(i.length>0){var o;(o=i.find(".w2ui-popup-buttons button")).length>0&&o[0].focus(),t=i}e(t).find(n).on("blur.keep-focus",(function(i){setTimeout((function(){var i=e(":focus");if(i.length>0&&!e(t).find(n).is(i)||i.hasClass("w2ui-popup-hidden")){var r=e(t).find(n);r.length>0&&r[0].focus()}}),1)}))},lock:function(t,i){var n=Array.prototype.slice.call(arguments,0);n.unshift(e("#w2ui-popup")),w2utils.lock.apply(window,n)},unlock:function(t){w2utils.unlock(e("#w2ui-popup"),t)},lockScreen:function(t){return!(e("#w2ui-lock").length>0||(null==t&&(t=e("#w2ui-popup").data("options")),null==t&&(t={}),t=e.extend({},w2popup.defaults,t),e("body").append('<div id="w2ui-lock"     onmousewheel="if (event.stopPropagation) event.stopPropagation(); else event.cancelBubble = true; if (event.preventDefault) event.preventDefault(); else return false;"    style="position: '+("IE5"==w2utils.engine?"absolute":"fixed")+"; z-Index: 1199; left: 0px; top: 0px;            padding: 0px; margin: 0px; background-color: "+t.color+'; width: 100%; height: 100%; opacity: 0;"></div>'),setTimeout((function(){e("#w2ui-lock").css("opacity",t.opacity).css(w2utils.cssPrefix("transition",t.speed+"s opacity"))}),1),1==t.modal?(e("#w2ui-lock").on("mousedown",(function(){e("#w2ui-lock").css("opacity","0.6").css(w2utils.cssPrefix("transition",".1s"))})),e("#w2ui-lock").on("mouseup",(function(){setTimeout((function(){e("#w2ui-lock").css("opacity",t.opacity).css(w2utils.cssPrefix("transition",".1s"))}),100)}))):e("#w2ui-lock").on("mousedown",(function(){w2popup.close()})),0))},unlockScreen:function(t){return 0!==e("#w2ui-lock").length&&(null==t&&(t=e("#w2ui-popup").data("options")),null==t&&(t={}),t=e.extend({},w2popup.defaults,t),e("#w2ui-lock").css("opacity","0").css(w2utils.cssPrefix("transition",t.speed+"s opacity")),setTimeout((function(){e("#w2ui-lock").remove()}),1e3*t.speed),!0)},resizeMessages:function(){e("#w2ui-popup").data("options"),e("#w2ui-popup .w2ui-message").each((function(){var t=e(this).data("options"),i=e("#w2ui-popup");parseInt(t.width)<10&&(t.width=10),parseInt(t.height)<10&&(t.height=10);var n=parseInt(i.find("> .w2ui-popup-title").css("height")),r=parseInt(i.width()),s=parseInt(i.height());t.width=t.originalWidth,t.width>r-10&&(t.width=r-10),t.height=t.originalHeight,t.height>s-n-5&&(t.height=s-n-5),t.originalHeight<0&&(t.height=s+t.originalHeight-n),t.originalWidth<0&&(t.width=r+2*t.originalWidth),e(this).css({left:(r-t.width)/2+"px",width:t.width+"px",height:t.height+"px"})}))},resize:function(t,i,n){var r,s,o=this,a=e("#w2ui-popup").data("options")||{};null==a.speed&&(a.speed=0),t=parseInt(t),i=parseInt(i),null==window.innerHeight?(r=parseInt(document.documentElement.offsetWidth),s=parseInt(document.documentElement.offsetHeight),"IE7"===w2utils.engine&&(r+=21,s+=4)):(r=parseInt(window.innerWidth),s=parseInt(window.innerHeight)),r-10<t&&(t=r-10),s-10<i&&(i=s-10);var l=(s-i)/2*.6,u=(r-t)/2;e("#w2ui-popup").css(w2utils.cssPrefix({transition:a.speed+"s width, "+a.speed+"s height, "+a.speed+"s left, "+a.speed+"s top"})).css({top:l,left:u,width:t,height:i});var c=setInterval((function(){o.resizeMessages()}),10);setTimeout((function(){clearInterval(c),a.width=t,a.height=i,o.resizeMessages(),"function"==typeof n&&n()}),1e3*a.speed+50)},restoreTemplate:function(){var t=e("#w2ui-popup").data("options");if(null!=t){var i=w2popup._template,n=t.title,r=t.body,s=t.buttons;if(w2popup._prev?(i=w2popup._prev.template,n=w2popup._prev.title,r=w2popup._prev.body,s=w2popup._prev.buttons,delete w2popup._prev):delete w2popup._template,null!=i){var o=e(i);if(0===o.length)return;"body"==e(r).attr("rel")?(n&&o.append(n),r&&o.append(r),s&&o.append(s)):o.append(r)}}}},e.extend(w2popup,w2utils.event)}(jQuery);var w2alert=function(e,t,i){var n=jQuery;return null==t&&(t=w2utils.lang("Notification")),n("#w2ui-popup").length>0&&"closing"!=w2popup.status?w2popup.message({width:400,height:170,body:'<div class="w2ui-centered w2ui-alert-msg" style="font-size: 13px;">'+e+"</div>",buttons:'<button onclick="w2popup.message();" class="w2ui-popup-btn w2ui-btn">'+w2utils.lang("Ok")+"</button>",onOpen:function(){n("#w2ui-popup .w2ui-message .w2ui-popup-btn").focus()},onClose:function(){"function"==typeof i&&i()}}):w2popup.open({width:450,height:220,showMax:!1,showClose:!1,title:t,body:'<div class="w2ui-centered w2ui-alert-msg" style="font-size: 13px;">'+e+"</div>",buttons:'<button onclick="w2popup.close();" class="w2ui-popup-btn w2ui-btn">'+w2utils.lang("Ok")+"</button>",onOpen:function(e){setTimeout((function(){n("#w2ui-popup .w2ui-popup-btn").focus()}),1)},onKeydown:function(e){n("#w2ui-popup .w2ui-popup-btn").focus().addClass("clicked")},onClose:function(){"function"==typeof i&&i()}}),{ok:function(e){return i=e,this},done:function(e){return i=e,this}}},w2confirm=function(e,t,i){var n=jQuery,r={},s={msg:"",title:w2utils.lang("Confirmation"),width:n("#w2ui-popup").length>0?400:450,height:n("#w2ui-popup").length>0?170:220,yes_text:"Yes",yes_class:"",yes_style:"",yes_callBack:null,no_text:"No",no_class:"",no_style:"",no_callBack:null,focus_to_no:!1,callBack:null};return 1==arguments.length&&"object"==typeof e?n.extend(r,s,e):"function"==typeof t?n.extend(r,s,{msg:e,callBack:t}):n.extend(r,s,{msg:e,title:t,callBack:i}),"object"==typeof r.btn_yes&&(r.yes_text=r.btn_yes.text||r.yes_text,r.yes_class=r.btn_yes.class||r.yes_class,r.yes_style=r.btn_yes.style||r.yes_style,r.yes_callBack=r.btn_yes.callBack||r.yes_callBack),"object"==typeof r.btn_no&&(r.no_text=r.btn_no.text||r.no_text,r.no_class=r.btn_no.class||r.no_class,r.no_style=r.btn_no.style||r.no_style,r.no_callBack=r.btn_no.callBack||r.no_callBack),n("#w2ui-popup").length>0&&"closing"!=w2popup.status&&w2popup.get()?(r.width>w2popup.get().width&&(r.width=w2popup.get().width),r.height>w2popup.get().height-50&&(r.height=w2popup.get().height-50),w2popup.message({width:r.width,height:r.height,body:'<div class="w2ui-centered w2ui-confirm-msg" style="font-size: 13px;">'+r.msg+"</div>",buttons:w2utils.settings.macButtonOrder?'<button id="No" class="w2ui-popup-btn w2ui-btn '+r.no_class+'" style="'+r.no_style+'">'+w2utils.lang(r.no_text)+'</button><button id="Yes" class="w2ui-popup-btn w2ui-btn '+r.yes_class+'" style="'+r.yes_style+'">'+w2utils.lang(r.yes_text)+"</button>":'<button id="Yes" class="w2ui-popup-btn w2ui-btn '+r.yes_class+'" style="'+r.yes_style+'">'+w2utils.lang(r.yes_text)+'</button><button id="No" class="w2ui-popup-btn w2ui-btn '+r.no_class+'" style="'+r.no_style+'">'+w2utils.lang(r.no_text)+"</button>",onOpen:function(e){n("#w2ui-popup .w2ui-message .w2ui-btn").on("click.w2confirm",(function(e){w2popup._confirm_btn=e.target.id,w2popup.message()})),"function"==typeof r.onOpen&&r.onOpen()},onClose:function(e){n("#w2ui-popup .w2ui-message .w2ui-btn").off("click.w2confirm"),setTimeout((function(){"function"==typeof r.callBack&&r.callBack(w2popup._confirm_btn),"Yes"==w2popup._confirm_btn&&"function"==typeof r.yes_callBack&&r.yes_callBack(),"No"==w2popup._confirm_btn&&"function"==typeof r.no_callBack&&r.no_callBack()}),300),"function"==typeof r.onClose&&r.onClose()}})):(w2utils.isInt(r.height)||(r.height=r.height+50),w2popup.open({width:r.width,height:r.height,title:r.title,modal:!0,showClose:!1,body:'<div class="w2ui-centered w2ui-confirm-msg" style="font-size: 13px;">'+r.msg+"</div>",buttons:w2utils.settings.macButtonOrder?'<button id="No" class="w2ui-popup-btn w2ui-btn '+r.no_class+'" style="'+r.no_style+'">'+w2utils.lang(r.no_text)+'</button><button id="Yes" class="w2ui-popup-btn w2ui-btn '+r.yes_class+'" style="'+r.yes_style+'">'+w2utils.lang(r.yes_text)+"</button>":'<button id="Yes" class="w2ui-popup-btn w2ui-btn '+r.yes_class+'" style="'+r.yes_style+'">'+w2utils.lang(r.yes_text)+'</button><button id="No" class="w2ui-popup-btn w2ui-btn '+r.no_class+'" style="'+r.no_style+'">'+w2utils.lang(r.no_text)+"</button>",onOpen:function(e){setTimeout((function(){n("#w2ui-popup .w2ui-popup-btn").on("click",(function(e){w2popup.close(),"function"==typeof r.callBack&&r.callBack(e.target.id),"Yes"==e.target.id&&"function"==typeof r.yes_callBack&&r.yes_callBack(),"No"==e.target.id&&"function"==typeof r.no_callBack&&r.no_callBack()})),r.focus_to_no?n("#w2ui-popup .w2ui-popup-btn#No").focus():n("#w2ui-popup .w2ui-popup-btn#Yes").focus(),"function"==typeof r.onOpen&&r.onOpen()}),1)},onClose:function(e){"function"==typeof r.onClose&&r.onClose()},onKeydown:function(e){if(0===n("#w2ui-popup .w2ui-message").length)switch(e.originalEvent.keyCode){case 13:n("#w2ui-popup .w2ui-popup-btn#Yes").focus().addClass("clicked"),w2popup.close();break;case 27:n("#w2ui-popup .w2ui-popup-btn#No").focus().click(),w2popup.close()}}})),{yes:function(e){return r.yes_callBack=e,this},no:function(e){return r.no_callBack=e,this}}},w2prompt=function(e,t,i){var n=jQuery,r={},s={title:w2utils.lang("Notification"),width:n("#w2ui-popup").length>0?400:450,height:n("#w2ui-popup").length>0?170:220,label:"",value:"",attrs:"",textarea:!1,ok_text:w2utils.lang("Ok"),ok_class:"",cancel_text:w2utils.lang("Cancel"),cancel_class:"",callBack:null,onOpen:null,onClose:null};function o(e,t){"ok"==e&&"function"==typeof r.ok_callBack&&r.ok_callBack(t),"cancel"==e&&"function"==typeof r.cancel_callBack&&r.cancel_callBack(t),"function"==typeof r.callBack&&r.callBack(e,t)}return w2popup.tmp=w2popup.tmp||{},1==arguments.length&&"object"==typeof e?n.extend(r,s,e):"function"==typeof t?n.extend(r,s,{label:e,callBack:t}):n.extend(r,s,{label:e,title:t,callBack:i}),n("#w2ui-popup").length>0&&"closing"!=w2popup.status&&w2popup.get()?(r.width>w2popup.get().width&&(r.width=w2popup.get().width),r.height>w2popup.get().height-50&&(r.height=w2popup.get().height-50),w2popup.message({width:r.width,height:r.height,body:r.textarea?'<div class="w2ui-prompt textarea">  <div>'+r.label+'</div>  <textarea id="w2prompt" class="w2ui-input" '+r.attrs+"></textarea></div>":'<div class="w2ui-prompt w2ui-centered">  <label>'+r.label+'</label>  <input id="w2prompt" class="w2ui-input" '+r.attrs+"></div>",buttons:w2utils.settings.macButtonOrder?'<button id="Cancel" class="w2ui-popup-btn w2ui-btn '+r.cancel_class+'">'+r.cancel_text+'</button><button id="Ok" class="w2ui-popup-btn w2ui-btn '+r.ok_class+'">'+r.ok_text+"</button>":'<button id="Ok" class="w2ui-popup-btn w2ui-btn '+r.ok_class+'">'+r.ok_text+'</button><button id="Cancel" class="w2ui-popup-btn w2ui-btn '+r.cancel_class+'">'+r.cancel_text+"</button>",onOpen:function(){n("#w2prompt").val(r.value).off(".w2prompt").on("keydown.w2prompt",(function(e){13==e.keyCode&&n("#w2ui-popup .w2ui-message .w2ui-btn#Ok").click()})),n("#w2ui-popup .w2ui-message .w2ui-btn#Ok").off(".w2prompt").on("click.w2prompt",(function(e){w2popup.tmp.btn="ok",w2popup.tmp.value=n("#w2prompt").val(),w2popup.message()})),n("#w2ui-popup .w2ui-message .w2ui-btn#Cancel").off(".w2prompt").on("click.w2prompt",(function(e){w2popup.tmp.btn="cancel",w2popup.tmp.value=null,w2popup.message()})),setTimeout((function(){n("#w2prompt").focus()}),100),"function"==typeof r.onOpen&&r.onOpen()},onClose:function(){n("#w2ui-popup .w2ui-message .w2ui-btn").off("click.w2prompt"),setTimeout((function(){o(w2popup.tmp.btn,w2popup.tmp.value)}),300),"function"==typeof r.onClose&&r.onClose()}})):(w2utils.isInt(r.height)||(r.height=r.height+50),w2popup.open({width:r.width,height:r.height,title:r.title,modal:!0,showClose:!1,body:r.textarea?'<div class="w2ui-prompt">  <div>'+r.label+'</div>  <textarea id="w2prompt" class="w2ui-input" '+r.attrs+"></textarea></div>":'<div class="w2ui-prompt w2ui-centered" style="font-size: 13px;">  <label>'+r.label+'</label>  <input id="w2prompt" class="w2ui-input" '+r.attrs+"></div>",buttons:w2utils.settings.macButtonOrder?'<button id="Cancel" class="w2ui-popup-btn w2ui-btn '+r.cancel_class+'">'+r.cancel_text+'</button><button id="Ok" class="w2ui-popup-btn w2ui-btn '+r.ok_class+'">'+r.ok_text+"</button>":'<button id="Ok" class="w2ui-popup-btn w2ui-btn '+r.ok_class+'">'+r.ok_text+'</button><button id="Cancel" class="w2ui-popup-btn w2ui-btn '+r.cancel_class+'">'+r.cancel_text+"</button>",onOpen:function(e){setTimeout((function(){n("#w2prompt").val(r.value),n("#w2prompt").w2field("text"),n("#w2ui-popup .w2ui-popup-btn#Ok").on("click",(function(e){w2popup.tmp.btn="ok",w2popup.tmp.value=n("#w2prompt").val(),w2popup.close()})),n("#w2ui-popup .w2ui-popup-btn#Cancel").on("click",(function(e){w2popup.tmp.btn="cancel",w2popup.tmp.value=null,w2popup.close()})),n("#w2ui-popup .w2ui-popup-btn#Ok"),setTimeout((function(){n("#w2prompt").focus()}),100),"function"==typeof r.onOpen&&r.onOpen()}),1)},onClose:function(e){o(w2popup.tmp.btn,w2popup.tmp.value),"function"==typeof r.onClose&&r.onClose()},onKeydown:function(e){if(0===n("#w2ui-popup .w2ui-message").length)switch(e.originalEvent.keyCode){case 13:n("#w2ui-popup .w2ui-popup-btn#Ok").focus().addClass("clicked");break;case 27:w2popup.tmp.btn="cancel",w2popup.tmp.value=null}}})),{change:function(e){return n("#w2prompt").on("keyup",e).keyup(),this},ok:function(e){return r.ok_callBack=e,this},cancel:function(e){return r.cancel_callBack=e,this}}};!function(e){var t=function(t){this.box=null,this.name=null,this.active=null,this.reorder=!1,this.flow="down",this.tooltip="top|left",this.tabs=[],this.routeData={},this.tmp={},this.right="",this.style="",e.extend(this,{handlers:[]}),e.extend(!0,this,w2obj.tabs,t)};e.fn.w2tabs=function(i){if(e.isPlainObject(i)){if(!w2utils.checkName(i,"w2tabs"))return;for(var n=i.tabs||[],r=new t(i),s=0;s<n.length;s++)r.tabs[s]=e.extend({},t.prototype.tab,n[s]);return w2ui[r.name]=r,0!==e(this).length&&r.render(e(this)[0]),r}var o=w2ui[e(this).attr("name")];return o?arguments.length>0?(o[i]&&o[i].apply(o,Array.prototype.slice.call(arguments,1)),this):o:null},t.prototype={onClick:null,onClose:null,onRender:null,onRefresh:null,onResize:null,onDestroy:null,tab:{id:null,text:null,route:null,hidden:!1,disabled:!1,closable:!1,tooltip:null,style:"",onClick:null,onRefresh:null,onClose:null},add:function(e){return this.insert(null,e)},insert:function(i,n){e.isArray(n)||(n=[n]);for(var r=0;r<n.length;r++){if(null==n[r].id)return void console.log('ERROR: The parameter "id" is required but not supplied. (obj: '+this.name+")");if(!w2utils.checkUniqueId(n[r].id,this.tabs,"tabs",this.name))return;var s=e.extend({},t.prototype.tab,n[r]);if(null==i)this.tabs.push(s);else{var o=this.get(i,!0),a=this.tabs[o].id;this.insertTabHTML(a,s)}}},remove:function(){for(var t=0,i=0;i<arguments.length;i++){var n=this.get(arguments[i]);if(!n)return!1;t++,this.tabs.splice(this.get(n.id,!0),1),e(this.box).find("#tabs_"+this.name+"_tab_"+w2utils.escapeId(n.id)).remove()}return this.resize(),t},select:function(e){return this.active!=e&&null!=this.get(e)&&(this.active=e,this.refresh(),!0)},set:function(t,i){var n=this.get(t,!0);return null!=n&&(e.extend(this.tabs[n],i),this.refresh(t),!0)},get:function(e,t){if(0===arguments.length){for(var i=[],n=0;n<this.tabs.length;n++)null!=this.tabs[n].id&&i.push(this.tabs[n].id);return i}for(var r=0;r<this.tabs.length;r++)if(this.tabs[r].id==e)return!0===t?r:this.tabs[r];return null},show:function(){for(var e=this,t=0,i=[],n=0;n<arguments.length;n++){var r=this.get(arguments[n]);r&&!1!==r.hidden&&(t++,r.hidden=!1,i.push(r.id))}return setTimeout((function(){for(var t=0;t<i.length;t++)e.refresh(i[t]);e.resize()}),15),t},hide:function(){for(var e=this,t=0,i=[],n=0;n<arguments.length;n++){var r=this.get(arguments[n]);r&&!0!==r.hidden&&(t++,r.hidden=!0,i.push(r.id))}return setTimeout((function(){for(var t=0;t<i.length;t++)e.refresh(i[t]);e.resize()}),15),t},enable:function(){for(var e=this,t=0,i=[],n=0;n<arguments.length;n++){var r=this.get(arguments[n]);r&&!1!==r.disabled&&(t++,r.disabled=!1,i.push(r.id))}return setTimeout((function(){for(var t=0;t<i.length;t++)e.refresh(i[t])}),15),t},disable:function(){for(var e=this,t=0,i=[],n=0;n<arguments.length;n++){var r=this.get(arguments[n]);r&&!0!==r.disabled&&(t++,r.disabled=!0,i.push(r.id))}return setTimeout((function(){for(var t=0;t<i.length;t++)e.refresh(i[t])}),15),t},dragMove:function(t){if(this.tmp.reordering){var i=this,n=this.tmp.moving,r=this.tabs[n.index],s=p(n.index,1),o=p(n.index,-1),a=e("#tabs_"+this.name+"_tab_"+w2utils.escapeId(r.id));if(n.divX>0&&s){var l=e("#tabs_"+this.name+"_tab_"+w2utils.escapeId(s.id)),u=parseInt(a.css("width")),c=parseInt(l.css("width"));if(c-=u=u<c?Math.floor(u/3):Math.floor(c/3),n.divX>c){var d=this.tabs.indexOf(s);return this.tabs.splice(n.index,0,this.tabs.splice(d,1)[0]),n.$tab.before(l),n.$tab.css("opacity",0),void Object.assign(this.tmp.moving,{index:d,divX:-u,x:t.pageX+u,left:n.left+n.divX+u})}}if(n.divX<0&&o){var h=e("#tabs_"+this.name+"_tab_"+w2utils.escapeId(o.id));if(u=parseInt(a.css("width")),c=parseInt(h.css("width")),c-=u=u<c?Math.floor(u/3):Math.floor(c/3),Math.abs(n.divX)>c)return d=this.tabs.indexOf(o),this.tabs.splice(n.index,0,this.tabs.splice(d,1)[0]),h.before(n.$tab),n.$tab.css("opacity",0),void Object.assign(n,{index:d,divX:u,x:t.pageX-u,left:n.left+n.divX-u})}}function p(e,t){e+=t;var n=i.tabs[e];return n&&n.hidden&&(n=p(e,t)),n}},tooltipShow:function(t,i,n){var r=this.get(t),s=e(this.box).find("#tabs_"+this.name+"_tab_"+w2utils.escapeId(t));if(null!=this.tooltip&&!r.disabled&&!this.tmp.reordering){var o=this.tooltip,a=r.tooltip;"function"==typeof a&&(a=a.call(this,r)),s.prop("_mouse_over",!0),setTimeout((function(){!0===s.prop("_mouse_over")&&!0!==s.prop("_mouse_tooltip")&&(s.prop("_mouse_tooltip",!0),s.w2tag(w2utils.lang(a),{position:o})),1==n&&s.w2tag(w2utils.lang(a),{position:o})}),1)}},tooltipHide:function(t){var i=this.get(t),n=e(this.box).find("#tabs_"+this.name+"_tab_"+w2utils.escapeId(t));null==this.tooltip||i.disabled||this.tmp.reordering||(n.removeProp("_mouse_over"),setTimeout((function(){!0!==n.prop("_mouse_over")&&!0===n.prop("_mouse_tooltip")&&(n.removeProp("_mouse_tooltip"),n.w2tag())}),1))},getTabHTML:function(e){var t=this.get(e,!0),i=this.tabs[t];if(null==i)return!1;null==i.text&&null!=i.caption&&(i.text=i.caption),null==i.tooltip&&null!=i.hint&&(i.tooltip=i.hint),null!=i.caption&&console.log("NOTICE: tabs tab.caption property is deprecated, please use tab.text. Tab -> ",i),null!=i.hint&&console.log("NOTICE: tabs tab.hint property is deprecated, please use tab.tooltip. Tab -> ",i);var n=i.text;"function"==typeof n&&(n=n.call(this,i)),null==n&&(n="");var r="",s="";return i.hidden&&(s+="display: none;"),i.disabled&&(s+="opacity: 0.2;"),i.closable&&!i.disabled&&(r='<div class="w2ui-tab-close'+(this.active===i.id?" active":"")+'"  onmouseover= "w2ui[\''+this.name+"'].tooltipShow('"+i.id+"', event)\"  onmouseout = \"w2ui['"+this.name+"'].tooltipHide('"+i.id+'\', event)"  onmousedown= "event.stopPropagation()"  onmouseup  = "w2ui[\''+this.name+"'].animateClose('"+i.id+"', event); event.stopPropagation()\"></div>"),'<div id="tabs_'+this.name+"_tab_"+i.id+'" style="'+s+" "+i.style+'"   class="w2ui-tab'+(this.active===i.id?" active":"")+(i.closable?" closable":"")+(i.class?" "+i.class:"")+'"   onmouseover = "w2ui[\''+this.name+"'].tooltipShow('"+i.id+"', event)\"   onmouseout  = \"w2ui['"+this.name+"'].tooltipHide('"+i.id+"', event)\"   onmousedown = \"w2ui['"+this.name+"'].initReorder('"+i.id+"', event)\"    onclick     = \"w2ui['"+this.name+"'].click('"+i.id+"', event)\">"+w2utils.lang(n)+r+"</div>"},refresh:function(t){var i=(new Date).getTime();"up"==this.flow?e(this.box).addClass("w2ui-tabs-up"):e(this.box).removeClass("w2ui-tabs-up");var n=this.trigger({phase:"before",type:"refresh",target:null!=t?t:this.name,object:this.get(t)});if(!0!==n.isCancelled){if(null==t)for(var r=0;r<this.tabs.length;r++)this.refresh(this.tabs[r].id);else{var s=e(this.box).find("#tabs_"+this.name+"_tab_"+w2utils.escapeId(t)),o=this.getTabHTML(t);0===s.length?e(this.box).find("#tabs_"+this.name+"_right").before(o):s.replaceWith(o)}return e("#tabs_"+this.name+"_right").html(this.right),this.trigger(e.extend(n,{phase:"after"})),(new Date).getTime()-i}},render:function(t){var i=(new Date).getTime(),n=this.trigger({phase:"before",type:"render",target:this.name,box:t});if(!0!==n.isCancelled){if(null!=t&&(e(this.box).find("#tabs_"+this.name+"_right").length>0&&e(this.box).removeAttr("name").removeClass("w2ui-reset w2ui-tabs").html(""),this.box=t),!this.box)return!1;var r='<div class="w2ui-scroll-wrapper" onmousedown="var el=w2ui[\''+this.name+'\']; if (el) el.resize();">    <div class="w2ui-tabs-line"></div>    <div id="tabs_'+this.name+'_right" class="w2ui-tabs-right">'+this.right+'</div></div><div class="w2ui-scroll-left" onclick="var el=w2ui[\''+this.name+"']; if (el) el.scroll('left');\"></div><div class=\"w2ui-scroll-right\" onclick=\"var el=w2ui['"+this.name+"']; if (el) el.scroll('right');\"></div>";return e(this.box).attr("name",this.name).addClass("w2ui-reset w2ui-tabs").html(r),e(this.box).length>0&&(e(this.box)[0].style.cssText+=this.style),this.trigger(e.extend(n,{phase:"after"})),this.refresh(),this.resize(),(new Date).getTime()-i}},initReorder:function(t,i){if(this.reorder){var n,r=this,s=e("#tabs_"+this.name+"_tab_"+w2utils.escapeId(t)),o=this.get(t,!0),a=s.clone();a.attr("id","#tabs_"+this.name+"_tab_ghost"),this.tmp.moving={index:o,indexFrom:o,$tab:s,$ghost:a,divX:0,left:s.offset().left,parentX:e(this.box).offset().left,x:i.pageX,opacity:s.css("opacity")},e("body").off(".w2uiTabReorder").on("mousemove.w2uiTabReorder",(function(t){if(!r.tmp.reordering){if(!0===(n=r.trigger({phase:"before",type:"reorder",target:r.tabs[o].id,indexFrom:o,tab:r.tabs[o]})).isCancelled)return;e().w2tag(),r.tmp.reordering=!0,a.addClass("moving"),a.css({"pointer-events":"none",position:"absolute",left:s.offset().left}),s.css("opacity",0),e(r.box).find(".w2ui-scroll-wrapper").append(a),e(r.box).find(".w2ui-tab-close").hide()}r.tmp.moving.divX=t.pageX-r.tmp.moving.x,a.css("left",r.tmp.moving.left-r.tmp.moving.parentX+r.tmp.moving.divX+"px"),r.dragMove(t)})).on("mouseup.w2uiTabReorder",(function(){e("body").off(".w2uiTabReorder"),a.css({transition:"0.1s",left:r.tmp.moving.$tab.offset().left-r.tmp.moving.parentX}),e(r.box).find(".w2ui-tab-close").show(),setTimeout((function(){a.remove(),s.css({opacity:r.tmp.moving.opacity}),r.tmp.reordering&&(r.trigger(e.extend(n,{phase:"after",indexTo:r.tmp.moving.index})),!0===n.isCancelled)||(r.tmp.reordering=!1)}),100)}))}},scroll:function(t){var i,n=e(this.box),r=this,s=n.find(".w2ui-scroll-wrapper"),o=s.scrollLeft(),a=e(this.box).find(".w2ui-tabs-right"),l=s.outerWidth(),u=o+parseInt(a.offset().left)+parseInt(a.width());switch(t){case"left":(i=o-l+50)<=0&&(i=0),s.animate({scrollLeft:i},300);break;case"right":(i=o+l-50)>=u-l&&(i=u-l),s.animate({scrollLeft:i},300)}setTimeout((function(){r.resize()}),350)},resize:function(){var t=(new Date).getTime(),i=this.trigger({phase:"before",type:"resize",target:this.name});if(!0!==i.isCancelled){var n=e(this.box);n.find(".w2ui-scroll-left, .w2ui-scroll-right").hide();var r=n.find(".w2ui-scroll-wrapper"),s=e(this.box).find(".w2ui-tabs-right"),o=r.outerWidth(),a=s.length>0?s[0].offsetLeft+s[0].clientWidth:0;if(a>o){r.scrollLeft()>0&&n.find(".w2ui-scroll-left").show();var l=parseInt(r.css("padding-right"));o<a-r.scrollLeft()-l&&n.find(".w2ui-scroll-right").show()}return this.trigger(e.extend(i,{phase:"after"})),(new Date).getTime()-t}},destroy:function(){var t=this.trigger({phase:"before",type:"destroy",target:this.name});!0!==t.isCancelled&&(e(this.box).find("#tabs_"+this.name+"_right").length>0&&e(this.box).removeAttr("name").removeClass("w2ui-reset w2ui-tabs").html(""),delete w2ui[this.name],this.trigger(e.extend(t,{phase:"after"})))},click:function(t,i){var n=this.get(t);if(null==n||n.disabled||this.tmp.reordering)return!1;var r=this.trigger({phase:"before",type:"click",target:t,tab:n,object:n,originalEvent:i});if(!0!==r.isCancelled){if(e(this.box).find("#tabs_"+this.name+"_tab_"+w2utils.escapeId(this.active)).removeClass("active"),e(this.box).find("#tabs_"+this.name+"_tab_"+w2utils.escapeId(this.active)).removeClass("active"),this.active=n.id,"string"==typeof n.route){var s=""!==n.route?String("/"+n.route).replace(/\/{2,}/g,"/"):"",o=w2utils.parseRoute(s);if(o.keys.length>0)for(var a=0;a<o.keys.length;a++)null!=this.routeData[o.keys[a].name]&&(s=s.replace(new RegExp(":"+o.keys[a].name,"g"),this.routeData[o.keys[a].name]));setTimeout((function(){window.location.hash=s}),1)}this.trigger(e.extend(r,{phase:"after"})),this.refresh(t)}},animateClose:function(t,i){var n=this.get(t);if(null==n||n.disabled)return!1;var r=this.trigger({phase:"before",type:"close",target:t,object:this.get(t),originalEvent:i});if(!0!==r.isCancelled){var s=this,o=e(this.box).find("#tabs_"+this.name+"_tab_"+w2utils.escapeId(n.id));o.css({opacity:0,transition:".25s"}).find(".w2ui-tab-close").remove(),o.css({"padding-left":0,"padding-right":0,"text-overflow":"clip",overflow:"hidden",width:"0px"}),setTimeout((function(){s.remove(t),s.trigger(e.extend(r,{phase:"after"})),s.refresh()}),250)}},insertTabHTML:function(t,i){var n=this.get(t,!0);this.tabs=this.tabs.slice(0,n).concat([i],this.tabs.slice(n));var r=e(this.box).find("#tabs_"+this.name+"_tab_"+w2utils.escapeId(t)),s=e(this.getTabHTML(i.id));r.before(s),this.resize()}},e.extend(t.prototype,w2utils.event),w2obj.tabs=t}(jQuery),function(e){var t=function(t){this.box=null,this.name=null,this.routeData={},this.items=[],this.right="",this.tooltip="top|left",e.extend(!0,this,w2obj.toolbar,t)};e.fn.w2toolbar=function(i){if(e.isPlainObject(i)){if(!w2utils.checkName(i,"w2toolbar"))return;var n=i.items||[],r=new t(i);e.extend(r,{items:[],handlers:[]});for(var s=0;s<n.length;s++)if(r.items[s]=e.extend({},t.prototype.item,n[s]),"menu-check"==r.items[s].type){var o=r.items[s];if(Array.isArray(o.selected)||(o.selected=[]),Array.isArray(o.items))for(var a=0;a<o.items.length;a++)(l=o.items[a]).checked&&-1==o.selected.indexOf(l.id)&&o.selected.push(l.id),l.checked||-1==o.selected.indexOf(l.id)||(l.checked=!0),null==l.checked&&(l.checked=!1)}else if("menu-radio"==r.items[s].type&&(o=r.items[s],Array.isArray(o.items)))for(a=0;a<o.items.length;a++){var l;(l=o.items[a]).checked&&null==o.selected?o.selected=l.id:l.checked=!1,l.checked||o.selected!=l.id||(l.checked=!0),null==l.checked&&(l.checked=!1)}return w2ui[r.name]=r,0!==e(this).length&&r.render(e(this)[0]),r}var u=w2ui[e(this).attr("name")];return u?arguments.length>0?(u[i]&&u[i].apply(u,Array.prototype.slice.call(arguments,1)),this):u:null},t.prototype={onClick:null,onRender:null,onRefresh:null,onResize:null,onDestroy:null,item:{id:null,type:"button",text:null,html:"",tooltip:null,count:null,hidden:!1,disabled:!1,checked:!1,img:null,icon:null,route:null,arrow:!0,style:null,group:null,items:null,selected:null,overlay:{},color:null,options:{advanced:!1,transparent:!0,html:""},onClick:null,onRefresh:null},add:function(e){this.insert(null,e)},insert:function(i,n){e.isArray(n)||(n=[n]);for(var r=0;r<n.length;r++){if(null==n[r].type)return void console.log('ERROR: The parameter "type" is required but not supplied in w2toolbar.add() method.');if(-1==e.inArray(String(n[r].type),["button","check","radio","drop","menu","menu-radio","menu-check","color","text-color","break","html","spacer"]))return void console.log('ERROR: The parameter "type" should be one of the following [button, check, radio, drop, menu, break, html, spacer] in w2toolbar.add() method.');if(null==n[r].id&&"break"!=n[r].type&&"spacer"!=n[r].type)return void console.log('ERROR: The parameter "id" is required but not supplied in w2toolbar.add() method.');if(!w2utils.checkUniqueId(n[r].id,this.items,"toolbar items",this.name))return;var s=e.extend({},t.prototype.item,n[r]);if(null==i)this.items.push(s);else{var o=this.get(i,!0);this.items=this.items.slice(0,o).concat([s],this.items.slice(o))}this.refresh(s.id),this.resize()}},remove:function(){for(var t=0,i=0;i<arguments.length;i++){var n=this.get(arguments[i]);if(n&&-1==String(arguments[i]).indexOf(":")){t++,e(this.box).find("#tb_"+this.name+"_item_"+w2utils.escapeId(n.id)).remove();var r=this.get(n.id,!0);null!=r&&this.items.splice(r,1)}}return this.resize(),t},set:function(t,i){var n=this.get(t);return null!=n&&(e.extend(n,i),this.refresh(String(t).split(":")[0]),!0)},get:function(e,t){if(0===arguments.length){for(var i=[],n=0;n<this.items.length;n++)null!=this.items[n].id&&i.push(this.items[n].id);return i}for(var r=String(e).split(":"),s=0;s<this.items.length;s++){var o=this.items[s];if(-1!=["menu","menu-radio","menu-check"].indexOf(o.type)&&2==r.length&&o.id==r[0]){var a=o.items;"function"==typeof a&&(a=a(this));for(var l=0;l<a.length;l++){var u=a[l];if(u.id==r[1]||null==u.id&&u.text==r[1])return 1==t?l:u;if(Array.isArray(u.items))for(var c=0;c<u.items.length;c++)if(u.items[c].id==r[1]||null==u.items[c].id&&u.items[c].text==r[1])return 1==t?l:u.items[c]}}else if(o.id==r[0])return 1==t?s:o}return null},show:function(){for(var e=this,t=0,i=[],n=0;n<arguments.length;n++){var r=this.get(arguments[n]);r&&(t++,r.hidden=!1,i.push(String(arguments[n]).split(":")[0]))}return setTimeout((function(){for(var t=0;t<i.length;t++)e.refresh(i[t]);e.resize()}),15),t},hide:function(){for(var e=this,t=0,i=[],n=0;n<arguments.length;n++){var r=this.get(arguments[n]);r&&(t++,r.hidden=!0,i.push(String(arguments[n]).split(":")[0]))}return setTimeout((function(){for(var t=0;t<i.length;t++)e.refresh(i[t]),e.tooltipHide(i[t]);e.resize()}),15),t},enable:function(){for(var e=this,t=0,i=[],n=0;n<arguments.length;n++){var r=this.get(arguments[n]);r&&(t++,r.disabled=!1,i.push(String(arguments[n]).split(":")[0]))}return setTimeout((function(){for(var t=0;t<i.length;t++)e.refresh(i[t])}),15),t},disable:function(){for(var e=this,t=0,i=[],n=0;n<arguments.length;n++){var r=this.get(arguments[n]);r&&(t++,r.disabled=!0,i.push(String(arguments[n]).split(":")[0]))}return setTimeout((function(){for(var t=0;t<i.length;t++)e.refresh(i[t]),e.tooltipHide(i[t])}),15),t},check:function(){for(var e=this,t=0,i=[],n=0;n<arguments.length;n++){var r=this.get(arguments[n]);r&&-1==String(arguments[n]).indexOf(":")&&(t++,r.checked=!0,i.push(String(arguments[n]).split(":")[0]))}return setTimeout((function(){for(var t=0;t<i.length;t++)e.refresh(i[t])}),15),t},uncheck:function(){for(var t=this,i=0,n=[],r=0;r<arguments.length;r++){var s=this.get(arguments[r]);s&&-1==String(arguments[r]).indexOf(":")&&(-1!=["menu","menu-radio","menu-check","drop","color","text-color"].indexOf(s.type)&&s.checked&&setTimeout((function(){e("#tb_"+t.name+"_item_"+w2utils.escapeId(s.id)).w2overlay({name:t.name,data:{"tb-item":s.id}})}),1),i++,s.checked=!1,n.push(String(arguments[r]).split(":")[0]))}return setTimeout((function(){for(var e=0;e<n.length;e++)t.refresh(n[e])}),15),i},click:function(t,i){var n=this,r=String(t).split(":"),s=this.get(r[0]),o=s&&s.items?w2obj.field.prototype.normMenu.call(this,s.items,s):[];if(r.length>1){var a=this.get(t);a&&!a.disabled&&n.menuClick({name:n.name,item:s,subItem:a,originalEvent:i})}else if(s&&!s.disabled){var l=this.trigger({phase:"before",type:"click",target:null!=t?t:this.name,item:s,object:s,originalEvent:i});if(!0===l.isCancelled)return;var u="#tb_"+this.name+"_item_"+w2utils.escapeId(s.id)+" table.w2ui-button";if(e(u).removeClass("down"),"radio"==s.type){for(var c=0;c<this.items.length;c++){var d=this.items[c];null!=d&&d.id!=s.id&&"radio"===d.type&&d.group==s.group&&d.checked&&(d.checked=!1,this.refresh(d.id))}s.checked=!0,e(u).addClass("checked")}if(-1!=["menu","menu-radio","menu-check","drop","color","text-color"].indexOf(s.type)&&(n.tooltipHide(t),s.checked?setTimeout((function(){e("#tb_"+n.name+"_item_"+w2utils.escapeId(s.id)).w2overlay({name:n.name,data:{"tb-item":s.id}}),s.checked=!1,n.refresh(s.id)}),1):setTimeout((function(){var t=e("#tb_"+n.name+"_item_"+w2utils.escapeId(s.id));e.isPlainObject(s.overlay)||(s.overlay={});var i=(t.width()-50)/2;if(i>19&&(i=19),"drop"==s.type&&t.w2overlay(s.html,e.extend({name:n.name,left:i,top:3,data:{"tb-item":s.id}},s.overlay,{onHide:function(e){a()}})),-1!=["menu","menu-radio","menu-check"].indexOf(s.type)){var r="normal";"menu-radio"==s.type&&(r="radio",o.forEach((function(e){s.selected==e.id?e.checked=!0:e.checked=!1}))),"menu-check"==s.type&&(r="check",o.forEach((function(t){e.isArray(s.selected)&&-1!=s.selected.indexOf(t.id)?t.checked=!0:t.checked=!1}))),t.w2menu(e.extend({name:n.name,items:o,left:i,top:3,data:{"tb-item":s.id}},s.overlay,{type:r,remove:function(e){n.menuClick({name:n.name,remove:!0,item:s,subItem:e.item,originalEvent:e.originalEvent,keepOpen:e.keepOpen})},select:function(e){n.menuClick({name:n.name,item:s,subItem:e.item,originalEvent:e.originalEvent,keepOpen:e.keepOpen})},onHide:function(e){a()}}))}function a(t){s.checked=!1,e(u).removeClass("checked")}-1!=["color","text-color"].indexOf(s.type)&&e(t).w2color(e.extend({color:s.color,onHide:function(e){a(),n._tmpColor&&n.colorClick({name:n.name,item:s,color:n._tmpColor,final:!0}),delete n._tmpColor},onSelect:function(e){null!=e&&(n.colorClick({name:n.name,item:s,color:e}),n._tmpColor=e)}},s.options))}),1)),-1!=["check","menu","menu-radio","menu-check","drop","color","text-color"].indexOf(s.type)&&(s.checked=!s.checked,s.checked?e(u).addClass("checked"):e(u).removeClass("checked")),s.route){var h=String("/"+s.route).replace(/\/{2,}/g,"/"),p=w2utils.parseRoute(h);if(p.keys.length>0)for(var f=0;f<p.keys.length;f++)h=h.replace(new RegExp(":"+p.keys[f].name,"g"),this.routeData[p.keys[f].name]);setTimeout((function(){window.location.hash=h}),1)}i&&-1!=["button","check","radio"].indexOf(s.type)&&this.tooltipShow(t,i,!0),this.trigger(e.extend(l,{phase:"after"}))}},scroll:function(t){var i,n,r,s=e(this.box),o=this,a=s.find(".w2ui-scroll-wrapper"),l=a.scrollLeft();switch(t){case"left":i=a.outerWidth(),n=a.find(":first").outerWidth(),(r=l-i+50)<=0&&(r=0),a.animate({scrollLeft:r},300);break;case"right":(r=l+(i=a.outerWidth())-50)>=(n=a.find(":first").outerWidth())-i&&(r=n-i),a.animate({scrollLeft:r},300)}setTimeout((function(){o.resize()}),350)},render:function(t){var i=(new Date).getTime(),n=this.trigger({phase:"before",type:"render",target:this.name,box:t});if(!0!==n.isCancelled&&(null!=t&&(e(this.box).find("> table #tb_"+this.name+"_right").length>0&&e(this.box).removeAttr("name").removeClass("w2ui-reset w2ui-toolbar").html(""),this.box=t),this.box)){for(var r='<div class="w2ui-scroll-wrapper" onmousedown="var el=w2ui[\''+this.name+'\']; if (el) el.resize();"><table cellspacing="0" cellpadding="0" width="100%"><tbody><tr>',s=0;s<this.items.length;s++){var o=this.items[s];null!=o&&(null==o.id&&(o.id="item_"+s),null!=o.caption&&console.log("NOTICE: toolbar item.caption property is deprecated, please use item.text. Item -> ",o),null!=o.hint&&console.log("NOTICE: toolbar item.hint property is deprecated, please use item.tooltip. Item -> ",o),"spacer"==o.type?r+='<td width="100%" id="tb_'+this.name+"_item_"+o.id+'" align="right"></td>':"new-line"==o.type?r+='<td width="100%"></td></tr></tbody></table><div class="w2ui-toolbar-new-line"></div><table cellspacing="0" cellpadding="0" width="100%"><tbody><tr>':r+='<td id="tb_'+this.name+"_item_"+o.id+'" style="'+(o.hidden?"display: none":"")+'"     class="'+(o.disabled?"disabled":"")+'" valign="middle"></td>')}return r+='<td width="100%" id="tb_'+this.name+'_right" align="right">'+this.right+"</td>",r+='</tr></tbody></table></div><div class="w2ui-scroll-left" onclick="var el=w2ui[\''+this.name+"']; if (el) el.scroll('left');\"></div><div class=\"w2ui-scroll-right\" onclick=\"var el=w2ui['"+this.name+"']; if (el) el.scroll('right');\"></div>",e(this.box).attr("name",this.name).addClass("w2ui-reset w2ui-toolbar").html(r),e(this.box).length>0&&(e(this.box)[0].style.cssText+=this.style),this.refresh(),this.resize(),this.trigger(e.extend(n,{phase:"after"})),(new Date).getTime()-i}},refresh:function(t){var i=(new Date).getTime(),n=this.trigger({phase:"before",type:"refresh",target:null!=t?t:this.name,item:this.get(t)});if(!0!==n.isCancelled){if(null!=t){var r=this.get(t);if(null==r)return!1;if("function"==typeof r.onRefresh){var s=this.trigger({phase:"before",type:"refresh",target:t,item:r,object:r});if(!0===s.isCancelled)return}var o=e(this.box).find("#tb_"+this.name+"_item_"+w2utils.escapeId(r.id)),a=this.getItemHTML(r);if(this.tooltipHide(t,{}),0===o.length)a="spacer"==r.type?'<td width="100%" id="tb_'+this.name+"_item_"+r.id+'" align="right"></td>':'<td id="tb_'+this.name+"_item_"+r.id+'" style="'+(r.hidden?"display: none":"")+'"     class="'+(r.disabled?"disabled":"")+'" valign="middle">'+a+"</td>",this.get(t,!0)==this.items.length-1?e(this.box).find("#tb_"+this.name+"_right").before(a):e(this.box).find("#tb_"+this.name+"_item_"+w2utils.escapeId(this.items[parseInt(this.get(t,!0))+1].id)).before(a);else{if(-1!=["menu","menu-radio","menu-check","drop","color","text-color"].indexOf(r.type)){var l=e("#w2ui-overlay-"+this.name);l.length>0&&(0==r.checked?l[0].hide():-1!=["menu","menu-radio","menu-check"].indexOf(r.type)&&l.w2menu("refresh",{items:r.items}))}o.html(a),r.hidden?o.css("display","none"):o.css("display",""),r.disabled?o.addClass("disabled"):o.removeClass("disabled")}return"function"==typeof r.onRefresh&&this.trigger(e.extend(s,{phase:"after"})),this.trigger(e.extend(n,{phase:"after"})),(new Date).getTime()-i}for(var u=0;u<this.items.length;u++){var c=this.items[u];null==c.id&&(c.id="item_"+u),this.refresh(c.id)}}},resize:function(){var t=(new Date).getTime(),i=this.trigger({phase:"before",type:"resize",target:this.name});if(!0!==i.isCancelled){var n=e(this.box);n.find(".w2ui-scroll-left, .w2ui-scroll-right").hide();var r=n.find(".w2ui-scroll-wrapper");return r.find(":first").outerWidth()>r.outerWidth()&&(r.scrollLeft()>0&&n.find(".w2ui-scroll-left").show(),r.scrollLeft()<r.find(":first").outerWidth()-r.outerWidth()&&n.find(".w2ui-scroll-right").show()),this.trigger(e.extend(i,{phase:"after"})),(new Date).getTime()-t}},destroy:function(){var t=this.trigger({phase:"before",type:"destroy",target:this.name});!0!==t.isCancelled&&(e(this.box).find("> table #tb_"+this.name+"_right").length>0&&e(this.box).removeAttr("name").removeClass("w2ui-reset w2ui-toolbar").html(""),e(this.box).html(""),delete w2ui[this.name],this.trigger(e.extend(t,{phase:"after"})))},getItemHTML:function(e){var t="";null!=e.caption&&null==e.text&&(e.text=e.caption),null==e.text&&(e.text=""),null==e.tooltip&&null!=e.hint&&(e.tooltip=e.hint),null==e.tooltip&&(e.tooltip=""),"function"==typeof e.get||!Array.isArray(e.items)&&"function"!=typeof e.items||(e.get=function(t){var i=e.items;return"function"==typeof i&&(i=e.items(e)),i.find((function(e){return e.id==t}))});var i="<td>&#160;</td>",n="function"==typeof e.text?e.text.call(this,e):e.text;if(e.img&&(i='<td><div class="w2ui-tb-image w2ui-icon '+e.img+'"></div></td>'),e.icon&&(i='<td><div class="w2ui-tb-image"><span class="'+("function"==typeof e.icon?e.icon.call(this,e):e.icon)+'"></span></div></td>'),""===t)switch(e.type){case"color":case"text-color":"string"==typeof e.color&&("#"==e.color.substr(0,1)&&(e.color=e.color.substr(1)),3!=e.color.length&&6!=e.color.length||(e.color="#"+e.color)),"color"==e.type&&(n='<div style="height: 12px; width: 12px; margin-top: 1px; border: 1px solid #8A8A8A; border-radius: 1px; box-shadow: 0px 0px 1px #fff;         background-color: '+(null!=e.color?e.color:"#fff")+'; float: left;"></div>'+(e.text?'<div style="margin-left: 17px;">'+w2utils.lang(e.text)+"</div>":"")),"text-color"==e.type&&(n='<div style="color: '+(null!=e.color?e.color:"#444")+';">'+(e.text?w2utils.lang(e.text):"<b>Aa</b>")+"</div>");case"menu":case"menu-check":case"menu-radio":case"button":case"check":case"radio":case"drop":t+='<table cellpadding="0" cellspacing="0"        class="w2ui-button '+(e.checked?"checked":"")+" "+(e.class?e.class:"")+'"        onclick     = "var el=w2ui[\''+this.name+"']; if (el) el.click('"+e.id+'\', event);"        onmouseenter = "'+(e.disabled?"":"jQuery(this).addClass('over'); w2ui['"+this.name+"'].tooltipShow('"+e.id+"', event);")+'"       onmouseleave = "'+(e.disabled?"":"jQuery(this).removeClass('over').removeClass('down'); w2ui['"+this.name+"'].tooltipHide('"+e.id+"', event);")+'"       onmousedown = "'+(e.disabled?"":"jQuery(this).addClass('down');")+'"       onmouseup   = "'+(e.disabled?"":"jQuery(this).removeClass('down');")+'"><tbody><tr><td>  <table cellpadding="1" cellspacing="0"><tbody>  <tr>'+i+(""!==n?'<td class="w2ui-tb-text w2ui-tb-caption" nowrap="nowrap" style="'+(e.style?e.style:"")+'">'+w2utils.lang(n)+"</td>":"")+(null!=e.count?'<td class="w2ui-tb-count" nowrap="nowrap"><span>'+e.count+"</span></td>":"")+(-1!=["menu","menu-radio","menu-check","drop","color","text-color"].indexOf(e.type)&&!1!==e.arrow?'<td class="w2ui-tb-down" nowrap="nowrap"><div></div></td>':"")+"  </tr></tbody></table></td></tr></tbody></table>";break;case"break":t+='<table cellpadding="0" cellspacing="0"><tbody><tr>    <td><div class="w2ui-break">&#160;</div></td></tr></tbody></table>';break;case"html":t+='<table cellpadding="0" cellspacing="0"><tbody><tr>    <td nowrap="nowrap">'+("function"==typeof e.html?e.html.call(this,e):e.html)+"</td></tr></tbody></table>"}return"<div>"+t+"</div>"},tooltipShow:function(t,i,n){if(null!=this.tooltip){var r=e(this.box).find("#tb_"+this.name+"_item_"+w2utils.escapeId(t)),s=this.get(t),o=this.tooltip,a=s.tooltip;"function"==typeof a&&(a=a.call(this,s)),clearTimeout(this._tooltipTimer),this._tooltipTimer=setTimeout((function(){if(!0!==r.prop("_mouse_tooltip")){if(r.prop("_mouse_tooltip",!0),-1!=["menu","menu-radio","menu-check","drop","color","text-color"].indexOf(s.type)&&1==s.checked)return;r.w2tag(w2utils.lang(a),{position:o})}}),0),r.prop("_mouse_tooltip")&&1==n&&r.w2tag(w2utils.lang(a),{position:o})}},tooltipHide:function(t,i){if(null!=this.tooltip){var n=e(this.box).find("#tb_"+this.name+"_item_"+w2utils.escapeId(t));this.get(t),clearTimeout(this._tooltipTimer),setTimeout((function(){!0===n.prop("_mouse_tooltip")&&(n.removeProp("_mouse_tooltip"),n.w2tag())}),1)}},menuClick:function(t){if(t.item&&!t.item.disabled){var i=this.trigger({phase:"before",type:!0!==t.remove?"click":"remove",target:t.item.id+":"+t.subItem.id,item:t.item,subItem:t.subItem,originalEvent:t.originalEvent});if(!0===i.isCancelled)return;var n=t.subItem,r=this.get(t.item.id),s=r.items;if("function"==typeof s&&(s=r.items()),"menu-radio"==r.type&&(r.selected=n.id,Array.isArray(s)&&s.forEach((function(e){!0===e.checked&&delete e.checked,Array.isArray(e.items)&&e.items.forEach((function(e){!0===e.checked&&delete e.checked}))})),n.checked=!0),"menu-check"==r.type)if(e.isArray(r.selected)||(r.selected=[]),null==n.group)-1==(o=r.selected.indexOf(n.id))?(r.selected.push(n.id),n.checked=!0):(r.selected.splice(o,1),n.checked=!1);else if(!1===n.group);else{var o,a=[];!function e(t){t.forEach((function(t){if(t.group===n.group){var i=r.selected.indexOf(t.id);-1!=i&&(t.id!=n.id&&a.push(t.id),r.selected.splice(i,1))}Array.isArray(t.items)&&e(t.items)}))}(s),-1==(o=r.selected.indexOf(n.id))&&(r.selected.push(n.id),n.checked=!0)}if("string"==typeof n.route){var l=""!==n.route?String("/"+n.route).replace(/\/{2,}/g,"/"):"",u=w2utils.parseRoute(l);if(u.keys.length>0)for(var c=0;c<u.keys.length;c++)null!=this.routeData[u.keys[c].name]&&(l=l.replace(new RegExp(":"+u.keys[c].name,"g"),this.routeData[u.keys[c].name]));setTimeout((function(){window.location.hash=l}),1)}this.refresh(t.item.id),this.trigger(e.extend(i,{phase:"after"}))}},colorClick:function(t){if(t.item&&!t.item.disabled){var i=this.trigger({phase:"before",type:"click",target:t.item.id,item:t.item,color:t.color,final:t.final,originalEvent:t.originalEvent});if(!0===i.isCancelled)return;t.item.color=t.color,this.refresh(t.item.id),this.trigger(e.extend(i,{phase:"after"}))}}},e.extend(t.prototype,w2utils.event),w2obj.toolbar=t}(jQuery),function(e){var t=function(t){this.name=null,this.box=null,this.sidebar=null,this.parent=null,this.nodes=[],this.menu=[],this.routeData={},this.selected=null,this.img=null,this.icon=null,this.style="",this.topHTML="",this.bottomHTML="",this.flatButton=!1,this.keyboard=!0,this.flat=!1,this.hasFocus=!1,e.extend(!0,this,w2obj.sidebar,t)};e.fn.w2sidebar=function(i){if(e.isPlainObject(i)){if(!w2utils.checkName(i,"w2sidebar"))return;var n=i.nodes,r=new t(i);return e.extend(r,{handlers:[],nodes:[]}),null!=n&&r.add(r,n),r.sidebar=r,w2ui[r.name]=r,0!==e(this).length&&r.render(e(this)[0]),r}var s=w2ui[e(this).attr("name")];return s?arguments.length>0?(s[i]&&s[i].apply(s,Array.prototype.slice.call(arguments,1)),this):s:null},t.prototype={levelPadding:12,handle:{size:0,style:"",content:""},onClick:null,onDblClick:null,onContextMenu:null,onMenuClick:null,onExpand:null,onCollapse:null,onKeydown:null,onRender:null,onRefresh:null,onResize:null,onDestroy:null,onFocus:null,onBlur:null,onFlat:null,node:{id:null,text:"",count:null,img:null,icon:null,nodes:[],style:"",route:null,selected:!1,expanded:!1,hidden:!1,disabled:!1,group:!1,groupShowHide:!0,collapsible:!1,plus:!1,onClick:null,onDblClick:null,onContextMenu:null,onExpand:null,onCollapse:null,parent:null,sidebar:null},add:function(e,t){return 1==arguments.length&&(t=arguments[0],e=this),"string"==typeof e&&(e=this.get(e)),this.insert(e,null,t)},insert:function(i,n,r){var s,o,a,l,u;if(2==arguments.length)if(r=arguments[1],null!=(n=arguments[0])){if(null==(o=this.get(n)))return e.isArray(r)||(r=[r]),null!=r[0].caption&&null==r[0].text&&(console.log("NOTICE: sidebar node.caption property is deprecated, please use node.text. Node -> ",r[0]),r[0].text=r[0].caption),s=r[0].text,console.log('ERROR: Cannot insert node "'+s+'" because cannot find node "'+n+'" to insert before.'),null;i=this.get(n).parent}else i=this;"string"==typeof i&&(i=this.get(i)),e.isArray(r)||(r=[r]);for(var c=0;c<r.length;c++)if(null!=typeof(l=r[c]).id)if(null==this.get(this,l.id)){if((a=e.extend({},t.prototype.node,l)).sidebar=this,a.parent=i,u=a.nodes||[],a.nodes=[],null==n)i.nodes.push(a);else{if(null==(o=this.get(i,n,!0)))return console.log('ERROR: Cannot insert node "'+l.text+'" because cannot find node "'+n+'" to insert before.'),null;i.nodes.splice(o,0,a)}u.length>0&&this.insert(a,null,u)}else console.log("ERROR: Cannot insert node with id="+l.id+" (text: "+l.text+") because another node with the same id already exists.");else null!=l.caption&&null==l.text&&(console.log("NOTICE: sidebar node.caption property is deprecated, please use node.text"),l.text=l.caption),s=l.text,console.log('ERROR: Cannot insert node "'+s+'" because it has no id.');return this.refresh(i.id),a},remove:function(){for(var e,t=0,i=0;i<arguments.length;i++)if(null!=(e=this.get(arguments[i]))){null!=this.selected&&this.selected===e.id&&(this.selected=null);var n=this.get(e.parent,arguments[i],!0);null!=n&&(e.parent.nodes[n].selected&&e.sidebar.unselect(e.id),e.parent.nodes.splice(n,1),t++)}return t>0&&1==arguments.length?this.refresh(e.parent.id):this.refresh(),t},set:function(t,i,n){if(2==arguments.length&&(n=i,i=t,t=this),"string"==typeof t&&(t=this.get(t)),null==t.nodes)return null;for(var r=0;r<t.nodes.length;r++){if(t.nodes[r].id===i){var s=this.update(i,n);if(0!=Object.keys(s).length){var o=n.nodes;e.extend(t.nodes[r],n,{nodes:[]}),null!=o&&this.add(t.nodes[r],o),this.refresh(i)}return!0}var a=this.set(t.nodes[r],i,n);if(a)return!0}return!1},get:function(e,t,i){if(0===arguments.length){for(var n=[],r=this.find({}),s=0;s<r.length;s++)null!=r[s].id&&n.push(r[s].id);return n}if((1==arguments.length||2==arguments.length&&!0===t)&&(i=t,t=e,e=this),"string"==typeof e&&(e=this.get(e)),null==e.nodes)return null;for(var o=0;o<e.nodes.length;o++){if(e.nodes[o].id==t)return!0===i?o:e.nodes[o];var a=this.get(e.nodes[o],t,i);if(a||0===a)return a}return null},find:function(e,t,i){if(1==arguments.length&&(t=e,e=this),i||(i=[]),"string"==typeof e&&(e=this.get(e)),null==e.nodes)return i;for(var n=0;n<e.nodes.length;n++){var r=!0;for(var s in t)e.nodes[n][s]!=t[s]&&(r=!1);r&&i.push(e.nodes[n]),e.nodes[n].nodes.length>0&&(i=this.find(e.nodes[n],t,i))}return i},hide:function(){for(var e=0,t=0;t<arguments.length;t++){var i=this.get(arguments[t]);null!=i&&!0!==i.hidden&&(i.hidden=!0,e++)}return e>0&&(1==arguments.length?this.refresh(arguments[0]):this.refresh()),e},show:function(){for(var e=0,t=0;t<arguments.length;t++){var i=this.get(arguments[t]);null!=i&&!1!==i.hidden&&(i.hidden=!1,e++)}return e>0&&(1==arguments.length?this.refresh(arguments[0]):this.refresh()),e},disable:function(){for(var e=0,t=0;t<arguments.length;t++){var i=this.get(arguments[t]);null!=i&&!0!==i.disabled&&(i.disabled=!0,i.selected&&this.unselect(i.id),e++)}return e>0&&(1==arguments.length?this.refresh(arguments[0]):this.refresh()),e},enable:function(){for(var e=0,t=0;t<arguments.length;t++){var i=this.get(arguments[t]);null!=i&&!1!==i.disabled&&(i.disabled=!1,e++)}return e>0&&(1==arguments.length?this.refresh(arguments[0]):this.refresh()),e},select:function(t){var i=this.get(t);if(!i)return!1;if(this.selected==t&&i.selected)return!1;this.unselect(this.selected);var n=e(this.box).find("#node_"+w2utils.escapeId(t));return n.addClass("w2ui-selected").find(".w2ui-icon").addClass("w2ui-icon-selected"),n.length>0&&this.scrollIntoView(t,!0),i.selected=!0,this.selected=t,!0},unselect:function(t){0===arguments.length&&(t=this.selected);var i=this.get(t);return!!i&&(i.selected=!1,e(this.box).find("#node_"+w2utils.escapeId(t)).removeClass("w2ui-selected").find(".w2ui-icon").removeClass("w2ui-icon-selected"),this.selected==t&&(this.selected=null),!0)},toggle:function(e){var t=this.get(e);return null!=t&&(t.plus?(this.set(e,{plus:!1}),this.expand(e),void this.refresh(e)):0!==t.nodes.length&&!!t.collapsible&&(this.get(e).expanded?this.collapse(e):this.expand(e)))},collapse:function(t){var i=this,n=this.get(t);if(null==n)return!1;var r=this.trigger({phase:"before",type:"collapse",target:t,object:n});return!0!==r.isCancelled?(e(this.box).find("#node_"+w2utils.escapeId(t)+"_sub").slideUp(200),e(this.box).find("#node_"+w2utils.escapeId(t)+" .w2ui-expanded").removeClass("w2ui-expanded").addClass("w2ui-collapsed"),n.expanded=!1,this.trigger(e.extend(r,{phase:"after"})),setTimeout((function(){i.refresh(t)}),200),!0):void 0},collapseAll:function(e){if(null==e&&(e=this),"string"==typeof e&&(e=this.get(e)),null==e.nodes)return!1;for(var t=0;t<e.nodes.length;t++)!0===e.nodes[t].expanded&&(e.nodes[t].expanded=!1),e.nodes[t].nodes&&e.nodes[t].nodes.length>0&&this.collapseAll(e.nodes[t]);return this.refresh(e.id),!0},expand:function(t){var i=this,n=this.get(t),r=this.trigger({phase:"before",type:"expand",target:t,object:n});if(!0!==r.isCancelled)return e(this.box).find("#node_"+w2utils.escapeId(t)+"_sub").slideDown(200),e(this.box).find("#node_"+w2utils.escapeId(t)+" .w2ui-collapsed").removeClass("w2ui-collapsed").addClass("w2ui-expanded"),n.expanded=!0,this.trigger(e.extend(r,{phase:"after"})),setTimeout((function(){i.refresh(t)}),200),!0},expandAll:function(e){if(null==e&&(e=this),"string"==typeof e&&(e=this.get(e)),null==e.nodes)return!1;for(var t=0;t<e.nodes.length;t++)!1===e.nodes[t].expanded&&(e.nodes[t].expanded=!0),e.nodes[t].nodes&&e.nodes[t].nodes.length>0&&this.expandAll(e.nodes[t]);this.refresh(e.id)},expandParents:function(e){var t=this.get(e);return null!=t&&(t.parent&&(t.parent.expanded||(t.parent.expanded=!0,this.refresh(t.parent.id)),this.expandParents(t.parent.id)),!0)},click:function(t,i){var n=this,r=this.get(t);if(null!=r&&!r.disabled&&!r.group){e(n.box).find(".w2ui-node.w2ui-selected").each((function(t,i){var r=e(i).attr("id").replace("node_",""),s=n.get(r);null!=s&&(s.selected=!1),e(i).removeClass("w2ui-selected").find(".w2ui-icon").removeClass("w2ui-icon-selected")}));var s=e(n.box).find("#node_"+w2utils.escapeId(t)),o=e(n.box).find("#node_"+w2utils.escapeId(n.selected));s.addClass("w2ui-selected").find(".w2ui-icon").addClass("w2ui-icon-selected"),setTimeout((function(){var a=n.trigger({phase:"before",type:"click",target:t,originalEvent:i,node:r,object:r});if(!0===a.isCancelled)return s.removeClass("w2ui-selected").find(".w2ui-icon").removeClass("w2ui-icon-selected"),void o.addClass("w2ui-selected").find(".w2ui-icon").addClass("w2ui-icon-selected");if(null!=o&&(o.selected=!1),n.get(t).selected=!0,n.selected=t,"string"==typeof r.route){var l=""!==r.route?String("/"+r.route).replace(/\/{2,}/g,"/"):"",u=w2utils.parseRoute(l);if(u.keys.length>0)for(var c=0;c<u.keys.length;c++)null!=n.routeData[u.keys[c].name]&&(l=l.replace(new RegExp(":"+u.keys[c].name,"g"),n.routeData[u.keys[c].name]));setTimeout((function(){window.location.hash=l}),1)}n.trigger(e.extend(a,{phase:"after"}))}),1)}},focus:function(t){var i=this,n=this.trigger({phase:"before",type:"focus",target:this.name,originalEvent:t});if(!0===n.isCancelled)return!1;this.hasFocus=!0,e(this.box).find(".w2ui-sidebar-body").addClass("w2ui-focus"),setTimeout((function(){var t=e(i.box).find("#sidebar_"+i.name+"_focus");t.is(":focus")||t.focus()}),10),this.trigger(e.extend(n,{phase:"after"}))},blur:function(t){var i=this.trigger({phase:"before",type:"blur",target:this.name,originalEvent:t});if(!0===i.isCancelled)return!1;this.hasFocus=!1,e(this.box).find(".w2ui-sidebar-body").removeClass("w2ui-focus"),this.trigger(e.extend(i,{phase:"after"}))},keydown:function(t){var i=this,n=i.get(i.selected);if(!0===i.keyboard){n||(n=i.nodes[0]);var r=i.trigger({phase:"before",type:"keydown",target:i.name,originalEvent:t});!0!==r.isCancelled&&(13!=t.keyCode&&32!=t.keyCode||n.nodes.length>0&&i.toggle(i.selected),37==t.keyCode&&(n.nodes.length>0&&n.expanded?i.collapse(i.selected):(s(n.parent),n.parent.group||i.collapse(n.parent.id))),39==t.keyCode&&(n.nodes.length>0||n.plus)&&!n.expanded&&i.expand(i.selected),38==t.keyCode&&(null==i.get(i.selected)?s(this.nodes[0]||null):s(o(n,a))),40==t.keyCode&&(null==i.get(i.selected)?s(this.nodes[0]||null):s(o(n,(function e(t,n){if(null==t)return null;var r=t.parent,s=i.get(t.id,!0),o=null;if(t.expanded&&t.nodes.length>0&&!0!==n){var a=t.nodes[0];o=a.hidden||a.disabled||a.group?e(a):a}else o=r&&s+1<r.nodes.length?r.nodes[s+1]:e(r,!0);return null!=o&&(o.hidden||o.disabled||o.group)&&(o=e(o)),o})))),-1!=e.inArray(t.keyCode,[13,32,37,38,39,40])&&(t.preventDefault&&t.preventDefault(),t.stopPropagation&&t.stopPropagation()),i.trigger(e.extend(r,{phase:"after"})))}function s(e,t){null==e||e.hidden||e.disabled||e.group||(i.click(e.id,t),setTimeout((function(){i.scrollIntoView()}),50))}function o(e,t){for(e=t(e);null!=e&&(e.hidden||e.disabled)&&!e.group;)e=t(e);return e}function a(e){if(null==e)return null;var t=e.parent,n=i.get(e.id,!0),r=n>0?l(t.nodes[n-1]):t;return null!=r&&(r.hidden||r.disabled||r.group)&&(r=a(r)),r}function l(e){if(e.expanded&&e.nodes.length>0){var t=e.nodes[e.nodes.length-1];return t.hidden||t.disabled||t.group?a(t):l(t)}return e}},scrollIntoView:function(t,i){if(null==t&&(t=this.selected),null!=this.get(t)){var n=e(this.box).find(".w2ui-sidebar-body"),r=e(this.box).find("#node_"+w2utils.escapeId(t)),s=r.offset().top-n.offset().top;(s+r.height()>n.height()||s<=0)&&n.animate({scrollTop:n.scrollTop()+s-n.height()/2+r.height()},i?0:250,"linear")}},dblClick:function(t,i){var n=this.get(t),r=this.trigger({phase:"before",type:"dblClick",target:t,originalEvent:i,object:n});!0!==r.isCancelled&&(this.toggle(t),this.trigger(e.extend(r,{phase:"after"})))},contextMenu:function(t,i){var n=this,r=n.get(t);t!=n.selected&&n.click(t);var s=n.trigger({phase:"before",type:"contextMenu",target:t,originalEvent:i,object:r,allowOnDisabled:!1});!0!==s.isCancelled&&(r.disabled&&!s.allowOnDisabled||(n.menu.length>0&&e(n.box).find("#node_"+w2utils.escapeId(t)).w2menu({items:n.menu,contextMenu:!0,originalEvent:i,onSelect:function(e){n.menuClick(t,parseInt(e.index),e.originalEvent)}}),i.preventDefault&&i.preventDefault(),n.trigger(e.extend(s,{phase:"after"}))))},menuClick:function(t,i,n){var r=this,s=r.trigger({phase:"before",type:"menuClick",target:t,originalEvent:n,menuIndex:i,menuItem:r.menu[i]});!0!==s.isCancelled&&r.trigger(e.extend(s,{phase:"after"}))},goFlat:function(){var t=this.trigger({phase:"before",type:"flat",goFlat:!this.flat});!0!==t.isCancelled&&(this.flat=!this.flat,this.refresh(),this.trigger(e.extend(t,{phase:"after"})))},render:function(t){var i=(new Date).getTime(),n=this,r=this.trigger({phase:"before",type:"render",target:this.name,box:t});if(!0!==r.isCancelled&&(null!=t&&(e(this.box).find("> div > div.w2ui-sidebar-body").length>0&&e(this.box).removeAttr("name").removeClass("w2ui-reset w2ui-sidebar").html(""),this.box=t),this.box)){e(this.box).attr("name",this.name).addClass("w2ui-reset w2ui-sidebar").html('<div><input id="sidebar_'+this.name+'_focus" style="position: absolute; top: 0; right: 0; width: 1px; z-index: -1; opacity: 0" '+(w2utils.isIOS?"readonly":"")+'/><div class="w2ui-sidebar-top"></div><div class="w2ui-sidebar-body"></div><div class="w2ui-sidebar-bottom"></div></div>'),e(this.box).find("> div").css({width:e(this.box).width()+"px",height:e(this.box).height()+"px"}),e(this.box).length>0&&(e(this.box)[0].style.cssText+=this.style);var s,o="";return 1==this.flatButton&&(o='<div class="w2ui-flat-'+(this.flat?"right":"left")+'" onclick="w2ui[\''+this.name+"'].goFlat()\"></div>"),""===this.topHTML&&""===o||(e(this.box).find(".w2ui-sidebar-top").html(this.topHTML+o),e(this.box).find(".w2ui-sidebar-body").css("top",e(this.box).find(".w2ui-sidebar-top").height()+"px")),""!==this.bottomHTML&&(e(this.box).find(".w2ui-sidebar-bottom").html(this.bottomHTML),e(this.box).find(".w2ui-sidebar-body").css("bottom",e(this.box).find(".w2ui-sidebar-bottom").height()+"px")),e(this.box).find("#sidebar_"+this.name+"_focus").on("focus",(function(e){clearTimeout(s),n.hasFocus||n.focus(e)})).on("blur",(function(e){s=setTimeout((function(){n.hasFocus&&n.blur(e)}),100)})).on("keydown",(function(e){9!=e.keyCode&&w2ui[n.name].keydown.call(w2ui[n.name],e)})),e(this.box).off("mousedown").on("mousedown",(function(t){setTimeout((function(){if(-1==["INPUT","TEXTAREA","SELECT"].indexOf(t.target.tagName.toUpperCase())){var i=e(n.box).find("#sidebar_"+n.name+"_focus");if(!i.is(":focus")){if(e(t.target).hasClass("w2ui-node")){var r=e(t.target).position().top+e(n.box).find(".w2ui-sidebar-top").height()+t.offsetY;i.css({top:r+"px",left:"0px"})}i.focus()}}}),1)})),this.trigger(e.extend(r,{phase:"after"})),this.refresh(),(new Date).getTime()-i}},update:function(t,i){var n,r=this.get(t);if(r){var s=e(this.box).find("#node_"+r.id);if(r.group)i.text&&(r.text=i.text,s.find(".w2ui-group-text").replaceWith("function"==typeof r.text?r.text.call(this,r):'<span class="w2ui-group-text">'+r.text+"</span>"),delete i.text),i.class&&(r.class=i.class,n=s.data("level"),s[0].className="w2ui-node-group w2ui-level-"+n+(r.class?" "+r.class:""),delete i.class),i.style&&(r.style=i.style,s.next()[0].style=r.style+";"+(!r.hidden&&r.expanded?"":"display: none;"),delete i.style);else{if(i.icon){var o=s.find(".w2ui-node-image > span");o.length>0&&(r.icon=i.icon,o[0].className="function"==typeof r.icon?r.icon.call(this,r):r.icon,delete i.icon)}if(i.count&&(r.count=i.count,s.find(".w2ui-node-count").html(r.count),s.find(".w2ui-node-count").length>0&&delete i.count),i.class&&s.length>0&&(r.class=i.class,n=s.data("level"),s[0].className="w2ui-node w2ui-level-"+n+(r.selected?" w2ui-selected":"")+(r.disabled?" w2ui-disabled":"")+(r.class?" "+r.class:""),delete i.class),i.text&&(r.text=i.text,s.find(".w2ui-node-text").html("function"==typeof r.text?r.text.call(this,r):r.text),delete i.text),i.style&&s.length>0){var a=s.find(".w2ui-node-text");r.style=i.style,a[0].style=r.style,delete i.style}}}return i},refresh:function(t){var i=(new Date).getTime(),n=this.trigger({phase:"before",type:"refresh",target:null!=t?t:this.name,fullRefresh:null==t});if(!0!==n.isCancelled){var r="";if(1==this.flatButton&&(r='<div class="w2ui-flat-'+(this.flat?"right":"left")+'" onclick="w2ui[\''+this.name+"'].goFlat()\"></div>"),""===this.topHTML&&""===r||(e(this.box).find(".w2ui-sidebar-top").html(this.topHTML+r),e(this.box).find(".w2ui-sidebar-body").css("top",e(this.box).find(".w2ui-sidebar-top").height()+"px")),""!==this.bottomHTML&&(e(this.box).find(".w2ui-sidebar-bottom").html(this.bottomHTML),e(this.box).find(".w2ui-sidebar-body").css("bottom",e(this.box).find(".w2ui-sidebar-bottom").height()+"px")),e(this.box).find("> div").removeClass("w2ui-sidebar-flat").addClass(this.flat?"w2ui-sidebar-flat":"").css({width:e(this.box).width()+"px",height:e(this.box).height()+"px"}),this.nodes.length>0&&null==this.nodes[0].parent){var s=this.nodes;this.nodes=[],this.add(this,s)}var o,a,l,u,c=this;if(null==t)o=this,l=".w2ui-sidebar-body";else{if(null==(o=this.get(t)))return;l="#node_"+w2utils.escapeId(o.id)+"_sub"}o!==this&&(s="#node_"+w2utils.escapeId(o.id),u=f(o),e(this.box).find(s).before('<div id="sidebar_'+this.name+'_tmp"></div>'),e(this.box).find(s).remove(),e(this.box).find(l).remove(),e("#sidebar_"+this.name+"_tmp").before(u),e("#sidebar_"+this.name+"_tmp").remove());var d={top:e(this.box).find(l).scrollTop(),left:e(this.box).find(l).scrollLeft()};e(this.box).find(l).html("");for(var h=0;h<o.nodes.length;h++)if(u=f(a=o.nodes[h]),e(this.box).find(l).append(u),0!==a.nodes.length)this.refresh(a.id);else{var p=this.trigger({phase:"before",type:"refresh",target:a.id});if(!0===p.isCancelled)return;this.trigger(e.extend(p,{phase:"after"}))}return e(this.box).find(l).scrollLeft(d.left).scrollTop(d.top),this.trigger(e.extend(n,{phase:"after"})),(new Date).getTime()-i}function f(e){var t="",i=e.img,n=e.icon;null==n&&null==i&&(null==n&&(n=c.icon),null==i&&(i=c.img));for(var r=e.parent,s=0;r&&null!=r.parent;)r=r.parent,s++;if(null!=e.caption&&null==e.text&&(e.text=e.caption),null!=e.caption&&(console.log("NOTICE: sidebar node.caption property is deprecated, please use node.text. Node -> ",e),e.text=e.caption),Array.isArray(e.nodes)&&e.nodes.length>0&&(e.collapsible=!0),e.group)t='<div class="w2ui-node-group w2ui-level-'+s+(e.class?" "+e.class:"")+'" id="node_'+e.id+'" data-level="'+s+'"   style="'+(e.hidden?"display: none":"")+'" onclick="w2ui[\''+c.name+"'].toggle('"+e.id+"')\"   oncontextmenu=\"w2ui['"+c.name+"'].contextMenu('"+e.id+"', event);\"   onmouseout=\"jQuery(this).find('span:nth-child(1)').css('color', 'transparent')\"    onmouseover=\"jQuery(this).find('span:nth-child(1)').css('color', 'inherit')\">"+(e.groupShowHide&&e.collapsible?"<span>"+(!e.hidden&&e.expanded?w2utils.lang("Hide"):w2utils.lang("Show"))+"</span>":"<span></span>")+("function"==typeof e.text?e.text.call(c,e):'<span class="w2ui-group-text">'+e.text+"</span>")+'</div><div class="w2ui-node-sub" id="node_'+e.id+'_sub" style="'+e.style+";"+(!e.hidden&&e.expanded?"":"display: none;")+'"></div>',c.flat&&(t='<div class="w2ui-node-group" id="node_'+e.id+'"><span>&#160;</span></div><div id="node_'+e.id+'_sub" style="'+e.style+";"+(!e.hidden&&e.expanded?"":"display: none;")+'"></div>');else{e.selected&&!e.disabled&&(c.selected=e.id),r="",i&&(r='<div class="w2ui-node-image w2ui-icon '+i+(e.selected&&!e.disabled?" w2ui-icon-selected":"")+'"></div>'),n&&(r='<div class="w2ui-node-image"><span class="'+("function"==typeof n?n.call(c,e):n)+'"></span></div>');var o=e.text,a="",l=null!=e.count?'<div class="w2ui-node-count">'+e.count+"</div>":"";!0===e.collapsible&&(a='<div class="w2ui-'+(e.expanded?"expanded":"collapsed")+'"><span></span></div>'),"function"==typeof e.text&&(o=e.text.call(c,e)),t='<div class="w2ui-node w2ui-level-'+s+(e.selected?" w2ui-selected":"")+(e.disabled?" w2ui-disabled":"")+(e.class?" "+e.class:"")+'"    id="node_'+e.id+'" data-level="'+s+'" style="position: relative; '+(e.hidden?"display: none;":"")+'"    ondblclick="w2ui[\''+c.name+"'].dblClick('"+e.id+"', event);\"    oncontextmenu=\"w2ui['"+c.name+"'].contextMenu('"+e.id+"', event);\"    onClick=\"w2ui['"+c.name+"'].click('"+e.id+"', event); \">"+(c.handle.content?'<div class="w2ui-node-handle" style="width: '+c.handle.size+"px; "+c.handle.style+'">'+c.handle.content+"</div>":"")+'   <div class="w2ui-node-data" style="margin-left:'+(s*c.levelPadding+c.handle.size)+'px">'+a+r+l+'<div class="w2ui-node-text w2ui-node-caption" style="'+(e.style||"")+'">'+o+'</div>   </div></div><div class="w2ui-node-sub" id="node_'+e.id+'_sub" style="'+e.style+";"+(!e.hidden&&e.expanded?"":"display: none;")+'"></div>',c.flat&&(t='<div class="w2ui-node w2ui-level-'+s+" "+(e.selected?"w2ui-selected":"")+" "+(e.disabled?"w2ui-disabled":"")+(e.class?" "+e.class:"")+'" id="node_'+e.id+'" style="'+(e.hidden?"display: none;":"")+"\"    onmouseover=\"jQuery(this).find('.w2ui-node-data').w2tag(w2utils.base64decode('"+w2utils.base64encode(o+(e.count||0===e.count?' - <span class="w2ui-node-count">'+e.count+"</span>":""))+"'),                { id: '"+e.id+"', left: -5 })\"    onmouseout=\"jQuery(this).find('.w2ui-node-data').w2tag(null, { id: '"+e.id+"' })\"    ondblclick=\"w2ui['"+c.name+"'].dblClick('"+e.id+"', event);\"    oncontextmenu=\"w2ui['"+c.name+"'].contextMenu('"+e.id+"', event);\"    onClick=\"w2ui['"+c.name+"'].click('"+e.id+'\', event); "><div class="w2ui-node-data w2ui-node-flat">'+r+'</div></div><div class="w2ui-node-sub" id="node_'+e.id+'_sub" style="'+e.style+";"+(!e.hidden&&e.expanded?"":"display: none;")+'"></div>')}return t}},resize:function(){var t=(new Date).getTime(),i=this.trigger({phase:"before",type:"resize",target:this.name});if(!0!==i.isCancelled)return e(this.box).css("overflow","hidden"),e(this.box).find("> div").css({width:e(this.box).width()+"px",height:e(this.box).height()+"px"}),this.trigger(e.extend(i,{phase:"after"})),(new Date).getTime()-t},destroy:function(){var t=this.trigger({phase:"before",type:"destroy",target:this.name});!0!==t.isCancelled&&(e(this.box).find("> div > div.w2ui-sidebar-body").length>0&&e(this.box).removeAttr("name").removeClass("w2ui-reset w2ui-sidebar").html(""),delete w2ui[this.name],this.trigger(e.extend(t,{phase:"after"})))},lock:function(e,t){var i=Array.prototype.slice.call(arguments,0);i.unshift(this.box),w2utils.lock.apply(window,i)},unlock:function(e){w2utils.unlock(this.box,e)}},e.extend(t.prototype,w2utils.event),w2obj.sidebar=t}(jQuery),function(e){var t=function(t){this.el=null,this.helpers={},this.type=t.type||"text",this.options=e.extend(!0,{},t),this.onSearch=t.onSearch||null,this.onRequest=t.onRequest||null,this.onLoad=t.onLoad||null,this.onError=t.onError||null,this.onClick=t.onClick||null,this.onAdd=t.onAdd||null,this.onNew=t.onNew||null,this.onRemove=t.onRemove||null,this.onMouseOver=t.onMouseOver||null,this.onMouseOut=t.onMouseOut||null,this.onIconClick=t.onIconClick||null,this.onScroll=t.onScroll||null,this.tmp={},delete this.options.type,delete this.options.onSearch,delete this.options.onRequest,delete this.options.onLoad,delete this.options.onError,delete this.options.onClick,delete this.options.onMouseOver,delete this.options.onMouseOut,delete this.options.onIconClick,delete this.options.onScroll,e.extend(!0,this,w2obj.field)};e.fn.w2field=function(i,n){if(0!==this.length){if(0===arguments.length){var r=e(this).data("w2field");return r}return"string"==typeof i&&"object"==typeof n&&(i=e.extend(!0,{},n,{type:i})),"string"==typeof i&&null==n&&(i={type:i}),i&&(i.type=String(i.type).toLowerCase()),this.each((function(n,r){var s=e(r).data("w2field");return null==s?(s=new t(i),e.extend(s,{handlers:[]}),r&&(s.el=e(r)[0]),s.init(),e(r).data("w2field",s),s):(s.clear(),"clear"!==i.type?(s=new t(i),e.extend(s,{handlers:[]}),r&&(s.el=e(r)[0]),s.init(),e(r).data("w2field",s),s):void 0)}))}var s=t.prototype;if(s[i])return s[i].apply(s,Array.prototype.slice.call(arguments,1))},t.prototype={custom:{},addType:function(e,t){return e=String(e).toLowerCase(),this.custom[e]=t,!0},removeType:function(e){return e=String(e).toLowerCase(),!!this.custom[e]&&(delete this.custom[e],!0)},init:function(){var t,i=this,n=this.options;if("function"!=typeof this.custom[this.type])if(-1!=["INPUT","TEXTAREA"].indexOf(this.el.tagName.toUpperCase())){switch(this.type){case"text":case"int":case"float":case"money":case"currency":case"percent":case"alphanumeric":case"bin":case"hex":t={min:null,max:null,step:1,autoFormat:!0,currencyPrefix:w2utils.settings.currencyPrefix,currencySuffix:w2utils.settings.currencySuffix,currencyPrecision:w2utils.settings.currencyPrecision,decimalSymbol:w2utils.settings.decimalSymbol,groupSymbol:w2utils.settings.groupSymbol,arrows:!1,keyboard:!0,precision:null,silent:!0,prefix:"",suffix:""},this.options=e.extend(!0,{},t,n),(n=this.options).numberRE=new RegExp("["+n.groupSymbol+"]","g"),n.moneyRE=new RegExp("["+n.currencyPrefix+n.currencySuffix+n.groupSymbol+"]","g"),n.percentRE=new RegExp("["+n.groupSymbol+"%]","g"),-1!==["text","alphanumeric","hex","bin"].indexOf(this.type)&&(n.arrows=!1,n.keyboard=!1),this.addPrefix(),this.addSuffix();break;case"color":t={prefix:"",suffix:'<div style="width: '+(parseInt(e(this.el).css("font-size"))||12)+'px">&#160;</div>',arrows:!1,keyboard:!1,advanced:null,transparent:!0},this.options=e.extend(!0,{},t,n),n=this.options,this.addPrefix(),this.addSuffix(),""!==e(this.el).val()&&setTimeout((function(){i.change()}),1);break;case"date":t={format:w2utils.settings.dateFormat,keyboard:!0,silent:!0,start:"",end:"",blocked:{},colored:{},blockWeekDays:null},this.options=e.extend(!0,{},t,n),n=this.options,null==e(this.el).attr("placeholder")&&e(this.el).attr("placeholder",n.format);break;case"time":t={format:w2utils.settings.timeFormat,keyboard:!0,silent:!0,start:"",end:"",noMinutes:!1},this.options=e.extend(!0,{},t,n),n=this.options,null==e(this.el).attr("placeholder")&&e(this.el).attr("placeholder",n.format);break;case"datetime":t={format:w2utils.settings.dateFormat+" | "+w2utils.settings.timeFormat,keyboard:!0,silent:!0,start:"",end:"",blocked:[],colored:{},placeholder:null,btn_now:!0,noMinutes:!1},this.options=e.extend(!0,{},t,n),n=this.options,null==e(this.el).attr("placeholder")&&e(this.el).attr("placeholder",n.placeholder||n.format);break;case"list":case"combo":if(t={items:[],selected:{},url:null,recId:null,recText:null,method:null,interval:350,postData:{},minLength:1,cacheMax:250,maxDropHeight:350,maxDropWidth:null,match:"begins",silent:!0,icon:null,iconStyle:"",align:"both",altRows:!0,onSearch:null,onRequest:null,onLoad:null,onError:null,onIconClick:null,renderDrop:null,compare:null,filter:!0,prefix:"",suffix:"",openOnFocus:!1,markSearch:!1},"function"==typeof n.items&&(n._items_fun=n.items),n.items=w2obj.field.prototype.normMenu.call(this,n.items),"list"===this.type){if(t.openOnFocus=!0,e(this.el).addClass("w2ui-select"),!e.isPlainObject(n.selected)&&Array.isArray(n.items))for(var r=0;r<n.items.length;r++){var s=n.items[r];if(s&&s.id===n.selected){n.selected=e.extend(!0,{},s);break}}this.watchSize()}n=e.extend({},t,n),this.options=n,e.isPlainObject(n.selected)||(n.selected={}),e(this.el).data("selected",n.selected),n.url&&(n.items=[],this.request(0)),"list"===this.type&&this.addFocus(),this.addPrefix(),this.addSuffix(),setTimeout((function(){i.refresh()}),10),e(this.el).attr("autocapitalize","off").attr("autocomplete","off").attr("autocorrect","off").attr("spellcheck","false"),null!=n.selected.text&&e(this.el).val(n.selected.text);break;case"enum":t={items:[],selected:[],max:0,url:null,recId:null,recText:null,interval:350,method:null,postData:{},minLength:1,cacheMax:250,maxWidth:250,maxHeight:350,maxDropHeight:350,maxDropWidth:null,match:"contains",silent:!0,align:"both",altRows:!0,openOnFocus:!1,markSearch:!0,renderDrop:null,renderItem:null,compare:null,filter:!0,style:"",onSearch:null,onRequest:null,onLoad:null,onError:null,onClick:null,onAdd:null,onNew:null,onRemove:null,onMouseOver:null,onMouseOut:null,onScroll:null},"function"==typeof(n=e.extend({},t,n,{suffix:""})).items&&(n._items_fun=n.items),n.items=w2obj.field.prototype.normMenu.call(this,n.items),n.selected=w2obj.field.prototype.normMenu.call(this,n.selected),this.options=n,e.isArray(n.selected)||(n.selected=[]),e(this.el).data("selected",n.selected),n.url&&(n.items=[],this.request(0)),this.addSuffix(),this.addMulti(),this.watchSize();break;case"file":t={selected:[],max:0,maxSize:0,maxFileSize:0,maxWidth:250,maxHeight:350,maxDropHeight:350,maxDropWidth:null,readContent:!0,silent:!0,align:"both",altRows:!0,renderItem:null,style:"",onClick:null,onAdd:null,onRemove:null,onMouseOver:null,onMouseOut:null},n=e.extend({},t,n),this.options=n,e.isArray(n.selected)||(n.selected=[]),e(this.el).data("selected",n.selected),null==e(this.el).attr("placeholder")&&e(this.el).attr("placeholder",w2utils.lang("Attach files by dragging and dropping or Click to Select")),this.addMulti(),this.watchSize()}this.tmp={onChange:function(e){i.change.call(i,e)},onClick:function(e){i.click.call(i,e)},onFocus:function(e){i.focus.call(i,e)},onBlur:function(e){i.blur.call(i,e)},onKeydown:function(e){i.keyDown.call(i,e)},onKeyup:function(e){i.keyUp.call(i,e)},onKeypress:function(e){i.keyPress.call(i,e)}},e(this.el).addClass("w2field w2ui-input").data("w2field",this).on("change.w2field",this.tmp.onChange).on("click.w2field",this.tmp.onClick).on("focus.w2field",this.tmp.onFocus).on("blur.w2field",this.tmp.onBlur).on("keydown.w2field",this.tmp.onKeydown).on("keyup.w2field",this.tmp.onKeyup).on("keypress.w2field",this.tmp.onKeypress).css(w2utils.cssPrefix("box-sizing","border-box")),this.change(e.Event("change"))}else console.log("ERROR: w2field could only be applied to INPUT or TEXTAREA.",this.el);else this.custom[this.type].call(this,n)},watchSize:function(){var t=this,i=e(t.el).data("tmp")||{};i.sizeTimer=setInterval((function(){e(t.el).parents("body").length>0?t.resize():clearInterval(i.sizeTimer)}),200),e(t.el).data("tmp",i)},get:function(){return-1!==["list","enum","file"].indexOf(this.type)?e(this.el).data("selected"):e(this.el).val()},set:function(t,i){if(-1!==["list","enum","file"].indexOf(this.type)){if("list"!==this.type&&i)null==e(this.el).data("selected")&&e(this.el).data("selected",[]),e(this.el).data("selected").push(t),e(this.el).trigger("input").change();else{var n="enum"===this.type?[t]:t;e(this.el).data("selected",n).trigger("input").change()}this.refresh()}else e(this.el).val(t)},setIndex:function(t,i){if(-1!==["list","enum"].indexOf(this.type)){var n=this.options.items;if(n&&n[t]){if("list"!==this.type&&i)null==e(this.el).data("selected")&&e(this.el).data("selected",[]),e(this.el).data("selected").push(n[t]),e(this.el).trigger("input").change();else{var r="enum"===this.type?[n[t]]:n[t];e(this.el).data("selected",r).trigger("input").change()}return this.refresh(),!0}}return!1},clear:function(){var t=this.options;-1!==["money","currency"].indexOf(this.type)&&e(this.el).val(e(this.el).val().replace(t.moneyRE,"")),"percent"===this.type&&e(this.el).val(e(this.el).val().replace(/%/g,"")),"list"===this.type&&e(this.el).removeClass("w2ui-select"),this.type="clear";var i=e(this.el).data("tmp");if(this.tmp){for(var n in null!=i&&(e(this.el).height("auto"),i&&i["old-padding-left"]&&e(this.el).css("padding-left",i["old-padding-left"]),i&&i["old-padding-right"]&&e(this.el).css("padding-right",i["old-padding-right"]),i&&i["old-background-color"]&&e(this.el).css("background-color",i["old-background-color"]),i&&i["old-border-color"]&&e(this.el).css("border-color",i["old-border-color"]),clearInterval(i.sizeTimer)),e(this.el).val(this.clean(e(this.el).val())).removeClass("w2field").removeData().off(".w2field"),this.helpers)e(this.helpers[n]).remove();this.helpers={}}},refresh:function(){var t=this,i=this.options,n=e(this.el).data("selected"),r=(new Date).getTime();if(-1!==["list"].indexOf(this.type)&&(e(t.el).parent().css("white-space","nowrap"),t.helpers.prefix&&t.helpers.prefix.hide(),setTimeout((function(){if(t.helpers.focus){!e.isEmptyObject(n)&&i.icon?(i.prefix='<span class="w2ui-icon '+i.icon+'"style="cursor: pointer; font-size: 14px; display: inline-block; margin-top: -1px; color: #7F98AD;'+i.iconStyle+'"></span>',t.addPrefix()):(i.prefix="",t.addPrefix());var r=t.helpers.focus.find("input");""===e(r).val()?(e(r).css("text-indent","-9999em").prev().css("opacity",0),e(t.el).val(n&&null!=n.text?w2utils.lang(n.text):"")):(e(r).css("text-indent",0).prev().css("opacity",1),e(t.el).val(""),setTimeout((function(){t.helpers.prefix&&t.helpers.prefix.hide();var n="position: absolute; opacity: 0; margin: 4px 0px 0px 2px; background-position: left !important;";i.icon?(e(r).css("margin-left","17px"),e(t.helpers.focus).find(".icon-search").attr("style",n+"width: 11px !important; opacity: 1; display: block")):(e(r).css("margin-left","0px"),e(t.helpers.focus).find(".icon-search").attr("style",n+"width: 0px !important; opacity: 0; display: none"))}),1)),e(t.el).prop("readonly")||e(t.el).prop("disabled")?setTimeout((function(){e(t.helpers.prefix).css("opacity","0.6"),e(t.helpers.suffix).css("opacity","0.6")}),1):setTimeout((function(){e(t.helpers.prefix).css("opacity","1"),e(t.helpers.suffix).css("opacity","1")}),1)}}),1)),-1!==["enum","file"].indexOf(this.type)){var s="";if(n)for(var o=0;o<n.length;o++){var a,l=n[o];a="function"==typeof i.renderItem?i.renderItem(l,o,'<div class="w2ui-list-remove" title="'+w2utils.lang("Remove")+'" index="'+o+'">&#160;&#160;</div>'):'<div class="w2ui-list-remove" title="'+w2utils.lang("Remove")+'" index="'+o+'">&#160;&#160;</div>'+("enum"===t.type?l.text:l.name+'<span class="file-size"> - '+w2utils.formatSize(l.size)+"</span>"),s+='<li index="'+o+'" style="max-width: '+parseInt(i.maxWidth)+"px; "+(l.style?l.style:"")+'">'+a+"</li>"}var u=t.helpers.multi,c=u.find("ul");if(u.attr("style",u.attr("style")+";"+i.style),e(t.el).css("z-index","-1"),e(t.el).prop("readonly")||e(t.el).prop("disabled")?setTimeout((function(){u[0].scrollTop=0,u.addClass("w2ui-readonly").find("li").css("opacity","0.9").parent().find("li.nomouse").hide().find("input").prop("readonly",!0).parents("ul").find(".w2ui-list-remove").hide()}),1):setTimeout((function(){u.removeClass("w2ui-readonly").find("li").css("opacity","1").parent().find("li.nomouse").show().find("input").prop("readonly",!1).parents("ul").find(".w2ui-list-remove").show()}),1),u.find(".w2ui-enum-placeholder").remove(),c.find("li").not("li.nomouse").remove(),""!==s)c.prepend(s);else if(null!=e(t.el).attr("placeholder")&&""===u.find("input").val()){var d="padding-top: "+e(this.el).css("padding-top")+";padding-left: "+e(this.el).css("padding-left")+"; box-sizing: "+e(this.el).css("box-sizing")+"; line-height: "+e(this.el).css("line-height")+"; font-size: "+e(this.el).css("font-size")+"; font-family: "+e(this.el).css("font-family")+"; ";u.prepend('<div class="w2ui-enum-placeholder" style="'+d+'">'+e(t.el).attr("placeholder")+"</div>")}u.off("scroll.w2field").on("scroll.w2field",(function(i){var n=t.trigger({phase:"before",type:"scroll",target:t.el,originalEvent:i});!0!==n.isCancelled&&t.trigger(e.extend(n,{phase:"after"}))})).find("li").data("mouse","out").on("click",(function(i){var r="LI"===i.target.tagName.toUpperCase()?i.target:e(i.target).parents("LI"),s=n[e(r).attr("index")];if(!e(r).hasClass("nomouse"))if(i.stopPropagation(),e(i.target).hasClass("w2ui-list-remove")){if(e(t.el).prop("readonly")||e(t.el).prop("disabled"))return;if(!0===(o=t.trigger({phase:"before",type:"remove",target:t.el,originalEvent:i.originalEvent,item:s})).isCancelled)return;e().w2overlay(),n.splice(e(i.target).attr("index"),1),e(t.el).trigger("input").trigger("change"),e(i.target).parent().fadeOut("fast"),setTimeout((function(){t.refresh(),t.trigger(e.extend(o,{phase:"after"}))}),300)}else{var o;if(!0===(o=t.trigger({phase:"before",type:"click",target:t.el,originalEvent:i.originalEvent,item:s})).isCancelled)return;if("file"===t.type){var a="";/image/i.test(s.type)&&(a='<div style="padding: 3px;">    <img src="'+(s.content?"data:"+s.type+";base64,"+s.content:"")+'" style="max-width: 300px;"         onload="var w = jQuery(this).width(); var h = jQuery(this).height();             if (w < 300 & h < 300) return;             if (w >= h && w > 300) jQuery(this).width(300);            if (w < h && h > 300) jQuery(this).height(300);"        onerror="this.style.display = \'none\'"    ></div>');var l='style="padding: 3px; text-align: right; color: #777;"',u='style="padding: 3px"';a+='<div style="padding: 8px;">    <table cellpadding="2"><tbody>    <tr><td '+l+">"+w2utils.lang("Name")+":</td><td "+u+">"+s.name+"</td></tr>    <tr><td "+l+">"+w2utils.lang("Size")+":</td><td "+u+">"+w2utils.formatSize(s.size)+"</td></tr>    <tr><td "+l+">"+w2utils.lang("Type")+":</td><td "+u+'>        <span style="width: 200px; display: block-inline; overflow: hidden; text-overflow: ellipsis; white-space: nowrap="nowrap";">'+s.type+"</span>    </td></tr>    <tr><td "+l+">"+w2utils.lang("Modified")+":</td><td "+u+">"+w2utils.date(s.modified)+"</td></tr>    </tbody></table></div>",e("#w2ui-overlay").remove(),e(r).w2overlay(a)}t.trigger(e.extend(o,{phase:"after"}))}})).on("mouseover",(function(i){var r="LI"===i.target.tagName.toUpperCase()?i.target:e(i.target).parents("LI");if(!e(r).hasClass("nomouse")){if("out"===e(r).data("mouse")){var s=n[e(i.target).attr("index")],o=t.trigger({phase:"before",type:"mouseOver",target:t.el,originalEvent:i.originalEvent,item:s});if(!0===o.isCancelled)return;t.trigger(e.extend(o,{phase:"after"}))}e(r).data("mouse","over")}})).on("mouseout",(function(i){var r="LI"===i.target.tagName.toUpperCase()?i.target:e(i.target).parents("LI");e(r).hasClass("nomouse")||(e(r).data("mouse","leaving"),setTimeout((function(){if("leaving"===e(r).data("mouse")){e(r).data("mouse","out");var s=n[e(i.target).attr("index")],o=t.trigger({phase:"before",type:"mouseOut",target:t.el,originalEvent:i.originalEvent,item:s});if(!0===o.isCancelled)return;t.trigger(e.extend(o,{phase:"after"}))}}),0))})),e(this.el).height("auto");var h=e(u).find("> div.w2ui-multi-items").height()+2*w2utils.getSize(u,"+height");h<26&&(h=26),h>i.maxHeight&&(h=i.maxHeight),u.length>0&&(u[0].scrollTop=1e3);var p=w2utils.getSize(e(this.el),"height")-2;if(p>h&&(h=p),e(u).css({height:h+"px",overflow:h==i.maxHeight?"auto":"hidden"}),h<i.maxHeight&&e(u).prop("scrollTop",0),e(this.el).css({height:h+0+"px"}),"enum"===t.type){var f=t.helpers.multi.find("input");f.width(8*(f.val().length+2)+"px")}}return(new Date).getTime()-r},reset:function(){var e=this.type;this.clear(),this.type=e,this.init()},resize:function(){var t=this,i=e(t.el).width(),n=e(t.el).height();if(!(t.tmp.current_width==i&&n>0)){var r=this.helpers.focus,s=this.helpers.multi,o=this.helpers.suffix,a=this.helpers.prefix;if(r&&r.width(e(t.el).width()),s){var l=w2utils.getSize(t.el,"width")-parseInt(e(t.el).css("margin-left"),10)-parseInt(e(t.el).css("margin-right"),10);e(s).width(l)}o&&(t.options.suffix='<div class="arrow-down" style="margin-top: '+(parseInt(e(t.el).height())-6)/2+'px;"></div>',t.addSuffix()),a&&t.addPrefix(),t.tmp.current_width=i}},clean:function(t){if("number"==typeof t)return t;var i=this.options;return t=String(t).trim(),-1!==["int","float","money","currency","percent"].indexOf(this.type)&&("string"==typeof t&&(i.autoFormat&&-1!==["money","currency"].indexOf(this.type)&&(t=String(t).replace(i.moneyRE,"")),i.autoFormat&&"percent"===this.type&&(t=String(t).replace(i.percentRE,"")),i.autoFormat&&-1!==["int","float"].indexOf(this.type)&&(t=String(t).replace(i.numberRE,"")),t=t.replace(/\s+/g,"").replace(w2utils.settings.groupSymbol,"").replace(w2utils.settings.decimalSymbol,".")),parseFloat(t)==t&&(null!=i.min&&t<i.min&&(t=i.min,e(this.el).val(i.min)),null!=i.max&&t>i.max&&(t=i.max,e(this.el).val(i.max))),t=""!==t&&w2utils.isFloat(t)?Number(t):""),t},format:function(e){var t=this.options;if(t.autoFormat&&""!==e)switch(this.type){case"money":case"currency":""!==(e=w2utils.formatNumber(e,t.currencyPrecision,t.groupSymbol))&&(e=t.currencyPrefix+e+t.currencySuffix);break;case"percent":""!==(e=w2utils.formatNumber(e,t.precision,t.groupSymbol))&&(e+="%");break;case"float":e=w2utils.formatNumber(e,t.precision,t.groupSymbol);break;case"int":e=w2utils.formatNumber(e,0,t.groupSymbol)}return e},change:function(t){var i=this,n=i.options;if(-1!==["int","float","money","currency","percent"].indexOf(this.type)){var r=e(this.el).val(),s=this.format(this.clean(e(this.el).val()));if(""!==r&&r!=s)return e(this.el).val(s).trigger("input").change(),t.stopPropagation(),t.preventDefault(),!1}if("color"===this.type){var o=e(this.el).val();if("rgb"!==o.substr(0,3).toLowerCase()){o="#"+o;var a=e(this.el).val().length;8!==a&&6!==a&&3!==a&&(o="")}e(this.el).next().find("div").css("background-color",o),e(this.el).hasClass("has-focus")&&!0!==e(this.el).data("skipInit")&&this.updateOverlay()}if(-1!==["list","enum","file"].indexOf(this.type)&&(i.refresh(),setTimeout((function(){i.refresh()}),5)),-1!==["date","time","datetime"].indexOf(this.type)){var l=parseInt(i.el.value);w2utils.isInt(i.el.value)&&l>3e3&&("time"===this.type&&e(i.el).val(w2utils.formatTime(new Date(l),n.format)).trigger("input").change(),"date"===this.type&&e(i.el).val(w2utils.formatDate(new Date(l),n.format)).trigger("input").change(),"datetime"===this.type&&e(i.el).val(w2utils.formatDateTime(new Date(l),n.format)).trigger("input").change())}},click:function(t){t.stopPropagation(),-1!==["list","combo","enum"].indexOf(this.type)&&(e(this.el).hasClass("has-focus")||this.focus(t)),-1!==["date","time","color","datetime"].indexOf(this.type)&&this.updateOverlay()},focus:function(t){var i=this;if(e(i.el).addClass("has-focus"),-1!==["color","date","time","datetime"].indexOf(i.type)){if(e(i.el).prop("readonly")||e(i.el).prop("disabled"))return;e("#w2ui-overlay").length>0&&e("#w2ui-overlay")[0].hide(),setTimeout((function(){i.updateOverlay()}),150)}if(-1!==["list","combo","enum"].indexOf(i.type)){if(e(i.el).prop("readonly")||e(i.el).prop("disabled"))return;e("#w2ui-overlay").length>0&&e("#w2ui-overlay")[0].hide(),i.resize(),setTimeout((function(){"list"===i.type&&e(i.el).is(":focus")?e(i.helpers.focus).find("input").focus():(i.search(),setTimeout((function(){i.updateOverlay()}),1))}),1),"function"==typeof i.options._items_fun&&(i.options.items=w2obj.field.prototype.normMenu.call(this,i.options._items_fun))}"file"===i.type&&e(i.helpers.multi).css({outline:"auto 5px #7DB4F3","outline-offset":"2px"})},blur:function(t){var i=this,n=i.options,r=e(i.el).val().trim(),s=e("#w2ui-overlay");if(e(i.el).removeClass("has-focus"),-1!==["color","date","time","list","combo","enum","datetime"].indexOf(i.type)){var o=window.setTimeout((function(){!0!==s.data("keepOpen")&&s.hide()}),0);e(".menu",s).one("focus",(function(){clearTimeout(o),e(this).one("focusout",(function(e){s.hide()}))}))}-1!==["int","float","money","currency","percent"].indexOf(i.type)&&(""===r||i.checkType(r)||(e(i.el).val("").trigger("input").change(),!1===n.silent&&(e(i.el).w2tag("Not a valid number"),setTimeout((function(){e(i.el).w2tag("")}),3e3)))),-1!==["date","time","datetime"].indexOf(i.type)&&(""===r||i.inRange(i.el.value)?"date"!==i.type||""===r||w2utils.isDate(i.el.value,n.format)?"time"!==i.type||""===r||w2utils.isTime(i.el.value)?"datetime"!==i.type||""===r||w2utils.isDateTime(i.el.value,n.format)||(e(i.el).val("").removeData("selected").trigger("input").change(),!1===n.silent&&(e(i.el).w2tag("Not a valid date"),setTimeout((function(){e(i.el).w2tag("")}),3e3))):(e(i.el).val("").removeData("selected").trigger("input").change(),!1===n.silent&&(e(i.el).w2tag("Not a valid time"),setTimeout((function(){e(i.el).w2tag("")}),3e3))):(e(i.el).val("").removeData("selected").trigger("input").change(),!1===n.silent&&(e(i.el).w2tag("Not a valid date"),setTimeout((function(){e(i.el).w2tag("")}),3e3))):(e(i.el).val("").removeData("selected").trigger("input").change(),!1===n.silent&&(e(i.el).w2tag("Not in range"),setTimeout((function(){e(i.el).w2tag("")}),3e3)))),"enum"===i.type&&e(i.helpers.multi).find("input").val("").width(20),"file"===i.type&&e(i.helpers.multi).css({outline:"none"})},keyPress:function(e){var t=this;if(t.options,-1!==["int","float","money","currency","percent","hex","bin","color","alphanumeric"].indexOf(t.type)){if(e.metaKey||e.ctrlKey||e.altKey||e.charCode!=e.keyCode&&e.keyCode>0)return;var i=String.fromCharCode(e.charCode);if(!t.checkType(i,!0)&&13!=e.keyCode)return e.preventDefault(),e.stopPropagation?e.stopPropagation():e.cancelBubble=!0,!1}-1!==["date","time","datetime"].indexOf(t.type)&&9!==e.keyCode&&setTimeout((function(){t.updateOverlay()}),1)},keyDown:function(t,i){var n=this,r=n.options,s=t.keyCode||i&&i.keyCode,o=!1;if(-1!==["int","float","money","currency","percent"].indexOf(n.type)){if(!r.keyboard||e(n.el).prop("readonly")||e(n.el).prop("disabled"))return;var a=parseFloat(e(n.el).val().replace(r.moneyRE,""))||0,l=r.step;switch((t.ctrlKey||t.metaKey)&&(l=10),s){case 38:if(t.shiftKey)break;var u=a+l<=r.max||null==r.max?Number((a+l).toFixed(12)):r.max;e(n.el).val(u).trigger("input").change(),o=!0;break;case 40:if(t.shiftKey)break;u=a-l>=r.min||null==r.min?Number((a-l).toFixed(12)):r.min,e(n.el).val(u).trigger("input").change(),o=!0}o&&(t.preventDefault(),setTimeout((function(){n.el.setSelectionRange(n.el.value.length,n.el.value.length)}),0))}if("date"===n.type){if(!r.keyboard||e(n.el).prop("readonly")||e(n.el).prop("disabled"))return;var c=864e5;switch(l=1,(t.ctrlKey||t.metaKey)&&(l=10),(p=w2utils.isDate(e(n.el).val(),r.format,!0))||(p=new Date,c=0),s){case 38:if(t.shiftKey)break;var d=w2utils.formatDate(p.getTime()+c,r.format);10==l&&(d=w2utils.formatDate(new Date(p.getFullYear(),p.getMonth()+1,p.getDate()),r.format)),e(n.el).val(d).trigger("input").change(),o=!0;break;case 40:if(t.shiftKey)break;d=w2utils.formatDate(p.getTime()-c,r.format),10==l&&(d=w2utils.formatDate(new Date(p.getFullYear(),p.getMonth()-1,p.getDate()),r.format)),e(n.el).val(d).trigger("input").change(),o=!0}o&&(t.preventDefault(),setTimeout((function(){n.el.setSelectionRange(n.el.value.length,n.el.value.length),n.updateOverlay()}),0))}if("time"===n.type){if(!r.keyboard||e(n.el).prop("readonly")||e(n.el).prop("disabled"))return;l=t.ctrlKey||t.metaKey?60:1,a=e(n.el).val();var h=n.toMin(a)||n.toMin((new Date).getHours()+":"+((new Date).getMinutes()-1));switch(s){case 38:if(t.shiftKey)break;h+=l,o=!0;break;case 40:if(t.shiftKey)break;h-=l,o=!0}o&&(e(n.el).val(n.fromMin(h)).trigger("input").change(),t.preventDefault(),setTimeout((function(){n.el.setSelectionRange(n.el.value.length,n.el.value.length)}),0))}if("datetime"===n.type){if(!r.keyboard||e(n.el).prop("readonly")||e(n.el).prop("disabled"))return;c=864e5,l=1,(t.ctrlKey||t.metaKey)&&(l=10);var p,f=e(n.el).val();switch((p=w2utils.isDateTime(f,this.options.format,!0))||(p=new Date,c=0),s){case 38:if(t.shiftKey)break;d=w2utils.formatDateTime(p.getTime()+c,r.format),10==l&&(d=w2utils.formatDateTime(new Date(p.getFullYear(),p.getMonth()+1,p.getDate()),r.format)),e(n.el).val(d).trigger("input").change(),o=!0;break;case 40:if(t.shiftKey)break;d=w2utils.formatDateTime(p.getTime()-c,r.format),10==l&&(d=w2utils.formatDateTime(new Date(p.getFullYear(),p.getMonth()-1,p.getDate()),r.format)),e(n.el).val(d).trigger("input").change(),o=!0}o&&(t.preventDefault(),setTimeout((function(){n.el.setSelectionRange(n.el.value.length,n.el.value.length),n.updateOverlay()}),0))}if("color"===n.type){if(e(n.el).prop("readonly")||e(n.el).prop("disabled"))return;if((t.ctrlKey||t.metaKey)&&!t.shiftKey){var g=null,m=null;switch(s){case 38:g="up";break;case 40:g="down";break;case 39:g="right";break;case 37:g="left"}n.el.nav&&null!=g&&(m=n.el.nav(g),e(n.el).val(m).trigger("input").change(),t.preventDefault())}}if(-1!==["list","combo","enum"].indexOf(n.type)){if(e(n.el).prop("readonly")||e(n.el).prop("disabled"))return;var v=e(n.el).data("selected"),y=e(n.el),w=!1;switch(-1!==["list","enum"].indexOf(n.type)&&("list"===n.type&&(y=e(n.helpers.focus).find("input")),"enum"===n.type&&(y=e(n.helpers.multi).find("input")),-1==[37,38,39,40].indexOf(s)&&setTimeout((function(){n.refresh()}),1),86==t.keyCode&&(t.ctrlKey||t.metaKey)&&setTimeout((function(){n.refresh(),n.search(),n.request()}),50)),s){case 27:"list"===n.type&&(""!==y.val()&&y.val(""),t.stopPropagation());break;case 37:case 39:break;case 13:if(0===e("#w2ui-overlay").length)break;var b=r.items[r.index];if("enum"===n.type)if(null!=b){if(!0===(x=n.trigger({phase:"before",type:"add",target:n.el,originalEvent:t.originalEvent,item:b})).isCancelled)return;b=x.item,v.length>=r.max&&r.max>0&&v.pop(),delete b.hidden,delete n.tmp.force_open,v.push(b),e(n.el).trigger("input").change(),y.val("").width(20),n.refresh(),n.trigger(e.extend(x,{phase:"after"}))}else{if(b={id:y.val(),text:y.val()},!0===(x=n.trigger({phase:"before",type:"new",target:n.el,originalEvent:t.originalEvent,item:b})).isCancelled)return;b=x.item,"function"==typeof n.onNew&&(v.length>=r.max&&r.max>0&&v.pop(),delete n.tmp.force_open,v.push(b),e(n.el).trigger("input").change(),y.val("").width(20),n.refresh()),n.trigger(e.extend(x,{phase:"after"}))}else b&&e(n.el).data("selected",b).val(b.text).trigger("input").change(),""===e(n.el).val()&&e(n.el).data("selected")&&e(n.el).removeData("selected").val("").trigger("input").change(),"list"===n.type&&(y.val(""),n.refresh()),n.tmp.force_hide=!0;break;case 8:case 46:if("enum"===n.type&&8===s&&""===y.val()&&v.length>0){var x;if(b=v[v.length-1],!0===(x=n.trigger({phase:"before",type:"remove",target:n.el,originalEvent:t.originalEvent,item:b})).isCancelled)return;v.pop(),e(n.el).trigger("input").trigger("change"),n.refresh(),n.trigger(e.extend(x,{phase:"after"}))}"list"===n.type&&""===y.val()&&(e(n.el).data("selected",{}).trigger("input").change(),n.refresh());break;case 38:for(r.index=w2utils.isInt(r.index)?parseInt(r.index):0,r.index--;r.index>0&&(r.items[r.index].hidden||r.items[r.index].disabled);)r.index--;if(0===r.index&&(r.items[r.index].hidden||r.items[r.index].disabled))for(;r.items[r.index]&&(r.items[r.index].hidden||r.items[r.index].disabled);)r.index++;w=!0;break;case 40:for(r.index=w2utils.isInt(r.index)?parseInt(r.index):-1,r.index++;r.index<r.items.length-1&&(r.items[r.index].hidden||r.items[r.index].disabled);)r.index++;if(r.index==r.items.length-1&&(r.items[r.index].hidden||r.items[r.index].disabled))for(;r.items[r.index]&&(r.items[r.index].hidden||r.items[r.index].disabled);)r.index--;""===y.val()&&0===e("#w2ui-overlay").length?n.tmp.force_open=!0:w=!0}if(w)return r.index<0&&(r.index=0),r.index>=r.items.length&&(r.index=r.items.length-1),n.updateOverlay(w),t.preventDefault(),void setTimeout((function(){if("enum"===n.type)(e=y.get(0)).setSelectionRange(e.value.length,e.value.length);else if("list"===n.type){var e;(e=y.get(0)).setSelectionRange(e.value.length,e.value.length)}else n.el.setSelectionRange(n.el.value.length,n.el.value.length)}),0);"enum"===n.type&&y.width(8*(y.val().length+2)+"px")}},keyUp:function(t){if(-1!==["list","combo","enum"].indexOf(this.type)){if(e(this.el).prop("readonly")||e(this.el).prop("disabled"))return;if(-1==[16,17,18,20,37,39,91].indexOf(t.keyCode)){var i=e(this.helpers.focus).find("input");0===i.length&&(i=e(this.el));var n=this.trigger({phase:"before",type:"search",originalEvent:t,target:i,search:i.val()});if(!0===n.isCancelled)return;this.tmp.force_hide||this.request(),1==i.val().length&&this.refresh(),0!==e("#w2ui-overlay").length&&-1!=[38,40].indexOf(t.keyCode)||this.search(),this.trigger(e.extend(n,{phase:"after"}))}}},clearCache:function(){this.options.items=[],this.tmp.xhr_loading=!1,this.tmp.xhr_search="",this.tmp.xhr_total=-1},request:function(t){var i=this,n=this.options,r=e(i.el).val()||"";if(n.url){if("enum"===i.type){var s=e(i.helpers.multi).find("input");r=0===s.length?"":s.val()}if("list"===i.type&&(s=e(i.helpers.focus).find("input"),r=0===s.length?"":s.val()),0!==n.minLength&&r.length<n.minLength)return n.items=[],void this.updateOverlay();if(null==t&&(t=n.interval),null==i.tmp.xhr_search&&(i.tmp.xhr_search=""),null==i.tmp.xhr_total&&(i.tmp.xhr_total=-1),n.url&&(0===n.items.length&&0!==i.tmp.xhr_total||i.tmp.xhr_total==n.cacheMax&&r.length>i.tmp.xhr_search.length||r.length>=i.tmp.xhr_search.length&&r.substr(0,i.tmp.xhr_search.length)!==i.tmp.xhr_search||r.length<i.tmp.xhr_search.length)){if(i.tmp.xhr)try{i.tmp.xhr.abort()}catch(e){}i.tmp.xhr_loading=!0,i.search(),clearTimeout(i.tmp.timeout),i.tmp.timeout=setTimeout((function(){var t=n.url,s={search:r,max:n.cacheMax};e.extend(s,n.postData);var o=i.trigger({phase:"before",type:"request",search:r,target:i.el,url:t,postData:s});if(!0!==o.isCancelled){var a={type:"GET",url:t=o.url,data:s=o.postData,dataType:"JSON"};n.method&&(a.type=n.method),"JSON"===w2utils.settings.dataType&&(a.type="POST",a.data=JSON.stringify(a.data),a.contentType="application/json"),"HTTPJSON"===w2utils.settings.dataType&&(a.data={request:JSON.stringify(a.data)}),null!=n.method&&(a.type=n.method),i.tmp.xhr=e.ajax(a).done((function(t,o,a){var l=i.trigger({phase:"before",type:"load",target:i.el,search:s.search,data:t,xhr:a});if(!0!==l.isCancelled)if("string"==typeof(t=l.data)&&(t=JSON.parse(t)),null==t.records&&null!=t.items&&(t.records=t.items,delete t.items),"success"===t.status&&null==t.records&&(t.records=[]),"success"===t.status&&Array.isArray(t.records)){t.records.length>n.cacheMax&&t.records.splice(n.cacheMax,1e5),null==n.recId&&null!=n.recid&&(n.recId=n.recid),(n.recId||n.recText)&&t.records.forEach((function(e){"string"==typeof n.recId&&(e.id=e[n.recId]),"function"==typeof n.recId&&(e.id=n.recId(e)),"string"==typeof n.recText&&(e.text=e[n.recText]),"function"==typeof n.recText&&(e.text=n.recText(e))})),i.tmp.xhr_loading=!1,i.tmp.xhr_search=r,i.tmp.xhr_total=t.records.length,i.tmp.lastError="",n.items=i.normMenu(t.records),""===r&&0===t.records.length?i.tmp.emptySet=!0:i.tmp.emptySet=!1;var u,c=e(i.el).data("find_selected");c&&(Array.isArray(c)?(u=[],c.forEach((function(t){var i=!1;n.items.forEach((function(n){(n.id==t||t&&t.id==n.id)&&(u.push(e.extend(!0,{},n)),i=!0)})),i||u.push(t)}))):(u=c,n.items.forEach((function(e){(e.id==c||c&&c.id==e.id)&&(u=e)}))),e(i.el).data("selected",u).removeData("find_selected").trigger("input").change()),i.search(),i.trigger(e.extend(l,{phase:"after"}))}else console.log("ERROR: server did not return proper structure. It should return",{status:"success",records:[{id:1,text:"item"}]})})).fail((function(t,s,o){var a={status:s,error:o,rawResponseText:t.responseText},l=i.trigger({phase:"before",type:"error",target:i.el,search:r,error:a,xhr:t});if(!0!==l.isCancelled){if("abort"!==s){var u;try{u=e.parseJSON(t.responseText)}catch(e){}console.log("ERROR: Server communication failed.","\n   EXPECTED:",{status:"success",records:[{id:1,text:"item"}]},"\n         OR:",{status:"error",message:"error message"},"\n   RECEIVED:","object"==typeof u?u:t.responseText)}i.tmp.xhr_loading=!1,i.tmp.xhr_search=r,i.tmp.xhr_total=0,i.tmp.emptySet=!0,i.tmp.lastError=l.error||"Server communication failed",n.items=[],i.clearCache(),i.search(),i.updateOverlay(!1),i.trigger(e.extend(l,{phase:"after"}))}})),i.trigger(e.extend(o,{phase:"after"}))}}),t)}}},search:function(){var t=this,i=this.options,n=e(t.el).val(),r=t.el,s=[],o=e(t.el).data("selected");if("enum"===t.type)for(var a in r=e(t.helpers.multi).find("input"),n=r.val(),o)o[a]&&s.push(o[a].id);else if("list"===t.type)for(var a in r=e(t.helpers.focus).find("input"),n=r.val(),o)o[a]&&s.push(o[a].id);var l=i.items;if(!0!==t.tmp.xhr_loading){for(var u=0,c=0;c<l.length;c++){var d=l[c];if(null!=i.compare)"function"==typeof i.compare&&(d.hidden=!1===i.compare.call(this,d,n));else{var h="",p="";-1!==["is","begins"].indexOf(i.match)&&(h="^"),-1!==["is","ends"].indexOf(i.match)&&(p="$");try{new RegExp(h+n+p,"i").test(d.text)||"..."===d.text?d.hidden=!1:d.hidden=!0}catch(e){}}!1===i.filter&&(d.hidden=!1),"enum"===t.type&&-1!==e.inArray(d.id,s)&&(d.hidden=!0),!0!==d.hidden&&(u++,delete d.hidden)}for(i.index=-1;l[i.index]&&l[i.index].hidden;)i.index++;u<=0&&(i.index=-1),i.spinner=!1,t.updateOverlay(),setTimeout((function(){var t=e("#w2ui-overlay").html()||"";i.markSearch&&-1!==t.indexOf("$.fn.w2menuHandler")&&e("#w2ui-overlay").w2marker(n)}),1)}else l.splice(0,i.cacheMax),i.spinner=!0,t.updateOverlay()},updateOverlay:function(t){var i=this,n=this.options;if("color"===this.type){if(e(i.el).prop("readonly")||e(i.el).prop("disabled"))return;e(this.el).w2color({color:e(this.el).val(),transparent:n.transparent,advanced:n.advanced},(function(t){null!=t&&e(i.el).val(t).trigger("input").change()}))}if("date"===this.type){if(e(i.el).prop("readonly")||e(i.el).prop("disabled"))return;0===e("#w2ui-overlay").length&&e(i.el).w2overlay('<div class="w2ui-reset w2ui-calendar"></div>',{css:{"background-color":"#f5f5f5"},onShow:function(t){w2utils.isIE&&e(".w2ui-calendar").on("mousedown",(function(t){var i=e(t.target);1===i.length&&"w2ui-jump-year"===i[0].id&&e("#w2ui-overlay").data("keepOpen",!0)}))}}),(a=w2utils.isDate(e(i.el).val(),i.options.format,!0))&&(s=a.getMonth()+1,o=a.getFullYear()),function t(n,r){e("#w2ui-overlay > div > div").html(i.getMonthHTML(n,r,e(i.el).val())),e("#w2ui-overlay .w2ui-calendar-title").on("mousedown",(function(){var n,r;e(this).next().hasClass("w2ui-calendar-jump")?e(this).next().remove():(e(this).after('<div class="w2ui-calendar-jump" style=""></div>'),e(this).next().hide().html(i.getYearHTML()).fadeIn(200),setTimeout((function(){e("#w2ui-overlay .w2ui-calendar-jump").find(".w2ui-jump-month, .w2ui-jump-year").on("click",(function(){e(this).hasClass("w2ui-jump-month")&&(e(this).parent().find(".w2ui-jump-month").removeClass("selected"),e(this).addClass("selected"),r=e(this).attr("name")),e(this).hasClass("w2ui-jump-year")&&(e(this).parent().find(".w2ui-jump-year").removeClass("selected"),e(this).addClass("selected"),n=e(this).attr("name")),null!=n&&null!=r&&(e("#w2ui-overlay .w2ui-calendar-jump").fadeOut(100),setTimeout((function(){t(parseInt(r)+1,n)}),100))})),e("#w2ui-overlay .w2ui-calendar-jump >:last-child").prop("scrollTop",2e3)}),1))})),e("#w2ui-overlay .w2ui-date").on("mousedown",(function(){var t=e(this).attr("date");e(i.el).val(t).trigger("input").change(),e(this).css({"background-color":"#B6D5FB","border-color":"#aaa"})})).on("mouseup",(function(){setTimeout((function(){e("#w2ui-overlay").length>0&&e("#w2ui-overlay").removeData("keepOpen")[0].hide()}),10)})),e("#w2ui-overlay .previous").on("mousedown",(function(){var e=i.options.current.split("/");e[0]=parseInt(e[0])-1,t(e[0],e[1])})),e("#w2ui-overlay .next").on("mousedown",(function(){var e=i.options.current.split("/");e[0]=parseInt(e[0])+1,t(e[0],e[1])}))}(s,o)}if("time"===this.type){if(e(i.el).prop("readonly")||e(i.el).prop("disabled"))return;0===e("#w2ui-overlay").length&&e(i.el).w2overlay('<div class="w2ui-reset w2ui-calendar-time" onclick="event.stopPropagation();"></div>',{css:{"background-color":"#fff"}});var r="h24"===this.options.format;e("#w2ui-overlay > div").html(i.getHourHTML()),e("#w2ui-overlay .w2ui-time").on("mousedown",(function(t){e(this).css({"background-color":"#B6D5FB","border-color":"#aaa"});var n=e(this).attr("hour");e(i.el).val((n>12&&!r?n-12:n)+":00"+(r?"":n<12?" am":" pm")).trigger("input").change()})),null==this.options.noMinutes||!1===this.options.noMinutes?e("#w2ui-overlay .w2ui-time").on("mouseup",(function(){var t=e(this).attr("hour");e("#w2ui-overlay").length>0&&e("#w2ui-overlay")[0].hide(),e(i.el).w2overlay('<div class="w2ui-reset w2ui-calendar-time"></div>',{css:{"background-color":"#fff"}}),e("#w2ui-overlay > div").html(i.getMinHTML(t)),e("#w2ui-overlay .w2ui-time").on("mousedown",(function(){e(this).css({"background-color":"#B6D5FB","border-color":"#aaa"});var n=e(this).attr("min");e(i.el).val((t>12&&!r?t-12:t)+":"+(n<10?0:"")+n+(r?"":t<12?" am":" pm")).trigger("input").change()})).on("mouseup",(function(){setTimeout((function(){e("#w2ui-overlay").length>0&&e("#w2ui-overlay").removeData("keepOpen")[0].hide()}),10)}))})):e("#w2ui-overlay .w2ui-time").on("mouseup",(function(){setTimeout((function(){e("#w2ui-overlay").length>0&&e("#w2ui-overlay").removeData("keepOpen")[0].hide()}),10)}))}if("datetime"===this.type){if(e(i.el).prop("readonly")||e(i.el).prop("disabled"))return;var s,o,a;e("#w2ui-overlay .w2ui-time").length>0&&e("#w2ui-overlay")[0].hide(),0===e("#w2ui-overlay").length&&e(i.el).w2overlay('<div class="w2ui-reset w2ui-calendar" onclick="event.stopPropagation();"></div>',{css:{"background-color":"#f5f5f5"},onShow:function(t){w2utils.isIE&&e(".w2ui-calendar").on("mousedown",(function(t){var i=e(t.target);1===i.length&&"w2ui-jump-year"===i[0].id&&e("#w2ui-overlay").data("keepOpen",!0)}))}}),(a=w2utils.isDateTime(e(i.el).val(),i.options.format,!0))&&(s=a.getMonth()+1,o=a.getFullYear());var l=null;!function t(r,s){e("#w2ui-overlay > div > div").html(i.getMonthHTML(r,s,e(i.el).val())+(n.btn_now?'<div class="w2ui-calendar-now now">'+w2utils.lang("Current Date & Time")+"</div>":"")),e("#w2ui-overlay .w2ui-calendar-title").on("mousedown",(function(){var n,r;e(this).next().hasClass("w2ui-calendar-jump")?e(this).next().remove():(e(this).after('<div class="w2ui-calendar-jump" style=""></div>'),e(this).next().hide().html(i.getYearHTML()).fadeIn(200),setTimeout((function(){e("#w2ui-overlay .w2ui-calendar-jump").find(".w2ui-jump-month, .w2ui-jump-year").on("click",(function(){e(this).hasClass("w2ui-jump-month")&&(e(this).parent().find(".w2ui-jump-month").removeClass("selected"),e(this).addClass("selected"),r=e(this).attr("name")),e(this).hasClass("w2ui-jump-year")&&(e(this).parent().find(".w2ui-jump-year").removeClass("selected"),e(this).addClass("selected"),n=e(this).attr("name")),null!=n&&null!=r&&(e("#w2ui-overlay .w2ui-calendar-jump").fadeOut(100),setTimeout((function(){t(parseInt(r)+1,n)}),100))})),e("#w2ui-overlay .w2ui-calendar-jump >:last-child").prop("scrollTop",2e3)}),1))})),e("#w2ui-overlay .w2ui-date").on("mousedown",(function(){var t=e(this).attr("date");e(i.el).val(t).trigger("input").change(),e(this).css({"background-color":"#B6D5FB","border-color":"#aaa"}),l=new Date(e(this).attr("data-date"))})).on("mouseup",(function(){var t,n;e("#w2ui-overlay").length>0&&e("#w2ui-overlay")[0].hide(),e(i.el).w2overlay('<div class="w2ui-reset w2ui-calendar-time"></div>',{css:{"background-color":"#fff"}}),i.options.format,e("#w2ui-overlay > div").html(i.getHourHTML()),e("#w2ui-overlay .w2ui-time").on("mousedown",(function(n){e(this).css({"background-color":"#B6D5FB","border-color":"#aaa"}),t=e(this).attr("hour"),l.setHours(t);var r=w2utils.formatDateTime(l,i.options.format);e(i.el).val(r).trigger("input").change()})),null==i.options.noMinutes||!1===i.options.noMinutes?e("#w2ui-overlay .w2ui-time").on("mouseup",(function(){var r=e(this).attr("hour");e("#w2ui-overlay").length>0&&e("#w2ui-overlay")[0].hide(),e(i.el).w2overlay('<div class="w2ui-reset w2ui-calendar-time"></div>',{css:{"background-color":"#fff"}}),e("#w2ui-overlay > div").html(i.getMinHTML(r)),e("#w2ui-overlay .w2ui-time").on("mousedown",(function(){e(this).css({"background-color":"#B6D5FB","border-color":"#aaa"}),n=e(this).attr("min"),l.setHours(t,n);var r=w2utils.formatDateTime(l,i.options.format);e(i.el).val(r).trigger("input").change()})).on("mouseup",(function(){setTimeout((function(){e("#w2ui-overlay").length>0&&e("#w2ui-overlay").removeData("keepOpen")[0].hide()}),10)}))})):e("#w2ui-overlay .w2ui-time").on("mouseup",(function(){setTimeout((function(){e("#w2ui-overlay").length>0&&e("#w2ui-overlay").removeData("keepOpen")[0].hide()}),10)}))})),e("#w2ui-overlay .previous").on("mousedown",(function(){var e=i.options.current.split("/");e[0]=parseInt(e[0])-1,t(e[0],e[1])})),e("#w2ui-overlay .next").on("mousedown",(function(){var e=i.options.current.split("/");e[0]=parseInt(e[0])+1,t(e[0],e[1])})),e("#w2ui-overlay .now").on("mousedown",(function(){var t=w2utils.formatDateTime(new Date,i.options.format);return e(i.el).val(t).trigger("input").change(),!1})).on("mouseup",(function(){setTimeout((function(){e("#w2ui-overlay").length>0&&e("#w2ui-overlay").removeData("keepOpen")[0].hide()}),10)}))}(s,o)}if(-1!==["list","combo","enum"].indexOf(this.type)){var u=this.el,c=this.el;if("enum"===this.type&&(u=e(this.helpers.multi),c=e(u).find("input")),"list"===this.type){var d=e(c).data("selected");e.isPlainObject(d)&&!e.isEmptyObject(d)&&-1==n.index&&n.items.forEach((function(e,t){e.id===d.id&&(n.index=t)})),c=e(this.helpers.focus).find("input")}if(e(this.el).hasClass("has-focus")){if(!1===n.openOnFocus&&""===e(c).val()&&!0!==i.tmp.force_open)return void e().w2overlay();if(i.tmp.force_hide)return e().w2overlay(),void setTimeout((function(){delete i.tmp.force_hide}),1);""!==e(c).val()&&delete i.tmp.force_open;var h=w2utils.lang("No matches");if(null!=n.url&&String(e(c).val()).length<n.minLength&&!0!==i.tmp.emptySet&&(h=n.minLength+" "+w2utils.lang("letters or more...")),null!=n.url&&""===e(c).val()&&!0!==i.tmp.emptySet&&(h=w2utils.lang(n.msgSearch||"Type to search...")),null==n.url&&0===n.items.length&&(h=w2utils.lang("Empty list")),null!=n.msgNoItems){var p={search:e(c).val(),options:e.extend(!0,{},n)};n.url&&(p.remote={url:n.url,empty:!!i.tmp.emptySet,error:i.tmp.lastError,minLength:n.minLength}),h="function"==typeof n.msgNoItems?n.msgNoItems(p):n.msgNoItems}i.tmp.lastError&&(h=i.tmp.lastError),h&&(h='<div style="white-space: normal; line-height: 1.3">'+h+"</div>");var f=e.extend(!0,{},n,{search:!1,render:n.renderDrop,maxHeight:n.maxDropHeight,maxWidth:n.maxDropWidth,msgNoItems:h,onSelect:function(t){if("enum"===i.type){var r=e(i.el).data("selected");if(t.item){var s,o=i.trigger({phase:"before",type:"add",target:i.el,originalEvent:t.originalEvent,item:t.item});if(!0===o.isCancelled)return;r.length>=n.max&&n.max>0&&r.pop(),delete t.item.hidden,r.push(t.item),e(i.el).data("selected",r).trigger("input").change(),e(i.helpers.multi).find("input").val("").width(20),i.refresh(),!0!==t.keepOpen?e("#w2ui-overlay").length>0&&e("#w2ui-overlay")[0].hide():(f.items.forEach((function(e,i){e.id==t.item.id&&(s=i)})),null!=s&&f.items.splice(s,1),f.selected=r,e(u).w2menu("refresh",f)),i.trigger(e.extend(o,{phase:"after"}))}}else e(i.el).data("selected",t.item).val(t.item.text).trigger("input").change(),i.helpers.focus&&i.helpers.focus.find("input").val("")}});e(u).w2menu(t?"refresh-index":"refresh",f)}}},inRange:function(t,i){var n=!1;if("date"===this.type){if(f=w2utils.isDate(t,this.options.format,!0)){if(this.options.start||this.options.end){var r="string"==typeof this.options.start?this.options.start:e(this.options.start).val(),s="string"==typeof this.options.end?this.options.end:e(this.options.end).val(),o=w2utils.isDate(r,this.options.format,!0),a=w2utils.isDate(s,this.options.format,!0),l=new Date(f);o||(o=l),a||(a=l),l>=o&&l<=a&&(n=!0)}else n=!0;if(this.options.blocked&&-1!==e.inArray(t,this.options.blocked)&&(n=!1),null!==this.options.blockWeekDays&&void 0!==this.options.blockWeekDays&&null!=this.options.blockWeekDays.length)for(var u=this.options.blockWeekDays.length,c=0;c<u;c++)f.getDay()==this.options.blockWeekDays[c]&&(n=!1)}}else if("time"===this.type)if(this.options.start||this.options.end){var d=this.toMin(t),h=this.toMin(this.options.start),p=this.toMin(this.options.end);h||(h=d),p||(p=d),d>=h&&d<=p&&(n=!0)}else n=!0;else if("datetime"===this.type){var f;if((f=w2utils.isDateTime(t,this.options.format,!0))&&(this.options.start||this.options.end?(l=f,(o="object"==typeof this.options.start&&this.options.start instanceof Date?this.options.start:""!==(r="string"==typeof this.options.start?this.options.start:e(this.options.start).val()).trim()?w2utils.isDateTime(r,this.options.format,!0):"")||(o=l),(a="object"==typeof this.options.end&&this.options.end instanceof Date?this.options.end:""!==(s="string"==typeof this.options.end?this.options.end:e(this.options.end).val()).trim()?w2utils.isDateTime(s,this.options.format,!0):"")||(a=l),i&&o instanceof Date&&(o.setHours(0),o.setMinutes(0),o.setSeconds(0)),l>=o&&l<=a&&(n=!0)):n=!0,n&&this.options.blocked))for(c=0;c<this.options.blocked.length;c++){var g=this.options.blocked[c];if("string"==typeof g&&(g=w2utils.isDateTime(g,this.options.format,!0)),"object"==typeof g&&g instanceof Date&&g.getFullYear()==f.getFullYear()&&g.getMonth()==f.getMonth()&&g.getDate()==f.getDate()){n=!1;break}}}return n},checkType:function(e,t){var i=this;switch(i.type){case"int":return!(!t||-1===["-",i.options.groupSymbol].indexOf(e))||w2utils.isInt(e.replace(i.options.numberRE,""));case"percent":e=e.replace(/%/g,"");case"float":return!(!t||-1===["-",w2utils.settings.decimalSymbol,i.options.groupSymbol].indexOf(e))||w2utils.isFloat(e.replace(i.options.numberRE,""));case"money":case"currency":return!(!t||-1===["-",i.options.decimalSymbol,i.options.groupSymbol,i.options.currencyPrefix,i.options.currencySuffix].indexOf(e))||w2utils.isFloat(e.replace(i.options.moneyRE,""));case"bin":return w2utils.isBin(e);case"hex":return w2utils.isHex(e);case"alphanumeric":return w2utils.isAlphaNumeric(e)}return!0},addPrefix:function(){var t=this;setTimeout((function(){if("clear"!==t.type){var i,n=e(t.el).data("tmp")||{};n["old-padding-left"]&&e(t.el).css("padding-left",n["old-padding-left"]),n["old-padding-left"]=e(t.el).css("padding-left"),e(t.el).data("tmp",n),t.helpers.prefix&&e(t.helpers.prefix).remove(),""!==t.options.prefix&&(e(t.el).before('<div class="w2ui-field-helper">'+t.options.prefix+"</div>"),(i=e(t.el).prev()).css({color:e(t.el).css("color"),"font-family":e(t.el).css("font-family"),"font-size":e(t.el).css("font-size"),"padding-top":e(t.el).css("padding-top"),"padding-bottom":e(t.el).css("padding-bottom"),"padding-left":e(t.el).css("padding-left"),"padding-right":0,"margin-top":parseInt(e(t.el).css("margin-top"),10)+2+"px","margin-bottom":parseInt(e(t.el).css("margin-bottom"),10)+1+"px","margin-left":e(t.el).css("margin-left"),"margin-right":0}).on("click",(function(i){if(t.options.icon&&"function"==typeof t.onIconClick){var n=t.trigger({phase:"before",type:"iconClick",target:t.el,el:e(this).find("span.w2ui-icon")[0]});if(!0===n.isCancelled)return;t.trigger(e.extend(n,{phase:"after"}))}else"list"===t.type?e(t.helpers.focus).find("input").focus():e(t.el).focus()})),e(t.el).css("padding-left",i.width()+parseInt(e(t.el).css("padding-left"),10)+"px"),t.helpers.prefix=i)}}),1)},addSuffix:function(){var t,i,n=this;setTimeout((function(){if("clear"!==n.type){var r=e(n.el).data("tmp")||{};r["old-padding-right"]&&e(n.el).css("padding-right",r["old-padding-right"]),r["old-padding-right"]=e(n.el).css("padding-right"),e(n.el).data("tmp",r),i=parseInt(e(n.el).css("padding-right"),10),n.options.arrows&&(n.helpers.arrows&&e(n.helpers.arrows).remove(),e(n.el).after('<div class="w2ui-field-helper" style="border: 1px solid transparent">&#160;    <div class="w2ui-field-up" type="up">        <div class="arrow-up" type="up"></div>    </div>    <div class="w2ui-field-down" type="down">        <div class="arrow-down" type="down"></div>    </div></div>'),(t=e(n.el).next()).css({color:e(n.el).css("color"),"font-family":e(n.el).css("font-family"),"font-size":e(n.el).css("font-size"),height:e(n.el).height()+parseInt(e(n.el).css("padding-top"),10)+parseInt(e(n.el).css("padding-bottom"),10)+"px",padding:0,"margin-top":parseInt(e(n.el).css("margin-top"),10)+1+"px","margin-bottom":0,"border-left":"1px solid silver"}).css("margin-left","-"+(t.width()+parseInt(e(n.el).css("margin-right"),10)+12)+"px").on("mousedown",(function(t){var i=e("body");function r(i){e(n.el).focus(),n.keyDown(e.Event("keydown"),{keyCode:"up"===e(t.target).attr("type")?38:40}),!1!==i&&e("body").data("_field_update_timer",setTimeout(r,60))}i.on("mouseup",(function e(){clearTimeout(i.data("_field_update_timer")),i.off("mouseup",e)})),i.data("_field_update_timer",setTimeout(r,700)),r(!1)})),i+=t.width()+12,e(n.el).css("padding-right",i+"px"),n.helpers.arrows=t),""!==n.options.suffix&&(n.helpers.suffix&&e(n.helpers.suffix).remove(),e(n.el).after('<div class="w2ui-field-helper">'+n.options.suffix+"</div>"),(t=e(n.el).next()).css({color:e(n.el).css("color"),"font-family":e(n.el).css("font-family"),"font-size":e(n.el).css("font-size"),"padding-top":e(n.el).css("padding-top"),"padding-bottom":e(n.el).css("padding-bottom"),"padding-left":"3px","padding-right":e(n.el).css("padding-right"),"margin-top":parseInt(e(n.el).css("margin-top"),10)+2+"px","margin-bottom":parseInt(e(n.el).css("margin-bottom"),10)+1+"px"}).on("click",(function(t){"list"===n.type?e(n.helpers.focus).find("input").focus():e(n.el).focus()})),t.css("margin-left","-"+(w2utils.getSize(t,"width")+parseInt(e(n.el).css("margin-right"),10)+2)+"px"),i+=t.width()+3,e(n.el).css("padding-right",i+"px"),n.helpers.suffix=t)}}),1)},addFocus:function(){var t,i=this;this.options,e(i.helpers.focus).remove();var n=parseInt(e(i.el).attr("tabIndex"));isNaN(n)||-1===n||(i.el._tabIndex=n),i.el._tabIndex&&(n=i.el._tabIndex),null==n&&(n=-1),isNaN(n)&&(n=0);var r="";null!=e(i.el).attr("id")&&(r='id="'+e(i.el).attr("id")+'_search"');var s='<div class="w2ui-field-helper">    <div class="w2ui-icon icon-search" style="opacity: 0; display: none"></div>    <input '+r+' type="text" tabIndex="'+n+'" autocapitalize="off" autocomplete="off" autocorrect="off" spellcheck="false"/></div>';e(i.el).attr("tabindex",-1).before(s);var o=e(i.el).prev();i.helpers.focus=o,o.css({width:e(i.el).width(),"margin-top":e(i.el).css("margin-top"),"margin-left":parseInt(e(i.el).css("margin-left"))+parseInt(e(i.el).css("padding-left"))+"px","margin-bottom":e(i.el).css("margin-bottom"),"margin-right":e(i.el).css("margin-right")}).find("input").css({cursor:"default",width:"100%",outline:"none",opacity:1,margin:0,border:"1px solid transparent",padding:e(i.el).css("padding-top"),"padding-left":0,"margin-left":0,"background-color":"transparent"}),o.find("input").on("click",(function(t){0===e("#w2ui-overlay").length&&i.focus(t),t.stopPropagation()})).on("focus",(function(n){t=e(i.el).attr("placeholder"),e(i.el).css({outline:"auto 5px #7DB4F3","outline-offset":"2px"}),e(this).val(""),e(i.el).triggerHandler("focus"),n.stopPropagation?n.stopPropagation():n.cancelBubble=!0})).on("blur",(function(n){e(i.el).css("outline","none"),e(this).val(""),i.refresh(),e(i.el).triggerHandler("blur"),n.stopPropagation?n.stopPropagation():n.cancelBubble=!0,null!=t&&e(i.el).attr("placeholder",t)})).on("keydown",(function(n){var r=this;i.keyDown(n),setTimeout((function(){""===r.value?e(i.el).attr("placeholder",t):e(i.el).attr("placeholder","")}),10)})).on("keyup",(function(e){i.keyUp(e)})).on("keypress",(function(e){i.keyPress(e)})),o.on("click",(function(t){e(this).find("input").focus()})),i.refresh()},addMulti:function(){var t=this;this.options,e(t.helpers.multi).remove();var i="",n="margin-top     : 0px; margin-bottom  : 0px; margin-left    : "+e(t.el).css("margin-left")+"; margin-right   : "+e(t.el).css("margin-right")+"; width          : "+(w2utils.getSize(t.el,"width")-parseInt(e(t.el).css("margin-left"),10)-parseInt(e(t.el).css("margin-right"),10))+"px;",r="";if(null!=e(t.el).attr("id")&&(r='id="'+e(t.el).attr("id")+'_search" '),"enum"===t.type){var s=e(t.el).attr("tabIndex");s&&-1!==s&&(t.el._tabIndex=s),t.el._tabIndex&&(s=t.el._tabIndex),null==s&&(s=0),i='<div class="w2ui-field-helper w2ui-list" style="'+n+'; box-sizing: border-box">    <div style="padding: 0px; margin: 0px; display: inline-block" class="w2ui-multi-items">    <ul>        <li style="padding-left: 0px; padding-right: 0px" class="nomouse">            <input '+r+' type="text" style="width: 20px; margin: -3px 0 0; padding: 2px 0; border-color: white" autocapitalize="off" autocomplete="off" autocorrect="off" spellcheck="false"'+(e(t.el).prop("readonly")?' readonly="readonly"':"")+(e(t.el).prop("disabled")?' disabled="disabled"':"")+' tabindex="'+s+'"/>        </li>    </ul>    </div></div>'}"file"===t.type&&(i='<div class="w2ui-field-helper w2ui-list" style="'+n+'; box-sizing: border-box">   <div style="position: absolute; left: 0px; right: 0px; top: 0px; bottom: 0px;">       <input '+r+' name="attachment" class="file-input" type="file" style="width: 100%; height: 100%; opacity: 0;" tabindex="-1"'+(1!==t.options.max?' multiple="multiple"':"")+(e(t.el).prop("readonly")?' readonly="readonly"':"")+(e(t.el).prop("disabled")?' disabled="disabled"':"")+(e(t.el).attr("accept")?' accept="'+e(t.el).attr("accept")+'"':"")+'/>   </div>    <div style="position: absolute; padding: 0px; margin: 0px; display: inline-block" class="w2ui-multi-items">        <ul><li style="padding-left: 0px; padding-right: 0px" class="nomouse"></li></ul>    </div></div>');var o=e(t.el).data("tmp")||{};o["old-background-color"]=e(t.el).css("background-color"),o["old-border-color"]=e(t.el).css("border-color"),e(t.el).data("tmp",o),e(t.el).before(i).css({"background-color":"transparent","border-color":"transparent"});var a=e(t.el).prev();t.helpers.multi=a,"enum"===t.type&&(e(t.el).attr("tabindex",-1),a.find("input").on("click",(function(i){0===e("#w2ui-overlay").length&&t.focus(i),e(t.el).triggerHandler("click")})).on("focus",(function(i){e(a).css({outline:"auto 5px #7DB4F3","outline-offset":"2px"}),e(t.el).triggerHandler("focus"),i.stopPropagation?i.stopPropagation():i.cancelBubble=!0})).on("blur",(function(i){e(a).css("outline","none"),e(t.el).triggerHandler("blur"),i.stopPropagation?i.stopPropagation():i.cancelBubble=!0})).on("keyup",(function(e){t.keyUp(e)})).on("keydown",(function(e){t.keyDown(e)})).on("keypress",(function(e){t.keyPress(e)})),a.on("click",(function(t){e(this).find("input").focus()}))),"file"===t.type&&(e(t.el).css("outline","none"),a.find("input").off(".drag").on("click.drag",(function(i){i.stopPropagation(),e(t.el).prop("readonly")||e(t.el).prop("disabled")||e(t.el).focus()})).on("dragenter.drag",(function(i){e(t.el).prop("readonly")||e(t.el).prop("disabled")||e(a).addClass("w2ui-file-dragover")})).on("dragleave.drag",(function(i){e(t.el).prop("readonly")||e(t.el).prop("disabled")||e(a).removeClass("w2ui-file-dragover")})).on("drop.drag",(function(i){if(!e(t.el).prop("readonly")&&!e(t.el).prop("disabled")){e(a).removeClass("w2ui-file-dragover");for(var n=i.originalEvent.dataTransfer.files,r=0,s=n.length;r<s;r++)t.addFile.call(t,n[r]);e(t.el).focus(),i.preventDefault(),i.stopPropagation()}})).on("dragover.drag",(function(e){e.preventDefault(),e.stopPropagation()})).on("change.drag",(function(){if(e(t.el).focus(),void 0!==this.files)for(var i=0,n=this.files.length;i<n;i++)t.addFile.call(t,this.files[i])}))),t.refresh()},addFile:function(t){var i,n=this,r=this.options,s=e(n.el).data("selected"),o={name:t.name,type:t.type,modified:t.lastModifiedDate,size:t.size,content:null,file:t},a=0,l=0;if(s)for(var u=0;u<s.length;u++){if(s[u].name==t.name&&s[u].size==t.size)return;a+=s[u].size,l++}var c=n.trigger({phase:"before",type:"add",target:n.el,file:o,total:l,totalSize:a});if(!0!==c.isCancelled){if(0!==r.maxFileSize&&o.size>r.maxFileSize)return i="Maximum file size is "+w2utils.formatSize(r.maxFileSize),!1===r.silent&&e(n.el).w2tag(i),void console.log("ERROR: "+i);if(0!==r.maxSize&&a+o.size>r.maxSize)return i=w2utils.lang("Maximum total size is")+" "+w2utils.formatSize(r.maxSize),void(!1===r.silent?e(n.el).w2tag(i):console.log("ERROR: "+i));if(0!==r.max&&l>=r.max)return i=w2utils.lang("Maximum number of files is")+" "+r.max,void(!1===r.silent?e(n.el).w2tag(i):console.log("ERROR: "+i));if(s.push(o),"undefined"!=typeof FileReader&&!0===r.readContent){var d=new FileReader;d.onload=function(t){var i=t.target.result,r=i.indexOf(",");o.content=i.substr(r+1),n.refresh(),e(n.el).trigger("input").trigger("change"),n.trigger(e.extend(c,{phase:"after"}))},d.readAsDataURL(t)}else n.refresh(),e(n.el).trigger("input").trigger("change"),n.trigger(e.extend(c,{phase:"after"}))}},normMenu:function(t,i){if(e.isArray(t)){for(var n=0;n<t.length;n++)"string"==typeof t[n]?t[n]={id:t[n],text:t[n]}:null!=t[n]?(null!=t[n].text&&null==t[n].id&&(t[n].id=t[n].text),null==t[n].text&&null!=t[n].id&&(t[n].text=t[n].id),null!=t[n].caption&&(t[n].text=t[n].caption)):t[n]={id:null,text:"null"};return t}if("function"==typeof t)return w2obj.field.prototype.normMenu.call(this,t.call(this,i));if("object"==typeof t){var r=[];for(var n in t)r.push({id:n,text:t[n]});return r}},getMonthHTML:function(e,t,i){var n=new Date,r=w2utils.settings.fullmonths,s=["31","28","31","30","31","30","31","31","30","31","30","31"],o=n.getFullYear()+"/"+(Number(n.getMonth())+1)+"/"+n.getDate(),a=w2utils.settings.fulldays.slice(),l=w2utils.settings.shortdays.slice();"M"!==w2utils.settings.weekStarts&&(a.unshift(a.pop()),l.unshift(l.pop()));var u=this.options;null==u&&(u={}),t=w2utils.isInt(t)?parseInt(t):n.getFullYear(),(e=w2utils.isInt(e)?parseInt(e):n.getMonth()+1)>12&&(e-=12,t++),(e<1||0===e)&&(e+=12,t--),t/4==Math.floor(t/4)?s[1]="29":s[1]="28",u.current=e+"/"+t;for(var c=(n=new Date(t,e-1,1)).getDay(),d="",h=0;h<l.length;h++)d+='<td title="'+a[h]+'">'+l[h]+"</td>";var p='<div class="w2ui-calendar-title title">    <div class="w2ui-calendar-previous previous"> <div></div> </div>    <div class="w2ui-calendar-next next"> <div></div> </div> '+r[e-1]+", "+t+'</div><table class="w2ui-calendar-days" cellspacing="0"><tbody>    <tr class="w2ui-day-title">'+d+"</tr>    <tr>",f=1;if("M"!==w2utils.settings.weekStarts&&c++,"datetime"===this.type){var g=w2utils.isDateTime(i,u.format,!0);i=w2utils.formatDate(g,w2utils.settings.dateFormat)}for(var m=1;m<43;m++){if(0===c&&1==m){for(var v=0;v<6;v++)p+='<td class="w2ui-day-empty">&#160;</td>';m+=6}else if(m<c||f>s[e-1]){p+='<td class="w2ui-day-empty">&#160;</td>',m%7==0&&(p+="</tr><tr>");continue}var y=t+"/"+e+"/"+f,w=new Date(y),b="";6===w.getDay()&&(b=" w2ui-saturday"),0===w.getDay()&&(b=" w2ui-sunday"),y==o&&(b+=" w2ui-today");var x,_,k=f,C="",T="";if("datetime"===this.type?(x=w2utils.formatDateTime(y,u.format),_=w2utils.formatDate(y,w2utils.settings.dateFormat)):_=x=w2utils.formatDate(y,u.format),u.colored&&void 0!==u.colored[_]){var S=u.colored[_].split(":");T="background-color: "+S[0]+";",C="color: "+S[1]+";"}p+='<td class="'+(this.inRange(x,!0)?"w2ui-date "+(_==i?"w2ui-date-selected":""):"w2ui-blocked")+b+'"    style="'+C+T+'" date="'+x+'" data-date="'+w+'">'+k+"</td>",(m%7==0||0===c&&1==m)&&(p+="</tr><tr>"),f++}return p+"</tr></tbody></table>"},getYearHTML:function(){for(var e=w2utils.settings.shortmonths,t=w2utils.settings.dateStartYear,i=w2utils.settings.dateEndYear,n="",r="",s=0;s<e.length;s++)n+='<div class="w2ui-jump-month" name="'+s+'">'+e[s]+"</div>";for(var o=t;o<=i;o++)r+='<div class="w2ui-jump-year" name="'+o+'">'+o+"</div>";return'<div id="w2ui-jump-month">'+n+'</div><div id="w2ui-jump-year">'+r+"</div>"},getHourHTML:function(){var e=[],t=this.options;null==t&&(t={format:w2utils.settings.timeFormat});for(var i=t.format.indexOf("h24")>-1,n=0;n<24;n++){var r=(n>=12&&!i?n-12:n)+":00"+(i?"":n<12?" am":" pm");12!=n||i||(r="12:00 pm"),e[Math.floor(n/8)]||(e[Math.floor(n/8)]="");var s=this.fromMin(this.toMin(r)),o=this.fromMin(this.toMin(r)+59);if("datetime"===this.type){var a=w2utils.isDateTime(this.el.value,t.format,!0),l=t.format.split("|")[0].trim();s=w2utils.formatDate(a,l)+" "+s,o=w2utils.formatDate(a,l)+" "+o}e[Math.floor(n/8)]+='<div class="'+(this.inRange(s)||this.inRange(o)?"w2ui-time ":"w2ui-blocked")+'" hour="'+n+'">'+r+"</div>"}return'<div class="w2ui-calendar">   <div class="w2ui-calendar-title">'+w2utils.lang("Select Hour")+'</div>   <div class="w2ui-calendar-time"><table><tbody><tr>       <td>'+e[0]+"</td>       <td>"+e[1]+"</td>       <td>"+e[2]+"</td>   </tr></tbody></table></div></div>"},getMinHTML:function(e){null==e&&(e=0);var t=this.options;null==t&&(t={format:w2utils.settings.timeFormat});for(var i=t.format.indexOf("h24")>-1,n=[],r=0;r<60;r+=5){var s=(e>12&&!i?e-12:e)+":"+(r<10?0:"")+r+" "+(i?"":e<12?"am":"pm"),o=s,a=r<20?0:r<40?1:2;if(n[a]||(n[a]=""),"datetime"===this.type){var l=w2utils.isDateTime(this.el.value,t.format,!0),u=t.format.split("|")[0].trim();o=w2utils.formatDate(l,u)+" "+o}n[a]+='<div class="'+(this.inRange(o)?"w2ui-time ":"w2ui-blocked")+'" min="'+r+'">'+s+"</div>"}return'<div class="w2ui-calendar">   <div class="w2ui-calendar-title">'+w2utils.lang("Select Minute")+'</div>   <div class="w2ui-calendar-time"><table><tbody><tr>       <td>'+n[0]+"</td>       <td>"+n[1]+"</td>       <td>"+n[2]+"</td>   </tr></tbody></table></div></div>"},toMin:function(e){if("string"!=typeof e)return null;var t=e.split(":");return 2!==t.length?null:(t[0]=parseInt(t[0]),t[1]=parseInt(t[1]),-1!==e.indexOf("pm")&&12!==t[0]&&(t[0]+=12),60*t[0]+t[1])},fromMin:function(e){e>=1440&&(e%=1440),e<0&&(e=1440+e);var t=Math.floor(e/60),i=(e%60<10?"0":"")+e%60,n=this.options;return null==n&&(n={format:w2utils.settings.timeFormat}),-1!==n.format.indexOf("h24")?t+":"+i:(t<=12?t:t-12)+":"+i+" "+(t>=12?"pm":"am")}},e.extend(t.prototype,w2utils.event),w2obj.field=t}(jQuery),function(e){var t=function(t){this.name=null,this.header="",this.box=null,this.url="",this.routeData={},this.formURL="",this.formHTML="",this.page=0,this.recid=0,this.fields=[],this.actions={},this.record={},this.original=null,this.postData={},this.httpHeaders={},this.method=null,this.toolbar={},this.tabs={},this.style="",this.focus=0,this.autosize=!0,this.nestedFields=!0,this.multipart=!1,this.tabindexBase=0,this.isGenerated=!1,this.last={xhr:null,errors:[]},e.extend(!0,this,w2obj.form,t)};e.fn.w2form=function(i){if(e.isPlainObject(i)){var n=this;if(!w2utils.checkName(i,"w2form"))return;var r=i.record,s=i.original,o=i.fields,a=i.toolbar,l=i.tabs,u=new t(i);if(e.extend(u,{record:{},original:null,fields:[],tabs:{},toolbar:{},handlers:[]}),e.isArray(l)){e.extend(!0,u.tabs,{tabs:[]});for(var c=0;c<l.length;c++){var d=l[c];"object"==typeof d?(u.tabs.tabs.push(d),!0===d.active&&(u.tabs.active=d.id)):u.tabs.tabs.push({id:d,text:d})}}else e.extend(!0,u.tabs,l);if(e.extend(!0,u.toolbar,a),o)for(var h=0;h<o.length;h++){var p=e.extend(!0,{},o[h]);null==p.field&&null!=p.name&&(console.log("NOTICE: form field.name property is deprecated, please use field.field. Field ->",p),p.field=p.name),u.fields[h]=p}for(var h in r)e.isPlainObject(r[h])?u.record[h]=e.extend(!0,{},r[h]):u.record[h]=r[h];for(var h in s)e.isPlainObject(s[h])?u.original[h]=e.extend(!0,{},s[h]):u.original[h]=s[h];return n.length>0&&(u.box=n[0]),""!==u.formURL?e.get(u.formURL,(function(t){u.formHTML=t,u.isGenerated=!0,0===e(u.box).length&&0===t.length||(e(u.box).html(t),u.render(u.box))})):""!==u.formHTML||(0!==e(this).length&&""!==e.trim(e(this).html())?u.formHTML=e(this).html():u.formHTML=u.generateHTML()),w2ui[u.name]=u,""===u.formURL&&(-1===String(u.formHTML).indexOf("w2ui-page")&&(u.formHTML='<div class="w2ui-page page-0" style="'+(u.pageStyle||"")+'">'+u.formHTML+"</div>"),e(u.box).html(u.formHTML),u.isGenerated=!0,u.render(u.box)),u}return(n=w2ui[e(this).attr("name")])?arguments.length>0?(n[i]&&n[i].apply(n,Array.prototype.slice.call(arguments,1)),this):n:null},t.prototype={onRequest:null,onLoad:null,onValidate:null,onSubmit:null,onProgress:null,onSave:null,onChange:null,onInput:null,onRender:null,onRefresh:null,onResize:null,onDestroy:null,onAction:null,onToolbar:null,onError:null,msgNotJSON:"Returned data is not in valid JSON format.",msgAJAXerror:"AJAX error. See console for more details.",msgRefresh:"Loading...",msgSaving:"Saving...",get:function(e,t){if(0===arguments.length){for(var i=[],n=0;n<this.fields.length;n++)null!=this.fields[n].field&&i.push(this.fields[n].field);return i}for(var r=0;r<this.fields.length;r++)if(this.fields[r].field==e)return!0===t?r:this.fields[r];return null},set:function(t,i){for(var n=0;n<this.fields.length;n++)if(this.fields[n].field==t)return e.extend(this.fields[n],i),this.refresh(t),!0;return!1},getValue:function(e){if(this.nestedFields){var t=void 0;try{var i=this.record;t=String(e).split(".").reduce((function(e,t){return e[t]}),i)}catch(e){}return t}return this.record[e]},setValue:function(e,t){if(!this.nestedFields)return this.record[e]=t,!0;try{var i=this.record;return String(e).split(".").map((function(e,n,r){r.length-1!==n?(i[e]||(i[e]={}),i=i[e]):i[e]=t})),!0}catch(e){return!1}},show:function(){for(var e=[],t=0;t<arguments.length;t++){var i=this.get(arguments[t]);i&&i.hidden&&(i.hidden=!1,e.push(i.field))}return e.length>0&&this.refresh.apply(this,e),this.updateEmptyGroups(),e.length},hide:function(){for(var e=[],t=0;t<arguments.length;t++){var i=this.get(arguments[t]);i&&!i.hidden&&(i.hidden=!0,e.push(i.field))}return e.length>0&&this.refresh.apply(this,e),this.updateEmptyGroups(),e.length},updateEmptyGroups:function(){e(this.box).find(".w2ui-group").each((function(t,i){var n,r;n=e(i).find(".w2ui-field"),r=!0,n.each((function(e,t){"none"!=t.style.display&&(r=!1)})),r?e(i).hide():e(i).show()}))},enable:function(){for(var e=[],t=0;t<arguments.length;t++){var i=this.get(arguments[t]);i&&i.disabled&&(i.disabled=!1,e.push(i.field))}return e.length>0&&this.refresh.apply(this,e),e.length},disable:function(){for(var e=[],t=0;t<arguments.length;t++){var i=this.get(arguments[t]);i&&!i.disabled&&(i.disabled=!0,e.push(i.field))}return e.length>0&&this.refresh.apply(this,e),e.length},change:function(){Array.from(arguments).forEach(function(e){var t=this.get(e);t.$el&&t.$el.change()}.bind(this))},reload:function(e){("object"!=typeof this.url?this.url:this.url.get)&&0!==this.recid&&null!=this.recid?this.request(e):"function"==typeof e&&e()},clear:function(){0!=arguments.length?Array.from(arguments).forEach(function(e){var t=this.record;String(e).split(".").map((function(e,i,n){n.length-1!==i?t=t[e]:delete t[e]})),this.refresh(e)}.bind(this)):(this.recid=0,this.record={},this.original=null,this.refresh()),e().w2tag()},error:function(t){var i=this,n=this.trigger({target:this.name,type:"error",message:t,xhr:this.last.xhr});!0!==n.isCancelled?(setTimeout((function(){i.message(t)}),1),this.trigger(e.extend(n,{phase:"after"}))):"function"==typeof callBack&&callBack()},message:function(t){"string"==typeof t&&(t={width:t.length<300?350:550,height:t.length<300?170:250,body:'<div class="w2ui-centered">'+t+"</div>",buttons:'<button class="w2ui-btn" onclick="w2ui[\''+this.name+"'].message()\">Ok</button>",onOpen:function(t){setTimeout((function(){e(t.box).find(".w2ui-btn").focus()}),25)}}),w2utils.message.call(this,{box:this.box,path:"w2ui."+this.name,title:".w2ui-form-header:visible",body:".w2ui-form-box"},t)},validate:function(t){null==t&&(t=!0),e().w2tag();for(var i=[],n=0;n<this.fields.length;n++){var r=this.fields[n];switch(null==this.getValue(r.field)&&this.setValue(r.field,""),r.type){case"int":this.getValue(r.field)&&!w2utils.isInt(this.getValue(r.field))&&i.push({field:r,error:w2utils.lang("Not an integer")});break;case"float":this.getValue(r.field)&&!w2utils.isFloat(this.getValue(r.field))&&i.push({field:r,error:w2utils.lang("Not a float")});break;case"money":this.getValue(r.field)&&!w2utils.isMoney(this.getValue(r.field))&&i.push({field:r,error:w2utils.lang("Not in money format")});break;case"color":case"hex":this.getValue(r.field)&&!w2utils.isHex(this.getValue(r.field))&&i.push({field:r,error:w2utils.lang("Not a hex number")});break;case"email":this.getValue(r.field)&&!w2utils.isEmail(this.getValue(r.field))&&i.push({field:r,error:w2utils.lang("Not a valid email")});break;case"checkbox":1==this.getValue(r.field)?this.setValue(r.field,1):this.setValue(r.field,0);break;case"date":r.options.format||(r.options.format=w2utils.settings.dateFormat),this.getValue(r.field)&&!w2utils.isDate(this.getValue(r.field),r.options.format)&&i.push({field:r,error:w2utils.lang("Not a valid date")+": "+r.options.format})}var s=this.getValue(r.field);r.required&&!0!==r.hidden&&-1==["div","custom","html","empty"].indexOf(r.type)&&(""===s||e.isArray(s)&&0===s.length||e.isPlainObject(s)&&e.isEmptyObject(s))&&i.push({field:r,error:w2utils.lang("Required field")}),r.options&&!0!==r.hidden&&r.options.minLength>0&&-1==["enum","list","combo"].indexOf(r.type)&&this.getValue(r.field).length<r.options.minLength&&i.push({field:r,error:w2utils.lang("Field should be at least "+r.options.minLength+" characters.")})}var o=this.trigger({phase:"before",target:this.name,type:"validate",errors:i});if(!0!==o.isCancelled)return this.last.errors=i,t&&this.showErrors(),this.trigger(e.extend(o,{phase:"after"})),i},showErrors:function(){var t=this.last.errors;if(t.length>0){var i=t[0];this.goto(t[0].field.page),e(i.field.$el).parents(".w2ui-field")[0].scrollIntoView(!0);for(var n=0;n<t.length;n++){i=t[n];var r=e.extend({class:"w2ui-error",hideOnFocus:!0},i.options);null!=i.field&&("radio"===i.field.type?e(e(i.field.el).closest("div")[0]).w2tag(i.error,r):-1!==["enum","file"].indexOf(i.field.type)?function(t){setTimeout((function(){var i=e(t.field.el).data("w2field").helpers.multi;e(t.field.el).w2tag(t.error,t.options),e(i).addClass("w2ui-error")}),1)}(i):e(i.field.el).w2tag(i.error,r))}setTimeout((function(){var i=t[0];e(i.field.$el).parents(".w2ui-page").off(".hideErrors").on("scroll.hideErrors",(function(n){for(var r=0;r<t.length;r++)i=t[r],e(i.field.el).w2tag();e(i.field.$el).parents(".w2ui-page").off(".hideErrors")}))}),300)}},getChanges:function(){var t={};return null==this.original||"object"!=typeof this.original||e.isEmptyObject(this.record)||(t=function t(i,n,r){for(var s in i)null!=i[s]&&"object"==typeof i[s]?(r[s]=t(i[s],n[s]||{},{}),(!r[s]||e.isEmptyObject(r[s])&&e.isEmptyObject(n[s]))&&delete r[s]):(i[s]!=n[s]||null==i[s]&&null!=n[s])&&(r[s]=i[s]);return e.isEmptyObject(r)?null:r}(this.record,this.original,{})),t},getCleanRecord:function(t){var i=e.extend(!0,{},this.record);return this.fields.forEach(function(t){if(-1!=["list","combo","enum"].indexOf(t.type)){var n={nestedFields:!0,record:i},r=this.getValue.call(n,t.field);e.isPlainObject(r)&&null!=r.id&&this.setValue.call(n,t.field,r.id),Array.isArray(r)&&r.forEach((function(t,i){e.isPlainObject(t)&&t.id&&(r[i]=t.id)}))}"map"==t.type&&(n={nestedFields:!0,record:i},(r=this.getValue.call(n,t.field))._order&&delete r._order)}.bind(this)),!0===t&&Object.keys(i).forEach(function(e){this.get(e)||delete i[e]}.bind(this)),i},request:function(t,i){var n=this;if("function"==typeof t&&(i=t,t=null),null==t&&(t={}),this.url&&("object"!=typeof this.url||this.url.get)){null==this.recid&&(this.recid=0);var r={cmd:"get"};r.recid=this.recid,r.name=this.name,e.extend(r,this.postData),e.extend(r,t);var s=this.trigger({phase:"before",type:"request",target:this.name,url:this.url,postData:r,httpHeaders:this.httpHeaders});if(!0!==s.isCancelled){this.record={},this.original=null,this.lock(w2utils.lang(this.msgRefresh));var o=s.url;if("object"==typeof s.url&&s.url.get&&(o=s.url.get),this.last.xhr)try{this.last.xhr.abort()}catch(e){}if(!e.isEmptyObject(n.routeData)){var a=w2utils.parseRoute(o);if(a.keys.length>0)for(var l=0;l<a.keys.length;l++)null!=n.routeData[a.keys[l].name]&&(o=o.replace(new RegExp(":"+a.keys[l].name,"g"),n.routeData[a.keys[l].name]))}var u={type:"POST",url:o,data:s.postData,headers:s.httpHeaders,dataType:"json"},c=n.dataType||w2utils.settings.dataType;switch(s.dataType&&(c=s.dataType),c){case"HTTP":u.data=String(e.param(u.data,!1)).replace(/%5B/g,"[").replace(/%5D/g,"]");break;case"HTTPJSON":u.data={request:JSON.stringify(u.data)};break;case"RESTFULL":u.type="GET",u.data=String(e.param(u.data,!1)).replace(/%5B/g,"[").replace(/%5D/g,"]");break;case"RESTFULLJSON":u.type="GET",u.data=JSON.stringify(u.data),u.contentType="application/json";break;case"JSON":u.type="POST",u.data=JSON.stringify(u.data),u.contentType="application/json"}this.method&&(u.type=this.method),s.method&&(u.type=s.method),this.last.xhr=e.ajax(u).done((function(t,r,s){n.unlock(),null==(t=s.responseJSON)&&(t={status:"error",message:w2utils.lang(n.msgNotJSON),responseText:s.responseText});var o=n.trigger({phase:"before",target:n.name,type:"load",data:t,xhr:s});!0!==o.isCancelled?("error"===o.data.status?n.error(w2utils.lang(o.data.message)):n.record=e.extend({},o.data.record),n.trigger(e.extend(o,{phase:"after"})),n.refresh(),n.applyFocus(),"function"==typeof i&&i(o.data)):"function"==typeof i&&i({status:"error",message:"Request aborted."})})).fail((function(t,i,r){var s={status:i,error:r,rawResponseText:t.responseText},o=n.trigger({phase:"before",type:"error",error:s,xhr:t});if(!0!==o.isCancelled){if("abort"!==i){var a;try{a="object"==typeof t.responseJSON?t.responseJSON:e.parseJSON(t.responseText)}catch(e){}console.log("ERROR: Server communication failed.","\n   EXPECTED:",{status:"success",items:[{id:1,text:"item"}]},"\n         OR:",{status:"error",message:"error message"},"\n   RECEIVED:","object"==typeof a?a:t.responseText),n.unlock()}n.trigger(e.extend(o,{phase:"after"}))}})),this.trigger(e.extend(s,{phase:"after"}))}else"function"==typeof i&&i({status:"error",message:"Request aborted."})}},submit:function(e,t){return this.save(e,t)},save:function(t,i){var n=this;e(this.box).find(":focus").change(),"function"==typeof t&&(i=t,t=null),0===n.validate(!0).length&&(null==t&&(t={}),n.url&&("object"!=typeof n.url||n.url.save)?(n.lock(w2utils.lang(n.msgSaving)+' <span id="'+n.name+'_progress"></span>'),setTimeout((function(){var r={cmd:"save"};r.recid=n.recid,r.name=n.name,e.extend(r,n.postData),e.extend(r,t),n.multipart||n.fields.forEach((function(e){"file"===e.type&&Array.isArray(n.getValue(e.field))&&n.getValue(e.field).forEach((function(e){delete e.file}))})),r.record=e.extend(!0,{},n.record);var s=n.trigger({phase:"before",type:"submit",target:n.name,url:n.url,postData:r,httpHeaders:n.httpHeaders});if(!0!==s.isCancelled){var o=s.url;if("object"==typeof s.url&&s.url.save&&(o=s.url.save),n.last.xhr)try{n.last.xhr.abort()}catch(e){}if(!e.isEmptyObject(n.routeData)){var a=w2utils.parseRoute(o);if(a.keys.length>0)for(var l=0;l<a.keys.length;l++)null!=n.routeData[a.keys[l].name]&&(o=o.replace(new RegExp(":"+a.keys[l].name,"g"),n.routeData[a.keys[l].name]))}var u={type:"POST",url:o,data:s.postData,headers:s.httpHeaders,dataType:"json",xhr:function(){var t=new window.XMLHttpRequest;return t.upload.addEventListener("progress",(function(t){if(t.lengthComputable){var i=n.trigger({phase:"before",type:"progress",total:t.total,loaded:t.loaded,originalEvent:t});if(!0===i.isCancelled)return;var r=Math.round(t.loaded/t.total*100);(r&&100!=r||""!=e("#"+n.name+"_progress").text())&&e("#"+n.name+"_progress").text(r+"%"),n.trigger(e.extend(i,{phase:"after"}))}}),!1),t}},c=n.dataType||w2utils.settings.dataType;switch(s.dataType&&(c=s.dataType),c){case"HTTP":u.data=String(e.param(u.data,!1)).replace(/%5B/g,"[").replace(/%5D/g,"]");break;case"HTTPJSON":u.data={request:JSON.stringify(u.data)};break;case"RESTFULL":0!==n.recid&&null!=n.recid&&(u.type="PUT"),u.data=String(e.param(u.data,!1)).replace(/%5B/g,"[").replace(/%5D/g,"]");break;case"RESTFULLJSON":0!==n.recid&&null!=n.recid&&(u.type="PUT"),u.data=JSON.stringify(u.data),u.contentType="application/json";break;case"JSON":if(u.type="POST",u.contentType="application/json",n.multipart){var d=new FormData;d.append("__body",JSON.stringify(u.data)),function e(t,i,n,r){function s(i,n,r){if("object"==typeof i&&i instanceof File&&t.append(r,i),"object"==typeof i)if(i&&i.constructor===Array)for(var o=0;o<i.length;o++){var a=n?n[o]:n;s(i[o],a,r+"["+o+"]")}else e(t,i,n,r)}for(var o in null==r&&(r=""),i){var a=""==r?o:"${p}[${prop}]",l=n?n[o]:n;s(i[o],l,a)}}(d,u.data),u.data=d,u.contentType=!1,u.processData=!1}else u.data=JSON.stringify(u.data)}this.method&&(u.type=this.method),s.method&&(u.type=s.method),n.last.xhr=e.ajax(u).done((function(t,r,s){n.unlock();var o=n.trigger({phase:"before",target:n.name,type:"save",xhr:s,status:r,data:t});!0!==o.isCancelled&&(null==(t=s.responseJSON)&&(t={status:"error",message:w2utils.lang(n.msgNotJSON),responseText:s.responseText}),"error"===t.status?n.error(w2utils.lang(t.message)):n.original=null,n.trigger(e.extend(o,{phase:"after"})),n.refresh(),"function"==typeof i&&i(t,s))})).fail((function(t,i,r){var s={status:i,error:r,rawResponseText:t.responseText},o=n.trigger({phase:"before",type:"error",error:s,xhr:t});!0!==o.isCancelled&&(console.log("ERROR: server communication failed. The server should return",{status:"success"},"OR",{status:"error",message:"error message"},", instead the AJAX request produced this: ",s),n.unlock(),n.trigger(e.extend(o,{phase:"after"})))})),n.trigger(e.extend(s,{phase:"after"}))}}),50)):console.log("ERROR: Form cannot be saved because no url is defined."))},lock:function(e,t){var i=Array.prototype.slice.call(arguments,0);i.unshift(this.box),setTimeout((function(){w2utils.lock.apply(window,i)}),10)},unlock:function(e){var t=this.box;setTimeout((function(){w2utils.unlock(t,e)}),25)},lockPage:function(t,i){var n=e(this.box).find(".page-"+t);return!!n.length&&(w2utils.lock(n,i),!0)},unlockPage:function(t,i){var n=e(this.box).find(".page-"+t);return!!n.length&&(w2utils.unlock(n,i),!0)},goto:function(t){this.page!==t&&(null!=t&&(this.page=t),!0===e(this.box).data("auto-size")&&e(this.box).height(0),this.refresh())},generateHTML:function(){for(var t,i,n,r,s,o=[],a="",l=0;l<this.fields.length;l++){n="",s=' tabindex="'+(r=this.tabindexBase+l+1)+'"';var u=this.fields[l];null==u.html&&(u.html={}),null==u.options&&(u.options={}),null!=u.html.caption&&null==u.html.label&&(console.log("NOTICE: form field.html.caption property is deprecated, please use field.html.label. Field ->",u),u.html.label=u.html.caption),null==u.html.label&&(u.html.label=u.field),u.html=e.extend(!0,{label:"",span:6,attr:"",text:"",style:"",page:0,column:0},u.html),null==t&&(t=u.html.page),null==i&&(i=u.html.column);var c='<input spellcheck="false" id="'+u.field+'" name="'+u.field+'" class="w2ui-input" type="text" '+u.html.attr+s+">";switch(u.type){case"pass":case"password":c='<input spellcheck="false" id="'+u.field+'" name="'+u.field+'" class="w2ui-input" type = "password" '+u.html.attr+s+">";break;case"check":case"checks":null==u.options.items&&null!=u.html.items&&(u.options.items=u.html.items);var d=u.options.items;c="",e.isArray(d)||(d=[]),d.length>0&&(d=w2obj.field.prototype.normMenu.call(this,d,u));for(var h=0;h<d.length;h++)c+='<label class="w2ui-box-label">  <input spellcheck="false" id="'+u.field+h+'" name="'+u.field+'" class="w2ui-input" type="checkbox" '+u.html.attr+(0===h?s:"")+' data-value="'+d[h].id+'" data-index="'+h+'"><span>&#160;'+d[h].text+"</span></label><br>";break;case"checkbox":c='<label class="w2ui-box-label">   <input spellcheck="false" id="'+u.field+'" name="'+u.field+'" class="w2ui-input" type="checkbox" '+u.html.attr+s+">   <span>"+u.html.label+"</span></label>";break;case"radio":for(c="",null==u.options.items&&null!=u.html.items&&(u.options.items=u.html.items),d=u.options.items,e.isArray(d)||(d=[]),d.length>0&&(d=w2obj.field.prototype.normMenu.call(this,d,u)),h=0;h<d.length;h++)c+='<label class="w2ui-box-label">  <input spellcheck="false" id="'+u.field+h+'" name="'+u.field+'" class="w2ui-input" type = "radio" '+u.html.attr+(0===h?s:"")+' value="'+d[h].id+'"><span>&#160;'+d[h].text+"</span></label><br>";break;case"select":for(c='<select spellcheck="false" id="'+u.field+'" name="'+u.field+'" class="w2ui-input" '+u.html.attr+s+">",null==u.options.items&&null!=u.html.items&&(u.options.items=u.html.items),d=u.options.items,e.isArray(d)||(d=[]),d.length>0&&(d=w2obj.field.prototype.normMenu.call(this,d,u)),h=0;h<d.length;h++)c+='<option spellcheck="false" value="'+d[h].id+'">'+d[h].text+"</option>";c+="</select>";break;case"textarea":c='<textarea spellcheck="false" id="'+u.field+'" name="'+u.field+'" class="w2ui-input" '+u.html.attr+s+"></textarea>";break;case"toggle":c='<input spellcheck="false" id="'+u.field+'" name="'+u.field+'" type="checkbox" '+u.html.attr+s+' class="w2ui-input w2ui-toggle"><div><div></div></div>';break;case"map":case"array":u.html.key=u.html.key||{},u.html.value=u.html.value||{},u.html.tabindex_str=s,c='<span style="float: right">'+(u.html.text||"")+'</span><input spellcheck="false" id="'+u.field+'" name="'+u.field+'" type="hidden" '+u.html.attr+s+'><div class="w2ui-map-container"></div>';break;case"html":case"div":case"custom":c='<div id="'+u.field+'" name="'+u.field+'" '+u.html.attr+s+">"+(u&&u.html&&u.html.html?u.html.html:"")+"</div>";break;case"empty":c=u&&u.html?(u.html.html||"")+(u.html.text||""):""}if(""!==a&&(t!=u.html.page||i!=u.html.column||u.html.group&&a!=u.html.group)&&(o[t][i]+="\n   </div>\n  </div>",a=""),u.html.group&&a!=u.html.group){var p="";u.html.groupCollapsable&&(p='<span class="w2ui-icon-collapse" style="width: 15px; display: inline-block; position: relative; top: -2px;"></span>'),n+='\n <div class="w2ui-group">\n   <div class="w2ui-group-title" style="'+(u.html.groupTitleStyle||"")+(""!=p?"cursor: pointer; user-select: none":"")+'"'+(""!=p?'data-group="'+w2utils.base64encode(u.html.group)+'"':"")+(""!=p?"onclick=\"w2ui['"+this.name+"'].toggleGroup('"+u.html.group+"')\"":"")+">"+p+u.html.group+'</div>\n   <div class="w2ui-group-fields" style="'+(u.html.groupStyle||"")+'">',a=u.html.group}if(null==u.html.anchor){var f=null!=u.html.span?"w2ui-span"+u.html.span:"";-1==u.html.span&&(f="w2ui-span-none");var g="<label"+("none"==f?' style="display: none"':"")+">"+w2utils.lang("checkbox"!=u.type?u.html.label:u.html.text)+"</label>";u.html.label||(g=""),n+='\n      <div class="w2ui-field '+f+'" style="'+(u.hidden?"display: none;":"")+u.html.style+'">\n         '+g+("empty"===u.type?c:"\n         <div>"+c+("array"!=u.type&&"map"!=u.type?w2utils.lang("checkbox"!=u.type?u.html.text:""):"")+"</div>")+"\n      </div>"}else o[u.html.page].anchors=o[u.html.page].anchors||{},o[u.html.page].anchors[u.html.anchor]='<div class="w2ui-field w2ui-field-inline" style="'+(u.hidden?"display: none;":"")+u.html.style+'">'+("empty"===u.type?c:"<div>"+w2utils.lang("checkbox"!=u.type?u.html.label:u.html.text)+c+w2utils.lang("checkbox"!=u.type?u.html.text:"")+"</div>")+"</div>";null==o[u.html.page]&&(o[u.html.page]={}),null==o[u.html.page][u.html.column]&&(o[u.html.page][u.html.column]=""),o[u.html.page][u.html.column]+=n,t=u.html.page,i=u.html.column}if(""!==a&&(o[t][i]+="\n   </div>\n  </div>"),this.tabs.tabs)for(h=0;h<this.tabs.tabs.length;h++)null==o[h]&&(o[h]=[]);var m="";if(!e.isEmptyObject(this.actions)){for(var v in m+='\n<div class="w2ui-buttons">',r=this.tabindexBase+this.fields.length+1,this.actions){var y=this.actions[v],w={text:"",style:"",class:""};e.isPlainObject(y)?(null==y.text&&null!=y.caption&&(console.log("NOTICE: form action.caption property is deprecated, please use action.text. Action ->",y),y.text=y.caption),y.text&&(w.text=y.text),y.style&&(w.style=y.style),y.class&&(w.class=y.class)):(w.text=v,-1!==["save","update","create"].indexOf(v.toLowerCase())?w.class="w2ui-btn-blue":w.class=""),m+='\n    <button name="'+v+'" class="w2ui-btn '+w.class+'" style="'+w.style+'" tabindex="'+r+'">'+w2utils.lang(w.text)+"</button>",r++}m+="\n</div>"}n="";for(var b=0;b<o.length;b++)n+='<div class="w2ui-page page-'+b+'" style="'+(0!==b?"display: none;":"")+this.pageStyle+'">',o[b].before&&(n+=o[b].before),n+='<div class="w2ui-column-container">',Object.keys(o[b]).sort().forEach((function(e,t){e==parseInt(e)&&(n+='<div class="w2ui-column col-'+e+'">'+(o[b][e]||"")+"\n</div>")})),n+="\n</div>",o[b].after&&(n+=o[b].after),n+="\n</div>",o[b].anchors&&Object.keys(o[b].anchors).forEach((function(e,t){n=n.replace(e,o[b].anchors[e])}));return n+=m},toggleGroup:function(t,i){var n=e(this.box).find('.w2ui-group-title[data-group="'+w2utils.base64encode(t)+'"]');if("none"==n.next().css("display")&&!0!==i)n.next().slideDown(300),n.next().next().remove(),n.find("span").addClass("w2ui-icon-collapse").removeClass("w2ui-icon-expand");else{n.next().slideUp(300);var r="width: "+n.next().css("width")+";padding-left: "+n.next().css("padding-left")+";padding-right: "+n.next().css("padding-right")+";margin-left: "+n.next().css("margin-left")+";margin-right: "+n.next().css("margin-right")+";";setTimeout((function(){n.next().after('<div style="height: 5px;'+r+'"></div>')}),100),n.find("span").addClass("w2ui-icon-expand").removeClass("w2ui-icon-collapse")}},action:function(t,i){var n=this.actions[t],r=n;e.isPlainObject(n)&&n.onClick&&(r=n.onClick);var s=this.trigger({phase:"before",target:t,type:"action",action:n,originalEvent:i});!0!==s.isCancelled&&("function"==typeof r&&r.call(this,i),this.trigger(e.extend(s,{phase:"after"})))},resize:function(){},refresh:function(){var t=(new Date).getTime(),i=this;if(this.box&&this.isGenerated&&null!=e(this.box).html()){var n=this.trigger({phase:"before",target:this.name,type:"refresh",page:this.page,field:a,fields:arguments});if(!0!==n.isCancelled){var r=Array.from(this.fields.keys());arguments.length>0?r=Array.from(arguments).map(function(e,t){return"string"!=typeof e&&console.log("ERROR: Arguments in refresh functions should be field names"),this.get(e,!0)}.bind(this)).filter((function(e,t){return null!=e})):(e(this.box).find("input, textarea, select").each((function(t,n){var r=null!=e(n).attr("name")?e(n).attr("name"):e(n).attr("id"),s=i.get(r);if(s){var o=e(n).closest(".w2ui-page");if(o.length>0)for(var a=0;a<100;a++)if(o.hasClass("page-"+a)){s.page=a;break}}})),e(this.box).find(".w2ui-page").hide(),e(this.box).find(".w2ui-page.page-"+this.page).show(),e(this.box).find(".w2ui-form-header").html(this.header),"object"==typeof this.tabs&&e.isArray(this.tabs.tabs)&&this.tabs.tabs.length>0?(e("#form_"+this.name+"_tabs").show(),this.tabs.active=this.tabs.tabs[this.page].id,this.tabs.refresh()):e("#form_"+this.name+"_tabs").hide(),"object"==typeof this.toolbar&&e.isArray(this.toolbar.items)&&this.toolbar.items.length>0?(e("#form_"+this.name+"_toolbar").show(),this.toolbar.refresh()):e("#form_"+this.name+"_toolbar").hide());for(var s=0;s<r.length;s++){if(null==(a=this.fields[r[s]]).name&&null!=a.field&&(a.name=a.field),null==a.field&&null!=a.name&&(a.field=a.name),a.$el=e(this.box).find('[name="'+String(a.name).replace(/\\/g,"\\\\")+'"]'),a.el=a.$el[0],a.el&&(a.el.id=a.name),(v=e(a).data("w2field"))&&v.clear(),e(a.$el).off(".w2form").on("change.w2form",(function(t){var n=this,r=i.get(this.name);if(null!=r)if(1!=e(this).data("skip_change")){var s=this.value,o=i.getValue(this.name);if(null==o&&(o=""),-1!==["list","enum","file"].indexOf(r.type)&&e(this).data("selected")){var a=e(this).data("selected"),l=i.getValue(this.name);if(e.isArray(a)){s=[];for(var u=0;u<a.length;u++)s[u]=e.extend(!0,{},a[u])}if(e.isPlainObject(a)&&(s=e.extend(!0,{},a)),e.isArray(l))for(o=[],u=0;u<l.length;u++)o[u]=e.extend(!0,{},l[u]);e.isPlainObject(l)&&(o=e.extend(!0,{},l))}if(-1!==["toggle","checkbox"].indexOf(r.type)&&(s=!!e(this).prop("checked")&&("on"===e(this).prop("value")||e(this).prop("value"))),-1!==["check","checks"].indexOf(r.type)){Array.isArray(o)||(o=[]),s=o.slice();var c=r.options.items[e(this).attr("data-index")];e(this).prop("checked")?s.push(c.id):s.splice(s.indexOf(c.id),1)}if(-1!==["int","float","percent","money","currency"].indexOf(r.type)&&(s=e(this).data("w2field").clean(s)),s!==o){var d=i.trigger({phase:"before",target:this.name,type:"change",value_new:s,value_previous:o,originalEvent:t});!0===d.isCancelled&&(d.value_new=i.getValue(this.name),e(this).val()!==d.value_new&&(e(this).data("skip_change",!0),setTimeout((function(){e(n).data("skip_change",!1)}),10)),e(this).val(d.value_new));var h=d.value_new;if(-1!==["enum","file"].indexOf(r.type)&&h.length>0){var p=e(r.el).data("w2field").helpers.multi;e(p).removeClass("w2ui-error")}(""===h||null==h||e.isArray(h)&&0===h.length||e.isPlainObject(h)&&e.isEmptyObject(h))&&(h=null),i.setValue(this.name,h),i.trigger(e.extend(d,{phase:"after"}))}}else e(this).data("skip_change",!1)})).on("input.w2form",(function(t){var n=this.value;"checkbox"==t.target.type&&(n=t.target.checked),null==i.original&&(e.isEmptyObject(i.record)?i.original={}:i.original=e.extend(!0,{},i.record));var r=i.trigger({phase:"before",target:this.name,type:"input",value_new:n,originalEvent:t});!0!==r.isCancelled&&i.trigger(e.extend(r,{phase:"after"}))})),a.required?e(a.el).parent().parent().addClass("w2ui-required"):e(a.el).parent().parent().removeClass("w2ui-required"),null!=a.disabled){var o=e(a.el);a.disabled?(null==o.data("w2ui-tabIndex")&&o.data("w2ui-tabIndex",o.prop("tabIndex")),e(a.el).prop("readonly",!0).prop("tabindex",-1).closest(".w2ui-field").addClass("w2ui-disabled")):e(a.el).prop("readonly",!1).prop("tabIndex",o.data("w2ui-tabIndex")).closest(".w2ui-field").removeClass("w2ui-disabled")}(v=a.el)||(v=e(this.box).find("#"+a.field)),a.hidden?e(v).closest(".w2ui-field").hide():e(v).closest(".w2ui-field").show()}for(e(this.box).find("button, input[type=button]").each((function(t,n){e(n).off("click").on("click",(function(e){var t=this.value;this.id&&(t=this.id),this.name&&(t=this.name),i.action(t,e)}))})),s=0;s<r.length;s++){var a=this.fields[r[s]],l=null!=this.getValue(a.name)?this.getValue(a.name):"";if(a.el)switch(e(a.el).hasClass("w2ui-input")||e(a.el).addClass("w2ui-input"),a.type=String(a.type).toLowerCase(),a.options||(a.options={}),a.type){case"text":case"textarea":case"email":case"pass":case"password":a.el.value=l;break;case"int":case"float":case"money":case"currency":case"percent":case"hex":case"alphanumeric":case"color":case"date":case"time":a.el.value=l,e(a.el).w2field(e.extend({},a.options,{type:a.type}));break;case"toggle":w2utils.isFloat(l)&&(l=parseFloat(l)),e(a.el).prop("checked",!!l),this.setValue(a.name,l||!1);break;case"radio":e(a.$el).prop("checked",!1).each((function(t,i){e(i).val()==l&&e(i).prop("checked",!0)}));break;case"checkbox":e(a.el).prop("checked",!!l),!0!==a.disabled&&!1!==a.disabled||e(a.el).prop("disabled",!!a.disabled);break;case"check":case"checks":Array.isArray(l)&&l.forEach((function(t){e(a.el).closest("div").find('[data-value="'+t+'"]').prop("checked",!0)})),a.disabled?e(a.el).closest("div").find("input[type=checkbox]").prop("disabled",!0):e(a.el).closest("div").find("input[type=checkbox]").removeProp("disabled");break;case"list":case"combo":if("list"===a.type){var u=e.isPlainObject(l)?l.id:e.isPlainObject(a.options.selected)?a.options.selected.id:l;a.options.items||(a.options.items=[]),"function"==typeof(g=a.options.items)&&(g=g());var c=!1;if(Array.isArray(g))for(var d=0;d<g.length;d++){var h=g[d];if(h.id==u){l=e.extend(!0,{},h),i.setValue(a.name,l),c=!0;break}}c||null==l||""===l||a.$el.data("find_selected",l)}else"combo"!==a.type||e.isPlainObject(l)?e.isPlainObject(l)&&null!=l.text?a.el.value=l.text:a.el.value="":a.el.value=l;e.isPlainObject(l)||(l={}),e(a.el).w2field(e.extend({},a.options,{type:a.type,selected:l}));break;case"enum":case"file":var p=[];c=!1,e.isArray(l)||(l=[]),"function"!=typeof a.options.items&&(e.isArray(a.options.items)||(a.options.items=[]),l.forEach((function(t){a.options.items.forEach((function(i){i&&(i.id==t||e.isPlainObject(t)&&i.id==t.id)&&(p.push(e.isPlainObject(i)?e.extend(!0,{},i):i),c=!0)}))}))),c||null==l||0===l.length||(a.$el.data("find_selected",l),p=l);var f=e.extend({},a.options,{type:a.type,selected:p});Object.keys(a.options).forEach((function(e){"function"==typeof a.options[e]&&(f[e]=a.options[e])})),e(a.el).w2field(f);break;case"select":var g;if(null!=(g=a.options.items)&&g.length>0){g=w2obj.field.prototype.normMenu.call(this,g,a),e(a.el).html("");for(var m=0;m<g.length;m++)e(a.el).append('<option value="'+g[m].id+'">'+g[m].text+"</option")}e(a.el).val(l);break;case"map":case"array":"map"!=a.type||null!=l&&e.isPlainObject(l)||(this.setValue(a.field,{}),l=this.getValue(a.field)),"array"!=a.type||null!=l&&Array.isArray(l)||(this.setValue(a.field,[]),l=this.getValue(a.field)),function(t,i){i.el.mapAdd=function(e,t,i){var n=(e.disabled?" readOnly ":"")+(e.html.tabindex_str||""),r='<div class="w2ui-map-field" style="margin-bottom: 5px"><input spellcheck="false" id="'+e.field+"_key_"+i+'" data-cnt="'+i+'" type="text" '+e.html.key.attr+n+' class="w2ui-input w2ui-map key">'+(e.html.key.text||"")+'<input spellcheck="false" id="'+e.field+"_value_"+i+'" data-cnt="'+i+'" type="text" '+e.html.value.attr+n+' class="w2ui-input w2ui-map value">'+(e.html.value.text||"")+"</div>";t.append(r)},i.el.mapRefresh=function(n,r){var s,o,a,l=1;"map"==i.type&&(e.isPlainObject(n)||(n={}),null==n._order&&(n._order=Object.keys(n)),s=n._order),"array"==i.type&&(Array.isArray(n)||(n=[]),s=n.map((function(e){return e.key}))),s.forEach((function(e){o=r.find("#"+w2utils.escapeId(i.name)+"_key_"+l),a=r.find("#"+w2utils.escapeId(i.name)+"_value_"+l),0!=o.length&&0!=a.length||(i.el.mapAdd(i,r,l),o=r.find("#"+w2utils.escapeId(i.name)+"_key_"+l),a=r.find("#"+w2utils.escapeId(i.name)+"_value_"+l));var t=n[e];if("array"==i.type){var s=n.filter((function(t){return t.key==e}));s.length>0&&(t=s[0].value)}o.val(e),a.val(t),!0!==i.disabled&&!1!==i.disabled||(o.prop("readOnly",!!i.disabled),a.prop("readOnly",!!i.disabled)),o.parents(".w2ui-map-field").attr("data-key",e),l++}));var u=r.find("#"+w2utils.escapeId(i.name)+"_key_"+l).parent(),c=r.find("#"+w2utils.escapeId(i.name)+"_key_"+(l+1)).parent();0!==u.length||o&&(!0===o.prop("readOnly")||!0===o.prop("disabled"))||i.el.mapAdd(i,r,l),1==u.length&&1==c.length&&(u.removeAttr("data-key"),u.find(".key").val(c.find(".key").val()),u.find(".value").val(c.find(".value").val()),c.remove()),!0!==i.disabled&&!1!==i.disabled||(u.find(".key").prop("readOnly",!!i.disabled),u.find(".value").prop("readOnly",!!i.disabled)),e(i.el).next().find("input.w2ui-map").off(".mapChange").on("keyup.mapChange",(function(t){var i=e(t.target).parents(".w2ui-map-field");13==t.keyCode&&i.next().find("input.key").focus()})).on("change.mapChange",(function(){var s=e(event.target).parents(".w2ui-map-field"),o=s.attr("data-key"),a=s.find(".key").val(),l=s.find(".value").val(),u={},c={},d=null,h=null;u[a]=l,"array"==i.type&&(n.forEach((function(e,t){e.key==o&&(h=t)})),d=n[h]),null!=o&&"map"==i.type&&(c[o]=n[o]),null!=o&&"array"==i.type&&(c[o]=d.value);var p=t.trigger({phase:"before",target:i.field,type:"change",originalEvent:event,value_new:u,value_previous:c});if(!0!==p.isCancelled){if("map"==i.type){delete n[o];var f=n._order.indexOf(o);if(""!=a){if(null!=n[a]){var g,m=0;do{g=a+ ++m}while(null!=n[g]);a=g,s.find(".key").val(g)}n[a]=l,s.attr("data-key",a),-1!=f?n._order[f]=a:n._order.push(a)}else n._order.splice(f,1),s.find(".value").val("")}else"array"==i.type&&(""!=a?null==d?n.push({key:a,value:l}):(d.key=a,d.value=l):n.splice(h,1));t.setValue(i.field,n),i.el.mapRefresh(n,r),t.trigger(e.extend(p,{phase:"after"}))}}))},i.el.mapRefresh(l,e(i.el).parent().find(".w2ui-map-container"))}(this,a);break;case"div":case"custom":e(a.el).html(l);break;case"html":case"empty":break;default:e(a.el).val(l),e(a.el).w2field(e.extend({},a.options,{type:a.type}))}}var v=e(this.box).find(".w2ui-page");for(d=0;d<v.length;d++)e(v[d]).find("> *").length>1&&e(v[d]).wrapInner("<div></div>");return this.trigger(e.extend(n,{phase:"after"})),this.resize(),(new Date).getTime()-t}}},render:function(t){var i=(new Date).getTime(),n=this;if("object"==typeof t&&(e(this.box).find("#form_"+this.name+"_tabs").length>0&&e(this.box).removeAttr("name").removeClass("w2ui-reset w2ui-form").html(""),this.box=t),this.isGenerated&&this.box){var r=this.trigger({phase:"before",target:this.name,type:"render",box:null!=t?t:this.box});if(!0!==r.isCancelled){var s='<div class="w2ui-form-box">'+(""!==this.header?'<div class="w2ui-form-header">'+this.header+"</div>":"")+'    <div id="form_'+this.name+'_toolbar" class="w2ui-form-toolbar" style="display: none"></div>    <div id="form_'+this.name+'_tabs" class="w2ui-form-tabs" style="display: none"></div>'+this.formHTML+"</div>";return e(this.box).attr("name",this.name).addClass("w2ui-reset w2ui-form").html(s),e(this.box).length>0&&(e(this.box)[0].style.cssText+=this.style),"function"!=typeof this.toolbar.render&&(this.toolbar=e().w2toolbar(e.extend({},this.toolbar,{name:this.name+"_toolbar",owner:this})),this.toolbar.on("click",(function(t){var i=n.trigger({phase:"before",type:"toolbar",target:t.target,originalEvent:t});!0!==i.isCancelled&&n.trigger(e.extend(i,{phase:"after"}))}))),"object"==typeof this.toolbar&&"function"==typeof this.toolbar.render&&this.toolbar.render(e("#form_"+this.name+"_toolbar")[0]),"function"!=typeof this.tabs.render&&(this.tabs=e().w2tabs(e.extend({},this.tabs,{name:this.name+"_tabs",owner:this,active:this.tabs.active})),this.tabs.on("click",(function(e){n.goto(this.get(e.target,!0))}))),"object"==typeof this.tabs&&"function"==typeof this.tabs.render&&(this.tabs.render(e("#form_"+this.name+"_tabs")[0]),this.tabs.active&&this.tabs.click(this.tabs.active)),this.trigger(e.extend(r,{phase:"after"})),this.resize(),("object"!=typeof this.url?this.url:this.url.get)&&0!==this.recid&&null!=this.recid?this.request():this.refresh(),0===e(".w2ui-layout").length&&(this.tmp_resize=function(t){null==w2ui[n.name]?e(window).off("resize.w2uiResize",n.tmp_resize):w2ui[n.name].resize()},e(window).off("resize.w2uiResize").on("resize.w2uiResize",n.tmp_resize)),-1!=this.focus&&setTimeout((function(){0===e(n.box).find("input, select, textarea").length?setTimeout(focusEl,500):n.applyFocus()}),50),(new Date).getTime()-i}}},applyFocus:function(){for(var t=this.focus,i=e(this.box).find("div:not(.w2ui-field-helper) > input, select, textarea, div > label:nth-child(1) > :radio").not(".file-input");e(i[t]).is(":hidden")&&i.length>=t;)t++;i[t]&&i[t].focus()},destroy:function(){var t=this.trigger({phase:"before",target:this.name,type:"destroy"});!0!==t.isCancelled&&("object"==typeof this.toolbar&&this.toolbar.destroy&&this.toolbar.destroy(),"object"==typeof this.tabs&&this.tabs.destroy&&this.tabs.destroy(),e(this.box).find("#form_"+this.name+"_tabs").length>0&&e(this.box).removeAttr("name").removeClass("w2ui-reset w2ui-form").html(""),delete w2ui[this.name],this.trigger(e.extend(t,{phase:"after"})),e(window).off("resize","body"))}},e.extend(t.prototype,w2utils.event),w2obj.form=t}(jQuery),module.exports={W2Layout:w2obj.layout,W2Grid:w2obj.grid,W2Toolbar:w2obj.toolbar,W2Sidebar:w2obj.sidebar,W2Tabs:w2obj.tabs,W2Form:w2obj.form,W2Popup:w2popup}},7187:e=>{"use strict";var t,i="object"==typeof Reflect?Reflect:null,n=i&&"function"==typeof i.apply?i.apply:function(e,t,i){return Function.prototype.apply.call(e,t,i)};t=i&&"function"==typeof i.ownKeys?i.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var r=Number.isNaN||function(e){return e!=e};function s(){s.init.call(this)}e.exports=s,e.exports.once=function(e,t){return new Promise((function(i,n){function r(i){e.removeListener(t,s),n(i)}function s(){"function"==typeof e.removeListener&&e.removeListener("error",r),i([].slice.call(arguments))}g(e,t,s,{once:!0}),"error"!==t&&function(e,t,i){"function"==typeof e.on&&g(e,"error",t,{once:!0})}(e,r)}))},s.EventEmitter=s,s.prototype._events=void 0,s.prototype._eventsCount=0,s.prototype._maxListeners=void 0;var o=10;function a(e){if("function"!=typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}function l(e){return void 0===e._maxListeners?s.defaultMaxListeners:e._maxListeners}function u(e,t,i,n){var r,s,o,u;if(a(i),void 0===(s=e._events)?(s=e._events=Object.create(null),e._eventsCount=0):(void 0!==s.newListener&&(e.emit("newListener",t,i.listener?i.listener:i),s=e._events),o=s[t]),void 0===o)o=s[t]=i,++e._eventsCount;else if("function"==typeof o?o=s[t]=n?[i,o]:[o,i]:n?o.unshift(i):o.push(i),(r=l(e))>0&&o.length>r&&!o.warned){o.warned=!0;var c=new Error("Possible EventEmitter memory leak detected. "+o.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");c.name="MaxListenersExceededWarning",c.emitter=e,c.type=t,c.count=o.length,u=c,console&&console.warn&&console.warn(u)}return e}function c(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function d(e,t,i){var n={fired:!1,wrapFn:void 0,target:e,type:t,listener:i},r=c.bind(n);return r.listener=i,n.wrapFn=r,r}function h(e,t,i){var n=e._events;if(void 0===n)return[];var r=n[t];return void 0===r?[]:"function"==typeof r?i?[r.listener||r]:[r]:i?function(e){for(var t=new Array(e.length),i=0;i<t.length;++i)t[i]=e[i].listener||e[i];return t}(r):f(r,r.length)}function p(e){var t=this._events;if(void 0!==t){var i=t[e];if("function"==typeof i)return 1;if(void 0!==i)return i.length}return 0}function f(e,t){for(var i=new Array(t),n=0;n<t;++n)i[n]=e[n];return i}function g(e,t,i,n){if("function"==typeof e.on)n.once?e.once(t,i):e.on(t,i);else{if("function"!=typeof e.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof e);e.addEventListener(t,(function r(s){n.once&&e.removeEventListener(t,r),i(s)}))}}Object.defineProperty(s,"defaultMaxListeners",{enumerable:!0,get:function(){return o},set:function(e){if("number"!=typeof e||e<0||r(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");o=e}}),s.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},s.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||r(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},s.prototype.getMaxListeners=function(){return l(this)},s.prototype.emit=function(e){for(var t=[],i=1;i<arguments.length;i++)t.push(arguments[i]);var r="error"===e,s=this._events;if(void 0!==s)r=r&&void 0===s.error;else if(!r)return!1;if(r){var o;if(t.length>0&&(o=t[0]),o instanceof Error)throw o;var a=new Error("Unhandled error."+(o?" ("+o.message+")":""));throw a.context=o,a}var l=s[e];if(void 0===l)return!1;if("function"==typeof l)n(l,this,t);else{var u=l.length,c=f(l,u);for(i=0;i<u;++i)n(c[i],this,t)}return!0},s.prototype.addListener=function(e,t){return u(this,e,t,!1)},s.prototype.on=s.prototype.addListener,s.prototype.prependListener=function(e,t){return u(this,e,t,!0)},s.prototype.once=function(e,t){return a(t),this.on(e,d(this,e,t)),this},s.prototype.prependOnceListener=function(e,t){return a(t),this.prependListener(e,d(this,e,t)),this},s.prototype.removeListener=function(e,t){var i,n,r,s,o;if(a(t),void 0===(n=this._events))return this;if(void 0===(i=n[e]))return this;if(i===t||i.listener===t)0==--this._eventsCount?this._events=Object.create(null):(delete n[e],n.removeListener&&this.emit("removeListener",e,i.listener||t));else if("function"!=typeof i){for(r=-1,s=i.length-1;s>=0;s--)if(i[s]===t||i[s].listener===t){o=i[s].listener,r=s;break}if(r<0)return this;0===r?i.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(i,r),1===i.length&&(n[e]=i[0]),void 0!==n.removeListener&&this.emit("removeListener",e,o||t)}return this},s.prototype.off=s.prototype.removeListener,s.prototype.removeAllListeners=function(e){var t,i,n;if(void 0===(i=this._events))return this;if(void 0===i.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==i[e]&&(0==--this._eventsCount?this._events=Object.create(null):delete i[e]),this;if(0===arguments.length){var r,s=Object.keys(i);for(n=0;n<s.length;++n)"removeListener"!==(r=s[n])&&this.removeAllListeners(r);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(t=i[e]))this.removeListener(e,t);else if(void 0!==t)for(n=t.length-1;n>=0;n--)this.removeListener(e,t[n]);return this},s.prototype.listeners=function(e){return h(this,e,!0)},s.prototype.rawListeners=function(e){return h(this,e,!1)},s.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):p.call(e,t)},s.prototype.listenerCount=p,s.prototype.eventNames=function(){return this._eventsCount>0?t(this._events):[]}},4171:(e,t,i)=>{"use strict";var n,r,s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};r=function(){for(var e=arguments.length,t=Array(e),i=0;i<e;i++)t[i]=arguments[i];var n=document.createElement("input");return"object"===s(t[0])&&(!0===t[0].multiple&&n.setAttribute("multiple",""),void 0!==t[0].accept&&n.setAttribute("accept",t[0].accept)),n.setAttribute("type","file"),n.style.display="none",n.setAttribute("id","hidden-file"),document.body.appendChild(n),new Promise((function(e){n.addEventListener("change",(function(){e(n.files);var i=t[t.length-1];"function"==typeof i&&i(n.files),document.body.removeChild(n)}));var i=document.createEvent("MouseEvents");i.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,0,null),n.dispatchEvent(i)}))},void 0===(n=function(){return r}.call(t,i,t,e))||(e.exports=n)},3162:function(e,t,i){var n;void 0===(n=function(){"use strict";function t(e,t,i){var n=new XMLHttpRequest;n.open("GET",e),n.responseType="blob",n.onload=function(){a(n.response,t,i)},n.onerror=function(){console.error("could not download file")},n.send()}function n(e){var t=new XMLHttpRequest;t.open("HEAD",e,!1);try{t.send()}catch(e){}return 200<=t.status&&299>=t.status}function r(e){try{e.dispatchEvent(new MouseEvent("click"))}catch(i){var t=document.createEvent("MouseEvents");t.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),e.dispatchEvent(t)}}var s="object"==typeof window&&window.window===window?window:"object"==typeof self&&self.self===self?self:"object"==typeof i.g&&i.g.global===i.g?i.g:void 0,o=s.navigator&&/Macintosh/.test(navigator.userAgent)&&/AppleWebKit/.test(navigator.userAgent)&&!/Safari/.test(navigator.userAgent),a=s.saveAs||("object"!=typeof window||window!==s?function(){}:"download"in HTMLAnchorElement.prototype&&!o?function(e,i,o){var a=s.URL||s.webkitURL,l=document.createElement("a");i=i||e.name||"download",l.download=i,l.rel="noopener","string"==typeof e?(l.href=e,l.origin===location.origin?r(l):n(l.href)?t(e,i,o):r(l,l.target="_blank")):(l.href=a.createObjectURL(e),setTimeout((function(){a.revokeObjectURL(l.href)}),4e4),setTimeout((function(){r(l)}),0))}:"msSaveOrOpenBlob"in navigator?function(e,i,s){if(i=i||e.name||"download","string"!=typeof e)navigator.msSaveOrOpenBlob(function(e,t){return void 0===t?t={autoBom:!1}:"object"!=typeof t&&(console.warn("Deprecated: Expected third argument to be a object"),t={autoBom:!t}),t.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(e.type)?new Blob(["\ufeff",e],{type:e.type}):e}(e,s),i);else if(n(e))t(e,i,s);else{var o=document.createElement("a");o.href=e,o.target="_blank",setTimeout((function(){r(o)}))}}:function(e,i,n,r){if((r=r||open("","_blank"))&&(r.document.title=r.document.body.innerText="downloading..."),"string"==typeof e)return t(e,i,n);var a="application/octet-stream"===e.type,l=/constructor/i.test(s.HTMLElement)||s.safari,u=/CriOS\/[\d]+/.test(navigator.userAgent);if((u||a&&l||o)&&"undefined"!=typeof FileReader){var c=new FileReader;c.onloadend=function(){var e=c.result;e=u?e:e.replace(/^data:[^;]*;/,"data:attachment/file;"),r?r.location.href=e:location=e,r=null},c.readAsDataURL(e)}else{var d=s.URL||s.webkitURL,h=d.createObjectURL(e);r?r.location=h:location.href=h,r=null,setTimeout((function(){d.revokeObjectURL(h)}),4e4)}});s.saveAs=a.saveAs=a,e.exports=a}.apply(t,[]))||(e.exports=n)},9755:function(e,t){var i;!function(t,i){"use strict";"object"==typeof e.exports?e.exports=t.document?i(t,!0):function(e){if(!e.document)throw new Error("jQuery requires a window with a document");return i(e)}:i(t)}("undefined"!=typeof window?window:this,(function(n,r){"use strict";var s=[],o=Object.getPrototypeOf,a=s.slice,l=s.flat?function(e){return s.flat.call(e)}:function(e){return s.concat.apply([],e)},u=s.push,c=s.indexOf,d={},h=d.toString,p=d.hasOwnProperty,f=p.toString,g=f.call(Object),m={},v=function(e){return"function"==typeof e&&"number"!=typeof e.nodeType&&"function"!=typeof e.item},y=function(e){return null!=e&&e===e.window},w=n.document,b={type:!0,src:!0,nonce:!0,noModule:!0};function x(e,t,i){var n,r,s=(i=i||w).createElement("script");if(s.text=e,t)for(n in b)(r=t[n]||t.getAttribute&&t.getAttribute(n))&&s.setAttribute(n,r);i.head.appendChild(s).parentNode.removeChild(s)}function _(e){return null==e?e+"":"object"==typeof e||"function"==typeof e?d[h.call(e)]||"object":typeof e}var k="3.6.1",C=function(e,t){return new C.fn.init(e,t)};function T(e){var t=!!e&&"length"in e&&e.length,i=_(e);return!v(e)&&!y(e)&&("array"===i||0===t||"number"==typeof t&&t>0&&t-1 in e)}C.fn=C.prototype={jquery:k,constructor:C,length:0,toArray:function(){return a.call(this)},get:function(e){return null==e?a.call(this):e<0?this[e+this.length]:this[e]},pushStack:function(e){var t=C.merge(this.constructor(),e);return t.prevObject=this,t},each:function(e){return C.each(this,e)},map:function(e){return this.pushStack(C.map(this,(function(t,i){return e.call(t,i,t)})))},slice:function(){return this.pushStack(a.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},even:function(){return this.pushStack(C.grep(this,(function(e,t){return(t+1)%2})))},odd:function(){return this.pushStack(C.grep(this,(function(e,t){return t%2})))},eq:function(e){var t=this.length,i=+e+(e<0?t:0);return this.pushStack(i>=0&&i<t?[this[i]]:[])},end:function(){return this.prevObject||this.constructor()},push:u,sort:s.sort,splice:s.splice},C.extend=C.fn.extend=function(){var e,t,i,n,r,s,o=arguments[0]||{},a=1,l=arguments.length,u=!1;for("boolean"==typeof o&&(u=o,o=arguments[a]||{},a++),"object"==typeof o||v(o)||(o={}),a===l&&(o=this,a--);a<l;a++)if(null!=(e=arguments[a]))for(t in e)n=e[t],"__proto__"!==t&&o!==n&&(u&&n&&(C.isPlainObject(n)||(r=Array.isArray(n)))?(i=o[t],s=r&&!Array.isArray(i)?[]:r||C.isPlainObject(i)?i:{},r=!1,o[t]=C.extend(u,s,n)):void 0!==n&&(o[t]=n));return o},C.extend({expando:"jQuery"+(k+Math.random()).replace(/\D/g,""),isReady:!0,error:function(e){throw new Error(e)},noop:function(){},isPlainObject:function(e){var t,i;return!(!e||"[object Object]"!==h.call(e)||(t=o(e))&&("function"!=typeof(i=p.call(t,"constructor")&&t.constructor)||f.call(i)!==g))},isEmptyObject:function(e){var t;for(t in e)return!1;return!0},globalEval:function(e,t,i){x(e,{nonce:t&&t.nonce},i)},each:function(e,t){var i,n=0;if(T(e))for(i=e.length;n<i&&!1!==t.call(e[n],n,e[n]);n++);else for(n in e)if(!1===t.call(e[n],n,e[n]))break;return e},makeArray:function(e,t){var i=t||[];return null!=e&&(T(Object(e))?C.merge(i,"string"==typeof e?[e]:e):u.call(i,e)),i},inArray:function(e,t,i){return null==t?-1:c.call(t,e,i)},merge:function(e,t){for(var i=+t.length,n=0,r=e.length;n<i;n++)e[r++]=t[n];return e.length=r,e},grep:function(e,t,i){for(var n=[],r=0,s=e.length,o=!i;r<s;r++)!t(e[r],r)!==o&&n.push(e[r]);return n},map:function(e,t,i){var n,r,s=0,o=[];if(T(e))for(n=e.length;s<n;s++)null!=(r=t(e[s],s,i))&&o.push(r);else for(s in e)null!=(r=t(e[s],s,i))&&o.push(r);return l(o)},guid:1,support:m}),"function"==typeof Symbol&&(C.fn[Symbol.iterator]=s[Symbol.iterator]),C.each("Boolean Number String Function Array Date RegExp Object Error Symbol".split(" "),(function(e,t){d["[object "+t+"]"]=t.toLowerCase()}));var S=function(e){var t,i,n,r,s,o,a,l,u,c,d,h,p,f,g,m,v,y,w,b="sizzle"+1*new Date,x=e.document,_=0,k=0,C=le(),T=le(),S=le(),O=le(),E=function(e,t){return e===t&&(d=!0),0},I={}.hasOwnProperty,D=[],z=D.pop,A=D.push,P=D.push,R=D.slice,j=function(e,t){for(var i=0,n=e.length;i<n;i++)if(e[i]===t)return i;return-1},$="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",M="[\\x20\\t\\r\\n\\f]",L="(?:\\\\[\\da-fA-F]{1,6}[\\x20\\t\\r\\n\\f]?|\\\\[^\\r\\n\\f]|[\\w-]|[^\0-\\x7f])+",F="\\[[\\x20\\t\\r\\n\\f]*("+L+")(?:"+M+"*([*^$|!~]?=)"+M+"*(?:'((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\"|("+L+"))|)"+M+"*\\]",N=":("+L+")(?:\\((('((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\")|((?:\\\\.|[^\\\\()[\\]]|"+F+")*)|.*)\\)|)",B=new RegExp(M+"+","g"),H=new RegExp("^[\\x20\\t\\r\\n\\f]+|((?:^|[^\\\\])(?:\\\\.)*)[\\x20\\t\\r\\n\\f]+$","g"),W=new RegExp("^[\\x20\\t\\r\\n\\f]*,[\\x20\\t\\r\\n\\f]*"),U=new RegExp("^[\\x20\\t\\r\\n\\f]*([>+~]|[\\x20\\t\\r\\n\\f])[\\x20\\t\\r\\n\\f]*"),G=new RegExp(M+"|>"),q=new RegExp(N),Y=new RegExp("^"+L+"$"),V={ID:new RegExp("^#("+L+")"),CLASS:new RegExp("^\\.("+L+")"),TAG:new RegExp("^("+L+"|[*])"),ATTR:new RegExp("^"+F),PSEUDO:new RegExp("^"+N),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\([\\x20\\t\\r\\n\\f]*(even|odd|(([+-]|)(\\d*)n|)[\\x20\\t\\r\\n\\f]*(?:([+-]|)[\\x20\\t\\r\\n\\f]*(\\d+)|))[\\x20\\t\\r\\n\\f]*\\)|)","i"),bool:new RegExp("^(?:"+$+")$","i"),needsContext:new RegExp("^[\\x20\\t\\r\\n\\f]*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\([\\x20\\t\\r\\n\\f]*((?:-\\d)?\\d*)[\\x20\\t\\r\\n\\f]*\\)|)(?=[^-]|$)","i")},X=/HTML$/i,Z=/^(?:input|select|textarea|button)$/i,K=/^h\d$/i,J=/^[^{]+\{\s*\[native \w/,Q=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,ee=/[+~]/,te=new RegExp("\\\\[\\da-fA-F]{1,6}[\\x20\\t\\r\\n\\f]?|\\\\([^\\r\\n\\f])","g"),ie=function(e,t){var i="0x"+e.slice(1)-65536;return t||(i<0?String.fromCharCode(i+65536):String.fromCharCode(i>>10|55296,1023&i|56320))},ne=/([\0-\x1f\x7f]|^-?\d)|^-$|[^\0-\x1f\x7f-\uFFFF\w-]/g,re=function(e,t){return t?"\0"===e?"�":e.slice(0,-1)+"\\"+e.charCodeAt(e.length-1).toString(16)+" ":"\\"+e},se=function(){h()},oe=be((function(e){return!0===e.disabled&&"fieldset"===e.nodeName.toLowerCase()}),{dir:"parentNode",next:"legend"});try{P.apply(D=R.call(x.childNodes),x.childNodes),D[x.childNodes.length].nodeType}catch(e){P={apply:D.length?function(e,t){A.apply(e,R.call(t))}:function(e,t){for(var i=e.length,n=0;e[i++]=t[n++];);e.length=i-1}}}function ae(e,t,n,r){var s,a,u,c,d,f,v,y=t&&t.ownerDocument,x=t?t.nodeType:9;if(n=n||[],"string"!=typeof e||!e||1!==x&&9!==x&&11!==x)return n;if(!r&&(h(t),t=t||p,g)){if(11!==x&&(d=Q.exec(e)))if(s=d[1]){if(9===x){if(!(u=t.getElementById(s)))return n;if(u.id===s)return n.push(u),n}else if(y&&(u=y.getElementById(s))&&w(t,u)&&u.id===s)return n.push(u),n}else{if(d[2])return P.apply(n,t.getElementsByTagName(e)),n;if((s=d[3])&&i.getElementsByClassName&&t.getElementsByClassName)return P.apply(n,t.getElementsByClassName(s)),n}if(i.qsa&&!O[e+" "]&&(!m||!m.test(e))&&(1!==x||"object"!==t.nodeName.toLowerCase())){if(v=e,y=t,1===x&&(G.test(e)||U.test(e))){for((y=ee.test(e)&&ve(t.parentNode)||t)===t&&i.scope||((c=t.getAttribute("id"))?c=c.replace(ne,re):t.setAttribute("id",c=b)),a=(f=o(e)).length;a--;)f[a]=(c?"#"+c:":scope")+" "+we(f[a]);v=f.join(",")}try{return P.apply(n,y.querySelectorAll(v)),n}catch(t){O(e,!0)}finally{c===b&&t.removeAttribute("id")}}}return l(e.replace(H,"$1"),t,n,r)}function le(){var e=[];return function t(i,r){return e.push(i+" ")>n.cacheLength&&delete t[e.shift()],t[i+" "]=r}}function ue(e){return e[b]=!0,e}function ce(e){var t=p.createElement("fieldset");try{return!!e(t)}catch(e){return!1}finally{t.parentNode&&t.parentNode.removeChild(t),t=null}}function de(e,t){for(var i=e.split("|"),r=i.length;r--;)n.attrHandle[i[r]]=t}function he(e,t){var i=t&&e,n=i&&1===e.nodeType&&1===t.nodeType&&e.sourceIndex-t.sourceIndex;if(n)return n;if(i)for(;i=i.nextSibling;)if(i===t)return-1;return e?1:-1}function pe(e){return function(t){return"input"===t.nodeName.toLowerCase()&&t.type===e}}function fe(e){return function(t){var i=t.nodeName.toLowerCase();return("input"===i||"button"===i)&&t.type===e}}function ge(e){return function(t){return"form"in t?t.parentNode&&!1===t.disabled?"label"in t?"label"in t.parentNode?t.parentNode.disabled===e:t.disabled===e:t.isDisabled===e||t.isDisabled!==!e&&oe(t)===e:t.disabled===e:"label"in t&&t.disabled===e}}function me(e){return ue((function(t){return t=+t,ue((function(i,n){for(var r,s=e([],i.length,t),o=s.length;o--;)i[r=s[o]]&&(i[r]=!(n[r]=i[r]))}))}))}function ve(e){return e&&void 0!==e.getElementsByTagName&&e}for(t in i=ae.support={},s=ae.isXML=function(e){var t=e&&e.namespaceURI,i=e&&(e.ownerDocument||e).documentElement;return!X.test(t||i&&i.nodeName||"HTML")},h=ae.setDocument=function(e){var t,r,o=e?e.ownerDocument||e:x;return o!=p&&9===o.nodeType&&o.documentElement?(f=(p=o).documentElement,g=!s(p),x!=p&&(r=p.defaultView)&&r.top!==r&&(r.addEventListener?r.addEventListener("unload",se,!1):r.attachEvent&&r.attachEvent("onunload",se)),i.scope=ce((function(e){return f.appendChild(e).appendChild(p.createElement("div")),void 0!==e.querySelectorAll&&!e.querySelectorAll(":scope fieldset div").length})),i.attributes=ce((function(e){return e.className="i",!e.getAttribute("className")})),i.getElementsByTagName=ce((function(e){return e.appendChild(p.createComment("")),!e.getElementsByTagName("*").length})),i.getElementsByClassName=J.test(p.getElementsByClassName),i.getById=ce((function(e){return f.appendChild(e).id=b,!p.getElementsByName||!p.getElementsByName(b).length})),i.getById?(n.filter.ID=function(e){var t=e.replace(te,ie);return function(e){return e.getAttribute("id")===t}},n.find.ID=function(e,t){if(void 0!==t.getElementById&&g){var i=t.getElementById(e);return i?[i]:[]}}):(n.filter.ID=function(e){var t=e.replace(te,ie);return function(e){var i=void 0!==e.getAttributeNode&&e.getAttributeNode("id");return i&&i.value===t}},n.find.ID=function(e,t){if(void 0!==t.getElementById&&g){var i,n,r,s=t.getElementById(e);if(s){if((i=s.getAttributeNode("id"))&&i.value===e)return[s];for(r=t.getElementsByName(e),n=0;s=r[n++];)if((i=s.getAttributeNode("id"))&&i.value===e)return[s]}return[]}}),n.find.TAG=i.getElementsByTagName?function(e,t){return void 0!==t.getElementsByTagName?t.getElementsByTagName(e):i.qsa?t.querySelectorAll(e):void 0}:function(e,t){var i,n=[],r=0,s=t.getElementsByTagName(e);if("*"===e){for(;i=s[r++];)1===i.nodeType&&n.push(i);return n}return s},n.find.CLASS=i.getElementsByClassName&&function(e,t){if(void 0!==t.getElementsByClassName&&g)return t.getElementsByClassName(e)},v=[],m=[],(i.qsa=J.test(p.querySelectorAll))&&(ce((function(e){var t;f.appendChild(e).innerHTML="<a id='"+b+"'></a><select id='"+b+"-\r\\' msallowcapture=''><option selected=''></option></select>",e.querySelectorAll("[msallowcapture^='']").length&&m.push("[*^$]=[\\x20\\t\\r\\n\\f]*(?:''|\"\")"),e.querySelectorAll("[selected]").length||m.push("\\[[\\x20\\t\\r\\n\\f]*(?:value|"+$+")"),e.querySelectorAll("[id~="+b+"-]").length||m.push("~="),(t=p.createElement("input")).setAttribute("name",""),e.appendChild(t),e.querySelectorAll("[name='']").length||m.push("\\[[\\x20\\t\\r\\n\\f]*name[\\x20\\t\\r\\n\\f]*=[\\x20\\t\\r\\n\\f]*(?:''|\"\")"),e.querySelectorAll(":checked").length||m.push(":checked"),e.querySelectorAll("a#"+b+"+*").length||m.push(".#.+[+~]"),e.querySelectorAll("\\\f"),m.push("[\\r\\n\\f]")})),ce((function(e){e.innerHTML="<a href='' disabled='disabled'></a><select disabled='disabled'><option/></select>";var t=p.createElement("input");t.setAttribute("type","hidden"),e.appendChild(t).setAttribute("name","D"),e.querySelectorAll("[name=d]").length&&m.push("name[\\x20\\t\\r\\n\\f]*[*^$|!~]?="),2!==e.querySelectorAll(":enabled").length&&m.push(":enabled",":disabled"),f.appendChild(e).disabled=!0,2!==e.querySelectorAll(":disabled").length&&m.push(":enabled",":disabled"),e.querySelectorAll("*,:x"),m.push(",.*:")}))),(i.matchesSelector=J.test(y=f.matches||f.webkitMatchesSelector||f.mozMatchesSelector||f.oMatchesSelector||f.msMatchesSelector))&&ce((function(e){i.disconnectedMatch=y.call(e,"*"),y.call(e,"[s!='']:x"),v.push("!=",N)})),m=m.length&&new RegExp(m.join("|")),v=v.length&&new RegExp(v.join("|")),t=J.test(f.compareDocumentPosition),w=t||J.test(f.contains)?function(e,t){var i=9===e.nodeType?e.documentElement:e,n=t&&t.parentNode;return e===n||!(!n||1!==n.nodeType||!(i.contains?i.contains(n):e.compareDocumentPosition&&16&e.compareDocumentPosition(n)))}:function(e,t){if(t)for(;t=t.parentNode;)if(t===e)return!0;return!1},E=t?function(e,t){if(e===t)return d=!0,0;var n=!e.compareDocumentPosition-!t.compareDocumentPosition;return n||(1&(n=(e.ownerDocument||e)==(t.ownerDocument||t)?e.compareDocumentPosition(t):1)||!i.sortDetached&&t.compareDocumentPosition(e)===n?e==p||e.ownerDocument==x&&w(x,e)?-1:t==p||t.ownerDocument==x&&w(x,t)?1:c?j(c,e)-j(c,t):0:4&n?-1:1)}:function(e,t){if(e===t)return d=!0,0;var i,n=0,r=e.parentNode,s=t.parentNode,o=[e],a=[t];if(!r||!s)return e==p?-1:t==p?1:r?-1:s?1:c?j(c,e)-j(c,t):0;if(r===s)return he(e,t);for(i=e;i=i.parentNode;)o.unshift(i);for(i=t;i=i.parentNode;)a.unshift(i);for(;o[n]===a[n];)n++;return n?he(o[n],a[n]):o[n]==x?-1:a[n]==x?1:0},p):p},ae.matches=function(e,t){return ae(e,null,null,t)},ae.matchesSelector=function(e,t){if(h(e),i.matchesSelector&&g&&!O[t+" "]&&(!v||!v.test(t))&&(!m||!m.test(t)))try{var n=y.call(e,t);if(n||i.disconnectedMatch||e.document&&11!==e.document.nodeType)return n}catch(e){O(t,!0)}return ae(t,p,null,[e]).length>0},ae.contains=function(e,t){return(e.ownerDocument||e)!=p&&h(e),w(e,t)},ae.attr=function(e,t){(e.ownerDocument||e)!=p&&h(e);var r=n.attrHandle[t.toLowerCase()],s=r&&I.call(n.attrHandle,t.toLowerCase())?r(e,t,!g):void 0;return void 0!==s?s:i.attributes||!g?e.getAttribute(t):(s=e.getAttributeNode(t))&&s.specified?s.value:null},ae.escape=function(e){return(e+"").replace(ne,re)},ae.error=function(e){throw new Error("Syntax error, unrecognized expression: "+e)},ae.uniqueSort=function(e){var t,n=[],r=0,s=0;if(d=!i.detectDuplicates,c=!i.sortStable&&e.slice(0),e.sort(E),d){for(;t=e[s++];)t===e[s]&&(r=n.push(s));for(;r--;)e.splice(n[r],1)}return c=null,e},r=ae.getText=function(e){var t,i="",n=0,s=e.nodeType;if(s){if(1===s||9===s||11===s){if("string"==typeof e.textContent)return e.textContent;for(e=e.firstChild;e;e=e.nextSibling)i+=r(e)}else if(3===s||4===s)return e.nodeValue}else for(;t=e[n++];)i+=r(t);return i},n=ae.selectors={cacheLength:50,createPseudo:ue,match:V,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(e){return e[1]=e[1].replace(te,ie),e[3]=(e[3]||e[4]||e[5]||"").replace(te,ie),"~="===e[2]&&(e[3]=" "+e[3]+" "),e.slice(0,4)},CHILD:function(e){return e[1]=e[1].toLowerCase(),"nth"===e[1].slice(0,3)?(e[3]||ae.error(e[0]),e[4]=+(e[4]?e[5]+(e[6]||1):2*("even"===e[3]||"odd"===e[3])),e[5]=+(e[7]+e[8]||"odd"===e[3])):e[3]&&ae.error(e[0]),e},PSEUDO:function(e){var t,i=!e[6]&&e[2];return V.CHILD.test(e[0])?null:(e[3]?e[2]=e[4]||e[5]||"":i&&q.test(i)&&(t=o(i,!0))&&(t=i.indexOf(")",i.length-t)-i.length)&&(e[0]=e[0].slice(0,t),e[2]=i.slice(0,t)),e.slice(0,3))}},filter:{TAG:function(e){var t=e.replace(te,ie).toLowerCase();return"*"===e?function(){return!0}:function(e){return e.nodeName&&e.nodeName.toLowerCase()===t}},CLASS:function(e){var t=C[e+" "];return t||(t=new RegExp("(^|[\\x20\\t\\r\\n\\f])"+e+"("+M+"|$)"))&&C(e,(function(e){return t.test("string"==typeof e.className&&e.className||void 0!==e.getAttribute&&e.getAttribute("class")||"")}))},ATTR:function(e,t,i){return function(n){var r=ae.attr(n,e);return null==r?"!="===t:!t||(r+="","="===t?r===i:"!="===t?r!==i:"^="===t?i&&0===r.indexOf(i):"*="===t?i&&r.indexOf(i)>-1:"$="===t?i&&r.slice(-i.length)===i:"~="===t?(" "+r.replace(B," ")+" ").indexOf(i)>-1:"|="===t&&(r===i||r.slice(0,i.length+1)===i+"-"))}},CHILD:function(e,t,i,n,r){var s="nth"!==e.slice(0,3),o="last"!==e.slice(-4),a="of-type"===t;return 1===n&&0===r?function(e){return!!e.parentNode}:function(t,i,l){var u,c,d,h,p,f,g=s!==o?"nextSibling":"previousSibling",m=t.parentNode,v=a&&t.nodeName.toLowerCase(),y=!l&&!a,w=!1;if(m){if(s){for(;g;){for(h=t;h=h[g];)if(a?h.nodeName.toLowerCase()===v:1===h.nodeType)return!1;f=g="only"===e&&!f&&"nextSibling"}return!0}if(f=[o?m.firstChild:m.lastChild],o&&y){for(w=(p=(u=(c=(d=(h=m)[b]||(h[b]={}))[h.uniqueID]||(d[h.uniqueID]={}))[e]||[])[0]===_&&u[1])&&u[2],h=p&&m.childNodes[p];h=++p&&h&&h[g]||(w=p=0)||f.pop();)if(1===h.nodeType&&++w&&h===t){c[e]=[_,p,w];break}}else if(y&&(w=p=(u=(c=(d=(h=t)[b]||(h[b]={}))[h.uniqueID]||(d[h.uniqueID]={}))[e]||[])[0]===_&&u[1]),!1===w)for(;(h=++p&&h&&h[g]||(w=p=0)||f.pop())&&((a?h.nodeName.toLowerCase()!==v:1!==h.nodeType)||!++w||(y&&((c=(d=h[b]||(h[b]={}))[h.uniqueID]||(d[h.uniqueID]={}))[e]=[_,w]),h!==t)););return(w-=r)===n||w%n==0&&w/n>=0}}},PSEUDO:function(e,t){var i,r=n.pseudos[e]||n.setFilters[e.toLowerCase()]||ae.error("unsupported pseudo: "+e);return r[b]?r(t):r.length>1?(i=[e,e,"",t],n.setFilters.hasOwnProperty(e.toLowerCase())?ue((function(e,i){for(var n,s=r(e,t),o=s.length;o--;)e[n=j(e,s[o])]=!(i[n]=s[o])})):function(e){return r(e,0,i)}):r}},pseudos:{not:ue((function(e){var t=[],i=[],n=a(e.replace(H,"$1"));return n[b]?ue((function(e,t,i,r){for(var s,o=n(e,null,r,[]),a=e.length;a--;)(s=o[a])&&(e[a]=!(t[a]=s))})):function(e,r,s){return t[0]=e,n(t,null,s,i),t[0]=null,!i.pop()}})),has:ue((function(e){return function(t){return ae(e,t).length>0}})),contains:ue((function(e){return e=e.replace(te,ie),function(t){return(t.textContent||r(t)).indexOf(e)>-1}})),lang:ue((function(e){return Y.test(e||"")||ae.error("unsupported lang: "+e),e=e.replace(te,ie).toLowerCase(),function(t){var i;do{if(i=g?t.lang:t.getAttribute("xml:lang")||t.getAttribute("lang"))return(i=i.toLowerCase())===e||0===i.indexOf(e+"-")}while((t=t.parentNode)&&1===t.nodeType);return!1}})),target:function(t){var i=e.location&&e.location.hash;return i&&i.slice(1)===t.id},root:function(e){return e===f},focus:function(e){return e===p.activeElement&&(!p.hasFocus||p.hasFocus())&&!!(e.type||e.href||~e.tabIndex)},enabled:ge(!1),disabled:ge(!0),checked:function(e){var t=e.nodeName.toLowerCase();return"input"===t&&!!e.checked||"option"===t&&!!e.selected},selected:function(e){return e.parentNode&&e.parentNode.selectedIndex,!0===e.selected},empty:function(e){for(e=e.firstChild;e;e=e.nextSibling)if(e.nodeType<6)return!1;return!0},parent:function(e){return!n.pseudos.empty(e)},header:function(e){return K.test(e.nodeName)},input:function(e){return Z.test(e.nodeName)},button:function(e){var t=e.nodeName.toLowerCase();return"input"===t&&"button"===e.type||"button"===t},text:function(e){var t;return"input"===e.nodeName.toLowerCase()&&"text"===e.type&&(null==(t=e.getAttribute("type"))||"text"===t.toLowerCase())},first:me((function(){return[0]})),last:me((function(e,t){return[t-1]})),eq:me((function(e,t,i){return[i<0?i+t:i]})),even:me((function(e,t){for(var i=0;i<t;i+=2)e.push(i);return e})),odd:me((function(e,t){for(var i=1;i<t;i+=2)e.push(i);return e})),lt:me((function(e,t,i){for(var n=i<0?i+t:i>t?t:i;--n>=0;)e.push(n);return e})),gt:me((function(e,t,i){for(var n=i<0?i+t:i;++n<t;)e.push(n);return e}))}},n.pseudos.nth=n.pseudos.eq,{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})n.pseudos[t]=pe(t);for(t in{submit:!0,reset:!0})n.pseudos[t]=fe(t);function ye(){}function we(e){for(var t=0,i=e.length,n="";t<i;t++)n+=e[t].value;return n}function be(e,t,i){var n=t.dir,r=t.next,s=r||n,o=i&&"parentNode"===s,a=k++;return t.first?function(t,i,r){for(;t=t[n];)if(1===t.nodeType||o)return e(t,i,r);return!1}:function(t,i,l){var u,c,d,h=[_,a];if(l){for(;t=t[n];)if((1===t.nodeType||o)&&e(t,i,l))return!0}else for(;t=t[n];)if(1===t.nodeType||o)if(c=(d=t[b]||(t[b]={}))[t.uniqueID]||(d[t.uniqueID]={}),r&&r===t.nodeName.toLowerCase())t=t[n]||t;else{if((u=c[s])&&u[0]===_&&u[1]===a)return h[2]=u[2];if(c[s]=h,h[2]=e(t,i,l))return!0}return!1}}function xe(e){return e.length>1?function(t,i,n){for(var r=e.length;r--;)if(!e[r](t,i,n))return!1;return!0}:e[0]}function _e(e,t,i,n,r){for(var s,o=[],a=0,l=e.length,u=null!=t;a<l;a++)(s=e[a])&&(i&&!i(s,n,r)||(o.push(s),u&&t.push(a)));return o}function ke(e,t,i,n,r,s){return n&&!n[b]&&(n=ke(n)),r&&!r[b]&&(r=ke(r,s)),ue((function(s,o,a,l){var u,c,d,h=[],p=[],f=o.length,g=s||function(e,t,i){for(var n=0,r=t.length;n<r;n++)ae(e,t[n],i);return i}(t||"*",a.nodeType?[a]:a,[]),m=!e||!s&&t?g:_e(g,h,e,a,l),v=i?r||(s?e:f||n)?[]:o:m;if(i&&i(m,v,a,l),n)for(u=_e(v,p),n(u,[],a,l),c=u.length;c--;)(d=u[c])&&(v[p[c]]=!(m[p[c]]=d));if(s){if(r||e){if(r){for(u=[],c=v.length;c--;)(d=v[c])&&u.push(m[c]=d);r(null,v=[],u,l)}for(c=v.length;c--;)(d=v[c])&&(u=r?j(s,d):h[c])>-1&&(s[u]=!(o[u]=d))}}else v=_e(v===o?v.splice(f,v.length):v),r?r(null,o,v,l):P.apply(o,v)}))}function Ce(e){for(var t,i,r,s=e.length,o=n.relative[e[0].type],a=o||n.relative[" "],l=o?1:0,c=be((function(e){return e===t}),a,!0),d=be((function(e){return j(t,e)>-1}),a,!0),h=[function(e,i,n){var r=!o&&(n||i!==u)||((t=i).nodeType?c(e,i,n):d(e,i,n));return t=null,r}];l<s;l++)if(i=n.relative[e[l].type])h=[be(xe(h),i)];else{if((i=n.filter[e[l].type].apply(null,e[l].matches))[b]){for(r=++l;r<s&&!n.relative[e[r].type];r++);return ke(l>1&&xe(h),l>1&&we(e.slice(0,l-1).concat({value:" "===e[l-2].type?"*":""})).replace(H,"$1"),i,l<r&&Ce(e.slice(l,r)),r<s&&Ce(e=e.slice(r)),r<s&&we(e))}h.push(i)}return xe(h)}return ye.prototype=n.filters=n.pseudos,n.setFilters=new ye,o=ae.tokenize=function(e,t){var i,r,s,o,a,l,u,c=T[e+" "];if(c)return t?0:c.slice(0);for(a=e,l=[],u=n.preFilter;a;){for(o in i&&!(r=W.exec(a))||(r&&(a=a.slice(r[0].length)||a),l.push(s=[])),i=!1,(r=U.exec(a))&&(i=r.shift(),s.push({value:i,type:r[0].replace(H," ")}),a=a.slice(i.length)),n.filter)!(r=V[o].exec(a))||u[o]&&!(r=u[o](r))||(i=r.shift(),s.push({value:i,type:o,matches:r}),a=a.slice(i.length));if(!i)break}return t?a.length:a?ae.error(e):T(e,l).slice(0)},a=ae.compile=function(e,t){var i,r=[],s=[],a=S[e+" "];if(!a){for(t||(t=o(e)),i=t.length;i--;)(a=Ce(t[i]))[b]?r.push(a):s.push(a);a=S(e,function(e,t){var i=t.length>0,r=e.length>0,s=function(s,o,a,l,c){var d,f,m,v=0,y="0",w=s&&[],b=[],x=u,k=s||r&&n.find.TAG("*",c),C=_+=null==x?1:Math.random()||.1,T=k.length;for(c&&(u=o==p||o||c);y!==T&&null!=(d=k[y]);y++){if(r&&d){for(f=0,o||d.ownerDocument==p||(h(d),a=!g);m=e[f++];)if(m(d,o||p,a)){l.push(d);break}c&&(_=C)}i&&((d=!m&&d)&&v--,s&&w.push(d))}if(v+=y,i&&y!==v){for(f=0;m=t[f++];)m(w,b,o,a);if(s){if(v>0)for(;y--;)w[y]||b[y]||(b[y]=z.call(l));b=_e(b)}P.apply(l,b),c&&!s&&b.length>0&&v+t.length>1&&ae.uniqueSort(l)}return c&&(_=C,u=x),w};return i?ue(s):s}(s,r)),a.selector=e}return a},l=ae.select=function(e,t,i,r){var s,l,u,c,d,h="function"==typeof e&&e,p=!r&&o(e=h.selector||e);if(i=i||[],1===p.length){if((l=p[0]=p[0].slice(0)).length>2&&"ID"===(u=l[0]).type&&9===t.nodeType&&g&&n.relative[l[1].type]){if(!(t=(n.find.ID(u.matches[0].replace(te,ie),t)||[])[0]))return i;h&&(t=t.parentNode),e=e.slice(l.shift().value.length)}for(s=V.needsContext.test(e)?0:l.length;s--&&(u=l[s],!n.relative[c=u.type]);)if((d=n.find[c])&&(r=d(u.matches[0].replace(te,ie),ee.test(l[0].type)&&ve(t.parentNode)||t))){if(l.splice(s,1),!(e=r.length&&we(l)))return P.apply(i,r),i;break}}return(h||a(e,p))(r,t,!g,i,!t||ee.test(e)&&ve(t.parentNode)||t),i},i.sortStable=b.split("").sort(E).join("")===b,i.detectDuplicates=!!d,h(),i.sortDetached=ce((function(e){return 1&e.compareDocumentPosition(p.createElement("fieldset"))})),ce((function(e){return e.innerHTML="<a href='#'></a>","#"===e.firstChild.getAttribute("href")}))||de("type|href|height|width",(function(e,t,i){if(!i)return e.getAttribute(t,"type"===t.toLowerCase()?1:2)})),i.attributes&&ce((function(e){return e.innerHTML="<input/>",e.firstChild.setAttribute("value",""),""===e.firstChild.getAttribute("value")}))||de("value",(function(e,t,i){if(!i&&"input"===e.nodeName.toLowerCase())return e.defaultValue})),ce((function(e){return null==e.getAttribute("disabled")}))||de($,(function(e,t,i){var n;if(!i)return!0===e[t]?t.toLowerCase():(n=e.getAttributeNode(t))&&n.specified?n.value:null})),ae}(n);C.find=S,C.expr=S.selectors,C.expr[":"]=C.expr.pseudos,C.uniqueSort=C.unique=S.uniqueSort,C.text=S.getText,C.isXMLDoc=S.isXML,C.contains=S.contains,C.escapeSelector=S.escape;var O=function(e,t,i){for(var n=[],r=void 0!==i;(e=e[t])&&9!==e.nodeType;)if(1===e.nodeType){if(r&&C(e).is(i))break;n.push(e)}return n},E=function(e,t){for(var i=[];e;e=e.nextSibling)1===e.nodeType&&e!==t&&i.push(e);return i},I=C.expr.match.needsContext;function D(e,t){return e.nodeName&&e.nodeName.toLowerCase()===t.toLowerCase()}var z=/^<([a-z][^\/\0>:\x20\t\r\n\f]*)[\x20\t\r\n\f]*\/?>(?:<\/\1>|)$/i;function A(e,t,i){return v(t)?C.grep(e,(function(e,n){return!!t.call(e,n,e)!==i})):t.nodeType?C.grep(e,(function(e){return e===t!==i})):"string"!=typeof t?C.grep(e,(function(e){return c.call(t,e)>-1!==i})):C.filter(t,e,i)}C.filter=function(e,t,i){var n=t[0];return i&&(e=":not("+e+")"),1===t.length&&1===n.nodeType?C.find.matchesSelector(n,e)?[n]:[]:C.find.matches(e,C.grep(t,(function(e){return 1===e.nodeType})))},C.fn.extend({find:function(e){var t,i,n=this.length,r=this;if("string"!=typeof e)return this.pushStack(C(e).filter((function(){for(t=0;t<n;t++)if(C.contains(r[t],this))return!0})));for(i=this.pushStack([]),t=0;t<n;t++)C.find(e,r[t],i);return n>1?C.uniqueSort(i):i},filter:function(e){return this.pushStack(A(this,e||[],!1))},not:function(e){return this.pushStack(A(this,e||[],!0))},is:function(e){return!!A(this,"string"==typeof e&&I.test(e)?C(e):e||[],!1).length}});var P,R=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]+))$/;(C.fn.init=function(e,t,i){var n,r;if(!e)return this;if(i=i||P,"string"==typeof e){if(!(n="<"===e[0]&&">"===e[e.length-1]&&e.length>=3?[null,e,null]:R.exec(e))||!n[1]&&t)return!t||t.jquery?(t||i).find(e):this.constructor(t).find(e);if(n[1]){if(t=t instanceof C?t[0]:t,C.merge(this,C.parseHTML(n[1],t&&t.nodeType?t.ownerDocument||t:w,!0)),z.test(n[1])&&C.isPlainObject(t))for(n in t)v(this[n])?this[n](t[n]):this.attr(n,t[n]);return this}return(r=w.getElementById(n[2]))&&(this[0]=r,this.length=1),this}return e.nodeType?(this[0]=e,this.length=1,this):v(e)?void 0!==i.ready?i.ready(e):e(C):C.makeArray(e,this)}).prototype=C.fn,P=C(w);var j=/^(?:parents|prev(?:Until|All))/,$={children:!0,contents:!0,next:!0,prev:!0};function M(e,t){for(;(e=e[t])&&1!==e.nodeType;);return e}C.fn.extend({has:function(e){var t=C(e,this),i=t.length;return this.filter((function(){for(var e=0;e<i;e++)if(C.contains(this,t[e]))return!0}))},closest:function(e,t){var i,n=0,r=this.length,s=[],o="string"!=typeof e&&C(e);if(!I.test(e))for(;n<r;n++)for(i=this[n];i&&i!==t;i=i.parentNode)if(i.nodeType<11&&(o?o.index(i)>-1:1===i.nodeType&&C.find.matchesSelector(i,e))){s.push(i);break}return this.pushStack(s.length>1?C.uniqueSort(s):s)},index:function(e){return e?"string"==typeof e?c.call(C(e),this[0]):c.call(this,e.jquery?e[0]:e):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(e,t){return this.pushStack(C.uniqueSort(C.merge(this.get(),C(e,t))))},addBack:function(e){return this.add(null==e?this.prevObject:this.prevObject.filter(e))}}),C.each({parent:function(e){var t=e.parentNode;return t&&11!==t.nodeType?t:null},parents:function(e){return O(e,"parentNode")},parentsUntil:function(e,t,i){return O(e,"parentNode",i)},next:function(e){return M(e,"nextSibling")},prev:function(e){return M(e,"previousSibling")},nextAll:function(e){return O(e,"nextSibling")},prevAll:function(e){return O(e,"previousSibling")},nextUntil:function(e,t,i){return O(e,"nextSibling",i)},prevUntil:function(e,t,i){return O(e,"previousSibling",i)},siblings:function(e){return E((e.parentNode||{}).firstChild,e)},children:function(e){return E(e.firstChild)},contents:function(e){return null!=e.contentDocument&&o(e.contentDocument)?e.contentDocument:(D(e,"template")&&(e=e.content||e),C.merge([],e.childNodes))}},(function(e,t){C.fn[e]=function(i,n){var r=C.map(this,t,i);return"Until"!==e.slice(-5)&&(n=i),n&&"string"==typeof n&&(r=C.filter(n,r)),this.length>1&&($[e]||C.uniqueSort(r),j.test(e)&&r.reverse()),this.pushStack(r)}}));var L=/[^\x20\t\r\n\f]+/g;function F(e){return e}function N(e){throw e}function B(e,t,i,n){var r;try{e&&v(r=e.promise)?r.call(e).done(t).fail(i):e&&v(r=e.then)?r.call(e,t,i):t.apply(void 0,[e].slice(n))}catch(e){i.apply(void 0,[e])}}C.Callbacks=function(e){e="string"==typeof e?function(e){var t={};return C.each(e.match(L)||[],(function(e,i){t[i]=!0})),t}(e):C.extend({},e);var t,i,n,r,s=[],o=[],a=-1,l=function(){for(r=r||e.once,n=t=!0;o.length;a=-1)for(i=o.shift();++a<s.length;)!1===s[a].apply(i[0],i[1])&&e.stopOnFalse&&(a=s.length,i=!1);e.memory||(i=!1),t=!1,r&&(s=i?[]:"")},u={add:function(){return s&&(i&&!t&&(a=s.length-1,o.push(i)),function t(i){C.each(i,(function(i,n){v(n)?e.unique&&u.has(n)||s.push(n):n&&n.length&&"string"!==_(n)&&t(n)}))}(arguments),i&&!t&&l()),this},remove:function(){return C.each(arguments,(function(e,t){for(var i;(i=C.inArray(t,s,i))>-1;)s.splice(i,1),i<=a&&a--})),this},has:function(e){return e?C.inArray(e,s)>-1:s.length>0},empty:function(){return s&&(s=[]),this},disable:function(){return r=o=[],s=i="",this},disabled:function(){return!s},lock:function(){return r=o=[],i||t||(s=i=""),this},locked:function(){return!!r},fireWith:function(e,i){return r||(i=[e,(i=i||[]).slice?i.slice():i],o.push(i),t||l()),this},fire:function(){return u.fireWith(this,arguments),this},fired:function(){return!!n}};return u},C.extend({Deferred:function(e){var t=[["notify","progress",C.Callbacks("memory"),C.Callbacks("memory"),2],["resolve","done",C.Callbacks("once memory"),C.Callbacks("once memory"),0,"resolved"],["reject","fail",C.Callbacks("once memory"),C.Callbacks("once memory"),1,"rejected"]],i="pending",r={state:function(){return i},always:function(){return s.done(arguments).fail(arguments),this},catch:function(e){return r.then(null,e)},pipe:function(){var e=arguments;return C.Deferred((function(i){C.each(t,(function(t,n){var r=v(e[n[4]])&&e[n[4]];s[n[1]]((function(){var e=r&&r.apply(this,arguments);e&&v(e.promise)?e.promise().progress(i.notify).done(i.resolve).fail(i.reject):i[n[0]+"With"](this,r?[e]:arguments)}))})),e=null})).promise()},then:function(e,i,r){var s=0;function o(e,t,i,r){return function(){var a=this,l=arguments,u=function(){var n,u;if(!(e<s)){if((n=i.apply(a,l))===t.promise())throw new TypeError("Thenable self-resolution");u=n&&("object"==typeof n||"function"==typeof n)&&n.then,v(u)?r?u.call(n,o(s,t,F,r),o(s,t,N,r)):(s++,u.call(n,o(s,t,F,r),o(s,t,N,r),o(s,t,F,t.notifyWith))):(i!==F&&(a=void 0,l=[n]),(r||t.resolveWith)(a,l))}},c=r?u:function(){try{u()}catch(n){C.Deferred.exceptionHook&&C.Deferred.exceptionHook(n,c.stackTrace),e+1>=s&&(i!==N&&(a=void 0,l=[n]),t.rejectWith(a,l))}};e?c():(C.Deferred.getStackHook&&(c.stackTrace=C.Deferred.getStackHook()),n.setTimeout(c))}}return C.Deferred((function(n){t[0][3].add(o(0,n,v(r)?r:F,n.notifyWith)),t[1][3].add(o(0,n,v(e)?e:F)),t[2][3].add(o(0,n,v(i)?i:N))})).promise()},promise:function(e){return null!=e?C.extend(e,r):r}},s={};return C.each(t,(function(e,n){var o=n[2],a=n[5];r[n[1]]=o.add,a&&o.add((function(){i=a}),t[3-e][2].disable,t[3-e][3].disable,t[0][2].lock,t[0][3].lock),o.add(n[3].fire),s[n[0]]=function(){return s[n[0]+"With"](this===s?void 0:this,arguments),this},s[n[0]+"With"]=o.fireWith})),r.promise(s),e&&e.call(s,s),s},when:function(e){var t=arguments.length,i=t,n=Array(i),r=a.call(arguments),s=C.Deferred(),o=function(e){return function(i){n[e]=this,r[e]=arguments.length>1?a.call(arguments):i,--t||s.resolveWith(n,r)}};if(t<=1&&(B(e,s.done(o(i)).resolve,s.reject,!t),"pending"===s.state()||v(r[i]&&r[i].then)))return s.then();for(;i--;)B(r[i],o(i),s.reject);return s.promise()}});var H=/^(Eval|Internal|Range|Reference|Syntax|Type|URI)Error$/;C.Deferred.exceptionHook=function(e,t){n.console&&n.console.warn&&e&&H.test(e.name)&&n.console.warn("jQuery.Deferred exception: "+e.message,e.stack,t)},C.readyException=function(e){n.setTimeout((function(){throw e}))};var W=C.Deferred();function U(){w.removeEventListener("DOMContentLoaded",U),n.removeEventListener("load",U),C.ready()}C.fn.ready=function(e){return W.then(e).catch((function(e){C.readyException(e)})),this},C.extend({isReady:!1,readyWait:1,ready:function(e){(!0===e?--C.readyWait:C.isReady)||(C.isReady=!0,!0!==e&&--C.readyWait>0||W.resolveWith(w,[C]))}}),C.ready.then=W.then,"complete"===w.readyState||"loading"!==w.readyState&&!w.documentElement.doScroll?n.setTimeout(C.ready):(w.addEventListener("DOMContentLoaded",U),n.addEventListener("load",U));var G=function(e,t,i,n,r,s,o){var a=0,l=e.length,u=null==i;if("object"===_(i))for(a in r=!0,i)G(e,t,a,i[a],!0,s,o);else if(void 0!==n&&(r=!0,v(n)||(o=!0),u&&(o?(t.call(e,n),t=null):(u=t,t=function(e,t,i){return u.call(C(e),i)})),t))for(;a<l;a++)t(e[a],i,o?n:n.call(e[a],a,t(e[a],i)));return r?e:u?t.call(e):l?t(e[0],i):s},q=/^-ms-/,Y=/-([a-z])/g;function V(e,t){return t.toUpperCase()}function X(e){return e.replace(q,"ms-").replace(Y,V)}var Z=function(e){return 1===e.nodeType||9===e.nodeType||!+e.nodeType};function K(){this.expando=C.expando+K.uid++}K.uid=1,K.prototype={cache:function(e){var t=e[this.expando];return t||(t={},Z(e)&&(e.nodeType?e[this.expando]=t:Object.defineProperty(e,this.expando,{value:t,configurable:!0}))),t},set:function(e,t,i){var n,r=this.cache(e);if("string"==typeof t)r[X(t)]=i;else for(n in t)r[X(n)]=t[n];return r},get:function(e,t){return void 0===t?this.cache(e):e[this.expando]&&e[this.expando][X(t)]},access:function(e,t,i){return void 0===t||t&&"string"==typeof t&&void 0===i?this.get(e,t):(this.set(e,t,i),void 0!==i?i:t)},remove:function(e,t){var i,n=e[this.expando];if(void 0!==n){if(void 0!==t){i=(t=Array.isArray(t)?t.map(X):(t=X(t))in n?[t]:t.match(L)||[]).length;for(;i--;)delete n[t[i]]}(void 0===t||C.isEmptyObject(n))&&(e.nodeType?e[this.expando]=void 0:delete e[this.expando])}},hasData:function(e){var t=e[this.expando];return void 0!==t&&!C.isEmptyObject(t)}};var J=new K,Q=new K,ee=/^(?:\{[\w\W]*\}|\[[\w\W]*\])$/,te=/[A-Z]/g;function ie(e,t,i){var n;if(void 0===i&&1===e.nodeType)if(n="data-"+t.replace(te,"-$&").toLowerCase(),"string"==typeof(i=e.getAttribute(n))){try{i=function(e){return"true"===e||"false"!==e&&("null"===e?null:e===+e+""?+e:ee.test(e)?JSON.parse(e):e)}(i)}catch(e){}Q.set(e,t,i)}else i=void 0;return i}C.extend({hasData:function(e){return Q.hasData(e)||J.hasData(e)},data:function(e,t,i){return Q.access(e,t,i)},removeData:function(e,t){Q.remove(e,t)},_data:function(e,t,i){return J.access(e,t,i)},_removeData:function(e,t){J.remove(e,t)}}),C.fn.extend({data:function(e,t){var i,n,r,s=this[0],o=s&&s.attributes;if(void 0===e){if(this.length&&(r=Q.get(s),1===s.nodeType&&!J.get(s,"hasDataAttrs"))){for(i=o.length;i--;)o[i]&&0===(n=o[i].name).indexOf("data-")&&(n=X(n.slice(5)),ie(s,n,r[n]));J.set(s,"hasDataAttrs",!0)}return r}return"object"==typeof e?this.each((function(){Q.set(this,e)})):G(this,(function(t){var i;if(s&&void 0===t)return void 0!==(i=Q.get(s,e))||void 0!==(i=ie(s,e))?i:void 0;this.each((function(){Q.set(this,e,t)}))}),null,t,arguments.length>1,null,!0)},removeData:function(e){return this.each((function(){Q.remove(this,e)}))}}),C.extend({queue:function(e,t,i){var n;if(e)return t=(t||"fx")+"queue",n=J.get(e,t),i&&(!n||Array.isArray(i)?n=J.access(e,t,C.makeArray(i)):n.push(i)),n||[]},dequeue:function(e,t){t=t||"fx";var i=C.queue(e,t),n=i.length,r=i.shift(),s=C._queueHooks(e,t);"inprogress"===r&&(r=i.shift(),n--),r&&("fx"===t&&i.unshift("inprogress"),delete s.stop,r.call(e,(function(){C.dequeue(e,t)}),s)),!n&&s&&s.empty.fire()},_queueHooks:function(e,t){var i=t+"queueHooks";return J.get(e,i)||J.access(e,i,{empty:C.Callbacks("once memory").add((function(){J.remove(e,[t+"queue",i])}))})}}),C.fn.extend({queue:function(e,t){var i=2;return"string"!=typeof e&&(t=e,e="fx",i--),arguments.length<i?C.queue(this[0],e):void 0===t?this:this.each((function(){var i=C.queue(this,e,t);C._queueHooks(this,e),"fx"===e&&"inprogress"!==i[0]&&C.dequeue(this,e)}))},dequeue:function(e){return this.each((function(){C.dequeue(this,e)}))},clearQueue:function(e){return this.queue(e||"fx",[])},promise:function(e,t){var i,n=1,r=C.Deferred(),s=this,o=this.length,a=function(){--n||r.resolveWith(s,[s])};for("string"!=typeof e&&(t=e,e=void 0),e=e||"fx";o--;)(i=J.get(s[o],e+"queueHooks"))&&i.empty&&(n++,i.empty.add(a));return a(),r.promise(t)}});var ne=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,re=new RegExp("^(?:([+-])=|)("+ne+")([a-z%]*)$","i"),se=["Top","Right","Bottom","Left"],oe=w.documentElement,ae=function(e){return C.contains(e.ownerDocument,e)},le={composed:!0};oe.getRootNode&&(ae=function(e){return C.contains(e.ownerDocument,e)||e.getRootNode(le)===e.ownerDocument});var ue=function(e,t){return"none"===(e=t||e).style.display||""===e.style.display&&ae(e)&&"none"===C.css(e,"display")};function ce(e,t,i,n){var r,s,o=20,a=n?function(){return n.cur()}:function(){return C.css(e,t,"")},l=a(),u=i&&i[3]||(C.cssNumber[t]?"":"px"),c=e.nodeType&&(C.cssNumber[t]||"px"!==u&&+l)&&re.exec(C.css(e,t));if(c&&c[3]!==u){for(l/=2,u=u||c[3],c=+l||1;o--;)C.style(e,t,c+u),(1-s)*(1-(s=a()/l||.5))<=0&&(o=0),c/=s;c*=2,C.style(e,t,c+u),i=i||[]}return i&&(c=+c||+l||0,r=i[1]?c+(i[1]+1)*i[2]:+i[2],n&&(n.unit=u,n.start=c,n.end=r)),r}var de={};function he(e){var t,i=e.ownerDocument,n=e.nodeName,r=de[n];return r||(t=i.body.appendChild(i.createElement(n)),r=C.css(t,"display"),t.parentNode.removeChild(t),"none"===r&&(r="block"),de[n]=r,r)}function pe(e,t){for(var i,n,r=[],s=0,o=e.length;s<o;s++)(n=e[s]).style&&(i=n.style.display,t?("none"===i&&(r[s]=J.get(n,"display")||null,r[s]||(n.style.display="")),""===n.style.display&&ue(n)&&(r[s]=he(n))):"none"!==i&&(r[s]="none",J.set(n,"display",i)));for(s=0;s<o;s++)null!=r[s]&&(e[s].style.display=r[s]);return e}C.fn.extend({show:function(){return pe(this,!0)},hide:function(){return pe(this)},toggle:function(e){return"boolean"==typeof e?e?this.show():this.hide():this.each((function(){ue(this)?C(this).show():C(this).hide()}))}});var fe,ge,me=/^(?:checkbox|radio)$/i,ve=/<([a-z][^\/\0>\x20\t\r\n\f]*)/i,ye=/^$|^module$|\/(?:java|ecma)script/i;fe=w.createDocumentFragment().appendChild(w.createElement("div")),(ge=w.createElement("input")).setAttribute("type","radio"),ge.setAttribute("checked","checked"),ge.setAttribute("name","t"),fe.appendChild(ge),m.checkClone=fe.cloneNode(!0).cloneNode(!0).lastChild.checked,fe.innerHTML="<textarea>x</textarea>",m.noCloneChecked=!!fe.cloneNode(!0).lastChild.defaultValue,fe.innerHTML="<option></option>",m.option=!!fe.lastChild;var we={thead:[1,"<table>","</table>"],col:[2,"<table><colgroup>","</colgroup></table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:[0,"",""]};function be(e,t){var i;return i=void 0!==e.getElementsByTagName?e.getElementsByTagName(t||"*"):void 0!==e.querySelectorAll?e.querySelectorAll(t||"*"):[],void 0===t||t&&D(e,t)?C.merge([e],i):i}function xe(e,t){for(var i=0,n=e.length;i<n;i++)J.set(e[i],"globalEval",!t||J.get(t[i],"globalEval"))}we.tbody=we.tfoot=we.colgroup=we.caption=we.thead,we.th=we.td,m.option||(we.optgroup=we.option=[1,"<select multiple='multiple'>","</select>"]);var _e=/<|&#?\w+;/;function ke(e,t,i,n,r){for(var s,o,a,l,u,c,d=t.createDocumentFragment(),h=[],p=0,f=e.length;p<f;p++)if((s=e[p])||0===s)if("object"===_(s))C.merge(h,s.nodeType?[s]:s);else if(_e.test(s)){for(o=o||d.appendChild(t.createElement("div")),a=(ve.exec(s)||["",""])[1].toLowerCase(),l=we[a]||we._default,o.innerHTML=l[1]+C.htmlPrefilter(s)+l[2],c=l[0];c--;)o=o.lastChild;C.merge(h,o.childNodes),(o=d.firstChild).textContent=""}else h.push(t.createTextNode(s));for(d.textContent="",p=0;s=h[p++];)if(n&&C.inArray(s,n)>-1)r&&r.push(s);else if(u=ae(s),o=be(d.appendChild(s),"script"),u&&xe(o),i)for(c=0;s=o[c++];)ye.test(s.type||"")&&i.push(s);return d}var Ce=/^([^.]*)(?:\.(.+)|)/;function Te(){return!0}function Se(){return!1}function Oe(e,t){return e===function(){try{return w.activeElement}catch(e){}}()==("focus"===t)}function Ee(e,t,i,n,r,s){var o,a;if("object"==typeof t){for(a in"string"!=typeof i&&(n=n||i,i=void 0),t)Ee(e,a,i,n,t[a],s);return e}if(null==n&&null==r?(r=i,n=i=void 0):null==r&&("string"==typeof i?(r=n,n=void 0):(r=n,n=i,i=void 0)),!1===r)r=Se;else if(!r)return e;return 1===s&&(o=r,r=function(e){return C().off(e),o.apply(this,arguments)},r.guid=o.guid||(o.guid=C.guid++)),e.each((function(){C.event.add(this,t,r,n,i)}))}function Ie(e,t,i){i?(J.set(e,t,!1),C.event.add(e,t,{namespace:!1,handler:function(e){var n,r,s=J.get(this,t);if(1&e.isTrigger&&this[t]){if(s.length)(C.event.special[t]||{}).delegateType&&e.stopPropagation();else if(s=a.call(arguments),J.set(this,t,s),n=i(this,t),this[t](),s!==(r=J.get(this,t))||n?J.set(this,t,!1):r={},s!==r)return e.stopImmediatePropagation(),e.preventDefault(),r&&r.value}else s.length&&(J.set(this,t,{value:C.event.trigger(C.extend(s[0],C.Event.prototype),s.slice(1),this)}),e.stopImmediatePropagation())}})):void 0===J.get(e,t)&&C.event.add(e,t,Te)}C.event={global:{},add:function(e,t,i,n,r){var s,o,a,l,u,c,d,h,p,f,g,m=J.get(e);if(Z(e))for(i.handler&&(i=(s=i).handler,r=s.selector),r&&C.find.matchesSelector(oe,r),i.guid||(i.guid=C.guid++),(l=m.events)||(l=m.events=Object.create(null)),(o=m.handle)||(o=m.handle=function(t){return void 0!==C&&C.event.triggered!==t.type?C.event.dispatch.apply(e,arguments):void 0}),u=(t=(t||"").match(L)||[""]).length;u--;)p=g=(a=Ce.exec(t[u])||[])[1],f=(a[2]||"").split(".").sort(),p&&(d=C.event.special[p]||{},p=(r?d.delegateType:d.bindType)||p,d=C.event.special[p]||{},c=C.extend({type:p,origType:g,data:n,handler:i,guid:i.guid,selector:r,needsContext:r&&C.expr.match.needsContext.test(r),namespace:f.join(".")},s),(h=l[p])||((h=l[p]=[]).delegateCount=0,d.setup&&!1!==d.setup.call(e,n,f,o)||e.addEventListener&&e.addEventListener(p,o)),d.add&&(d.add.call(e,c),c.handler.guid||(c.handler.guid=i.guid)),r?h.splice(h.delegateCount++,0,c):h.push(c),C.event.global[p]=!0)},remove:function(e,t,i,n,r){var s,o,a,l,u,c,d,h,p,f,g,m=J.hasData(e)&&J.get(e);if(m&&(l=m.events)){for(u=(t=(t||"").match(L)||[""]).length;u--;)if(p=g=(a=Ce.exec(t[u])||[])[1],f=(a[2]||"").split(".").sort(),p){for(d=C.event.special[p]||{},h=l[p=(n?d.delegateType:d.bindType)||p]||[],a=a[2]&&new RegExp("(^|\\.)"+f.join("\\.(?:.*\\.|)")+"(\\.|$)"),o=s=h.length;s--;)c=h[s],!r&&g!==c.origType||i&&i.guid!==c.guid||a&&!a.test(c.namespace)||n&&n!==c.selector&&("**"!==n||!c.selector)||(h.splice(s,1),c.selector&&h.delegateCount--,d.remove&&d.remove.call(e,c));o&&!h.length&&(d.teardown&&!1!==d.teardown.call(e,f,m.handle)||C.removeEvent(e,p,m.handle),delete l[p])}else for(p in l)C.event.remove(e,p+t[u],i,n,!0);C.isEmptyObject(l)&&J.remove(e,"handle events")}},dispatch:function(e){var t,i,n,r,s,o,a=new Array(arguments.length),l=C.event.fix(e),u=(J.get(this,"events")||Object.create(null))[l.type]||[],c=C.event.special[l.type]||{};for(a[0]=l,t=1;t<arguments.length;t++)a[t]=arguments[t];if(l.delegateTarget=this,!c.preDispatch||!1!==c.preDispatch.call(this,l)){for(o=C.event.handlers.call(this,l,u),t=0;(r=o[t++])&&!l.isPropagationStopped();)for(l.currentTarget=r.elem,i=0;(s=r.handlers[i++])&&!l.isImmediatePropagationStopped();)l.rnamespace&&!1!==s.namespace&&!l.rnamespace.test(s.namespace)||(l.handleObj=s,l.data=s.data,void 0!==(n=((C.event.special[s.origType]||{}).handle||s.handler).apply(r.elem,a))&&!1===(l.result=n)&&(l.preventDefault(),l.stopPropagation()));return c.postDispatch&&c.postDispatch.call(this,l),l.result}},handlers:function(e,t){var i,n,r,s,o,a=[],l=t.delegateCount,u=e.target;if(l&&u.nodeType&&!("click"===e.type&&e.button>=1))for(;u!==this;u=u.parentNode||this)if(1===u.nodeType&&("click"!==e.type||!0!==u.disabled)){for(s=[],o={},i=0;i<l;i++)void 0===o[r=(n=t[i]).selector+" "]&&(o[r]=n.needsContext?C(r,this).index(u)>-1:C.find(r,this,null,[u]).length),o[r]&&s.push(n);s.length&&a.push({elem:u,handlers:s})}return u=this,l<t.length&&a.push({elem:u,handlers:t.slice(l)}),a},addProp:function(e,t){Object.defineProperty(C.Event.prototype,e,{enumerable:!0,configurable:!0,get:v(t)?function(){if(this.originalEvent)return t(this.originalEvent)}:function(){if(this.originalEvent)return this.originalEvent[e]},set:function(t){Object.defineProperty(this,e,{enumerable:!0,configurable:!0,writable:!0,value:t})}})},fix:function(e){return e[C.expando]?e:new C.Event(e)},special:{load:{noBubble:!0},click:{setup:function(e){var t=this||e;return me.test(t.type)&&t.click&&D(t,"input")&&Ie(t,"click",Te),!1},trigger:function(e){var t=this||e;return me.test(t.type)&&t.click&&D(t,"input")&&Ie(t,"click"),!0},_default:function(e){var t=e.target;return me.test(t.type)&&t.click&&D(t,"input")&&J.get(t,"click")||D(t,"a")}},beforeunload:{postDispatch:function(e){void 0!==e.result&&e.originalEvent&&(e.originalEvent.returnValue=e.result)}}}},C.removeEvent=function(e,t,i){e.removeEventListener&&e.removeEventListener(t,i)},C.Event=function(e,t){if(!(this instanceof C.Event))return new C.Event(e,t);e&&e.type?(this.originalEvent=e,this.type=e.type,this.isDefaultPrevented=e.defaultPrevented||void 0===e.defaultPrevented&&!1===e.returnValue?Te:Se,this.target=e.target&&3===e.target.nodeType?e.target.parentNode:e.target,this.currentTarget=e.currentTarget,this.relatedTarget=e.relatedTarget):this.type=e,t&&C.extend(this,t),this.timeStamp=e&&e.timeStamp||Date.now(),this[C.expando]=!0},C.Event.prototype={constructor:C.Event,isDefaultPrevented:Se,isPropagationStopped:Se,isImmediatePropagationStopped:Se,isSimulated:!1,preventDefault:function(){var e=this.originalEvent;this.isDefaultPrevented=Te,e&&!this.isSimulated&&e.preventDefault()},stopPropagation:function(){var e=this.originalEvent;this.isPropagationStopped=Te,e&&!this.isSimulated&&e.stopPropagation()},stopImmediatePropagation:function(){var e=this.originalEvent;this.isImmediatePropagationStopped=Te,e&&!this.isSimulated&&e.stopImmediatePropagation(),this.stopPropagation()}},C.each({altKey:!0,bubbles:!0,cancelable:!0,changedTouches:!0,ctrlKey:!0,detail:!0,eventPhase:!0,metaKey:!0,pageX:!0,pageY:!0,shiftKey:!0,view:!0,char:!0,code:!0,charCode:!0,key:!0,keyCode:!0,button:!0,buttons:!0,clientX:!0,clientY:!0,offsetX:!0,offsetY:!0,pointerId:!0,pointerType:!0,screenX:!0,screenY:!0,targetTouches:!0,toElement:!0,touches:!0,which:!0},C.event.addProp),C.each({focus:"focusin",blur:"focusout"},(function(e,t){C.event.special[e]={setup:function(){return Ie(this,e,Oe),!1},trigger:function(){return Ie(this,e),!0},_default:function(t){return J.get(t.target,e)},delegateType:t}})),C.each({mouseenter:"mouseover",mouseleave:"mouseout",pointerenter:"pointerover",pointerleave:"pointerout"},(function(e,t){C.event.special[e]={delegateType:t,bindType:t,handle:function(e){var i,n=this,r=e.relatedTarget,s=e.handleObj;return r&&(r===n||C.contains(n,r))||(e.type=s.origType,i=s.handler.apply(this,arguments),e.type=t),i}}})),C.fn.extend({on:function(e,t,i,n){return Ee(this,e,t,i,n)},one:function(e,t,i,n){return Ee(this,e,t,i,n,1)},off:function(e,t,i){var n,r;if(e&&e.preventDefault&&e.handleObj)return n=e.handleObj,C(e.delegateTarget).off(n.namespace?n.origType+"."+n.namespace:n.origType,n.selector,n.handler),this;if("object"==typeof e){for(r in e)this.off(r,t,e[r]);return this}return!1!==t&&"function"!=typeof t||(i=t,t=void 0),!1===i&&(i=Se),this.each((function(){C.event.remove(this,e,i,t)}))}});var De=/<script|<style|<link/i,ze=/checked\s*(?:[^=]|=\s*.checked.)/i,Ae=/^\s*<!\[CDATA\[|\]\]>\s*$/g;function Pe(e,t){return D(e,"table")&&D(11!==t.nodeType?t:t.firstChild,"tr")&&C(e).children("tbody")[0]||e}function Re(e){return e.type=(null!==e.getAttribute("type"))+"/"+e.type,e}function je(e){return"true/"===(e.type||"").slice(0,5)?e.type=e.type.slice(5):e.removeAttribute("type"),e}function $e(e,t){var i,n,r,s,o,a;if(1===t.nodeType){if(J.hasData(e)&&(a=J.get(e).events))for(r in J.remove(t,"handle events"),a)for(i=0,n=a[r].length;i<n;i++)C.event.add(t,r,a[r][i]);Q.hasData(e)&&(s=Q.access(e),o=C.extend({},s),Q.set(t,o))}}function Me(e,t){var i=t.nodeName.toLowerCase();"input"===i&&me.test(e.type)?t.checked=e.checked:"input"!==i&&"textarea"!==i||(t.defaultValue=e.defaultValue)}function Le(e,t,i,n){t=l(t);var r,s,o,a,u,c,d=0,h=e.length,p=h-1,f=t[0],g=v(f);if(g||h>1&&"string"==typeof f&&!m.checkClone&&ze.test(f))return e.each((function(r){var s=e.eq(r);g&&(t[0]=f.call(this,r,s.html())),Le(s,t,i,n)}));if(h&&(s=(r=ke(t,e[0].ownerDocument,!1,e,n)).firstChild,1===r.childNodes.length&&(r=s),s||n)){for(a=(o=C.map(be(r,"script"),Re)).length;d<h;d++)u=r,d!==p&&(u=C.clone(u,!0,!0),a&&C.merge(o,be(u,"script"))),i.call(e[d],u,d);if(a)for(c=o[o.length-1].ownerDocument,C.map(o,je),d=0;d<a;d++)u=o[d],ye.test(u.type||"")&&!J.access(u,"globalEval")&&C.contains(c,u)&&(u.src&&"module"!==(u.type||"").toLowerCase()?C._evalUrl&&!u.noModule&&C._evalUrl(u.src,{nonce:u.nonce||u.getAttribute("nonce")},c):x(u.textContent.replace(Ae,""),u,c))}return e}function Fe(e,t,i){for(var n,r=t?C.filter(t,e):e,s=0;null!=(n=r[s]);s++)i||1!==n.nodeType||C.cleanData(be(n)),n.parentNode&&(i&&ae(n)&&xe(be(n,"script")),n.parentNode.removeChild(n));return e}C.extend({htmlPrefilter:function(e){return e},clone:function(e,t,i){var n,r,s,o,a=e.cloneNode(!0),l=ae(e);if(!(m.noCloneChecked||1!==e.nodeType&&11!==e.nodeType||C.isXMLDoc(e)))for(o=be(a),n=0,r=(s=be(e)).length;n<r;n++)Me(s[n],o[n]);if(t)if(i)for(s=s||be(e),o=o||be(a),n=0,r=s.length;n<r;n++)$e(s[n],o[n]);else $e(e,a);return(o=be(a,"script")).length>0&&xe(o,!l&&be(e,"script")),a},cleanData:function(e){for(var t,i,n,r=C.event.special,s=0;void 0!==(i=e[s]);s++)if(Z(i)){if(t=i[J.expando]){if(t.events)for(n in t.events)r[n]?C.event.remove(i,n):C.removeEvent(i,n,t.handle);i[J.expando]=void 0}i[Q.expando]&&(i[Q.expando]=void 0)}}}),C.fn.extend({detach:function(e){return Fe(this,e,!0)},remove:function(e){return Fe(this,e)},text:function(e){return G(this,(function(e){return void 0===e?C.text(this):this.empty().each((function(){1!==this.nodeType&&11!==this.nodeType&&9!==this.nodeType||(this.textContent=e)}))}),null,e,arguments.length)},append:function(){return Le(this,arguments,(function(e){1!==this.nodeType&&11!==this.nodeType&&9!==this.nodeType||Pe(this,e).appendChild(e)}))},prepend:function(){return Le(this,arguments,(function(e){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var t=Pe(this,e);t.insertBefore(e,t.firstChild)}}))},before:function(){return Le(this,arguments,(function(e){this.parentNode&&this.parentNode.insertBefore(e,this)}))},after:function(){return Le(this,arguments,(function(e){this.parentNode&&this.parentNode.insertBefore(e,this.nextSibling)}))},empty:function(){for(var e,t=0;null!=(e=this[t]);t++)1===e.nodeType&&(C.cleanData(be(e,!1)),e.textContent="");return this},clone:function(e,t){return e=null!=e&&e,t=null==t?e:t,this.map((function(){return C.clone(this,e,t)}))},html:function(e){return G(this,(function(e){var t=this[0]||{},i=0,n=this.length;if(void 0===e&&1===t.nodeType)return t.innerHTML;if("string"==typeof e&&!De.test(e)&&!we[(ve.exec(e)||["",""])[1].toLowerCase()]){e=C.htmlPrefilter(e);try{for(;i<n;i++)1===(t=this[i]||{}).nodeType&&(C.cleanData(be(t,!1)),t.innerHTML=e);t=0}catch(e){}}t&&this.empty().append(e)}),null,e,arguments.length)},replaceWith:function(){var e=[];return Le(this,arguments,(function(t){var i=this.parentNode;C.inArray(this,e)<0&&(C.cleanData(be(this)),i&&i.replaceChild(t,this))}),e)}}),C.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},(function(e,t){C.fn[e]=function(e){for(var i,n=[],r=C(e),s=r.length-1,o=0;o<=s;o++)i=o===s?this:this.clone(!0),C(r[o])[t](i),u.apply(n,i.get());return this.pushStack(n)}}));var Ne=new RegExp("^("+ne+")(?!px)[a-z%]+$","i"),Be=/^--/,He=function(e){var t=e.ownerDocument.defaultView;return t&&t.opener||(t=n),t.getComputedStyle(e)},We=function(e,t,i){var n,r,s={};for(r in t)s[r]=e.style[r],e.style[r]=t[r];for(r in n=i.call(e),t)e.style[r]=s[r];return n},Ue=new RegExp(se.join("|"),"i"),Ge=new RegExp("^[\\x20\\t\\r\\n\\f]+|((?:^|[^\\\\])(?:\\\\.)*)[\\x20\\t\\r\\n\\f]+$","g");function qe(e,t,i){var n,r,s,o,a=Be.test(t),l=e.style;return(i=i||He(e))&&(o=i.getPropertyValue(t)||i[t],a&&(o=o.replace(Ge,"$1")),""!==o||ae(e)||(o=C.style(e,t)),!m.pixelBoxStyles()&&Ne.test(o)&&Ue.test(t)&&(n=l.width,r=l.minWidth,s=l.maxWidth,l.minWidth=l.maxWidth=l.width=o,o=i.width,l.width=n,l.minWidth=r,l.maxWidth=s)),void 0!==o?o+"":o}function Ye(e,t){return{get:function(){if(!e())return(this.get=t).apply(this,arguments);delete this.get}}}!function(){function e(){if(c){u.style.cssText="position:absolute;left:-11111px;width:60px;margin-top:1px;padding:0;border:0",c.style.cssText="position:relative;display:block;box-sizing:border-box;overflow:scroll;margin:auto;border:1px;padding:1px;width:60%;top:1%",oe.appendChild(u).appendChild(c);var e=n.getComputedStyle(c);i="1%"!==e.top,l=12===t(e.marginLeft),c.style.right="60%",o=36===t(e.right),r=36===t(e.width),c.style.position="absolute",s=12===t(c.offsetWidth/3),oe.removeChild(u),c=null}}function t(e){return Math.round(parseFloat(e))}var i,r,s,o,a,l,u=w.createElement("div"),c=w.createElement("div");c.style&&(c.style.backgroundClip="content-box",c.cloneNode(!0).style.backgroundClip="",m.clearCloneStyle="content-box"===c.style.backgroundClip,C.extend(m,{boxSizingReliable:function(){return e(),r},pixelBoxStyles:function(){return e(),o},pixelPosition:function(){return e(),i},reliableMarginLeft:function(){return e(),l},scrollboxSize:function(){return e(),s},reliableTrDimensions:function(){var e,t,i,r;return null==a&&(e=w.createElement("table"),t=w.createElement("tr"),i=w.createElement("div"),e.style.cssText="position:absolute;left:-11111px;border-collapse:separate",t.style.cssText="border:1px solid",t.style.height="1px",i.style.height="9px",i.style.display="block",oe.appendChild(e).appendChild(t).appendChild(i),r=n.getComputedStyle(t),a=parseInt(r.height,10)+parseInt(r.borderTopWidth,10)+parseInt(r.borderBottomWidth,10)===t.offsetHeight,oe.removeChild(e)),a}}))}();var Ve=["Webkit","Moz","ms"],Xe=w.createElement("div").style,Ze={};function Ke(e){return C.cssProps[e]||Ze[e]||(e in Xe?e:Ze[e]=function(e){for(var t=e[0].toUpperCase()+e.slice(1),i=Ve.length;i--;)if((e=Ve[i]+t)in Xe)return e}(e)||e)}var Je=/^(none|table(?!-c[ea]).+)/,Qe={position:"absolute",visibility:"hidden",display:"block"},et={letterSpacing:"0",fontWeight:"400"};function tt(e,t,i){var n=re.exec(t);return n?Math.max(0,n[2]-(i||0))+(n[3]||"px"):t}function it(e,t,i,n,r,s){var o="width"===t?1:0,a=0,l=0;if(i===(n?"border":"content"))return 0;for(;o<4;o+=2)"margin"===i&&(l+=C.css(e,i+se[o],!0,r)),n?("content"===i&&(l-=C.css(e,"padding"+se[o],!0,r)),"margin"!==i&&(l-=C.css(e,"border"+se[o]+"Width",!0,r))):(l+=C.css(e,"padding"+se[o],!0,r),"padding"!==i?l+=C.css(e,"border"+se[o]+"Width",!0,r):a+=C.css(e,"border"+se[o]+"Width",!0,r));return!n&&s>=0&&(l+=Math.max(0,Math.ceil(e["offset"+t[0].toUpperCase()+t.slice(1)]-s-l-a-.5))||0),l}function nt(e,t,i){var n=He(e),r=(!m.boxSizingReliable()||i)&&"border-box"===C.css(e,"boxSizing",!1,n),s=r,o=qe(e,t,n),a="offset"+t[0].toUpperCase()+t.slice(1);if(Ne.test(o)){if(!i)return o;o="auto"}return(!m.boxSizingReliable()&&r||!m.reliableTrDimensions()&&D(e,"tr")||"auto"===o||!parseFloat(o)&&"inline"===C.css(e,"display",!1,n))&&e.getClientRects().length&&(r="border-box"===C.css(e,"boxSizing",!1,n),(s=a in e)&&(o=e[a])),(o=parseFloat(o)||0)+it(e,t,i||(r?"border":"content"),s,n,o)+"px"}function rt(e,t,i,n,r){return new rt.prototype.init(e,t,i,n,r)}C.extend({cssHooks:{opacity:{get:function(e,t){if(t){var i=qe(e,"opacity");return""===i?"1":i}}}},cssNumber:{animationIterationCount:!0,columnCount:!0,fillOpacity:!0,flexGrow:!0,flexShrink:!0,fontWeight:!0,gridArea:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnStart:!0,gridRow:!0,gridRowEnd:!0,gridRowStart:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{},style:function(e,t,i,n){if(e&&3!==e.nodeType&&8!==e.nodeType&&e.style){var r,s,o,a=X(t),l=Be.test(t),u=e.style;if(l||(t=Ke(a)),o=C.cssHooks[t]||C.cssHooks[a],void 0===i)return o&&"get"in o&&void 0!==(r=o.get(e,!1,n))?r:u[t];"string"==(s=typeof i)&&(r=re.exec(i))&&r[1]&&(i=ce(e,t,r),s="number"),null!=i&&i==i&&("number"!==s||l||(i+=r&&r[3]||(C.cssNumber[a]?"":"px")),m.clearCloneStyle||""!==i||0!==t.indexOf("background")||(u[t]="inherit"),o&&"set"in o&&void 0===(i=o.set(e,i,n))||(l?u.setProperty(t,i):u[t]=i))}},css:function(e,t,i,n){var r,s,o,a=X(t);return Be.test(t)||(t=Ke(a)),(o=C.cssHooks[t]||C.cssHooks[a])&&"get"in o&&(r=o.get(e,!0,i)),void 0===r&&(r=qe(e,t,n)),"normal"===r&&t in et&&(r=et[t]),""===i||i?(s=parseFloat(r),!0===i||isFinite(s)?s||0:r):r}}),C.each(["height","width"],(function(e,t){C.cssHooks[t]={get:function(e,i,n){if(i)return!Je.test(C.css(e,"display"))||e.getClientRects().length&&e.getBoundingClientRect().width?nt(e,t,n):We(e,Qe,(function(){return nt(e,t,n)}))},set:function(e,i,n){var r,s=He(e),o=!m.scrollboxSize()&&"absolute"===s.position,a=(o||n)&&"border-box"===C.css(e,"boxSizing",!1,s),l=n?it(e,t,n,a,s):0;return a&&o&&(l-=Math.ceil(e["offset"+t[0].toUpperCase()+t.slice(1)]-parseFloat(s[t])-it(e,t,"border",!1,s)-.5)),l&&(r=re.exec(i))&&"px"!==(r[3]||"px")&&(e.style[t]=i,i=C.css(e,t)),tt(0,i,l)}}})),C.cssHooks.marginLeft=Ye(m.reliableMarginLeft,(function(e,t){if(t)return(parseFloat(qe(e,"marginLeft"))||e.getBoundingClientRect().left-We(e,{marginLeft:0},(function(){return e.getBoundingClientRect().left})))+"px"})),C.each({margin:"",padding:"",border:"Width"},(function(e,t){C.cssHooks[e+t]={expand:function(i){for(var n=0,r={},s="string"==typeof i?i.split(" "):[i];n<4;n++)r[e+se[n]+t]=s[n]||s[n-2]||s[0];return r}},"margin"!==e&&(C.cssHooks[e+t].set=tt)})),C.fn.extend({css:function(e,t){return G(this,(function(e,t,i){var n,r,s={},o=0;if(Array.isArray(t)){for(n=He(e),r=t.length;o<r;o++)s[t[o]]=C.css(e,t[o],!1,n);return s}return void 0!==i?C.style(e,t,i):C.css(e,t)}),e,t,arguments.length>1)}}),C.Tween=rt,rt.prototype={constructor:rt,init:function(e,t,i,n,r,s){this.elem=e,this.prop=i,this.easing=r||C.easing._default,this.options=t,this.start=this.now=this.cur(),this.end=n,this.unit=s||(C.cssNumber[i]?"":"px")},cur:function(){var e=rt.propHooks[this.prop];return e&&e.get?e.get(this):rt.propHooks._default.get(this)},run:function(e){var t,i=rt.propHooks[this.prop];return this.options.duration?this.pos=t=C.easing[this.easing](e,this.options.duration*e,0,1,this.options.duration):this.pos=t=e,this.now=(this.end-this.start)*t+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),i&&i.set?i.set(this):rt.propHooks._default.set(this),this}},rt.prototype.init.prototype=rt.prototype,rt.propHooks={_default:{get:function(e){var t;return 1!==e.elem.nodeType||null!=e.elem[e.prop]&&null==e.elem.style[e.prop]?e.elem[e.prop]:(t=C.css(e.elem,e.prop,""))&&"auto"!==t?t:0},set:function(e){C.fx.step[e.prop]?C.fx.step[e.prop](e):1!==e.elem.nodeType||!C.cssHooks[e.prop]&&null==e.elem.style[Ke(e.prop)]?e.elem[e.prop]=e.now:C.style(e.elem,e.prop,e.now+e.unit)}}},rt.propHooks.scrollTop=rt.propHooks.scrollLeft={set:function(e){e.elem.nodeType&&e.elem.parentNode&&(e.elem[e.prop]=e.now)}},C.easing={linear:function(e){return e},swing:function(e){return.5-Math.cos(e*Math.PI)/2},_default:"swing"},C.fx=rt.prototype.init,C.fx.step={};var st,ot,at=/^(?:toggle|show|hide)$/,lt=/queueHooks$/;function ut(){ot&&(!1===w.hidden&&n.requestAnimationFrame?n.requestAnimationFrame(ut):n.setTimeout(ut,C.fx.interval),C.fx.tick())}function ct(){return n.setTimeout((function(){st=void 0})),st=Date.now()}function dt(e,t){var i,n=0,r={height:e};for(t=t?1:0;n<4;n+=2-t)r["margin"+(i=se[n])]=r["padding"+i]=e;return t&&(r.opacity=r.width=e),r}function ht(e,t,i){for(var n,r=(pt.tweeners[t]||[]).concat(pt.tweeners["*"]),s=0,o=r.length;s<o;s++)if(n=r[s].call(i,t,e))return n}function pt(e,t,i){var n,r,s=0,o=pt.prefilters.length,a=C.Deferred().always((function(){delete l.elem})),l=function(){if(r)return!1;for(var t=st||ct(),i=Math.max(0,u.startTime+u.duration-t),n=1-(i/u.duration||0),s=0,o=u.tweens.length;s<o;s++)u.tweens[s].run(n);return a.notifyWith(e,[u,n,i]),n<1&&o?i:(o||a.notifyWith(e,[u,1,0]),a.resolveWith(e,[u]),!1)},u=a.promise({elem:e,props:C.extend({},t),opts:C.extend(!0,{specialEasing:{},easing:C.easing._default},i),originalProperties:t,originalOptions:i,startTime:st||ct(),duration:i.duration,tweens:[],createTween:function(t,i){var n=C.Tween(e,u.opts,t,i,u.opts.specialEasing[t]||u.opts.easing);return u.tweens.push(n),n},stop:function(t){var i=0,n=t?u.tweens.length:0;if(r)return this;for(r=!0;i<n;i++)u.tweens[i].run(1);return t?(a.notifyWith(e,[u,1,0]),a.resolveWith(e,[u,t])):a.rejectWith(e,[u,t]),this}}),c=u.props;for(function(e,t){var i,n,r,s,o;for(i in e)if(r=t[n=X(i)],s=e[i],Array.isArray(s)&&(r=s[1],s=e[i]=s[0]),i!==n&&(e[n]=s,delete e[i]),(o=C.cssHooks[n])&&"expand"in o)for(i in s=o.expand(s),delete e[n],s)i in e||(e[i]=s[i],t[i]=r);else t[n]=r}(c,u.opts.specialEasing);s<o;s++)if(n=pt.prefilters[s].call(u,e,c,u.opts))return v(n.stop)&&(C._queueHooks(u.elem,u.opts.queue).stop=n.stop.bind(n)),n;return C.map(c,ht,u),v(u.opts.start)&&u.opts.start.call(e,u),u.progress(u.opts.progress).done(u.opts.done,u.opts.complete).fail(u.opts.fail).always(u.opts.always),C.fx.timer(C.extend(l,{elem:e,anim:u,queue:u.opts.queue})),u}C.Animation=C.extend(pt,{tweeners:{"*":[function(e,t){var i=this.createTween(e,t);return ce(i.elem,e,re.exec(t),i),i}]},tweener:function(e,t){v(e)?(t=e,e=["*"]):e=e.match(L);for(var i,n=0,r=e.length;n<r;n++)i=e[n],pt.tweeners[i]=pt.tweeners[i]||[],pt.tweeners[i].unshift(t)},prefilters:[function(e,t,i){var n,r,s,o,a,l,u,c,d="width"in t||"height"in t,h=this,p={},f=e.style,g=e.nodeType&&ue(e),m=J.get(e,"fxshow");for(n in i.queue||(null==(o=C._queueHooks(e,"fx")).unqueued&&(o.unqueued=0,a=o.empty.fire,o.empty.fire=function(){o.unqueued||a()}),o.unqueued++,h.always((function(){h.always((function(){o.unqueued--,C.queue(e,"fx").length||o.empty.fire()}))}))),t)if(r=t[n],at.test(r)){if(delete t[n],s=s||"toggle"===r,r===(g?"hide":"show")){if("show"!==r||!m||void 0===m[n])continue;g=!0}p[n]=m&&m[n]||C.style(e,n)}if((l=!C.isEmptyObject(t))||!C.isEmptyObject(p))for(n in d&&1===e.nodeType&&(i.overflow=[f.overflow,f.overflowX,f.overflowY],null==(u=m&&m.display)&&(u=J.get(e,"display")),"none"===(c=C.css(e,"display"))&&(u?c=u:(pe([e],!0),u=e.style.display||u,c=C.css(e,"display"),pe([e]))),("inline"===c||"inline-block"===c&&null!=u)&&"none"===C.css(e,"float")&&(l||(h.done((function(){f.display=u})),null==u&&(c=f.display,u="none"===c?"":c)),f.display="inline-block")),i.overflow&&(f.overflow="hidden",h.always((function(){f.overflow=i.overflow[0],f.overflowX=i.overflow[1],f.overflowY=i.overflow[2]}))),l=!1,p)l||(m?"hidden"in m&&(g=m.hidden):m=J.access(e,"fxshow",{display:u}),s&&(m.hidden=!g),g&&pe([e],!0),h.done((function(){for(n in g||pe([e]),J.remove(e,"fxshow"),p)C.style(e,n,p[n])}))),l=ht(g?m[n]:0,n,h),n in m||(m[n]=l.start,g&&(l.end=l.start,l.start=0))}],prefilter:function(e,t){t?pt.prefilters.unshift(e):pt.prefilters.push(e)}}),C.speed=function(e,t,i){var n=e&&"object"==typeof e?C.extend({},e):{complete:i||!i&&t||v(e)&&e,duration:e,easing:i&&t||t&&!v(t)&&t};return C.fx.off?n.duration=0:"number"!=typeof n.duration&&(n.duration in C.fx.speeds?n.duration=C.fx.speeds[n.duration]:n.duration=C.fx.speeds._default),null!=n.queue&&!0!==n.queue||(n.queue="fx"),n.old=n.complete,n.complete=function(){v(n.old)&&n.old.call(this),n.queue&&C.dequeue(this,n.queue)},n},C.fn.extend({fadeTo:function(e,t,i,n){return this.filter(ue).css("opacity",0).show().end().animate({opacity:t},e,i,n)},animate:function(e,t,i,n){var r=C.isEmptyObject(e),s=C.speed(t,i,n),o=function(){var t=pt(this,C.extend({},e),s);(r||J.get(this,"finish"))&&t.stop(!0)};return o.finish=o,r||!1===s.queue?this.each(o):this.queue(s.queue,o)},stop:function(e,t,i){var n=function(e){var t=e.stop;delete e.stop,t(i)};return"string"!=typeof e&&(i=t,t=e,e=void 0),t&&this.queue(e||"fx",[]),this.each((function(){var t=!0,r=null!=e&&e+"queueHooks",s=C.timers,o=J.get(this);if(r)o[r]&&o[r].stop&&n(o[r]);else for(r in o)o[r]&&o[r].stop&&lt.test(r)&&n(o[r]);for(r=s.length;r--;)s[r].elem!==this||null!=e&&s[r].queue!==e||(s[r].anim.stop(i),t=!1,s.splice(r,1));!t&&i||C.dequeue(this,e)}))},finish:function(e){return!1!==e&&(e=e||"fx"),this.each((function(){var t,i=J.get(this),n=i[e+"queue"],r=i[e+"queueHooks"],s=C.timers,o=n?n.length:0;for(i.finish=!0,C.queue(this,e,[]),r&&r.stop&&r.stop.call(this,!0),t=s.length;t--;)s[t].elem===this&&s[t].queue===e&&(s[t].anim.stop(!0),s.splice(t,1));for(t=0;t<o;t++)n[t]&&n[t].finish&&n[t].finish.call(this);delete i.finish}))}}),C.each(["toggle","show","hide"],(function(e,t){var i=C.fn[t];C.fn[t]=function(e,n,r){return null==e||"boolean"==typeof e?i.apply(this,arguments):this.animate(dt(t,!0),e,n,r)}})),C.each({slideDown:dt("show"),slideUp:dt("hide"),slideToggle:dt("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},(function(e,t){C.fn[e]=function(e,i,n){return this.animate(t,e,i,n)}})),C.timers=[],C.fx.tick=function(){var e,t=0,i=C.timers;for(st=Date.now();t<i.length;t++)(e=i[t])()||i[t]!==e||i.splice(t--,1);i.length||C.fx.stop(),st=void 0},C.fx.timer=function(e){C.timers.push(e),C.fx.start()},C.fx.interval=13,C.fx.start=function(){ot||(ot=!0,ut())},C.fx.stop=function(){ot=null},C.fx.speeds={slow:600,fast:200,_default:400},C.fn.delay=function(e,t){return e=C.fx&&C.fx.speeds[e]||e,t=t||"fx",this.queue(t,(function(t,i){var r=n.setTimeout(t,e);i.stop=function(){n.clearTimeout(r)}}))},function(){var e=w.createElement("input"),t=w.createElement("select").appendChild(w.createElement("option"));e.type="checkbox",m.checkOn=""!==e.value,m.optSelected=t.selected,(e=w.createElement("input")).value="t",e.type="radio",m.radioValue="t"===e.value}();var ft,gt=C.expr.attrHandle;C.fn.extend({attr:function(e,t){return G(this,C.attr,e,t,arguments.length>1)},removeAttr:function(e){return this.each((function(){C.removeAttr(this,e)}))}}),C.extend({attr:function(e,t,i){var n,r,s=e.nodeType;if(3!==s&&8!==s&&2!==s)return void 0===e.getAttribute?C.prop(e,t,i):(1===s&&C.isXMLDoc(e)||(r=C.attrHooks[t.toLowerCase()]||(C.expr.match.bool.test(t)?ft:void 0)),void 0!==i?null===i?void C.removeAttr(e,t):r&&"set"in r&&void 0!==(n=r.set(e,i,t))?n:(e.setAttribute(t,i+""),i):r&&"get"in r&&null!==(n=r.get(e,t))?n:null==(n=C.find.attr(e,t))?void 0:n)},attrHooks:{type:{set:function(e,t){if(!m.radioValue&&"radio"===t&&D(e,"input")){var i=e.value;return e.setAttribute("type",t),i&&(e.value=i),t}}}},removeAttr:function(e,t){var i,n=0,r=t&&t.match(L);if(r&&1===e.nodeType)for(;i=r[n++];)e.removeAttribute(i)}}),ft={set:function(e,t,i){return!1===t?C.removeAttr(e,i):e.setAttribute(i,i),i}},C.each(C.expr.match.bool.source.match(/\w+/g),(function(e,t){var i=gt[t]||C.find.attr;gt[t]=function(e,t,n){var r,s,o=t.toLowerCase();return n||(s=gt[o],gt[o]=r,r=null!=i(e,t,n)?o:null,gt[o]=s),r}}));var mt=/^(?:input|select|textarea|button)$/i,vt=/^(?:a|area)$/i;function yt(e){return(e.match(L)||[]).join(" ")}function wt(e){return e.getAttribute&&e.getAttribute("class")||""}function bt(e){return Array.isArray(e)?e:"string"==typeof e&&e.match(L)||[]}C.fn.extend({prop:function(e,t){return G(this,C.prop,e,t,arguments.length>1)},removeProp:function(e){return this.each((function(){delete this[C.propFix[e]||e]}))}}),C.extend({prop:function(e,t,i){var n,r,s=e.nodeType;if(3!==s&&8!==s&&2!==s)return 1===s&&C.isXMLDoc(e)||(t=C.propFix[t]||t,r=C.propHooks[t]),void 0!==i?r&&"set"in r&&void 0!==(n=r.set(e,i,t))?n:e[t]=i:r&&"get"in r&&null!==(n=r.get(e,t))?n:e[t]},propHooks:{tabIndex:{get:function(e){var t=C.find.attr(e,"tabindex");return t?parseInt(t,10):mt.test(e.nodeName)||vt.test(e.nodeName)&&e.href?0:-1}}},propFix:{for:"htmlFor",class:"className"}}),m.optSelected||(C.propHooks.selected={get:function(e){var t=e.parentNode;return t&&t.parentNode&&t.parentNode.selectedIndex,null},set:function(e){var t=e.parentNode;t&&(t.selectedIndex,t.parentNode&&t.parentNode.selectedIndex)}}),C.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],(function(){C.propFix[this.toLowerCase()]=this})),C.fn.extend({addClass:function(e){var t,i,n,r,s,o;return v(e)?this.each((function(t){C(this).addClass(e.call(this,t,wt(this)))})):(t=bt(e)).length?this.each((function(){if(n=wt(this),i=1===this.nodeType&&" "+yt(n)+" "){for(s=0;s<t.length;s++)r=t[s],i.indexOf(" "+r+" ")<0&&(i+=r+" ");o=yt(i),n!==o&&this.setAttribute("class",o)}})):this},removeClass:function(e){var t,i,n,r,s,o;return v(e)?this.each((function(t){C(this).removeClass(e.call(this,t,wt(this)))})):arguments.length?(t=bt(e)).length?this.each((function(){if(n=wt(this),i=1===this.nodeType&&" "+yt(n)+" "){for(s=0;s<t.length;s++)for(r=t[s];i.indexOf(" "+r+" ")>-1;)i=i.replace(" "+r+" "," ");o=yt(i),n!==o&&this.setAttribute("class",o)}})):this:this.attr("class","")},toggleClass:function(e,t){var i,n,r,s,o=typeof e,a="string"===o||Array.isArray(e);return v(e)?this.each((function(i){C(this).toggleClass(e.call(this,i,wt(this),t),t)})):"boolean"==typeof t&&a?t?this.addClass(e):this.removeClass(e):(i=bt(e),this.each((function(){if(a)for(s=C(this),r=0;r<i.length;r++)n=i[r],s.hasClass(n)?s.removeClass(n):s.addClass(n);else void 0!==e&&"boolean"!==o||((n=wt(this))&&J.set(this,"__className__",n),this.setAttribute&&this.setAttribute("class",n||!1===e?"":J.get(this,"__className__")||""))})))},hasClass:function(e){var t,i,n=0;for(t=" "+e+" ";i=this[n++];)if(1===i.nodeType&&(" "+yt(wt(i))+" ").indexOf(t)>-1)return!0;return!1}});var xt=/\r/g;C.fn.extend({val:function(e){var t,i,n,r=this[0];return arguments.length?(n=v(e),this.each((function(i){var r;1===this.nodeType&&(null==(r=n?e.call(this,i,C(this).val()):e)?r="":"number"==typeof r?r+="":Array.isArray(r)&&(r=C.map(r,(function(e){return null==e?"":e+""}))),(t=C.valHooks[this.type]||C.valHooks[this.nodeName.toLowerCase()])&&"set"in t&&void 0!==t.set(this,r,"value")||(this.value=r))}))):r?(t=C.valHooks[r.type]||C.valHooks[r.nodeName.toLowerCase()])&&"get"in t&&void 0!==(i=t.get(r,"value"))?i:"string"==typeof(i=r.value)?i.replace(xt,""):null==i?"":i:void 0}}),C.extend({valHooks:{option:{get:function(e){var t=C.find.attr(e,"value");return null!=t?t:yt(C.text(e))}},select:{get:function(e){var t,i,n,r=e.options,s=e.selectedIndex,o="select-one"===e.type,a=o?null:[],l=o?s+1:r.length;for(n=s<0?l:o?s:0;n<l;n++)if(((i=r[n]).selected||n===s)&&!i.disabled&&(!i.parentNode.disabled||!D(i.parentNode,"optgroup"))){if(t=C(i).val(),o)return t;a.push(t)}return a},set:function(e,t){for(var i,n,r=e.options,s=C.makeArray(t),o=r.length;o--;)((n=r[o]).selected=C.inArray(C.valHooks.option.get(n),s)>-1)&&(i=!0);return i||(e.selectedIndex=-1),s}}}}),C.each(["radio","checkbox"],(function(){C.valHooks[this]={set:function(e,t){if(Array.isArray(t))return e.checked=C.inArray(C(e).val(),t)>-1}},m.checkOn||(C.valHooks[this].get=function(e){return null===e.getAttribute("value")?"on":e.value})})),m.focusin="onfocusin"in n;var _t=/^(?:focusinfocus|focusoutblur)$/,kt=function(e){e.stopPropagation()};C.extend(C.event,{trigger:function(e,t,i,r){var s,o,a,l,u,c,d,h,f=[i||w],g=p.call(e,"type")?e.type:e,m=p.call(e,"namespace")?e.namespace.split("."):[];if(o=h=a=i=i||w,3!==i.nodeType&&8!==i.nodeType&&!_t.test(g+C.event.triggered)&&(g.indexOf(".")>-1&&(m=g.split("."),g=m.shift(),m.sort()),u=g.indexOf(":")<0&&"on"+g,(e=e[C.expando]?e:new C.Event(g,"object"==typeof e&&e)).isTrigger=r?2:3,e.namespace=m.join("."),e.rnamespace=e.namespace?new RegExp("(^|\\.)"+m.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,e.result=void 0,e.target||(e.target=i),t=null==t?[e]:C.makeArray(t,[e]),d=C.event.special[g]||{},r||!d.trigger||!1!==d.trigger.apply(i,t))){if(!r&&!d.noBubble&&!y(i)){for(l=d.delegateType||g,_t.test(l+g)||(o=o.parentNode);o;o=o.parentNode)f.push(o),a=o;a===(i.ownerDocument||w)&&f.push(a.defaultView||a.parentWindow||n)}for(s=0;(o=f[s++])&&!e.isPropagationStopped();)h=o,e.type=s>1?l:d.bindType||g,(c=(J.get(o,"events")||Object.create(null))[e.type]&&J.get(o,"handle"))&&c.apply(o,t),(c=u&&o[u])&&c.apply&&Z(o)&&(e.result=c.apply(o,t),!1===e.result&&e.preventDefault());return e.type=g,r||e.isDefaultPrevented()||d._default&&!1!==d._default.apply(f.pop(),t)||!Z(i)||u&&v(i[g])&&!y(i)&&((a=i[u])&&(i[u]=null),C.event.triggered=g,e.isPropagationStopped()&&h.addEventListener(g,kt),i[g](),e.isPropagationStopped()&&h.removeEventListener(g,kt),C.event.triggered=void 0,a&&(i[u]=a)),e.result}},simulate:function(e,t,i){var n=C.extend(new C.Event,i,{type:e,isSimulated:!0});C.event.trigger(n,null,t)}}),C.fn.extend({trigger:function(e,t){return this.each((function(){C.event.trigger(e,t,this)}))},triggerHandler:function(e,t){var i=this[0];if(i)return C.event.trigger(e,t,i,!0)}}),m.focusin||C.each({focus:"focusin",blur:"focusout"},(function(e,t){var i=function(e){C.event.simulate(t,e.target,C.event.fix(e))};C.event.special[t]={setup:function(){var n=this.ownerDocument||this.document||this,r=J.access(n,t);r||n.addEventListener(e,i,!0),J.access(n,t,(r||0)+1)},teardown:function(){var n=this.ownerDocument||this.document||this,r=J.access(n,t)-1;r?J.access(n,t,r):(n.removeEventListener(e,i,!0),J.remove(n,t))}}}));var Ct=n.location,Tt={guid:Date.now()},St=/\?/;C.parseXML=function(e){var t,i;if(!e||"string"!=typeof e)return null;try{t=(new n.DOMParser).parseFromString(e,"text/xml")}catch(e){}return i=t&&t.getElementsByTagName("parsererror")[0],t&&!i||C.error("Invalid XML: "+(i?C.map(i.childNodes,(function(e){return e.textContent})).join("\n"):e)),t};var Ot=/\[\]$/,Et=/\r?\n/g,It=/^(?:submit|button|image|reset|file)$/i,Dt=/^(?:input|select|textarea|keygen)/i;function zt(e,t,i,n){var r;if(Array.isArray(t))C.each(t,(function(t,r){i||Ot.test(e)?n(e,r):zt(e+"["+("object"==typeof r&&null!=r?t:"")+"]",r,i,n)}));else if(i||"object"!==_(t))n(e,t);else for(r in t)zt(e+"["+r+"]",t[r],i,n)}C.param=function(e,t){var i,n=[],r=function(e,t){var i=v(t)?t():t;n[n.length]=encodeURIComponent(e)+"="+encodeURIComponent(null==i?"":i)};if(null==e)return"";if(Array.isArray(e)||e.jquery&&!C.isPlainObject(e))C.each(e,(function(){r(this.name,this.value)}));else for(i in e)zt(i,e[i],t,r);return n.join("&")},C.fn.extend({serialize:function(){return C.param(this.serializeArray())},serializeArray:function(){return this.map((function(){var e=C.prop(this,"elements");return e?C.makeArray(e):this})).filter((function(){var e=this.type;return this.name&&!C(this).is(":disabled")&&Dt.test(this.nodeName)&&!It.test(e)&&(this.checked||!me.test(e))})).map((function(e,t){var i=C(this).val();return null==i?null:Array.isArray(i)?C.map(i,(function(e){return{name:t.name,value:e.replace(Et,"\r\n")}})):{name:t.name,value:i.replace(Et,"\r\n")}})).get()}});var At=/%20/g,Pt=/#.*$/,Rt=/([?&])_=[^&]*/,jt=/^(.*?):[ \t]*([^\r\n]*)$/gm,$t=/^(?:GET|HEAD)$/,Mt=/^\/\//,Lt={},Ft={},Nt="*/".concat("*"),Bt=w.createElement("a");function Ht(e){return function(t,i){"string"!=typeof t&&(i=t,t="*");var n,r=0,s=t.toLowerCase().match(L)||[];if(v(i))for(;n=s[r++];)"+"===n[0]?(n=n.slice(1)||"*",(e[n]=e[n]||[]).unshift(i)):(e[n]=e[n]||[]).push(i)}}function Wt(e,t,i,n){var r={},s=e===Ft;function o(a){var l;return r[a]=!0,C.each(e[a]||[],(function(e,a){var u=a(t,i,n);return"string"!=typeof u||s||r[u]?s?!(l=u):void 0:(t.dataTypes.unshift(u),o(u),!1)})),l}return o(t.dataTypes[0])||!r["*"]&&o("*")}function Ut(e,t){var i,n,r=C.ajaxSettings.flatOptions||{};for(i in t)void 0!==t[i]&&((r[i]?e:n||(n={}))[i]=t[i]);return n&&C.extend(!0,e,n),e}Bt.href=Ct.href,C.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:Ct.href,type:"GET",isLocal:/^(?:about|app|app-storage|.+-extension|file|res|widget):$/.test(Ct.protocol),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":Nt,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/\bxml\b/,html:/\bhtml/,json:/\bjson\b/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":!0,"text json":JSON.parse,"text xml":C.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(e,t){return t?Ut(Ut(e,C.ajaxSettings),t):Ut(C.ajaxSettings,e)},ajaxPrefilter:Ht(Lt),ajaxTransport:Ht(Ft),ajax:function(e,t){"object"==typeof e&&(t=e,e=void 0),t=t||{};var i,r,s,o,a,l,u,c,d,h,p=C.ajaxSetup({},t),f=p.context||p,g=p.context&&(f.nodeType||f.jquery)?C(f):C.event,m=C.Deferred(),v=C.Callbacks("once memory"),y=p.statusCode||{},b={},x={},_="canceled",k={readyState:0,getResponseHeader:function(e){var t;if(u){if(!o)for(o={};t=jt.exec(s);)o[t[1].toLowerCase()+" "]=(o[t[1].toLowerCase()+" "]||[]).concat(t[2]);t=o[e.toLowerCase()+" "]}return null==t?null:t.join(", ")},getAllResponseHeaders:function(){return u?s:null},setRequestHeader:function(e,t){return null==u&&(e=x[e.toLowerCase()]=x[e.toLowerCase()]||e,b[e]=t),this},overrideMimeType:function(e){return null==u&&(p.mimeType=e),this},statusCode:function(e){var t;if(e)if(u)k.always(e[k.status]);else for(t in e)y[t]=[y[t],e[t]];return this},abort:function(e){var t=e||_;return i&&i.abort(t),T(0,t),this}};if(m.promise(k),p.url=((e||p.url||Ct.href)+"").replace(Mt,Ct.protocol+"//"),p.type=t.method||t.type||p.method||p.type,p.dataTypes=(p.dataType||"*").toLowerCase().match(L)||[""],null==p.crossDomain){l=w.createElement("a");try{l.href=p.url,l.href=l.href,p.crossDomain=Bt.protocol+"//"+Bt.host!=l.protocol+"//"+l.host}catch(e){p.crossDomain=!0}}if(p.data&&p.processData&&"string"!=typeof p.data&&(p.data=C.param(p.data,p.traditional)),Wt(Lt,p,t,k),u)return k;for(d in(c=C.event&&p.global)&&0==C.active++&&C.event.trigger("ajaxStart"),p.type=p.type.toUpperCase(),p.hasContent=!$t.test(p.type),r=p.url.replace(Pt,""),p.hasContent?p.data&&p.processData&&0===(p.contentType||"").indexOf("application/x-www-form-urlencoded")&&(p.data=p.data.replace(At,"+")):(h=p.url.slice(r.length),p.data&&(p.processData||"string"==typeof p.data)&&(r+=(St.test(r)?"&":"?")+p.data,delete p.data),!1===p.cache&&(r=r.replace(Rt,"$1"),h=(St.test(r)?"&":"?")+"_="+Tt.guid+++h),p.url=r+h),p.ifModified&&(C.lastModified[r]&&k.setRequestHeader("If-Modified-Since",C.lastModified[r]),C.etag[r]&&k.setRequestHeader("If-None-Match",C.etag[r])),(p.data&&p.hasContent&&!1!==p.contentType||t.contentType)&&k.setRequestHeader("Content-Type",p.contentType),k.setRequestHeader("Accept",p.dataTypes[0]&&p.accepts[p.dataTypes[0]]?p.accepts[p.dataTypes[0]]+("*"!==p.dataTypes[0]?", "+Nt+"; q=0.01":""):p.accepts["*"]),p.headers)k.setRequestHeader(d,p.headers[d]);if(p.beforeSend&&(!1===p.beforeSend.call(f,k,p)||u))return k.abort();if(_="abort",v.add(p.complete),k.done(p.success),k.fail(p.error),i=Wt(Ft,p,t,k)){if(k.readyState=1,c&&g.trigger("ajaxSend",[k,p]),u)return k;p.async&&p.timeout>0&&(a=n.setTimeout((function(){k.abort("timeout")}),p.timeout));try{u=!1,i.send(b,T)}catch(e){if(u)throw e;T(-1,e)}}else T(-1,"No Transport");function T(e,t,o,l){var d,h,w,b,x,_=t;u||(u=!0,a&&n.clearTimeout(a),i=void 0,s=l||"",k.readyState=e>0?4:0,d=e>=200&&e<300||304===e,o&&(b=function(e,t,i){for(var n,r,s,o,a=e.contents,l=e.dataTypes;"*"===l[0];)l.shift(),void 0===n&&(n=e.mimeType||t.getResponseHeader("Content-Type"));if(n)for(r in a)if(a[r]&&a[r].test(n)){l.unshift(r);break}if(l[0]in i)s=l[0];else{for(r in i){if(!l[0]||e.converters[r+" "+l[0]]){s=r;break}o||(o=r)}s=s||o}if(s)return s!==l[0]&&l.unshift(s),i[s]}(p,k,o)),!d&&C.inArray("script",p.dataTypes)>-1&&C.inArray("json",p.dataTypes)<0&&(p.converters["text script"]=function(){}),b=function(e,t,i,n){var r,s,o,a,l,u={},c=e.dataTypes.slice();if(c[1])for(o in e.converters)u[o.toLowerCase()]=e.converters[o];for(s=c.shift();s;)if(e.responseFields[s]&&(i[e.responseFields[s]]=t),!l&&n&&e.dataFilter&&(t=e.dataFilter(t,e.dataType)),l=s,s=c.shift())if("*"===s)s=l;else if("*"!==l&&l!==s){if(!(o=u[l+" "+s]||u["* "+s]))for(r in u)if((a=r.split(" "))[1]===s&&(o=u[l+" "+a[0]]||u["* "+a[0]])){!0===o?o=u[r]:!0!==u[r]&&(s=a[0],c.unshift(a[1]));break}if(!0!==o)if(o&&e.throws)t=o(t);else try{t=o(t)}catch(e){return{state:"parsererror",error:o?e:"No conversion from "+l+" to "+s}}}return{state:"success",data:t}}(p,b,k,d),d?(p.ifModified&&((x=k.getResponseHeader("Last-Modified"))&&(C.lastModified[r]=x),(x=k.getResponseHeader("etag"))&&(C.etag[r]=x)),204===e||"HEAD"===p.type?_="nocontent":304===e?_="notmodified":(_=b.state,h=b.data,d=!(w=b.error))):(w=_,!e&&_||(_="error",e<0&&(e=0))),k.status=e,k.statusText=(t||_)+"",d?m.resolveWith(f,[h,_,k]):m.rejectWith(f,[k,_,w]),k.statusCode(y),y=void 0,c&&g.trigger(d?"ajaxSuccess":"ajaxError",[k,p,d?h:w]),v.fireWith(f,[k,_]),c&&(g.trigger("ajaxComplete",[k,p]),--C.active||C.event.trigger("ajaxStop")))}return k},getJSON:function(e,t,i){return C.get(e,t,i,"json")},getScript:function(e,t){return C.get(e,void 0,t,"script")}}),C.each(["get","post"],(function(e,t){C[t]=function(e,i,n,r){return v(i)&&(r=r||n,n=i,i=void 0),C.ajax(C.extend({url:e,type:t,dataType:r,data:i,success:n},C.isPlainObject(e)&&e))}})),C.ajaxPrefilter((function(e){var t;for(t in e.headers)"content-type"===t.toLowerCase()&&(e.contentType=e.headers[t]||"")})),C._evalUrl=function(e,t,i){return C.ajax({url:e,type:"GET",dataType:"script",cache:!0,async:!1,global:!1,converters:{"text script":function(){}},dataFilter:function(e){C.globalEval(e,t,i)}})},C.fn.extend({wrapAll:function(e){var t;return this[0]&&(v(e)&&(e=e.call(this[0])),t=C(e,this[0].ownerDocument).eq(0).clone(!0),this[0].parentNode&&t.insertBefore(this[0]),t.map((function(){for(var e=this;e.firstElementChild;)e=e.firstElementChild;return e})).append(this)),this},wrapInner:function(e){return v(e)?this.each((function(t){C(this).wrapInner(e.call(this,t))})):this.each((function(){var t=C(this),i=t.contents();i.length?i.wrapAll(e):t.append(e)}))},wrap:function(e){var t=v(e);return this.each((function(i){C(this).wrapAll(t?e.call(this,i):e)}))},unwrap:function(e){return this.parent(e).not("body").each((function(){C(this).replaceWith(this.childNodes)})),this}}),C.expr.pseudos.hidden=function(e){return!C.expr.pseudos.visible(e)},C.expr.pseudos.visible=function(e){return!!(e.offsetWidth||e.offsetHeight||e.getClientRects().length)},C.ajaxSettings.xhr=function(){try{return new n.XMLHttpRequest}catch(e){}};var Gt={0:200,1223:204},qt=C.ajaxSettings.xhr();m.cors=!!qt&&"withCredentials"in qt,m.ajax=qt=!!qt,C.ajaxTransport((function(e){var t,i;if(m.cors||qt&&!e.crossDomain)return{send:function(r,s){var o,a=e.xhr();if(a.open(e.type,e.url,e.async,e.username,e.password),e.xhrFields)for(o in e.xhrFields)a[o]=e.xhrFields[o];for(o in e.mimeType&&a.overrideMimeType&&a.overrideMimeType(e.mimeType),e.crossDomain||r["X-Requested-With"]||(r["X-Requested-With"]="XMLHttpRequest"),r)a.setRequestHeader(o,r[o]);t=function(e){return function(){t&&(t=i=a.onload=a.onerror=a.onabort=a.ontimeout=a.onreadystatechange=null,"abort"===e?a.abort():"error"===e?"number"!=typeof a.status?s(0,"error"):s(a.status,a.statusText):s(Gt[a.status]||a.status,a.statusText,"text"!==(a.responseType||"text")||"string"!=typeof a.responseText?{binary:a.response}:{text:a.responseText},a.getAllResponseHeaders()))}},a.onload=t(),i=a.onerror=a.ontimeout=t("error"),void 0!==a.onabort?a.onabort=i:a.onreadystatechange=function(){4===a.readyState&&n.setTimeout((function(){t&&i()}))},t=t("abort");try{a.send(e.hasContent&&e.data||null)}catch(e){if(t)throw e}},abort:function(){t&&t()}}})),C.ajaxPrefilter((function(e){e.crossDomain&&(e.contents.script=!1)})),C.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/\b(?:java|ecma)script\b/},converters:{"text script":function(e){return C.globalEval(e),e}}}),C.ajaxPrefilter("script",(function(e){void 0===e.cache&&(e.cache=!1),e.crossDomain&&(e.type="GET")})),C.ajaxTransport("script",(function(e){var t,i;if(e.crossDomain||e.scriptAttrs)return{send:function(n,r){t=C("<script>").attr(e.scriptAttrs||{}).prop({charset:e.scriptCharset,src:e.url}).on("load error",i=function(e){t.remove(),i=null,e&&r("error"===e.type?404:200,e.type)}),w.head.appendChild(t[0])},abort:function(){i&&i()}}}));var Yt,Vt=[],Xt=/(=)\?(?=&|$)|\?\?/;C.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var e=Vt.pop()||C.expando+"_"+Tt.guid++;return this[e]=!0,e}}),C.ajaxPrefilter("json jsonp",(function(e,t,i){var r,s,o,a=!1!==e.jsonp&&(Xt.test(e.url)?"url":"string"==typeof e.data&&0===(e.contentType||"").indexOf("application/x-www-form-urlencoded")&&Xt.test(e.data)&&"data");if(a||"jsonp"===e.dataTypes[0])return r=e.jsonpCallback=v(e.jsonpCallback)?e.jsonpCallback():e.jsonpCallback,a?e[a]=e[a].replace(Xt,"$1"+r):!1!==e.jsonp&&(e.url+=(St.test(e.url)?"&":"?")+e.jsonp+"="+r),e.converters["script json"]=function(){return o||C.error(r+" was not called"),o[0]},e.dataTypes[0]="json",s=n[r],n[r]=function(){o=arguments},i.always((function(){void 0===s?C(n).removeProp(r):n[r]=s,e[r]&&(e.jsonpCallback=t.jsonpCallback,Vt.push(r)),o&&v(s)&&s(o[0]),o=s=void 0})),"script"})),m.createHTMLDocument=((Yt=w.implementation.createHTMLDocument("").body).innerHTML="<form></form><form></form>",2===Yt.childNodes.length),C.parseHTML=function(e,t,i){return"string"!=typeof e?[]:("boolean"==typeof t&&(i=t,t=!1),t||(m.createHTMLDocument?((n=(t=w.implementation.createHTMLDocument("")).createElement("base")).href=w.location.href,t.head.appendChild(n)):t=w),s=!i&&[],(r=z.exec(e))?[t.createElement(r[1])]:(r=ke([e],t,s),s&&s.length&&C(s).remove(),C.merge([],r.childNodes)));var n,r,s},C.fn.load=function(e,t,i){var n,r,s,o=this,a=e.indexOf(" ");return a>-1&&(n=yt(e.slice(a)),e=e.slice(0,a)),v(t)?(i=t,t=void 0):t&&"object"==typeof t&&(r="POST"),o.length>0&&C.ajax({url:e,type:r||"GET",dataType:"html",data:t}).done((function(e){s=arguments,o.html(n?C("<div>").append(C.parseHTML(e)).find(n):e)})).always(i&&function(e,t){o.each((function(){i.apply(this,s||[e.responseText,t,e])}))}),this},C.expr.pseudos.animated=function(e){return C.grep(C.timers,(function(t){return e===t.elem})).length},C.offset={setOffset:function(e,t,i){var n,r,s,o,a,l,u=C.css(e,"position"),c=C(e),d={};"static"===u&&(e.style.position="relative"),a=c.offset(),s=C.css(e,"top"),l=C.css(e,"left"),("absolute"===u||"fixed"===u)&&(s+l).indexOf("auto")>-1?(o=(n=c.position()).top,r=n.left):(o=parseFloat(s)||0,r=parseFloat(l)||0),v(t)&&(t=t.call(e,i,C.extend({},a))),null!=t.top&&(d.top=t.top-a.top+o),null!=t.left&&(d.left=t.left-a.left+r),"using"in t?t.using.call(e,d):c.css(d)}},C.fn.extend({offset:function(e){if(arguments.length)return void 0===e?this:this.each((function(t){C.offset.setOffset(this,e,t)}));var t,i,n=this[0];return n?n.getClientRects().length?(t=n.getBoundingClientRect(),i=n.ownerDocument.defaultView,{top:t.top+i.pageYOffset,left:t.left+i.pageXOffset}):{top:0,left:0}:void 0},position:function(){if(this[0]){var e,t,i,n=this[0],r={top:0,left:0};if("fixed"===C.css(n,"position"))t=n.getBoundingClientRect();else{for(t=this.offset(),i=n.ownerDocument,e=n.offsetParent||i.documentElement;e&&(e===i.body||e===i.documentElement)&&"static"===C.css(e,"position");)e=e.parentNode;e&&e!==n&&1===e.nodeType&&((r=C(e).offset()).top+=C.css(e,"borderTopWidth",!0),r.left+=C.css(e,"borderLeftWidth",!0))}return{top:t.top-r.top-C.css(n,"marginTop",!0),left:t.left-r.left-C.css(n,"marginLeft",!0)}}},offsetParent:function(){return this.map((function(){for(var e=this.offsetParent;e&&"static"===C.css(e,"position");)e=e.offsetParent;return e||oe}))}}),C.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},(function(e,t){var i="pageYOffset"===t;C.fn[e]=function(n){return G(this,(function(e,n,r){var s;if(y(e)?s=e:9===e.nodeType&&(s=e.defaultView),void 0===r)return s?s[t]:e[n];s?s.scrollTo(i?s.pageXOffset:r,i?r:s.pageYOffset):e[n]=r}),e,n,arguments.length)}})),C.each(["top","left"],(function(e,t){C.cssHooks[t]=Ye(m.pixelPosition,(function(e,i){if(i)return i=qe(e,t),Ne.test(i)?C(e).position()[t]+"px":i}))})),C.each({Height:"height",Width:"width"},(function(e,t){C.each({padding:"inner"+e,content:t,"":"outer"+e},(function(i,n){C.fn[n]=function(r,s){var o=arguments.length&&(i||"boolean"!=typeof r),a=i||(!0===r||!0===s?"margin":"border");return G(this,(function(t,i,r){var s;return y(t)?0===n.indexOf("outer")?t["inner"+e]:t.document.documentElement["client"+e]:9===t.nodeType?(s=t.documentElement,Math.max(t.body["scroll"+e],s["scroll"+e],t.body["offset"+e],s["offset"+e],s["client"+e])):void 0===r?C.css(t,i,a):C.style(t,i,r,a)}),t,o?r:void 0,o)}}))})),C.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],(function(e,t){C.fn[t]=function(e){return this.on(t,e)}})),C.fn.extend({bind:function(e,t,i){return this.on(e,null,t,i)},unbind:function(e,t){return this.off(e,null,t)},delegate:function(e,t,i,n){return this.on(t,e,i,n)},undelegate:function(e,t,i){return 1===arguments.length?this.off(e,"**"):this.off(t,e||"**",i)},hover:function(e,t){return this.mouseenter(e).mouseleave(t||e)}}),C.each("blur focus focusin focusout resize scroll click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup contextmenu".split(" "),(function(e,t){C.fn[t]=function(e,i){return arguments.length>0?this.on(t,null,e,i):this.trigger(t)}}));var Zt=/^[\s\uFEFF\xA0]+|([^\s\uFEFF\xA0])[\s\uFEFF\xA0]+$/g;C.proxy=function(e,t){var i,n,r;if("string"==typeof t&&(i=e[t],t=e,e=i),v(e))return n=a.call(arguments,2),r=function(){return e.apply(t||this,n.concat(a.call(arguments)))},r.guid=e.guid=e.guid||C.guid++,r},C.holdReady=function(e){e?C.readyWait++:C.ready(!0)},C.isArray=Array.isArray,C.parseJSON=JSON.parse,C.nodeName=D,C.isFunction=v,C.isWindow=y,C.camelCase=X,C.type=_,C.now=Date.now,C.isNumeric=function(e){var t=C.type(e);return("number"===t||"string"===t)&&!isNaN(e-parseFloat(e))},C.trim=function(e){return null==e?"":(e+"").replace(Zt,"$1")},void 0===(i=function(){return C}.apply(t,[]))||(e.exports=i);var Kt=n.jQuery,Jt=n.$;return C.noConflict=function(e){return n.$===C&&(n.$=Jt),e&&n.jQuery===C&&(n.jQuery=Kt),C},void 0===r&&(n.jQuery=n.$=C),C}))},5733:(e,t,i)=>{e.exports=function e(t,i,n){function r(o,a){if(!i[o]){if(!t[o]){if(s)return s(o,!0);var l=new Error("Cannot find module '"+o+"'");throw l.code="MODULE_NOT_FOUND",l}var u=i[o]={exports:{}};t[o][0].call(u.exports,(function(e){return r(t[o][1][e]||e)}),u,u.exports,e,t,i,n)}return i[o].exports}for(var s=void 0,o=0;o<n.length;o++)r(n[o]);return r}({1:[function(e,t,i){"use strict";var n=e("./utils"),r=e("./support"),s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";i.encode=function(e){for(var t,i,r,o,a,l,u,c=[],d=0,h=e.length,p=h,f="string"!==n.getTypeOf(e);d<e.length;)p=h-d,r=f?(t=e[d++],i=d<h?e[d++]:0,d<h?e[d++]:0):(t=e.charCodeAt(d++),i=d<h?e.charCodeAt(d++):0,d<h?e.charCodeAt(d++):0),o=t>>2,a=(3&t)<<4|i>>4,l=1<p?(15&i)<<2|r>>6:64,u=2<p?63&r:64,c.push(s.charAt(o)+s.charAt(a)+s.charAt(l)+s.charAt(u));return c.join("")},i.decode=function(e){var t,i,n,o,a,l,u=0,c=0,d="data:";if(e.substr(0,d.length)===d)throw new Error("Invalid base64 input, it looks like a data url.");var h,p=3*(e=e.replace(/[^A-Za-z0-9+/=]/g,"")).length/4;if(e.charAt(e.length-1)===s.charAt(64)&&p--,e.charAt(e.length-2)===s.charAt(64)&&p--,p%1!=0)throw new Error("Invalid base64 input, bad content length.");for(h=r.uint8array?new Uint8Array(0|p):new Array(0|p);u<e.length;)t=s.indexOf(e.charAt(u++))<<2|(o=s.indexOf(e.charAt(u++)))>>4,i=(15&o)<<4|(a=s.indexOf(e.charAt(u++)))>>2,n=(3&a)<<6|(l=s.indexOf(e.charAt(u++))),h[c++]=t,64!==a&&(h[c++]=i),64!==l&&(h[c++]=n);return h}},{"./support":30,"./utils":32}],2:[function(e,t,i){"use strict";var n=e("./external"),r=e("./stream/DataWorker"),s=e("./stream/Crc32Probe"),o=e("./stream/DataLengthProbe");function a(e,t,i,n,r){this.compressedSize=e,this.uncompressedSize=t,this.crc32=i,this.compression=n,this.compressedContent=r}a.prototype={getContentWorker:function(){var e=new r(n.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new o("data_length")),t=this;return e.on("end",(function(){if(this.streamInfo.data_length!==t.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")})),e},getCompressedWorker:function(){return new r(n.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},a.createWorkerFrom=function(e,t,i){return e.pipe(new s).pipe(new o("uncompressedSize")).pipe(t.compressWorker(i)).pipe(new o("compressedSize")).withStreamInfo("compression",t)},t.exports=a},{"./external":6,"./stream/Crc32Probe":25,"./stream/DataLengthProbe":26,"./stream/DataWorker":27}],3:[function(e,t,i){"use strict";var n=e("./stream/GenericWorker");i.STORE={magic:"\0\0",compressWorker:function(){return new n("STORE compression")},uncompressWorker:function(){return new n("STORE decompression")}},i.DEFLATE=e("./flate")},{"./flate":7,"./stream/GenericWorker":28}],4:[function(e,t,i){"use strict";var n=e("./utils"),r=function(){for(var e,t=[],i=0;i<256;i++){e=i;for(var n=0;n<8;n++)e=1&e?3988292384^e>>>1:e>>>1;t[i]=e}return t}();t.exports=function(e,t){return void 0!==e&&e.length?"string"!==n.getTypeOf(e)?function(e,t,i,n){var s=r,o=0+i;e^=-1;for(var a=0;a<o;a++)e=e>>>8^s[255&(e^t[a])];return-1^e}(0|t,e,e.length):function(e,t,i,n){var s=r,o=0+i;e^=-1;for(var a=0;a<o;a++)e=e>>>8^s[255&(e^t.charCodeAt(a))];return-1^e}(0|t,e,e.length):0}},{"./utils":32}],5:[function(e,t,i){"use strict";i.base64=!1,i.binary=!1,i.dir=!1,i.createFolders=!0,i.date=null,i.compression=null,i.compressionOptions=null,i.comment=null,i.unixPermissions=null,i.dosPermissions=null},{}],6:[function(e,t,i){"use strict";var n;n="undefined"!=typeof Promise?Promise:e("lie"),t.exports={Promise:n}},{lie:37}],7:[function(e,t,i){"use strict";var n="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Uint32Array,r=e("pako"),s=e("./utils"),o=e("./stream/GenericWorker"),a=n?"uint8array":"array";function l(e,t){o.call(this,"FlateWorker/"+e),this._pako=null,this._pakoAction=e,this._pakoOptions=t,this.meta={}}i.magic="\b\0",s.inherits(l,o),l.prototype.processChunk=function(e){this.meta=e.meta,null===this._pako&&this._createPako(),this._pako.push(s.transformTo(a,e.data),!1)},l.prototype.flush=function(){o.prototype.flush.call(this),null===this._pako&&this._createPako(),this._pako.push([],!0)},l.prototype.cleanUp=function(){o.prototype.cleanUp.call(this),this._pako=null},l.prototype._createPako=function(){this._pako=new r[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var e=this;this._pako.onData=function(t){e.push({data:t,meta:e.meta})}},i.compressWorker=function(e){return new l("Deflate",e)},i.uncompressWorker=function(){return new l("Inflate",{})}},{"./stream/GenericWorker":28,"./utils":32,pako:38}],8:[function(e,t,i){"use strict";function n(e,t){var i,n="";for(i=0;i<t;i++)n+=String.fromCharCode(255&e),e>>>=8;return n}function r(e,t,i,r,o,c){var d,h,p=e.file,f=e.compression,g=c!==a.utf8encode,m=s.transformTo("string",c(p.name)),v=s.transformTo("string",a.utf8encode(p.name)),y=p.comment,w=s.transformTo("string",c(y)),b=s.transformTo("string",a.utf8encode(y)),x=v.length!==p.name.length,_=b.length!==y.length,k="",C="",T="",S=p.dir,O=p.date,E={crc32:0,compressedSize:0,uncompressedSize:0};t&&!i||(E.crc32=e.crc32,E.compressedSize=e.compressedSize,E.uncompressedSize=e.uncompressedSize);var I=0;t&&(I|=8),g||!x&&!_||(I|=2048);var D=0,z=0;S&&(D|=16),"UNIX"===o?(z=798,D|=function(e,t){var i=e;return e||(i=t?16893:33204),(65535&i)<<16}(p.unixPermissions,S)):(z=20,D|=function(e){return 63&(e||0)}(p.dosPermissions)),d=O.getUTCHours(),d<<=6,d|=O.getUTCMinutes(),d<<=5,d|=O.getUTCSeconds()/2,h=O.getUTCFullYear()-1980,h<<=4,h|=O.getUTCMonth()+1,h<<=5,h|=O.getUTCDate(),x&&(C=n(1,1)+n(l(m),4)+v,k+="up"+n(C.length,2)+C),_&&(T=n(1,1)+n(l(w),4)+b,k+="uc"+n(T.length,2)+T);var A="";return A+="\n\0",A+=n(I,2),A+=f.magic,A+=n(d,2),A+=n(h,2),A+=n(E.crc32,4),A+=n(E.compressedSize,4),A+=n(E.uncompressedSize,4),A+=n(m.length,2),A+=n(k.length,2),{fileRecord:u.LOCAL_FILE_HEADER+A+m+k,dirRecord:u.CENTRAL_FILE_HEADER+n(z,2)+A+n(w.length,2)+"\0\0\0\0"+n(D,4)+n(r,4)+m+k+w}}var s=e("../utils"),o=e("../stream/GenericWorker"),a=e("../utf8"),l=e("../crc32"),u=e("../signature");function c(e,t,i,n){o.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=t,this.zipPlatform=i,this.encodeFileName=n,this.streamFiles=e,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}s.inherits(c,o),c.prototype.push=function(e){var t=e.meta.percent||0,i=this.entriesCount,n=this._sources.length;this.accumulate?this.contentBuffer.push(e):(this.bytesWritten+=e.data.length,o.prototype.push.call(this,{data:e.data,meta:{currentFile:this.currentFile,percent:i?(t+100*(i-n-1))/i:100}}))},c.prototype.openedSource=function(e){this.currentSourceOffset=this.bytesWritten,this.currentFile=e.file.name;var t=this.streamFiles&&!e.file.dir;if(t){var i=r(e,t,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:i.fileRecord,meta:{percent:0}})}else this.accumulate=!0},c.prototype.closedSource=function(e){this.accumulate=!1;var t=this.streamFiles&&!e.file.dir,i=r(e,t,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(i.dirRecord),t)this.push({data:function(e){return u.DATA_DESCRIPTOR+n(e.crc32,4)+n(e.compressedSize,4)+n(e.uncompressedSize,4)}(e),meta:{percent:100}});else for(this.push({data:i.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},c.prototype.flush=function(){for(var e=this.bytesWritten,t=0;t<this.dirRecords.length;t++)this.push({data:this.dirRecords[t],meta:{percent:100}});var i=this.bytesWritten-e,r=function(e,t,i,r,o){var a=s.transformTo("string",o(r));return u.CENTRAL_DIRECTORY_END+"\0\0\0\0"+n(e,2)+n(e,2)+n(t,4)+n(i,4)+n(a.length,2)+a}(this.dirRecords.length,i,e,this.zipComment,this.encodeFileName);this.push({data:r,meta:{percent:100}})},c.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},c.prototype.registerPrevious=function(e){this._sources.push(e);var t=this;return e.on("data",(function(e){t.processChunk(e)})),e.on("end",(function(){t.closedSource(t.previous.streamInfo),t._sources.length?t.prepareNextSource():t.end()})),e.on("error",(function(e){t.error(e)})),this},c.prototype.resume=function(){return!!o.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},c.prototype.error=function(e){var t=this._sources;if(!o.prototype.error.call(this,e))return!1;for(var i=0;i<t.length;i++)try{t[i].error(e)}catch(e){}return!0},c.prototype.lock=function(){o.prototype.lock.call(this);for(var e=this._sources,t=0;t<e.length;t++)e[t].lock()},t.exports=c},{"../crc32":4,"../signature":23,"../stream/GenericWorker":28,"../utf8":31,"../utils":32}],9:[function(e,t,i){"use strict";var n=e("../compressions"),r=e("./ZipFileWorker");i.generateWorker=function(e,t,i){var s=new r(t.streamFiles,i,t.platform,t.encodeFileName),o=0;try{e.forEach((function(e,i){o++;var r=function(e,t){var i=e||t,r=n[i];if(!r)throw new Error(i+" is not a valid compression method !");return r}(i.options.compression,t.compression),a=i.options.compressionOptions||t.compressionOptions||{},l=i.dir,u=i.date;i._compressWorker(r,a).withStreamInfo("file",{name:e,dir:l,date:u,comment:i.comment||"",unixPermissions:i.unixPermissions,dosPermissions:i.dosPermissions}).pipe(s)})),s.entriesCount=o}catch(e){s.error(e)}return s}},{"../compressions":3,"./ZipFileWorker":8}],10:[function(e,t,i){"use strict";function n(){if(!(this instanceof n))return new n;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files=Object.create(null),this.comment=null,this.root="",this.clone=function(){var e=new n;for(var t in this)"function"!=typeof this[t]&&(e[t]=this[t]);return e}}(n.prototype=e("./object")).loadAsync=e("./load"),n.support=e("./support"),n.defaults=e("./defaults"),n.version="3.10.1",n.loadAsync=function(e,t){return(new n).loadAsync(e,t)},n.external=e("./external"),t.exports=n},{"./defaults":5,"./external":6,"./load":11,"./object":15,"./support":30}],11:[function(e,t,i){"use strict";var n=e("./utils"),r=e("./external"),s=e("./utf8"),o=e("./zipEntries"),a=e("./stream/Crc32Probe"),l=e("./nodejsUtils");function u(e){return new r.Promise((function(t,i){var n=e.decompressed.getContentWorker().pipe(new a);n.on("error",(function(e){i(e)})).on("end",(function(){n.streamInfo.crc32!==e.decompressed.crc32?i(new Error("Corrupted zip : CRC32 mismatch")):t()})).resume()}))}t.exports=function(e,t){var i=this;return t=n.extend(t||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:s.utf8decode}),l.isNode&&l.isStream(e)?r.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):n.prepareContent("the loaded zip file",e,!0,t.optimizedBinaryString,t.base64).then((function(e){var i=new o(t);return i.load(e),i})).then((function(e){var i=[r.Promise.resolve(e)],n=e.files;if(t.checkCRC32)for(var s=0;s<n.length;s++)i.push(u(n[s]));return r.Promise.all(i)})).then((function(e){for(var r=e.shift(),s=r.files,o=0;o<s.length;o++){var a=s[o],l=a.fileNameStr,u=n.resolve(a.fileNameStr);i.file(u,a.decompressed,{binary:!0,optimizedBinaryString:!0,date:a.date,dir:a.dir,comment:a.fileCommentStr.length?a.fileCommentStr:null,unixPermissions:a.unixPermissions,dosPermissions:a.dosPermissions,createFolders:t.createFolders}),a.dir||(i.file(u).unsafeOriginalName=l)}return r.zipComment.length&&(i.comment=r.zipComment),i}))}},{"./external":6,"./nodejsUtils":14,"./stream/Crc32Probe":25,"./utf8":31,"./utils":32,"./zipEntries":33}],12:[function(e,t,i){"use strict";var n=e("../utils"),r=e("../stream/GenericWorker");function s(e,t){r.call(this,"Nodejs stream input adapter for "+e),this._upstreamEnded=!1,this._bindStream(t)}n.inherits(s,r),s.prototype._bindStream=function(e){var t=this;(this._stream=e).pause(),e.on("data",(function(e){t.push({data:e,meta:{percent:0}})})).on("error",(function(e){t.isPaused?this.generatedError=e:t.error(e)})).on("end",(function(){t.isPaused?t._upstreamEnded=!0:t.end()}))},s.prototype.pause=function(){return!!r.prototype.pause.call(this)&&(this._stream.pause(),!0)},s.prototype.resume=function(){return!!r.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0)},t.exports=s},{"../stream/GenericWorker":28,"../utils":32}],13:[function(e,t,i){"use strict";var n=e("readable-stream").Readable;function r(e,t,i){n.call(this,t),this._helper=e;var r=this;e.on("data",(function(e,t){r.push(e)||r._helper.pause(),i&&i(t)})).on("error",(function(e){r.emit("error",e)})).on("end",(function(){r.push(null)}))}e("../utils").inherits(r,n),r.prototype._read=function(){this._helper.resume()},t.exports=r},{"../utils":32,"readable-stream":16}],14:[function(e,t,i){"use strict";t.exports={isNode:"undefined"!=typeof Buffer,newBufferFrom:function(e,t){if(Buffer.from&&Buffer.from!==Uint8Array.from)return Buffer.from(e,t);if("number"==typeof e)throw new Error('The "data" argument must not be a number');return new Buffer(e,t)},allocBuffer:function(e){if(Buffer.alloc)return Buffer.alloc(e);var t=new Buffer(e);return t.fill(0),t},isBuffer:function(e){return Buffer.isBuffer(e)},isStream:function(e){return e&&"function"==typeof e.on&&"function"==typeof e.pause&&"function"==typeof e.resume}}},{}],15:[function(e,t,i){"use strict";function n(e,t,i){var n,r=s.getTypeOf(t),a=s.extend(i||{},l);a.date=a.date||new Date,null!==a.compression&&(a.compression=a.compression.toUpperCase()),"string"==typeof a.unixPermissions&&(a.unixPermissions=parseInt(a.unixPermissions,8)),a.unixPermissions&&16384&a.unixPermissions&&(a.dir=!0),a.dosPermissions&&16&a.dosPermissions&&(a.dir=!0),a.dir&&(e=g(e)),a.createFolders&&(n=f(e))&&m.call(this,n,!0);var d="string"===r&&!1===a.binary&&!1===a.base64;i&&void 0!==i.binary||(a.binary=!d),(t instanceof u&&0===t.uncompressedSize||a.dir||!t||0===t.length)&&(a.base64=!1,a.binary=!0,t="",a.compression="STORE",r="string");var v;v=t instanceof u||t instanceof o?t:h.isNode&&h.isStream(t)?new p(e,t):s.prepareContent(e,t,a.binary,a.optimizedBinaryString,a.base64);var y=new c(e,v,a);this.files[e]=y}var r=e("./utf8"),s=e("./utils"),o=e("./stream/GenericWorker"),a=e("./stream/StreamHelper"),l=e("./defaults"),u=e("./compressedObject"),c=e("./zipObject"),d=e("./generate"),h=e("./nodejsUtils"),p=e("./nodejs/NodejsStreamInputAdapter"),f=function(e){"/"===e.slice(-1)&&(e=e.substring(0,e.length-1));var t=e.lastIndexOf("/");return 0<t?e.substring(0,t):""},g=function(e){return"/"!==e.slice(-1)&&(e+="/"),e},m=function(e,t){return t=void 0!==t?t:l.createFolders,e=g(e),this.files[e]||n.call(this,e,null,{dir:!0,createFolders:t}),this.files[e]};function v(e){return"[object RegExp]"===Object.prototype.toString.call(e)}var y={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(e){var t,i,n;for(t in this.files)n=this.files[t],(i=t.slice(this.root.length,t.length))&&t.slice(0,this.root.length)===this.root&&e(i,n)},filter:function(e){var t=[];return this.forEach((function(i,n){e(i,n)&&t.push(n)})),t},file:function(e,t,i){if(1!==arguments.length)return e=this.root+e,n.call(this,e,t,i),this;if(v(e)){var r=e;return this.filter((function(e,t){return!t.dir&&r.test(e)}))}var s=this.files[this.root+e];return s&&!s.dir?s:null},folder:function(e){if(!e)return this;if(v(e))return this.filter((function(t,i){return i.dir&&e.test(t)}));var t=this.root+e,i=m.call(this,t),n=this.clone();return n.root=i.name,n},remove:function(e){e=this.root+e;var t=this.files[e];if(t||("/"!==e.slice(-1)&&(e+="/"),t=this.files[e]),t&&!t.dir)delete this.files[e];else for(var i=this.filter((function(t,i){return i.name.slice(0,e.length)===e})),n=0;n<i.length;n++)delete this.files[i[n].name];return this},generate:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(e){var t,i={};try{if((i=s.extend(e||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:r.utf8encode})).type=i.type.toLowerCase(),i.compression=i.compression.toUpperCase(),"binarystring"===i.type&&(i.type="string"),!i.type)throw new Error("No output type specified.");s.checkSupport(i.type),"darwin"!==i.platform&&"freebsd"!==i.platform&&"linux"!==i.platform&&"sunos"!==i.platform||(i.platform="UNIX"),"win32"===i.platform&&(i.platform="DOS");var n=i.comment||this.comment||"";t=d.generateWorker(this,i,n)}catch(e){(t=new o("error")).error(e)}return new a(t,i.type||"string",i.mimeType)},generateAsync:function(e,t){return this.generateInternalStream(e).accumulate(t)},generateNodeStream:function(e,t){return(e=e||{}).type||(e.type="nodebuffer"),this.generateInternalStream(e).toNodejsStream(t)}};t.exports=y},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":12,"./nodejsUtils":14,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31,"./utils":32,"./zipObject":35}],16:[function(e,t,i){"use strict";t.exports=e("stream")},{stream:void 0}],17:[function(e,t,i){"use strict";var n=e("./DataReader");function r(e){n.call(this,e);for(var t=0;t<this.data.length;t++)e[t]=255&e[t]}e("../utils").inherits(r,n),r.prototype.byteAt=function(e){return this.data[this.zero+e]},r.prototype.lastIndexOfSignature=function(e){for(var t=e.charCodeAt(0),i=e.charCodeAt(1),n=e.charCodeAt(2),r=e.charCodeAt(3),s=this.length-4;0<=s;--s)if(this.data[s]===t&&this.data[s+1]===i&&this.data[s+2]===n&&this.data[s+3]===r)return s-this.zero;return-1},r.prototype.readAndCheckSignature=function(e){var t=e.charCodeAt(0),i=e.charCodeAt(1),n=e.charCodeAt(2),r=e.charCodeAt(3),s=this.readData(4);return t===s[0]&&i===s[1]&&n===s[2]&&r===s[3]},r.prototype.readData=function(e){if(this.checkOffset(e),0===e)return[];var t=this.data.slice(this.zero+this.index,this.zero+this.index+e);return this.index+=e,t},t.exports=r},{"../utils":32,"./DataReader":18}],18:[function(e,t,i){"use strict";var n=e("../utils");function r(e){this.data=e,this.length=e.length,this.index=0,this.zero=0}r.prototype={checkOffset:function(e){this.checkIndex(this.index+e)},checkIndex:function(e){if(this.length<this.zero+e||e<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+e+"). Corrupted zip ?")},setIndex:function(e){this.checkIndex(e),this.index=e},skip:function(e){this.setIndex(this.index+e)},byteAt:function(){},readInt:function(e){var t,i=0;for(this.checkOffset(e),t=this.index+e-1;t>=this.index;t--)i=(i<<8)+this.byteAt(t);return this.index+=e,i},readString:function(e){return n.transformTo("string",this.readData(e))},readData:function(){},lastIndexOfSignature:function(){},readAndCheckSignature:function(){},readDate:function(){var e=this.readInt(4);return new Date(Date.UTC(1980+(e>>25&127),(e>>21&15)-1,e>>16&31,e>>11&31,e>>5&63,(31&e)<<1))}},t.exports=r},{"../utils":32}],19:[function(e,t,i){"use strict";var n=e("./Uint8ArrayReader");function r(e){n.call(this,e)}e("../utils").inherits(r,n),r.prototype.readData=function(e){this.checkOffset(e);var t=this.data.slice(this.zero+this.index,this.zero+this.index+e);return this.index+=e,t},t.exports=r},{"../utils":32,"./Uint8ArrayReader":21}],20:[function(e,t,i){"use strict";var n=e("./DataReader");function r(e){n.call(this,e)}e("../utils").inherits(r,n),r.prototype.byteAt=function(e){return this.data.charCodeAt(this.zero+e)},r.prototype.lastIndexOfSignature=function(e){return this.data.lastIndexOf(e)-this.zero},r.prototype.readAndCheckSignature=function(e){return e===this.readData(4)},r.prototype.readData=function(e){this.checkOffset(e);var t=this.data.slice(this.zero+this.index,this.zero+this.index+e);return this.index+=e,t},t.exports=r},{"../utils":32,"./DataReader":18}],21:[function(e,t,i){"use strict";var n=e("./ArrayReader");function r(e){n.call(this,e)}e("../utils").inherits(r,n),r.prototype.readData=function(e){if(this.checkOffset(e),0===e)return new Uint8Array(0);var t=this.data.subarray(this.zero+this.index,this.zero+this.index+e);return this.index+=e,t},t.exports=r},{"../utils":32,"./ArrayReader":17}],22:[function(e,t,i){"use strict";var n=e("../utils"),r=e("../support"),s=e("./ArrayReader"),o=e("./StringReader"),a=e("./NodeBufferReader"),l=e("./Uint8ArrayReader");t.exports=function(e){var t=n.getTypeOf(e);return n.checkSupport(t),"string"!==t||r.uint8array?"nodebuffer"===t?new a(e):r.uint8array?new l(n.transformTo("uint8array",e)):new s(n.transformTo("array",e)):new o(e)}},{"../support":30,"../utils":32,"./ArrayReader":17,"./NodeBufferReader":19,"./StringReader":20,"./Uint8ArrayReader":21}],23:[function(e,t,i){"use strict";i.LOCAL_FILE_HEADER="PK",i.CENTRAL_FILE_HEADER="PK",i.CENTRAL_DIRECTORY_END="PK",i.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK",i.ZIP64_CENTRAL_DIRECTORY_END="PK",i.DATA_DESCRIPTOR="PK\b"},{}],24:[function(e,t,i){"use strict";var n=e("./GenericWorker"),r=e("../utils");function s(e){n.call(this,"ConvertWorker to "+e),this.destType=e}r.inherits(s,n),s.prototype.processChunk=function(e){this.push({data:r.transformTo(this.destType,e.data),meta:e.meta})},t.exports=s},{"../utils":32,"./GenericWorker":28}],25:[function(e,t,i){"use strict";var n=e("./GenericWorker"),r=e("../crc32");function s(){n.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}e("../utils").inherits(s,n),s.prototype.processChunk=function(e){this.streamInfo.crc32=r(e.data,this.streamInfo.crc32||0),this.push(e)},t.exports=s},{"../crc32":4,"../utils":32,"./GenericWorker":28}],26:[function(e,t,i){"use strict";var n=e("../utils"),r=e("./GenericWorker");function s(e){r.call(this,"DataLengthProbe for "+e),this.propName=e,this.withStreamInfo(e,0)}n.inherits(s,r),s.prototype.processChunk=function(e){if(e){var t=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=t+e.data.length}r.prototype.processChunk.call(this,e)},t.exports=s},{"../utils":32,"./GenericWorker":28}],27:[function(e,t,i){"use strict";var n=e("../utils"),r=e("./GenericWorker");function s(e){r.call(this,"DataWorker");var t=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,e.then((function(e){t.dataIsReady=!0,t.data=e,t.max=e&&e.length||0,t.type=n.getTypeOf(e),t.isPaused||t._tickAndRepeat()}),(function(e){t.error(e)}))}n.inherits(s,r),s.prototype.cleanUp=function(){r.prototype.cleanUp.call(this),this.data=null},s.prototype.resume=function(){return!!r.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,n.delay(this._tickAndRepeat,[],this)),!0)},s.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(n.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},s.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var e=null,t=Math.min(this.max,this.index+16384);if(this.index>=this.max)return this.end();switch(this.type){case"string":e=this.data.substring(this.index,t);break;case"uint8array":e=this.data.subarray(this.index,t);break;case"array":case"nodebuffer":e=this.data.slice(this.index,t)}return this.index=t,this.push({data:e,meta:{percent:this.max?this.index/this.max*100:0}})},t.exports=s},{"../utils":32,"./GenericWorker":28}],28:[function(e,t,i){"use strict";function n(e){this.name=e||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}n.prototype={push:function(e){this.emit("data",e)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(e){this.emit("error",e)}return!0},error:function(e){return!this.isFinished&&(this.isPaused?this.generatedError=e:(this.isFinished=!0,this.emit("error",e),this.previous&&this.previous.error(e),this.cleanUp()),!0)},on:function(e,t){return this._listeners[e].push(t),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(e,t){if(this._listeners[e])for(var i=0;i<this._listeners[e].length;i++)this._listeners[e][i].call(this,t)},pipe:function(e){return e.registerPrevious(this)},registerPrevious:function(e){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=e.streamInfo,this.mergeStreamInfo(),this.previous=e;var t=this;return e.on("data",(function(e){t.processChunk(e)})),e.on("end",(function(){t.end()})),e.on("error",(function(e){t.error(e)})),this},pause:function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;var e=this.isPaused=!1;return this.generatedError&&(this.error(this.generatedError),e=!0),this.previous&&this.previous.resume(),!e},flush:function(){},processChunk:function(e){this.push(e)},withStreamInfo:function(e,t){return this.extraStreamInfo[e]=t,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var e in this.extraStreamInfo)Object.prototype.hasOwnProperty.call(this.extraStreamInfo,e)&&(this.streamInfo[e]=this.extraStreamInfo[e])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var e="Worker "+this.name;return this.previous?this.previous+" -> "+e:e}},t.exports=n},{}],29:[function(e,t,i){"use strict";var n=e("../utils"),r=e("./ConvertWorker"),s=e("./GenericWorker"),o=e("../base64"),a=e("../support"),l=e("../external"),u=null;if(a.nodestream)try{u=e("../nodejs/NodejsStreamOutputAdapter")}catch(e){}function c(e,t,i){var o=t;switch(t){case"blob":case"arraybuffer":o="uint8array";break;case"base64":o="string"}try{this._internalType=o,this._outputType=t,this._mimeType=i,n.checkSupport(o),this._worker=e.pipe(new r(o)),e.lock()}catch(e){this._worker=new s("error"),this._worker.error(e)}}c.prototype={accumulate:function(e){return function(e,t){return new l.Promise((function(i,r){var s=[],a=e._internalType,l=e._outputType,u=e._mimeType;e.on("data",(function(e,i){s.push(e),t&&t(i)})).on("error",(function(e){s=[],r(e)})).on("end",(function(){try{var e=function(e,t,i){switch(e){case"blob":return n.newBlob(n.transformTo("arraybuffer",t),i);case"base64":return o.encode(t);default:return n.transformTo(e,t)}}(l,function(e,t){var i,n=0,r=null,s=0;for(i=0;i<t.length;i++)s+=t[i].length;switch(e){case"string":return t.join("");case"array":return Array.prototype.concat.apply([],t);case"uint8array":for(r=new Uint8Array(s),i=0;i<t.length;i++)r.set(t[i],n),n+=t[i].length;return r;case"nodebuffer":return Buffer.concat(t);default:throw new Error("concat : unsupported type '"+e+"'")}}(a,s),u);i(e)}catch(e){r(e)}s=[]})).resume()}))}(this,e)},on:function(e,t){var i=this;return"data"===e?this._worker.on(e,(function(e){t.call(i,e.data,e.meta)})):this._worker.on(e,(function(){n.delay(t,arguments,i)})),this},resume:function(){return n.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(e){if(n.checkSupport("nodestream"),"nodebuffer"!==this._outputType)throw new Error(this._outputType+" is not supported by this method");return new u(this,{objectMode:"nodebuffer"!==this._outputType},e)}},t.exports=c},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":13,"../support":30,"../utils":32,"./ConvertWorker":24,"./GenericWorker":28}],30:[function(e,t,i){"use strict";if(i.base64=!0,i.array=!0,i.string=!0,i.arraybuffer="undefined"!=typeof ArrayBuffer&&"undefined"!=typeof Uint8Array,i.nodebuffer="undefined"!=typeof Buffer,i.uint8array="undefined"!=typeof Uint8Array,"undefined"==typeof ArrayBuffer)i.blob=!1;else{var n=new ArrayBuffer(0);try{i.blob=0===new Blob([n],{type:"application/zip"}).size}catch(e){try{var r=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);r.append(n),i.blob=0===r.getBlob("application/zip").size}catch(e){i.blob=!1}}}try{i.nodestream=!!e("readable-stream").Readable}catch(e){i.nodestream=!1}},{"readable-stream":16}],31:[function(e,t,i){"use strict";for(var n=e("./utils"),r=e("./support"),s=e("./nodejsUtils"),o=e("./stream/GenericWorker"),a=new Array(256),l=0;l<256;l++)a[l]=252<=l?6:248<=l?5:240<=l?4:224<=l?3:192<=l?2:1;function u(){o.call(this,"utf-8 decode"),this.leftOver=null}function c(){o.call(this,"utf-8 encode")}a[254]=a[254]=1,i.utf8encode=function(e){return r.nodebuffer?s.newBufferFrom(e,"utf-8"):function(e){var t,i,n,s,o,a=e.length,l=0;for(s=0;s<a;s++)55296==(64512&(i=e.charCodeAt(s)))&&s+1<a&&56320==(64512&(n=e.charCodeAt(s+1)))&&(i=65536+(i-55296<<10)+(n-56320),s++),l+=i<128?1:i<2048?2:i<65536?3:4;for(t=r.uint8array?new Uint8Array(l):new Array(l),s=o=0;o<l;s++)55296==(64512&(i=e.charCodeAt(s)))&&s+1<a&&56320==(64512&(n=e.charCodeAt(s+1)))&&(i=65536+(i-55296<<10)+(n-56320),s++),i<128?t[o++]=i:(i<2048?t[o++]=192|i>>>6:(i<65536?t[o++]=224|i>>>12:(t[o++]=240|i>>>18,t[o++]=128|i>>>12&63),t[o++]=128|i>>>6&63),t[o++]=128|63&i);return t}(e)},i.utf8decode=function(e){return r.nodebuffer?n.transformTo("nodebuffer",e).toString("utf-8"):function(e){var t,i,r,s,o=e.length,l=new Array(2*o);for(t=i=0;t<o;)if((r=e[t++])<128)l[i++]=r;else if(4<(s=a[r]))l[i++]=65533,t+=s-1;else{for(r&=2===s?31:3===s?15:7;1<s&&t<o;)r=r<<6|63&e[t++],s--;1<s?l[i++]=65533:r<65536?l[i++]=r:(r-=65536,l[i++]=55296|r>>10&1023,l[i++]=56320|1023&r)}return l.length!==i&&(l.subarray?l=l.subarray(0,i):l.length=i),n.applyFromCharCode(l)}(e=n.transformTo(r.uint8array?"uint8array":"array",e))},n.inherits(u,o),u.prototype.processChunk=function(e){var t=n.transformTo(r.uint8array?"uint8array":"array",e.data);if(this.leftOver&&this.leftOver.length){if(r.uint8array){var s=t;(t=new Uint8Array(s.length+this.leftOver.length)).set(this.leftOver,0),t.set(s,this.leftOver.length)}else t=this.leftOver.concat(t);this.leftOver=null}var o=function(e,t){var i;for((t=t||e.length)>e.length&&(t=e.length),i=t-1;0<=i&&128==(192&e[i]);)i--;return i<0||0===i?t:i+a[e[i]]>t?i:t}(t),l=t;o!==t.length&&(r.uint8array?(l=t.subarray(0,o),this.leftOver=t.subarray(o,t.length)):(l=t.slice(0,o),this.leftOver=t.slice(o,t.length))),this.push({data:i.utf8decode(l),meta:e.meta})},u.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:i.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},i.Utf8DecodeWorker=u,n.inherits(c,o),c.prototype.processChunk=function(e){this.push({data:i.utf8encode(e.data),meta:e.meta})},i.Utf8EncodeWorker=c},{"./nodejsUtils":14,"./stream/GenericWorker":28,"./support":30,"./utils":32}],32:[function(e,t,i){"use strict";var n=e("./support"),r=e("./base64"),s=e("./nodejsUtils"),o=e("./external");function a(e){return e}function l(e,t){for(var i=0;i<e.length;++i)t[i]=255&e.charCodeAt(i);return t}e("setimmediate"),i.newBlob=function(e,t){i.checkSupport("blob");try{return new Blob([e],{type:t})}catch(i){try{var n=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);return n.append(e),n.getBlob(t)}catch(e){throw new Error("Bug : can't construct the Blob.")}}};var u={stringifyByChunk:function(e,t,i){var n=[],r=0,s=e.length;if(s<=i)return String.fromCharCode.apply(null,e);for(;r<s;)"array"===t||"nodebuffer"===t?n.push(String.fromCharCode.apply(null,e.slice(r,Math.min(r+i,s)))):n.push(String.fromCharCode.apply(null,e.subarray(r,Math.min(r+i,s)))),r+=i;return n.join("")},stringifyByChar:function(e){for(var t="",i=0;i<e.length;i++)t+=String.fromCharCode(e[i]);return t},applyCanBeUsed:{uint8array:function(){try{return n.uint8array&&1===String.fromCharCode.apply(null,new Uint8Array(1)).length}catch(e){return!1}}(),nodebuffer:function(){try{return n.nodebuffer&&1===String.fromCharCode.apply(null,s.allocBuffer(1)).length}catch(e){return!1}}()}};function c(e){var t=65536,n=i.getTypeOf(e),r=!0;if("uint8array"===n?r=u.applyCanBeUsed.uint8array:"nodebuffer"===n&&(r=u.applyCanBeUsed.nodebuffer),r)for(;1<t;)try{return u.stringifyByChunk(e,n,t)}catch(e){t=Math.floor(t/2)}return u.stringifyByChar(e)}function d(e,t){for(var i=0;i<e.length;i++)t[i]=e[i];return t}i.applyFromCharCode=c;var h={};h.string={string:a,array:function(e){return l(e,new Array(e.length))},arraybuffer:function(e){return h.string.uint8array(e).buffer},uint8array:function(e){return l(e,new Uint8Array(e.length))},nodebuffer:function(e){return l(e,s.allocBuffer(e.length))}},h.array={string:c,array:a,arraybuffer:function(e){return new Uint8Array(e).buffer},uint8array:function(e){return new Uint8Array(e)},nodebuffer:function(e){return s.newBufferFrom(e)}},h.arraybuffer={string:function(e){return c(new Uint8Array(e))},array:function(e){return d(new Uint8Array(e),new Array(e.byteLength))},arraybuffer:a,uint8array:function(e){return new Uint8Array(e)},nodebuffer:function(e){return s.newBufferFrom(new Uint8Array(e))}},h.uint8array={string:c,array:function(e){return d(e,new Array(e.length))},arraybuffer:function(e){return e.buffer},uint8array:a,nodebuffer:function(e){return s.newBufferFrom(e)}},h.nodebuffer={string:c,array:function(e){return d(e,new Array(e.length))},arraybuffer:function(e){return h.nodebuffer.uint8array(e).buffer},uint8array:function(e){return d(e,new Uint8Array(e.length))},nodebuffer:a},i.transformTo=function(e,t){if(t=t||"",!e)return t;i.checkSupport(e);var n=i.getTypeOf(t);return h[n][e](t)},i.resolve=function(e){for(var t=e.split("/"),i=[],n=0;n<t.length;n++){var r=t[n];"."===r||""===r&&0!==n&&n!==t.length-1||(".."===r?i.pop():i.push(r))}return i.join("/")},i.getTypeOf=function(e){return"string"==typeof e?"string":"[object Array]"===Object.prototype.toString.call(e)?"array":n.nodebuffer&&s.isBuffer(e)?"nodebuffer":n.uint8array&&e instanceof Uint8Array?"uint8array":n.arraybuffer&&e instanceof ArrayBuffer?"arraybuffer":void 0},i.checkSupport=function(e){if(!n[e.toLowerCase()])throw new Error(e+" is not supported by this platform")},i.MAX_VALUE_16BITS=65535,i.MAX_VALUE_32BITS=-1,i.pretty=function(e){var t,i,n="";for(i=0;i<(e||"").length;i++)n+="\\x"+((t=e.charCodeAt(i))<16?"0":"")+t.toString(16).toUpperCase();return n},i.delay=function(e,t,i){setImmediate((function(){e.apply(i||null,t||[])}))},i.inherits=function(e,t){function i(){}i.prototype=t.prototype,e.prototype=new i},i.extend=function(){var e,t,i={};for(e=0;e<arguments.length;e++)for(t in arguments[e])Object.prototype.hasOwnProperty.call(arguments[e],t)&&void 0===i[t]&&(i[t]=arguments[e][t]);return i},i.prepareContent=function(e,t,s,a,u){return o.Promise.resolve(t).then((function(e){return n.blob&&(e instanceof Blob||-1!==["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(e)))&&"undefined"!=typeof FileReader?new o.Promise((function(t,i){var n=new FileReader;n.onload=function(e){t(e.target.result)},n.onerror=function(e){i(e.target.error)},n.readAsArrayBuffer(e)})):e})).then((function(t){var c=i.getTypeOf(t);return c?("arraybuffer"===c?t=i.transformTo("uint8array",t):"string"===c&&(u?t=r.decode(t):s&&!0!==a&&(t=function(e){return l(e,n.uint8array?new Uint8Array(e.length):new Array(e.length))}(t))),t):o.Promise.reject(new Error("Can't read the data of '"+e+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))}))}},{"./base64":1,"./external":6,"./nodejsUtils":14,"./support":30,setimmediate:54}],33:[function(e,t,i){"use strict";var n=e("./reader/readerFor"),r=e("./utils"),s=e("./signature"),o=e("./zipEntry"),a=e("./support");function l(e){this.files=[],this.loadOptions=e}l.prototype={checkSignature:function(e){if(!this.reader.readAndCheckSignature(e)){this.reader.index-=4;var t=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+r.pretty(t)+", expected "+r.pretty(e)+")")}},isSignature:function(e,t){var i=this.reader.index;this.reader.setIndex(e);var n=this.reader.readString(4)===t;return this.reader.setIndex(i),n},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var e=this.reader.readData(this.zipCommentLength),t=a.uint8array?"uint8array":"array",i=r.transformTo(t,e);this.zipComment=this.loadOptions.decodeFileName(i)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var e,t,i,n=this.zip64EndOfCentralSize-44;0<n;)e=this.reader.readInt(2),t=this.reader.readInt(4),i=this.reader.readData(t),this.zip64ExtensibleData[e]={id:e,length:t,value:i}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),1<this.disksCount)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var e,t;for(e=0;e<this.files.length;e++)t=this.files[e],this.reader.setIndex(t.localHeaderOffset),this.checkSignature(s.LOCAL_FILE_HEADER),t.readLocalPart(this.reader),t.handleUTF8(),t.processAttributes()},readCentralDir:function(){var e;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(s.CENTRAL_FILE_HEADER);)(e=new o({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(e);if(this.centralDirRecords!==this.files.length&&0!==this.centralDirRecords&&0===this.files.length)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var e=this.reader.lastIndexOfSignature(s.CENTRAL_DIRECTORY_END);if(e<0)throw this.isSignature(0,s.LOCAL_FILE_HEADER)?new Error("Corrupted zip: can't find end of central directory"):new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html");this.reader.setIndex(e);var t=e;if(this.checkSignature(s.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===r.MAX_VALUE_16BITS||this.diskWithCentralDirStart===r.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===r.MAX_VALUE_16BITS||this.centralDirRecords===r.MAX_VALUE_16BITS||this.centralDirSize===r.MAX_VALUE_32BITS||this.centralDirOffset===r.MAX_VALUE_32BITS){if(this.zip64=!0,(e=this.reader.lastIndexOfSignature(s.ZIP64_CENTRAL_DIRECTORY_LOCATOR))<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(e),this.checkSignature(s.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,s.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(s.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(s.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var i=this.centralDirOffset+this.centralDirSize;this.zip64&&(i+=20,i+=12+this.zip64EndOfCentralSize);var n=t-i;if(0<n)this.isSignature(t,s.CENTRAL_FILE_HEADER)||(this.reader.zero=n);else if(n<0)throw new Error("Corrupted zip: missing "+Math.abs(n)+" bytes.")},prepareReader:function(e){this.reader=n(e)},load:function(e){this.prepareReader(e),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},t.exports=l},{"./reader/readerFor":22,"./signature":23,"./support":30,"./utils":32,"./zipEntry":34}],34:[function(e,t,i){"use strict";var n=e("./reader/readerFor"),r=e("./utils"),s=e("./compressedObject"),o=e("./crc32"),a=e("./utf8"),l=e("./compressions"),u=e("./support");function c(e,t){this.options=e,this.loadOptions=t}c.prototype={isEncrypted:function(){return 1==(1&this.bitFlag)},useUTF8:function(){return 2048==(2048&this.bitFlag)},readLocalPart:function(e){var t,i;if(e.skip(22),this.fileNameLength=e.readInt(2),i=e.readInt(2),this.fileName=e.readData(this.fileNameLength),e.skip(i),-1===this.compressedSize||-1===this.uncompressedSize)throw new Error("Bug or corrupted zip : didn't get enough information from the central directory (compressedSize === -1 || uncompressedSize === -1)");if(null===(t=function(e){for(var t in l)if(Object.prototype.hasOwnProperty.call(l,t)&&l[t].magic===e)return l[t];return null}(this.compressionMethod)))throw new Error("Corrupted zip : compression "+r.pretty(this.compressionMethod)+" unknown (inner file : "+r.transformTo("string",this.fileName)+")");this.decompressed=new s(this.compressedSize,this.uncompressedSize,this.crc32,t,e.readData(this.compressedSize))},readCentralPart:function(e){this.versionMadeBy=e.readInt(2),e.skip(2),this.bitFlag=e.readInt(2),this.compressionMethod=e.readString(2),this.date=e.readDate(),this.crc32=e.readInt(4),this.compressedSize=e.readInt(4),this.uncompressedSize=e.readInt(4);var t=e.readInt(2);if(this.extraFieldsLength=e.readInt(2),this.fileCommentLength=e.readInt(2),this.diskNumberStart=e.readInt(2),this.internalFileAttributes=e.readInt(2),this.externalFileAttributes=e.readInt(4),this.localHeaderOffset=e.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");e.skip(t),this.readExtraFields(e),this.parseZIP64ExtraField(e),this.fileComment=e.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var e=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),0==e&&(this.dosPermissions=63&this.externalFileAttributes),3==e&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||"/"!==this.fileNameStr.slice(-1)||(this.dir=!0)},parseZIP64ExtraField:function(){if(this.extraFields[1]){var e=n(this.extraFields[1].value);this.uncompressedSize===r.MAX_VALUE_32BITS&&(this.uncompressedSize=e.readInt(8)),this.compressedSize===r.MAX_VALUE_32BITS&&(this.compressedSize=e.readInt(8)),this.localHeaderOffset===r.MAX_VALUE_32BITS&&(this.localHeaderOffset=e.readInt(8)),this.diskNumberStart===r.MAX_VALUE_32BITS&&(this.diskNumberStart=e.readInt(4))}},readExtraFields:function(e){var t,i,n,r=e.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});e.index+4<r;)t=e.readInt(2),i=e.readInt(2),n=e.readData(i),this.extraFields[t]={id:t,length:i,value:n};e.setIndex(r)},handleUTF8:function(){var e=u.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=a.utf8decode(this.fileName),this.fileCommentStr=a.utf8decode(this.fileComment);else{var t=this.findExtraFieldUnicodePath();if(null!==t)this.fileNameStr=t;else{var i=r.transformTo(e,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(i)}var n=this.findExtraFieldUnicodeComment();if(null!==n)this.fileCommentStr=n;else{var s=r.transformTo(e,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(s)}}},findExtraFieldUnicodePath:function(){var e=this.extraFields[28789];if(e){var t=n(e.value);return 1!==t.readInt(1)||o(this.fileName)!==t.readInt(4)?null:a.utf8decode(t.readData(e.length-5))}return null},findExtraFieldUnicodeComment:function(){var e=this.extraFields[25461];if(e){var t=n(e.value);return 1!==t.readInt(1)||o(this.fileComment)!==t.readInt(4)?null:a.utf8decode(t.readData(e.length-5))}return null}},t.exports=c},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":22,"./support":30,"./utf8":31,"./utils":32}],35:[function(e,t,i){"use strict";function n(e,t,i){this.name=e,this.dir=i.dir,this.date=i.date,this.comment=i.comment,this.unixPermissions=i.unixPermissions,this.dosPermissions=i.dosPermissions,this._data=t,this._dataBinary=i.binary,this.options={compression:i.compression,compressionOptions:i.compressionOptions}}var r=e("./stream/StreamHelper"),s=e("./stream/DataWorker"),o=e("./utf8"),a=e("./compressedObject"),l=e("./stream/GenericWorker");n.prototype={internalStream:function(e){var t=null,i="string";try{if(!e)throw new Error("No output type specified.");var n="string"===(i=e.toLowerCase())||"text"===i;"binarystring"!==i&&"text"!==i||(i="string"),t=this._decompressWorker();var s=!this._dataBinary;s&&!n&&(t=t.pipe(new o.Utf8EncodeWorker)),!s&&n&&(t=t.pipe(new o.Utf8DecodeWorker))}catch(e){(t=new l("error")).error(e)}return new r(t,i,"")},async:function(e,t){return this.internalStream(e).accumulate(t)},nodeStream:function(e,t){return this.internalStream(e||"nodebuffer").toNodejsStream(t)},_compressWorker:function(e,t){if(this._data instanceof a&&this._data.compression.magic===e.magic)return this._data.getCompressedWorker();var i=this._decompressWorker();return this._dataBinary||(i=i.pipe(new o.Utf8EncodeWorker)),a.createWorkerFrom(i,e,t)},_decompressWorker:function(){return this._data instanceof a?this._data.getContentWorker():this._data instanceof l?this._data:new s(this._data)}};for(var u=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],c=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},d=0;d<u.length;d++)n.prototype[u[d]]=c;t.exports=n},{"./compressedObject":2,"./stream/DataWorker":27,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31}],36:[function(e,t,n){(function(e){"use strict";var i,n,r=e.MutationObserver||e.WebKitMutationObserver;if(r){var s=0,o=new r(c),a=e.document.createTextNode("");o.observe(a,{characterData:!0}),i=function(){a.data=s=++s%2}}else if(e.setImmediate||void 0===e.MessageChannel)i="document"in e&&"onreadystatechange"in e.document.createElement("script")?function(){var t=e.document.createElement("script");t.onreadystatechange=function(){c(),t.onreadystatechange=null,t.parentNode.removeChild(t),t=null},e.document.documentElement.appendChild(t)}:function(){setTimeout(c,0)};else{var l=new e.MessageChannel;l.port1.onmessage=c,i=function(){l.port2.postMessage(0)}}var u=[];function c(){var e,t;n=!0;for(var i=u.length;i;){for(t=u,u=[],e=-1;++e<i;)t[e]();i=u.length}n=!1}t.exports=function(e){1!==u.push(e)||n||i()}}).call(this,void 0!==i.g?i.g:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],37:[function(e,t,i){"use strict";var n=e("immediate");function r(){}var s={},o=["REJECTED"],a=["FULFILLED"],l=["PENDING"];function u(e){if("function"!=typeof e)throw new TypeError("resolver must be a function");this.state=l,this.queue=[],this.outcome=void 0,e!==r&&p(this,e)}function c(e,t,i){this.promise=e,"function"==typeof t&&(this.onFulfilled=t,this.callFulfilled=this.otherCallFulfilled),"function"==typeof i&&(this.onRejected=i,this.callRejected=this.otherCallRejected)}function d(e,t,i){n((function(){var n;try{n=t(i)}catch(n){return s.reject(e,n)}n===e?s.reject(e,new TypeError("Cannot resolve promise with itself")):s.resolve(e,n)}))}function h(e){var t=e&&e.then;if(e&&("object"==typeof e||"function"==typeof e)&&"function"==typeof t)return function(){t.apply(e,arguments)}}function p(e,t){var i=!1;function n(t){i||(i=!0,s.reject(e,t))}function r(t){i||(i=!0,s.resolve(e,t))}var o=f((function(){t(r,n)}));"error"===o.status&&n(o.value)}function f(e,t){var i={};try{i.value=e(t),i.status="success"}catch(e){i.status="error",i.value=e}return i}(t.exports=u).prototype.finally=function(e){if("function"!=typeof e)return this;var t=this.constructor;return this.then((function(i){return t.resolve(e()).then((function(){return i}))}),(function(i){return t.resolve(e()).then((function(){throw i}))}))},u.prototype.catch=function(e){return this.then(null,e)},u.prototype.then=function(e,t){if("function"!=typeof e&&this.state===a||"function"!=typeof t&&this.state===o)return this;var i=new this.constructor(r);return this.state!==l?d(i,this.state===a?e:t,this.outcome):this.queue.push(new c(i,e,t)),i},c.prototype.callFulfilled=function(e){s.resolve(this.promise,e)},c.prototype.otherCallFulfilled=function(e){d(this.promise,this.onFulfilled,e)},c.prototype.callRejected=function(e){s.reject(this.promise,e)},c.prototype.otherCallRejected=function(e){d(this.promise,this.onRejected,e)},s.resolve=function(e,t){var i=f(h,t);if("error"===i.status)return s.reject(e,i.value);var n=i.value;if(n)p(e,n);else{e.state=a,e.outcome=t;for(var r=-1,o=e.queue.length;++r<o;)e.queue[r].callFulfilled(t)}return e},s.reject=function(e,t){e.state=o,e.outcome=t;for(var i=-1,n=e.queue.length;++i<n;)e.queue[i].callRejected(t);return e},u.resolve=function(e){return e instanceof this?e:s.resolve(new this(r),e)},u.reject=function(e){var t=new this(r);return s.reject(t,e)},u.all=function(e){var t=this;if("[object Array]"!==Object.prototype.toString.call(e))return this.reject(new TypeError("must be an array"));var i=e.length,n=!1;if(!i)return this.resolve([]);for(var o=new Array(i),a=0,l=-1,u=new this(r);++l<i;)c(e[l],l);return u;function c(e,r){t.resolve(e).then((function(e){o[r]=e,++a!==i||n||(n=!0,s.resolve(u,o))}),(function(e){n||(n=!0,s.reject(u,e))}))}},u.race=function(e){if("[object Array]"!==Object.prototype.toString.call(e))return this.reject(new TypeError("must be an array"));var t=e.length,i=!1;if(!t)return this.resolve([]);for(var n,o=-1,a=new this(r);++o<t;)n=e[o],this.resolve(n).then((function(e){i||(i=!0,s.resolve(a,e))}),(function(e){i||(i=!0,s.reject(a,e))}));return a}},{immediate:36}],38:[function(e,t,i){"use strict";var n={};(0,e("./lib/utils/common").assign)(n,e("./lib/deflate"),e("./lib/inflate"),e("./lib/zlib/constants")),t.exports=n},{"./lib/deflate":39,"./lib/inflate":40,"./lib/utils/common":41,"./lib/zlib/constants":44}],39:[function(e,t,i){"use strict";var n=e("./zlib/deflate"),r=e("./utils/common"),s=e("./utils/strings"),o=e("./zlib/messages"),a=e("./zlib/zstream"),l=Object.prototype.toString;function u(e){if(!(this instanceof u))return new u(e);this.options=r.assign({level:-1,method:8,chunkSize:16384,windowBits:15,memLevel:8,strategy:0,to:""},e||{});var t=this.options;t.raw&&0<t.windowBits?t.windowBits=-t.windowBits:t.gzip&&0<t.windowBits&&t.windowBits<16&&(t.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new a,this.strm.avail_out=0;var i=n.deflateInit2(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(0!==i)throw new Error(o[i]);if(t.header&&n.deflateSetHeader(this.strm,t.header),t.dictionary){var c;if(c="string"==typeof t.dictionary?s.string2buf(t.dictionary):"[object ArrayBuffer]"===l.call(t.dictionary)?new Uint8Array(t.dictionary):t.dictionary,0!==(i=n.deflateSetDictionary(this.strm,c)))throw new Error(o[i]);this._dict_set=!0}}function c(e,t){var i=new u(t);if(i.push(e,!0),i.err)throw i.msg||o[i.err];return i.result}u.prototype.push=function(e,t){var i,o,a=this.strm,u=this.options.chunkSize;if(this.ended)return!1;o=t===~~t?t:!0===t?4:0,"string"==typeof e?a.input=s.string2buf(e):"[object ArrayBuffer]"===l.call(e)?a.input=new Uint8Array(e):a.input=e,a.next_in=0,a.avail_in=a.input.length;do{if(0===a.avail_out&&(a.output=new r.Buf8(u),a.next_out=0,a.avail_out=u),1!==(i=n.deflate(a,o))&&0!==i)return this.onEnd(i),!(this.ended=!0);0!==a.avail_out&&(0!==a.avail_in||4!==o&&2!==o)||("string"===this.options.to?this.onData(s.buf2binstring(r.shrinkBuf(a.output,a.next_out))):this.onData(r.shrinkBuf(a.output,a.next_out)))}while((0<a.avail_in||0===a.avail_out)&&1!==i);return 4===o?(i=n.deflateEnd(this.strm),this.onEnd(i),this.ended=!0,0===i):2!==o||(this.onEnd(0),!(a.avail_out=0))},u.prototype.onData=function(e){this.chunks.push(e)},u.prototype.onEnd=function(e){0===e&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=r.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg},i.Deflate=u,i.deflate=c,i.deflateRaw=function(e,t){return(t=t||{}).raw=!0,c(e,t)},i.gzip=function(e,t){return(t=t||{}).gzip=!0,c(e,t)}},{"./utils/common":41,"./utils/strings":42,"./zlib/deflate":46,"./zlib/messages":51,"./zlib/zstream":53}],40:[function(e,t,i){"use strict";var n=e("./zlib/inflate"),r=e("./utils/common"),s=e("./utils/strings"),o=e("./zlib/constants"),a=e("./zlib/messages"),l=e("./zlib/zstream"),u=e("./zlib/gzheader"),c=Object.prototype.toString;function d(e){if(!(this instanceof d))return new d(e);this.options=r.assign({chunkSize:16384,windowBits:0,to:""},e||{});var t=this.options;t.raw&&0<=t.windowBits&&t.windowBits<16&&(t.windowBits=-t.windowBits,0===t.windowBits&&(t.windowBits=-15)),!(0<=t.windowBits&&t.windowBits<16)||e&&e.windowBits||(t.windowBits+=32),15<t.windowBits&&t.windowBits<48&&0==(15&t.windowBits)&&(t.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new l,this.strm.avail_out=0;var i=n.inflateInit2(this.strm,t.windowBits);if(i!==o.Z_OK)throw new Error(a[i]);this.header=new u,n.inflateGetHeader(this.strm,this.header)}function h(e,t){var i=new d(t);if(i.push(e,!0),i.err)throw i.msg||a[i.err];return i.result}d.prototype.push=function(e,t){var i,a,l,u,d,h,p=this.strm,f=this.options.chunkSize,g=this.options.dictionary,m=!1;if(this.ended)return!1;a=t===~~t?t:!0===t?o.Z_FINISH:o.Z_NO_FLUSH,"string"==typeof e?p.input=s.binstring2buf(e):"[object ArrayBuffer]"===c.call(e)?p.input=new Uint8Array(e):p.input=e,p.next_in=0,p.avail_in=p.input.length;do{if(0===p.avail_out&&(p.output=new r.Buf8(f),p.next_out=0,p.avail_out=f),(i=n.inflate(p,o.Z_NO_FLUSH))===o.Z_NEED_DICT&&g&&(h="string"==typeof g?s.string2buf(g):"[object ArrayBuffer]"===c.call(g)?new Uint8Array(g):g,i=n.inflateSetDictionary(this.strm,h)),i===o.Z_BUF_ERROR&&!0===m&&(i=o.Z_OK,m=!1),i!==o.Z_STREAM_END&&i!==o.Z_OK)return this.onEnd(i),!(this.ended=!0);p.next_out&&(0!==p.avail_out&&i!==o.Z_STREAM_END&&(0!==p.avail_in||a!==o.Z_FINISH&&a!==o.Z_SYNC_FLUSH)||("string"===this.options.to?(l=s.utf8border(p.output,p.next_out),u=p.next_out-l,d=s.buf2string(p.output,l),p.next_out=u,p.avail_out=f-u,u&&r.arraySet(p.output,p.output,l,u,0),this.onData(d)):this.onData(r.shrinkBuf(p.output,p.next_out)))),0===p.avail_in&&0===p.avail_out&&(m=!0)}while((0<p.avail_in||0===p.avail_out)&&i!==o.Z_STREAM_END);return i===o.Z_STREAM_END&&(a=o.Z_FINISH),a===o.Z_FINISH?(i=n.inflateEnd(this.strm),this.onEnd(i),this.ended=!0,i===o.Z_OK):a!==o.Z_SYNC_FLUSH||(this.onEnd(o.Z_OK),!(p.avail_out=0))},d.prototype.onData=function(e){this.chunks.push(e)},d.prototype.onEnd=function(e){e===o.Z_OK&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=r.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg},i.Inflate=d,i.inflate=h,i.inflateRaw=function(e,t){return(t=t||{}).raw=!0,h(e,t)},i.ungzip=h},{"./utils/common":41,"./utils/strings":42,"./zlib/constants":44,"./zlib/gzheader":47,"./zlib/inflate":49,"./zlib/messages":51,"./zlib/zstream":53}],41:[function(e,t,i){"use strict";var n="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Int32Array;i.assign=function(e){for(var t=Array.prototype.slice.call(arguments,1);t.length;){var i=t.shift();if(i){if("object"!=typeof i)throw new TypeError(i+"must be non-object");for(var n in i)i.hasOwnProperty(n)&&(e[n]=i[n])}}return e},i.shrinkBuf=function(e,t){return e.length===t?e:e.subarray?e.subarray(0,t):(e.length=t,e)};var r={arraySet:function(e,t,i,n,r){if(t.subarray&&e.subarray)e.set(t.subarray(i,i+n),r);else for(var s=0;s<n;s++)e[r+s]=t[i+s]},flattenChunks:function(e){var t,i,n,r,s,o;for(t=n=0,i=e.length;t<i;t++)n+=e[t].length;for(o=new Uint8Array(n),t=r=0,i=e.length;t<i;t++)s=e[t],o.set(s,r),r+=s.length;return o}},s={arraySet:function(e,t,i,n,r){for(var s=0;s<n;s++)e[r+s]=t[i+s]},flattenChunks:function(e){return[].concat.apply([],e)}};i.setTyped=function(e){e?(i.Buf8=Uint8Array,i.Buf16=Uint16Array,i.Buf32=Int32Array,i.assign(i,r)):(i.Buf8=Array,i.Buf16=Array,i.Buf32=Array,i.assign(i,s))},i.setTyped(n)},{}],42:[function(e,t,i){"use strict";var n=e("./common"),r=!0,s=!0;try{String.fromCharCode.apply(null,[0])}catch(e){r=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(e){s=!1}for(var o=new n.Buf8(256),a=0;a<256;a++)o[a]=252<=a?6:248<=a?5:240<=a?4:224<=a?3:192<=a?2:1;function l(e,t){if(t<65537&&(e.subarray&&s||!e.subarray&&r))return String.fromCharCode.apply(null,n.shrinkBuf(e,t));for(var i="",o=0;o<t;o++)i+=String.fromCharCode(e[o]);return i}o[254]=o[254]=1,i.string2buf=function(e){var t,i,r,s,o,a=e.length,l=0;for(s=0;s<a;s++)55296==(64512&(i=e.charCodeAt(s)))&&s+1<a&&56320==(64512&(r=e.charCodeAt(s+1)))&&(i=65536+(i-55296<<10)+(r-56320),s++),l+=i<128?1:i<2048?2:i<65536?3:4;for(t=new n.Buf8(l),s=o=0;o<l;s++)55296==(64512&(i=e.charCodeAt(s)))&&s+1<a&&56320==(64512&(r=e.charCodeAt(s+1)))&&(i=65536+(i-55296<<10)+(r-56320),s++),i<128?t[o++]=i:(i<2048?t[o++]=192|i>>>6:(i<65536?t[o++]=224|i>>>12:(t[o++]=240|i>>>18,t[o++]=128|i>>>12&63),t[o++]=128|i>>>6&63),t[o++]=128|63&i);return t},i.buf2binstring=function(e){return l(e,e.length)},i.binstring2buf=function(e){for(var t=new n.Buf8(e.length),i=0,r=t.length;i<r;i++)t[i]=e.charCodeAt(i);return t},i.buf2string=function(e,t){var i,n,r,s,a=t||e.length,u=new Array(2*a);for(i=n=0;i<a;)if((r=e[i++])<128)u[n++]=r;else if(4<(s=o[r]))u[n++]=65533,i+=s-1;else{for(r&=2===s?31:3===s?15:7;1<s&&i<a;)r=r<<6|63&e[i++],s--;1<s?u[n++]=65533:r<65536?u[n++]=r:(r-=65536,u[n++]=55296|r>>10&1023,u[n++]=56320|1023&r)}return l(u,n)},i.utf8border=function(e,t){var i;for((t=t||e.length)>e.length&&(t=e.length),i=t-1;0<=i&&128==(192&e[i]);)i--;return i<0||0===i?t:i+o[e[i]]>t?i:t}},{"./common":41}],43:[function(e,t,i){"use strict";t.exports=function(e,t,i,n){for(var r=65535&e|0,s=e>>>16&65535|0,o=0;0!==i;){for(i-=o=2e3<i?2e3:i;s=s+(r=r+t[n++]|0)|0,--o;);r%=65521,s%=65521}return r|s<<16|0}},{}],44:[function(e,t,i){"use strict";t.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],45:[function(e,t,i){"use strict";var n=function(){for(var e,t=[],i=0;i<256;i++){e=i;for(var n=0;n<8;n++)e=1&e?3988292384^e>>>1:e>>>1;t[i]=e}return t}();t.exports=function(e,t,i,r){var s=n,o=r+i;e^=-1;for(var a=r;a<o;a++)e=e>>>8^s[255&(e^t[a])];return-1^e}},{}],46:[function(e,t,i){"use strict";var n,r=e("../utils/common"),s=e("./trees"),o=e("./adler32"),a=e("./crc32"),l=e("./messages"),u=-2,c=258,d=262,h=113;function p(e,t){return e.msg=l[t],t}function f(e){return(e<<1)-(4<e?9:0)}function g(e){for(var t=e.length;0<=--t;)e[t]=0}function m(e){var t=e.state,i=t.pending;i>e.avail_out&&(i=e.avail_out),0!==i&&(r.arraySet(e.output,t.pending_buf,t.pending_out,i,e.next_out),e.next_out+=i,t.pending_out+=i,e.total_out+=i,e.avail_out-=i,t.pending-=i,0===t.pending&&(t.pending_out=0))}function v(e,t){s._tr_flush_block(e,0<=e.block_start?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,m(e.strm)}function y(e,t){e.pending_buf[e.pending++]=t}function w(e,t){e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=255&t}function b(e,t){var i,n,r=e.max_chain_length,s=e.strstart,o=e.prev_length,a=e.nice_match,l=e.strstart>e.w_size-d?e.strstart-(e.w_size-d):0,u=e.window,h=e.w_mask,p=e.prev,f=e.strstart+c,g=u[s+o-1],m=u[s+o];e.prev_length>=e.good_match&&(r>>=2),a>e.lookahead&&(a=e.lookahead);do{if(u[(i=t)+o]===m&&u[i+o-1]===g&&u[i]===u[s]&&u[++i]===u[s+1]){s+=2,i++;do{}while(u[++s]===u[++i]&&u[++s]===u[++i]&&u[++s]===u[++i]&&u[++s]===u[++i]&&u[++s]===u[++i]&&u[++s]===u[++i]&&u[++s]===u[++i]&&u[++s]===u[++i]&&s<f);if(n=c-(f-s),s=f-c,o<n){if(e.match_start=t,a<=(o=n))break;g=u[s+o-1],m=u[s+o]}}}while((t=p[t&h])>l&&0!=--r);return o<=e.lookahead?o:e.lookahead}function x(e){var t,i,n,s,l,u,c,h,p,f,g=e.w_size;do{if(s=e.window_size-e.lookahead-e.strstart,e.strstart>=g+(g-d)){for(r.arraySet(e.window,e.window,g,g,0),e.match_start-=g,e.strstart-=g,e.block_start-=g,t=i=e.hash_size;n=e.head[--t],e.head[t]=g<=n?n-g:0,--i;);for(t=i=g;n=e.prev[--t],e.prev[t]=g<=n?n-g:0,--i;);s+=g}if(0===e.strm.avail_in)break;if(u=e.strm,c=e.window,h=e.strstart+e.lookahead,f=void 0,(p=s)<(f=u.avail_in)&&(f=p),i=0===f?0:(u.avail_in-=f,r.arraySet(c,u.input,u.next_in,f,h),1===u.state.wrap?u.adler=o(u.adler,c,f,h):2===u.state.wrap&&(u.adler=a(u.adler,c,f,h)),u.next_in+=f,u.total_in+=f,f),e.lookahead+=i,e.lookahead+e.insert>=3)for(l=e.strstart-e.insert,e.ins_h=e.window[l],e.ins_h=(e.ins_h<<e.hash_shift^e.window[l+1])&e.hash_mask;e.insert&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[l+3-1])&e.hash_mask,e.prev[l&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=l,l++,e.insert--,!(e.lookahead+e.insert<3)););}while(e.lookahead<d&&0!==e.strm.avail_in)}function _(e,t){for(var i,n;;){if(e.lookahead<d){if(x(e),e.lookahead<d&&0===t)return 1;if(0===e.lookahead)break}if(i=0,e.lookahead>=3&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+3-1])&e.hash_mask,i=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),0!==i&&e.strstart-i<=e.w_size-d&&(e.match_length=b(e,i)),e.match_length>=3)if(n=s._tr_tally(e,e.strstart-e.match_start,e.match_length-3),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=3){for(e.match_length--;e.strstart++,e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+3-1])&e.hash_mask,i=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart,0!=--e.match_length;);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+1])&e.hash_mask;else n=s._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(n&&(v(e,!1),0===e.strm.avail_out))return 1}return e.insert=e.strstart<2?e.strstart:2,4===t?(v(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(v(e,!1),0===e.strm.avail_out)?1:2}function k(e,t){for(var i,n,r;;){if(e.lookahead<d){if(x(e),e.lookahead<d&&0===t)return 1;if(0===e.lookahead)break}if(i=0,e.lookahead>=3&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+3-1])&e.hash_mask,i=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=2,0!==i&&e.prev_length<e.max_lazy_match&&e.strstart-i<=e.w_size-d&&(e.match_length=b(e,i),e.match_length<=5&&(1===e.strategy||3===e.match_length&&4096<e.strstart-e.match_start)&&(e.match_length=2)),e.prev_length>=3&&e.match_length<=e.prev_length){for(r=e.strstart+e.lookahead-3,n=s._tr_tally(e,e.strstart-1-e.prev_match,e.prev_length-3),e.lookahead-=e.prev_length-1,e.prev_length-=2;++e.strstart<=r&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+3-1])&e.hash_mask,i=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),0!=--e.prev_length;);if(e.match_available=0,e.match_length=2,e.strstart++,n&&(v(e,!1),0===e.strm.avail_out))return 1}else if(e.match_available){if((n=s._tr_tally(e,0,e.window[e.strstart-1]))&&v(e,!1),e.strstart++,e.lookahead--,0===e.strm.avail_out)return 1}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(n=s._tr_tally(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<2?e.strstart:2,4===t?(v(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(v(e,!1),0===e.strm.avail_out)?1:2}function C(e,t,i,n,r){this.good_length=e,this.max_lazy=t,this.nice_length=i,this.max_chain=n,this.func=r}function T(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=8,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new r.Buf16(1146),this.dyn_dtree=new r.Buf16(122),this.bl_tree=new r.Buf16(78),g(this.dyn_ltree),g(this.dyn_dtree),g(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new r.Buf16(16),this.heap=new r.Buf16(573),g(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new r.Buf16(573),g(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function S(e){var t;return e&&e.state?(e.total_in=e.total_out=0,e.data_type=2,(t=e.state).pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=t.wrap?42:h,e.adler=2===t.wrap?0:1,t.last_flush=0,s._tr_init(t),0):p(e,u)}function O(e){var t=S(e);return 0===t&&function(e){e.window_size=2*e.w_size,g(e.head),e.max_lazy_match=n[e.level].max_lazy,e.good_match=n[e.level].good_length,e.nice_match=n[e.level].nice_length,e.max_chain_length=n[e.level].max_chain,e.strstart=0,e.block_start=0,e.lookahead=0,e.insert=0,e.match_length=e.prev_length=2,e.match_available=0,e.ins_h=0}(e.state),t}function E(e,t,i,n,s,o){if(!e)return u;var a=1;if(-1===t&&(t=6),n<0?(a=0,n=-n):15<n&&(a=2,n-=16),s<1||9<s||8!==i||n<8||15<n||t<0||9<t||o<0||4<o)return p(e,u);8===n&&(n=9);var l=new T;return(e.state=l).strm=e,l.wrap=a,l.gzhead=null,l.w_bits=n,l.w_size=1<<l.w_bits,l.w_mask=l.w_size-1,l.hash_bits=s+7,l.hash_size=1<<l.hash_bits,l.hash_mask=l.hash_size-1,l.hash_shift=~~((l.hash_bits+3-1)/3),l.window=new r.Buf8(2*l.w_size),l.head=new r.Buf16(l.hash_size),l.prev=new r.Buf16(l.w_size),l.lit_bufsize=1<<s+6,l.pending_buf_size=4*l.lit_bufsize,l.pending_buf=new r.Buf8(l.pending_buf_size),l.d_buf=1*l.lit_bufsize,l.l_buf=3*l.lit_bufsize,l.level=t,l.strategy=o,l.method=i,O(e)}n=[new C(0,0,0,0,(function(e,t){var i=65535;for(i>e.pending_buf_size-5&&(i=e.pending_buf_size-5);;){if(e.lookahead<=1){if(x(e),0===e.lookahead&&0===t)return 1;if(0===e.lookahead)break}e.strstart+=e.lookahead,e.lookahead=0;var n=e.block_start+i;if((0===e.strstart||e.strstart>=n)&&(e.lookahead=e.strstart-n,e.strstart=n,v(e,!1),0===e.strm.avail_out))return 1;if(e.strstart-e.block_start>=e.w_size-d&&(v(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,4===t?(v(e,!0),0===e.strm.avail_out?3:4):(e.strstart>e.block_start&&(v(e,!1),e.strm.avail_out),1)})),new C(4,4,8,4,_),new C(4,5,16,8,_),new C(4,6,32,32,_),new C(4,4,16,16,k),new C(8,16,32,32,k),new C(8,16,128,128,k),new C(8,32,128,256,k),new C(32,128,258,1024,k),new C(32,258,258,4096,k)],i.deflateInit=function(e,t){return E(e,t,8,15,8,0)},i.deflateInit2=E,i.deflateReset=O,i.deflateResetKeep=S,i.deflateSetHeader=function(e,t){return e&&e.state?2!==e.state.wrap?u:(e.state.gzhead=t,0):u},i.deflate=function(e,t){var i,r,o,l;if(!e||!e.state||5<t||t<0)return e?p(e,u):u;if(r=e.state,!e.output||!e.input&&0!==e.avail_in||666===r.status&&4!==t)return p(e,0===e.avail_out?-5:u);if(r.strm=e,i=r.last_flush,r.last_flush=t,42===r.status)if(2===r.wrap)e.adler=0,y(r,31),y(r,139),y(r,8),r.gzhead?(y(r,(r.gzhead.text?1:0)+(r.gzhead.hcrc?2:0)+(r.gzhead.extra?4:0)+(r.gzhead.name?8:0)+(r.gzhead.comment?16:0)),y(r,255&r.gzhead.time),y(r,r.gzhead.time>>8&255),y(r,r.gzhead.time>>16&255),y(r,r.gzhead.time>>24&255),y(r,9===r.level?2:2<=r.strategy||r.level<2?4:0),y(r,255&r.gzhead.os),r.gzhead.extra&&r.gzhead.extra.length&&(y(r,255&r.gzhead.extra.length),y(r,r.gzhead.extra.length>>8&255)),r.gzhead.hcrc&&(e.adler=a(e.adler,r.pending_buf,r.pending,0)),r.gzindex=0,r.status=69):(y(r,0),y(r,0),y(r,0),y(r,0),y(r,0),y(r,9===r.level?2:2<=r.strategy||r.level<2?4:0),y(r,3),r.status=h);else{var d=8+(r.w_bits-8<<4)<<8;d|=(2<=r.strategy||r.level<2?0:r.level<6?1:6===r.level?2:3)<<6,0!==r.strstart&&(d|=32),d+=31-d%31,r.status=h,w(r,d),0!==r.strstart&&(w(r,e.adler>>>16),w(r,65535&e.adler)),e.adler=1}if(69===r.status)if(r.gzhead.extra){for(o=r.pending;r.gzindex<(65535&r.gzhead.extra.length)&&(r.pending!==r.pending_buf_size||(r.gzhead.hcrc&&r.pending>o&&(e.adler=a(e.adler,r.pending_buf,r.pending-o,o)),m(e),o=r.pending,r.pending!==r.pending_buf_size));)y(r,255&r.gzhead.extra[r.gzindex]),r.gzindex++;r.gzhead.hcrc&&r.pending>o&&(e.adler=a(e.adler,r.pending_buf,r.pending-o,o)),r.gzindex===r.gzhead.extra.length&&(r.gzindex=0,r.status=73)}else r.status=73;if(73===r.status)if(r.gzhead.name){o=r.pending;do{if(r.pending===r.pending_buf_size&&(r.gzhead.hcrc&&r.pending>o&&(e.adler=a(e.adler,r.pending_buf,r.pending-o,o)),m(e),o=r.pending,r.pending===r.pending_buf_size)){l=1;break}l=r.gzindex<r.gzhead.name.length?255&r.gzhead.name.charCodeAt(r.gzindex++):0,y(r,l)}while(0!==l);r.gzhead.hcrc&&r.pending>o&&(e.adler=a(e.adler,r.pending_buf,r.pending-o,o)),0===l&&(r.gzindex=0,r.status=91)}else r.status=91;if(91===r.status)if(r.gzhead.comment){o=r.pending;do{if(r.pending===r.pending_buf_size&&(r.gzhead.hcrc&&r.pending>o&&(e.adler=a(e.adler,r.pending_buf,r.pending-o,o)),m(e),o=r.pending,r.pending===r.pending_buf_size)){l=1;break}l=r.gzindex<r.gzhead.comment.length?255&r.gzhead.comment.charCodeAt(r.gzindex++):0,y(r,l)}while(0!==l);r.gzhead.hcrc&&r.pending>o&&(e.adler=a(e.adler,r.pending_buf,r.pending-o,o)),0===l&&(r.status=103)}else r.status=103;if(103===r.status&&(r.gzhead.hcrc?(r.pending+2>r.pending_buf_size&&m(e),r.pending+2<=r.pending_buf_size&&(y(r,255&e.adler),y(r,e.adler>>8&255),e.adler=0,r.status=h)):r.status=h),0!==r.pending){if(m(e),0===e.avail_out)return r.last_flush=-1,0}else if(0===e.avail_in&&f(t)<=f(i)&&4!==t)return p(e,-5);if(666===r.status&&0!==e.avail_in)return p(e,-5);if(0!==e.avail_in||0!==r.lookahead||0!==t&&666!==r.status){var b=2===r.strategy?function(e,t){for(var i;;){if(0===e.lookahead&&(x(e),0===e.lookahead)){if(0===t)return 1;break}if(e.match_length=0,i=s._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++,i&&(v(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,4===t?(v(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(v(e,!1),0===e.strm.avail_out)?1:2}(r,t):3===r.strategy?function(e,t){for(var i,n,r,o,a=e.window;;){if(e.lookahead<=c){if(x(e),e.lookahead<=c&&0===t)return 1;if(0===e.lookahead)break}if(e.match_length=0,e.lookahead>=3&&0<e.strstart&&(n=a[r=e.strstart-1])===a[++r]&&n===a[++r]&&n===a[++r]){o=e.strstart+c;do{}while(n===a[++r]&&n===a[++r]&&n===a[++r]&&n===a[++r]&&n===a[++r]&&n===a[++r]&&n===a[++r]&&n===a[++r]&&r<o);e.match_length=c-(o-r),e.match_length>e.lookahead&&(e.match_length=e.lookahead)}if(e.match_length>=3?(i=s._tr_tally(e,1,e.match_length-3),e.lookahead-=e.match_length,e.strstart+=e.match_length,e.match_length=0):(i=s._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++),i&&(v(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,4===t?(v(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(v(e,!1),0===e.strm.avail_out)?1:2}(r,t):n[r.level].func(r,t);if(3!==b&&4!==b||(r.status=666),1===b||3===b)return 0===e.avail_out&&(r.last_flush=-1),0;if(2===b&&(1===t?s._tr_align(r):5!==t&&(s._tr_stored_block(r,0,0,!1),3===t&&(g(r.head),0===r.lookahead&&(r.strstart=0,r.block_start=0,r.insert=0))),m(e),0===e.avail_out))return r.last_flush=-1,0}return 4!==t?0:r.wrap<=0?1:(2===r.wrap?(y(r,255&e.adler),y(r,e.adler>>8&255),y(r,e.adler>>16&255),y(r,e.adler>>24&255),y(r,255&e.total_in),y(r,e.total_in>>8&255),y(r,e.total_in>>16&255),y(r,e.total_in>>24&255)):(w(r,e.adler>>>16),w(r,65535&e.adler)),m(e),0<r.wrap&&(r.wrap=-r.wrap),0!==r.pending?0:1)},i.deflateEnd=function(e){var t;return e&&e.state?42!==(t=e.state.status)&&69!==t&&73!==t&&91!==t&&103!==t&&t!==h&&666!==t?p(e,u):(e.state=null,t===h?p(e,-3):0):u},i.deflateSetDictionary=function(e,t){var i,n,s,a,l,c,d,h,p=t.length;if(!e||!e.state)return u;if(2===(a=(i=e.state).wrap)||1===a&&42!==i.status||i.lookahead)return u;for(1===a&&(e.adler=o(e.adler,t,p,0)),i.wrap=0,p>=i.w_size&&(0===a&&(g(i.head),i.strstart=0,i.block_start=0,i.insert=0),h=new r.Buf8(i.w_size),r.arraySet(h,t,p-i.w_size,i.w_size,0),t=h,p=i.w_size),l=e.avail_in,c=e.next_in,d=e.input,e.avail_in=p,e.next_in=0,e.input=t,x(i);i.lookahead>=3;){for(n=i.strstart,s=i.lookahead-2;i.ins_h=(i.ins_h<<i.hash_shift^i.window[n+3-1])&i.hash_mask,i.prev[n&i.w_mask]=i.head[i.ins_h],i.head[i.ins_h]=n,n++,--s;);i.strstart=n,i.lookahead=2,x(i)}return i.strstart+=i.lookahead,i.block_start=i.strstart,i.insert=i.lookahead,i.lookahead=0,i.match_length=i.prev_length=2,i.match_available=0,e.next_in=c,e.input=d,e.avail_in=l,i.wrap=a,0},i.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./messages":51,"./trees":52}],47:[function(e,t,i){"use strict";t.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],48:[function(e,t,i){"use strict";t.exports=function(e,t){var i,n,r,s,o,a,l,u,c,d,h,p,f,g,m,v,y,w,b,x,_,k,C,T,S;i=e.state,n=e.next_in,T=e.input,r=n+(e.avail_in-5),s=e.next_out,S=e.output,o=s-(t-e.avail_out),a=s+(e.avail_out-257),l=i.dmax,u=i.wsize,c=i.whave,d=i.wnext,h=i.window,p=i.hold,f=i.bits,g=i.lencode,m=i.distcode,v=(1<<i.lenbits)-1,y=(1<<i.distbits)-1;e:do{f<15&&(p+=T[n++]<<f,f+=8,p+=T[n++]<<f,f+=8),w=g[p&v];t:for(;;){if(p>>>=b=w>>>24,f-=b,0==(b=w>>>16&255))S[s++]=65535&w;else{if(!(16&b)){if(0==(64&b)){w=g[(65535&w)+(p&(1<<b)-1)];continue t}if(32&b){i.mode=12;break e}e.msg="invalid literal/length code",i.mode=30;break e}x=65535&w,(b&=15)&&(f<b&&(p+=T[n++]<<f,f+=8),x+=p&(1<<b)-1,p>>>=b,f-=b),f<15&&(p+=T[n++]<<f,f+=8,p+=T[n++]<<f,f+=8),w=m[p&y];i:for(;;){if(p>>>=b=w>>>24,f-=b,!(16&(b=w>>>16&255))){if(0==(64&b)){w=m[(65535&w)+(p&(1<<b)-1)];continue i}e.msg="invalid distance code",i.mode=30;break e}if(_=65535&w,f<(b&=15)&&(p+=T[n++]<<f,(f+=8)<b&&(p+=T[n++]<<f,f+=8)),l<(_+=p&(1<<b)-1)){e.msg="invalid distance too far back",i.mode=30;break e}if(p>>>=b,f-=b,(b=s-o)<_){if(c<(b=_-b)&&i.sane){e.msg="invalid distance too far back",i.mode=30;break e}if(C=h,(k=0)===d){if(k+=u-b,b<x){for(x-=b;S[s++]=h[k++],--b;);k=s-_,C=S}}else if(d<b){if(k+=u+d-b,(b-=d)<x){for(x-=b;S[s++]=h[k++],--b;);if(k=0,d<x){for(x-=b=d;S[s++]=h[k++],--b;);k=s-_,C=S}}}else if(k+=d-b,b<x){for(x-=b;S[s++]=h[k++],--b;);k=s-_,C=S}for(;2<x;)S[s++]=C[k++],S[s++]=C[k++],S[s++]=C[k++],x-=3;x&&(S[s++]=C[k++],1<x&&(S[s++]=C[k++]))}else{for(k=s-_;S[s++]=S[k++],S[s++]=S[k++],S[s++]=S[k++],2<(x-=3););x&&(S[s++]=S[k++],1<x&&(S[s++]=S[k++]))}break}}break}}while(n<r&&s<a);n-=x=f>>3,p&=(1<<(f-=x<<3))-1,e.next_in=n,e.next_out=s,e.avail_in=n<r?r-n+5:5-(n-r),e.avail_out=s<a?a-s+257:257-(s-a),i.hold=p,i.bits=f}},{}],49:[function(e,t,i){"use strict";var n=e("../utils/common"),r=e("./adler32"),s=e("./crc32"),o=e("./inffast"),a=e("./inftrees"),l=-2;function u(e){return(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24)}function c(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new n.Buf16(320),this.work=new n.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function d(e){var t;return e&&e.state?(t=e.state,e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=1,t.last=0,t.havedict=0,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new n.Buf32(852),t.distcode=t.distdyn=new n.Buf32(592),t.sane=1,t.back=-1,0):l}function h(e){var t;return e&&e.state?((t=e.state).wsize=0,t.whave=0,t.wnext=0,d(e)):l}function p(e,t){var i,n;return e&&e.state?(n=e.state,t<0?(i=0,t=-t):(i=1+(t>>4),t<48&&(t&=15)),t&&(t<8||15<t)?l:(null!==n.window&&n.wbits!==t&&(n.window=null),n.wrap=i,n.wbits=t,h(e))):l}function f(e,t){var i,n;return e?(n=new c,(e.state=n).window=null,0!==(i=p(e,t))&&(e.state=null),i):l}var g,m,v=!0;function y(e){if(v){var t;for(g=new n.Buf32(512),m=new n.Buf32(32),t=0;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(a(1,e.lens,0,288,g,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;a(2,e.lens,0,32,m,0,e.work,{bits:5}),v=!1}e.lencode=g,e.lenbits=9,e.distcode=m,e.distbits=5}function w(e,t,i,r){var s,o=e.state;return null===o.window&&(o.wsize=1<<o.wbits,o.wnext=0,o.whave=0,o.window=new n.Buf8(o.wsize)),r>=o.wsize?(n.arraySet(o.window,t,i-o.wsize,o.wsize,0),o.wnext=0,o.whave=o.wsize):(r<(s=o.wsize-o.wnext)&&(s=r),n.arraySet(o.window,t,i-r,s,o.wnext),(r-=s)?(n.arraySet(o.window,t,i-r,r,0),o.wnext=r,o.whave=o.wsize):(o.wnext+=s,o.wnext===o.wsize&&(o.wnext=0),o.whave<o.wsize&&(o.whave+=s))),0}i.inflateReset=h,i.inflateReset2=p,i.inflateResetKeep=d,i.inflateInit=function(e){return f(e,15)},i.inflateInit2=f,i.inflate=function(e,t){var i,c,d,h,p,f,g,m,v,b,x,_,k,C,T,S,O,E,I,D,z,A,P,R,j=0,$=new n.Buf8(4),M=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!e||!e.state||!e.output||!e.input&&0!==e.avail_in)return l;12===(i=e.state).mode&&(i.mode=13),p=e.next_out,d=e.output,g=e.avail_out,h=e.next_in,c=e.input,f=e.avail_in,m=i.hold,v=i.bits,b=f,x=g,A=0;e:for(;;)switch(i.mode){case 1:if(0===i.wrap){i.mode=13;break}for(;v<16;){if(0===f)break e;f--,m+=c[h++]<<v,v+=8}if(2&i.wrap&&35615===m){$[i.check=0]=255&m,$[1]=m>>>8&255,i.check=s(i.check,$,2,0),v=m=0,i.mode=2;break}if(i.flags=0,i.head&&(i.head.done=!1),!(1&i.wrap)||(((255&m)<<8)+(m>>8))%31){e.msg="incorrect header check",i.mode=30;break}if(8!=(15&m)){e.msg="unknown compression method",i.mode=30;break}if(v-=4,z=8+(15&(m>>>=4)),0===i.wbits)i.wbits=z;else if(z>i.wbits){e.msg="invalid window size",i.mode=30;break}i.dmax=1<<z,e.adler=i.check=1,i.mode=512&m?10:12,v=m=0;break;case 2:for(;v<16;){if(0===f)break e;f--,m+=c[h++]<<v,v+=8}if(i.flags=m,8!=(255&i.flags)){e.msg="unknown compression method",i.mode=30;break}if(57344&i.flags){e.msg="unknown header flags set",i.mode=30;break}i.head&&(i.head.text=m>>8&1),512&i.flags&&($[0]=255&m,$[1]=m>>>8&255,i.check=s(i.check,$,2,0)),v=m=0,i.mode=3;case 3:for(;v<32;){if(0===f)break e;f--,m+=c[h++]<<v,v+=8}i.head&&(i.head.time=m),512&i.flags&&($[0]=255&m,$[1]=m>>>8&255,$[2]=m>>>16&255,$[3]=m>>>24&255,i.check=s(i.check,$,4,0)),v=m=0,i.mode=4;case 4:for(;v<16;){if(0===f)break e;f--,m+=c[h++]<<v,v+=8}i.head&&(i.head.xflags=255&m,i.head.os=m>>8),512&i.flags&&($[0]=255&m,$[1]=m>>>8&255,i.check=s(i.check,$,2,0)),v=m=0,i.mode=5;case 5:if(1024&i.flags){for(;v<16;){if(0===f)break e;f--,m+=c[h++]<<v,v+=8}i.length=m,i.head&&(i.head.extra_len=m),512&i.flags&&($[0]=255&m,$[1]=m>>>8&255,i.check=s(i.check,$,2,0)),v=m=0}else i.head&&(i.head.extra=null);i.mode=6;case 6:if(1024&i.flags&&(f<(_=i.length)&&(_=f),_&&(i.head&&(z=i.head.extra_len-i.length,i.head.extra||(i.head.extra=new Array(i.head.extra_len)),n.arraySet(i.head.extra,c,h,_,z)),512&i.flags&&(i.check=s(i.check,c,_,h)),f-=_,h+=_,i.length-=_),i.length))break e;i.length=0,i.mode=7;case 7:if(2048&i.flags){if(0===f)break e;for(_=0;z=c[h+_++],i.head&&z&&i.length<65536&&(i.head.name+=String.fromCharCode(z)),z&&_<f;);if(512&i.flags&&(i.check=s(i.check,c,_,h)),f-=_,h+=_,z)break e}else i.head&&(i.head.name=null);i.length=0,i.mode=8;case 8:if(4096&i.flags){if(0===f)break e;for(_=0;z=c[h+_++],i.head&&z&&i.length<65536&&(i.head.comment+=String.fromCharCode(z)),z&&_<f;);if(512&i.flags&&(i.check=s(i.check,c,_,h)),f-=_,h+=_,z)break e}else i.head&&(i.head.comment=null);i.mode=9;case 9:if(512&i.flags){for(;v<16;){if(0===f)break e;f--,m+=c[h++]<<v,v+=8}if(m!==(65535&i.check)){e.msg="header crc mismatch",i.mode=30;break}v=m=0}i.head&&(i.head.hcrc=i.flags>>9&1,i.head.done=!0),e.adler=i.check=0,i.mode=12;break;case 10:for(;v<32;){if(0===f)break e;f--,m+=c[h++]<<v,v+=8}e.adler=i.check=u(m),v=m=0,i.mode=11;case 11:if(0===i.havedict)return e.next_out=p,e.avail_out=g,e.next_in=h,e.avail_in=f,i.hold=m,i.bits=v,2;e.adler=i.check=1,i.mode=12;case 12:if(5===t||6===t)break e;case 13:if(i.last){m>>>=7&v,v-=7&v,i.mode=27;break}for(;v<3;){if(0===f)break e;f--,m+=c[h++]<<v,v+=8}switch(i.last=1&m,v-=1,3&(m>>>=1)){case 0:i.mode=14;break;case 1:if(y(i),i.mode=20,6!==t)break;m>>>=2,v-=2;break e;case 2:i.mode=17;break;case 3:e.msg="invalid block type",i.mode=30}m>>>=2,v-=2;break;case 14:for(m>>>=7&v,v-=7&v;v<32;){if(0===f)break e;f--,m+=c[h++]<<v,v+=8}if((65535&m)!=(m>>>16^65535)){e.msg="invalid stored block lengths",i.mode=30;break}if(i.length=65535&m,v=m=0,i.mode=15,6===t)break e;case 15:i.mode=16;case 16:if(_=i.length){if(f<_&&(_=f),g<_&&(_=g),0===_)break e;n.arraySet(d,c,h,_,p),f-=_,h+=_,g-=_,p+=_,i.length-=_;break}i.mode=12;break;case 17:for(;v<14;){if(0===f)break e;f--,m+=c[h++]<<v,v+=8}if(i.nlen=257+(31&m),m>>>=5,v-=5,i.ndist=1+(31&m),m>>>=5,v-=5,i.ncode=4+(15&m),m>>>=4,v-=4,286<i.nlen||30<i.ndist){e.msg="too many length or distance symbols",i.mode=30;break}i.have=0,i.mode=18;case 18:for(;i.have<i.ncode;){for(;v<3;){if(0===f)break e;f--,m+=c[h++]<<v,v+=8}i.lens[M[i.have++]]=7&m,m>>>=3,v-=3}for(;i.have<19;)i.lens[M[i.have++]]=0;if(i.lencode=i.lendyn,i.lenbits=7,P={bits:i.lenbits},A=a(0,i.lens,0,19,i.lencode,0,i.work,P),i.lenbits=P.bits,A){e.msg="invalid code lengths set",i.mode=30;break}i.have=0,i.mode=19;case 19:for(;i.have<i.nlen+i.ndist;){for(;S=(j=i.lencode[m&(1<<i.lenbits)-1])>>>16&255,O=65535&j,!((T=j>>>24)<=v);){if(0===f)break e;f--,m+=c[h++]<<v,v+=8}if(O<16)m>>>=T,v-=T,i.lens[i.have++]=O;else{if(16===O){for(R=T+2;v<R;){if(0===f)break e;f--,m+=c[h++]<<v,v+=8}if(m>>>=T,v-=T,0===i.have){e.msg="invalid bit length repeat",i.mode=30;break}z=i.lens[i.have-1],_=3+(3&m),m>>>=2,v-=2}else if(17===O){for(R=T+3;v<R;){if(0===f)break e;f--,m+=c[h++]<<v,v+=8}v-=T,z=0,_=3+(7&(m>>>=T)),m>>>=3,v-=3}else{for(R=T+7;v<R;){if(0===f)break e;f--,m+=c[h++]<<v,v+=8}v-=T,z=0,_=11+(127&(m>>>=T)),m>>>=7,v-=7}if(i.have+_>i.nlen+i.ndist){e.msg="invalid bit length repeat",i.mode=30;break}for(;_--;)i.lens[i.have++]=z}}if(30===i.mode)break;if(0===i.lens[256]){e.msg="invalid code -- missing end-of-block",i.mode=30;break}if(i.lenbits=9,P={bits:i.lenbits},A=a(1,i.lens,0,i.nlen,i.lencode,0,i.work,P),i.lenbits=P.bits,A){e.msg="invalid literal/lengths set",i.mode=30;break}if(i.distbits=6,i.distcode=i.distdyn,P={bits:i.distbits},A=a(2,i.lens,i.nlen,i.ndist,i.distcode,0,i.work,P),i.distbits=P.bits,A){e.msg="invalid distances set",i.mode=30;break}if(i.mode=20,6===t)break e;case 20:i.mode=21;case 21:if(6<=f&&258<=g){e.next_out=p,e.avail_out=g,e.next_in=h,e.avail_in=f,i.hold=m,i.bits=v,o(e,x),p=e.next_out,d=e.output,g=e.avail_out,h=e.next_in,c=e.input,f=e.avail_in,m=i.hold,v=i.bits,12===i.mode&&(i.back=-1);break}for(i.back=0;S=(j=i.lencode[m&(1<<i.lenbits)-1])>>>16&255,O=65535&j,!((T=j>>>24)<=v);){if(0===f)break e;f--,m+=c[h++]<<v,v+=8}if(S&&0==(240&S)){for(E=T,I=S,D=O;S=(j=i.lencode[D+((m&(1<<E+I)-1)>>E)])>>>16&255,O=65535&j,!(E+(T=j>>>24)<=v);){if(0===f)break e;f--,m+=c[h++]<<v,v+=8}m>>>=E,v-=E,i.back+=E}if(m>>>=T,v-=T,i.back+=T,i.length=O,0===S){i.mode=26;break}if(32&S){i.back=-1,i.mode=12;break}if(64&S){e.msg="invalid literal/length code",i.mode=30;break}i.extra=15&S,i.mode=22;case 22:if(i.extra){for(R=i.extra;v<R;){if(0===f)break e;f--,m+=c[h++]<<v,v+=8}i.length+=m&(1<<i.extra)-1,m>>>=i.extra,v-=i.extra,i.back+=i.extra}i.was=i.length,i.mode=23;case 23:for(;S=(j=i.distcode[m&(1<<i.distbits)-1])>>>16&255,O=65535&j,!((T=j>>>24)<=v);){if(0===f)break e;f--,m+=c[h++]<<v,v+=8}if(0==(240&S)){for(E=T,I=S,D=O;S=(j=i.distcode[D+((m&(1<<E+I)-1)>>E)])>>>16&255,O=65535&j,!(E+(T=j>>>24)<=v);){if(0===f)break e;f--,m+=c[h++]<<v,v+=8}m>>>=E,v-=E,i.back+=E}if(m>>>=T,v-=T,i.back+=T,64&S){e.msg="invalid distance code",i.mode=30;break}i.offset=O,i.extra=15&S,i.mode=24;case 24:if(i.extra){for(R=i.extra;v<R;){if(0===f)break e;f--,m+=c[h++]<<v,v+=8}i.offset+=m&(1<<i.extra)-1,m>>>=i.extra,v-=i.extra,i.back+=i.extra}if(i.offset>i.dmax){e.msg="invalid distance too far back",i.mode=30;break}i.mode=25;case 25:if(0===g)break e;if(_=x-g,i.offset>_){if((_=i.offset-_)>i.whave&&i.sane){e.msg="invalid distance too far back",i.mode=30;break}k=_>i.wnext?(_-=i.wnext,i.wsize-_):i.wnext-_,_>i.length&&(_=i.length),C=i.window}else C=d,k=p-i.offset,_=i.length;for(g<_&&(_=g),g-=_,i.length-=_;d[p++]=C[k++],--_;);0===i.length&&(i.mode=21);break;case 26:if(0===g)break e;d[p++]=i.length,g--,i.mode=21;break;case 27:if(i.wrap){for(;v<32;){if(0===f)break e;f--,m|=c[h++]<<v,v+=8}if(x-=g,e.total_out+=x,i.total+=x,x&&(e.adler=i.check=i.flags?s(i.check,d,x,p-x):r(i.check,d,x,p-x)),x=g,(i.flags?m:u(m))!==i.check){e.msg="incorrect data check",i.mode=30;break}v=m=0}i.mode=28;case 28:if(i.wrap&&i.flags){for(;v<32;){if(0===f)break e;f--,m+=c[h++]<<v,v+=8}if(m!==(4294967295&i.total)){e.msg="incorrect length check",i.mode=30;break}v=m=0}i.mode=29;case 29:A=1;break e;case 30:A=-3;break e;case 31:return-4;default:return l}return e.next_out=p,e.avail_out=g,e.next_in=h,e.avail_in=f,i.hold=m,i.bits=v,(i.wsize||x!==e.avail_out&&i.mode<30&&(i.mode<27||4!==t))&&w(e,e.output,e.next_out,x-e.avail_out)?(i.mode=31,-4):(b-=e.avail_in,x-=e.avail_out,e.total_in+=b,e.total_out+=x,i.total+=x,i.wrap&&x&&(e.adler=i.check=i.flags?s(i.check,d,x,e.next_out-x):r(i.check,d,x,e.next_out-x)),e.data_type=i.bits+(i.last?64:0)+(12===i.mode?128:0)+(20===i.mode||15===i.mode?256:0),(0==b&&0===x||4===t)&&0===A&&(A=-5),A)},i.inflateEnd=function(e){if(!e||!e.state)return l;var t=e.state;return t.window&&(t.window=null),e.state=null,0},i.inflateGetHeader=function(e,t){var i;return e&&e.state?0==(2&(i=e.state).wrap)?l:((i.head=t).done=!1,0):l},i.inflateSetDictionary=function(e,t){var i,n=t.length;return e&&e.state?0!==(i=e.state).wrap&&11!==i.mode?l:11===i.mode&&r(1,t,n,0)!==i.check?-3:w(e,t,n,n)?(i.mode=31,-4):(i.havedict=1,0):l},i.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./inffast":48,"./inftrees":50}],50:[function(e,t,i){"use strict";var n=e("../utils/common"),r=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],s=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],o=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],a=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];t.exports=function(e,t,i,l,u,c,d,h){var p,f,g,m,v,y,w,b,x,_=h.bits,k=0,C=0,T=0,S=0,O=0,E=0,I=0,D=0,z=0,A=0,P=null,R=0,j=new n.Buf16(16),$=new n.Buf16(16),M=null,L=0;for(k=0;k<=15;k++)j[k]=0;for(C=0;C<l;C++)j[t[i+C]]++;for(O=_,S=15;1<=S&&0===j[S];S--);if(S<O&&(O=S),0===S)return u[c++]=20971520,u[c++]=20971520,h.bits=1,0;for(T=1;T<S&&0===j[T];T++);for(O<T&&(O=T),k=D=1;k<=15;k++)if(D<<=1,(D-=j[k])<0)return-1;if(0<D&&(0===e||1!==S))return-1;for($[1]=0,k=1;k<15;k++)$[k+1]=$[k]+j[k];for(C=0;C<l;C++)0!==t[i+C]&&(d[$[t[i+C]]++]=C);if(y=0===e?(P=M=d,19):1===e?(P=r,R-=257,M=s,L-=257,256):(P=o,M=a,-1),k=T,v=c,I=C=A=0,g=-1,m=(z=1<<(E=O))-1,1===e&&852<z||2===e&&592<z)return 1;for(;;){for(w=k-I,x=d[C]<y?(b=0,d[C]):d[C]>y?(b=M[L+d[C]],P[R+d[C]]):(b=96,0),p=1<<k-I,T=f=1<<E;u[v+(A>>I)+(f-=p)]=w<<24|b<<16|x|0,0!==f;);for(p=1<<k-1;A&p;)p>>=1;if(0!==p?(A&=p-1,A+=p):A=0,C++,0==--j[k]){if(k===S)break;k=t[i+d[C]]}if(O<k&&(A&m)!==g){for(0===I&&(I=O),v+=T,D=1<<(E=k-I);E+I<S&&!((D-=j[E+I])<=0);)E++,D<<=1;if(z+=1<<E,1===e&&852<z||2===e&&592<z)return 1;u[g=A&m]=O<<24|E<<16|v-c|0}}return 0!==A&&(u[v+A]=k-I<<24|64<<16|0),h.bits=O,0}},{"../utils/common":41}],51:[function(e,t,i){"use strict";t.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],52:[function(e,t,i){"use strict";var n=e("../utils/common");function r(e){for(var t=e.length;0<=--t;)e[t]=0}var s=256,o=286,a=30,l=15,u=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],c=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],d=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],h=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],p=new Array(576);r(p);var f=new Array(60);r(f);var g=new Array(512);r(g);var m=new Array(256);r(m);var v=new Array(29);r(v);var y,w,b,x=new Array(a);function _(e,t,i,n,r){this.static_tree=e,this.extra_bits=t,this.extra_base=i,this.elems=n,this.max_length=r,this.has_stree=e&&e.length}function k(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}function C(e){return e<256?g[e]:g[256+(e>>>7)]}function T(e,t){e.pending_buf[e.pending++]=255&t,e.pending_buf[e.pending++]=t>>>8&255}function S(e,t,i){e.bi_valid>16-i?(e.bi_buf|=t<<e.bi_valid&65535,T(e,e.bi_buf),e.bi_buf=t>>16-e.bi_valid,e.bi_valid+=i-16):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=i)}function O(e,t,i){S(e,i[2*t],i[2*t+1])}function E(e,t){for(var i=0;i|=1&e,e>>>=1,i<<=1,0<--t;);return i>>>1}function I(e,t,i){var n,r,s=new Array(16),o=0;for(n=1;n<=l;n++)s[n]=o=o+i[n-1]<<1;for(r=0;r<=t;r++){var a=e[2*r+1];0!==a&&(e[2*r]=E(s[a]++,a))}}function D(e){var t;for(t=0;t<o;t++)e.dyn_ltree[2*t]=0;for(t=0;t<a;t++)e.dyn_dtree[2*t]=0;for(t=0;t<19;t++)e.bl_tree[2*t]=0;e.dyn_ltree[512]=1,e.opt_len=e.static_len=0,e.last_lit=e.matches=0}function z(e){8<e.bi_valid?T(e,e.bi_buf):0<e.bi_valid&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0}function A(e,t,i,n){var r=2*t,s=2*i;return e[r]<e[s]||e[r]===e[s]&&n[t]<=n[i]}function P(e,t,i){for(var n=e.heap[i],r=i<<1;r<=e.heap_len&&(r<e.heap_len&&A(t,e.heap[r+1],e.heap[r],e.depth)&&r++,!A(t,n,e.heap[r],e.depth));)e.heap[i]=e.heap[r],i=r,r<<=1;e.heap[i]=n}function R(e,t,i){var n,r,o,a,l=0;if(0!==e.last_lit)for(;n=e.pending_buf[e.d_buf+2*l]<<8|e.pending_buf[e.d_buf+2*l+1],r=e.pending_buf[e.l_buf+l],l++,0===n?O(e,r,t):(O(e,(o=m[r])+s+1,t),0!==(a=u[o])&&S(e,r-=v[o],a),O(e,o=C(--n),i),0!==(a=c[o])&&S(e,n-=x[o],a)),l<e.last_lit;);O(e,256,t)}function j(e,t){var i,n,r,s=t.dyn_tree,o=t.stat_desc.static_tree,a=t.stat_desc.has_stree,u=t.stat_desc.elems,c=-1;for(e.heap_len=0,e.heap_max=573,i=0;i<u;i++)0!==s[2*i]?(e.heap[++e.heap_len]=c=i,e.depth[i]=0):s[2*i+1]=0;for(;e.heap_len<2;)s[2*(r=e.heap[++e.heap_len]=c<2?++c:0)]=1,e.depth[r]=0,e.opt_len--,a&&(e.static_len-=o[2*r+1]);for(t.max_code=c,i=e.heap_len>>1;1<=i;i--)P(e,s,i);for(r=u;i=e.heap[1],e.heap[1]=e.heap[e.heap_len--],P(e,s,1),n=e.heap[1],e.heap[--e.heap_max]=i,e.heap[--e.heap_max]=n,s[2*r]=s[2*i]+s[2*n],e.depth[r]=(e.depth[i]>=e.depth[n]?e.depth[i]:e.depth[n])+1,s[2*i+1]=s[2*n+1]=r,e.heap[1]=r++,P(e,s,1),2<=e.heap_len;);e.heap[--e.heap_max]=e.heap[1],function(e,t){var i,n,r,s,o,a,u=t.dyn_tree,c=t.max_code,d=t.stat_desc.static_tree,h=t.stat_desc.has_stree,p=t.stat_desc.extra_bits,f=t.stat_desc.extra_base,g=t.stat_desc.max_length,m=0;for(s=0;s<=l;s++)e.bl_count[s]=0;for(u[2*e.heap[e.heap_max]+1]=0,i=e.heap_max+1;i<573;i++)g<(s=u[2*u[2*(n=e.heap[i])+1]+1]+1)&&(s=g,m++),u[2*n+1]=s,c<n||(e.bl_count[s]++,o=0,f<=n&&(o=p[n-f]),a=u[2*n],e.opt_len+=a*(s+o),h&&(e.static_len+=a*(d[2*n+1]+o)));if(0!==m){do{for(s=g-1;0===e.bl_count[s];)s--;e.bl_count[s]--,e.bl_count[s+1]+=2,e.bl_count[g]--,m-=2}while(0<m);for(s=g;0!==s;s--)for(n=e.bl_count[s];0!==n;)c<(r=e.heap[--i])||(u[2*r+1]!==s&&(e.opt_len+=(s-u[2*r+1])*u[2*r],u[2*r+1]=s),n--)}}(e,t),I(s,c,e.bl_count)}function $(e,t,i){var n,r,s=-1,o=t[1],a=0,l=7,u=4;for(0===o&&(l=138,u=3),t[2*(i+1)+1]=65535,n=0;n<=i;n++)r=o,o=t[2*(n+1)+1],++a<l&&r===o||(a<u?e.bl_tree[2*r]+=a:0!==r?(r!==s&&e.bl_tree[2*r]++,e.bl_tree[32]++):a<=10?e.bl_tree[34]++:e.bl_tree[36]++,s=r,u=(a=0)===o?(l=138,3):r===o?(l=6,3):(l=7,4))}function M(e,t,i){var n,r,s=-1,o=t[1],a=0,l=7,u=4;for(0===o&&(l=138,u=3),n=0;n<=i;n++)if(r=o,o=t[2*(n+1)+1],!(++a<l&&r===o)){if(a<u)for(;O(e,r,e.bl_tree),0!=--a;);else 0!==r?(r!==s&&(O(e,r,e.bl_tree),a--),O(e,16,e.bl_tree),S(e,a-3,2)):a<=10?(O(e,17,e.bl_tree),S(e,a-3,3)):(O(e,18,e.bl_tree),S(e,a-11,7));s=r,u=(a=0)===o?(l=138,3):r===o?(l=6,3):(l=7,4)}}r(x);var L=!1;function F(e,t,i,r){S(e,0+(r?1:0),3),function(e,t,i,r){z(e),T(e,i),T(e,~i),n.arraySet(e.pending_buf,e.window,t,i,e.pending),e.pending+=i}(e,t,i)}i._tr_init=function(e){L||(function(){var e,t,i,n,r,s=new Array(16);for(n=i=0;n<28;n++)for(v[n]=i,e=0;e<1<<u[n];e++)m[i++]=n;for(m[i-1]=n,n=r=0;n<16;n++)for(x[n]=r,e=0;e<1<<c[n];e++)g[r++]=n;for(r>>=7;n<a;n++)for(x[n]=r<<7,e=0;e<1<<c[n]-7;e++)g[256+r++]=n;for(t=0;t<=l;t++)s[t]=0;for(e=0;e<=143;)p[2*e+1]=8,e++,s[8]++;for(;e<=255;)p[2*e+1]=9,e++,s[9]++;for(;e<=279;)p[2*e+1]=7,e++,s[7]++;for(;e<=287;)p[2*e+1]=8,e++,s[8]++;for(I(p,287,s),e=0;e<a;e++)f[2*e+1]=5,f[2*e]=E(e,5);y=new _(p,u,257,o,l),w=new _(f,c,0,a,l),b=new _(new Array(0),d,0,19,7)}(),L=!0),e.l_desc=new k(e.dyn_ltree,y),e.d_desc=new k(e.dyn_dtree,w),e.bl_desc=new k(e.bl_tree,b),e.bi_buf=0,e.bi_valid=0,D(e)},i._tr_stored_block=F,i._tr_flush_block=function(e,t,i,n){var r,o,a=0;0<e.level?(2===e.strm.data_type&&(e.strm.data_type=function(e){var t,i=4093624447;for(t=0;t<=31;t++,i>>>=1)if(1&i&&0!==e.dyn_ltree[2*t])return 0;if(0!==e.dyn_ltree[18]||0!==e.dyn_ltree[20]||0!==e.dyn_ltree[26])return 1;for(t=32;t<s;t++)if(0!==e.dyn_ltree[2*t])return 1;return 0}(e)),j(e,e.l_desc),j(e,e.d_desc),a=function(e){var t;for($(e,e.dyn_ltree,e.l_desc.max_code),$(e,e.dyn_dtree,e.d_desc.max_code),j(e,e.bl_desc),t=18;3<=t&&0===e.bl_tree[2*h[t]+1];t--);return e.opt_len+=3*(t+1)+5+5+4,t}(e),r=e.opt_len+3+7>>>3,(o=e.static_len+3+7>>>3)<=r&&(r=o)):r=o=i+5,i+4<=r&&-1!==t?F(e,t,i,n):4===e.strategy||o===r?(S(e,2+(n?1:0),3),R(e,p,f)):(S(e,4+(n?1:0),3),function(e,t,i,n){var r;for(S(e,t-257,5),S(e,i-1,5),S(e,n-4,4),r=0;r<n;r++)S(e,e.bl_tree[2*h[r]+1],3);M(e,e.dyn_ltree,t-1),M(e,e.dyn_dtree,i-1)}(e,e.l_desc.max_code+1,e.d_desc.max_code+1,a+1),R(e,e.dyn_ltree,e.dyn_dtree)),D(e),n&&z(e)},i._tr_tally=function(e,t,i){return e.pending_buf[e.d_buf+2*e.last_lit]=t>>>8&255,e.pending_buf[e.d_buf+2*e.last_lit+1]=255&t,e.pending_buf[e.l_buf+e.last_lit]=255&i,e.last_lit++,0===t?e.dyn_ltree[2*i]++:(e.matches++,t--,e.dyn_ltree[2*(m[i]+s+1)]++,e.dyn_dtree[2*C(t)]++),e.last_lit===e.lit_bufsize-1},i._tr_align=function(e){S(e,2,3),O(e,256,p),function(e){16===e.bi_valid?(T(e,e.bi_buf),e.bi_buf=0,e.bi_valid=0):8<=e.bi_valid&&(e.pending_buf[e.pending++]=255&e.bi_buf,e.bi_buf>>=8,e.bi_valid-=8)}(e)}},{"../utils/common":41}],53:[function(e,t,i){"use strict";t.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],54:[function(e,t,n){(function(e){!function(e,t){"use strict";if(!e.setImmediate){var i,n,r,s,o=1,a={},l=!1,u=e.document,c=Object.getPrototypeOf&&Object.getPrototypeOf(e);c=c&&c.setTimeout?c:e,i="[object process]"==={}.toString.call(e.process)?function(e){process.nextTick((function(){h(e)}))}:function(){if(e.postMessage&&!e.importScripts){var t=!0,i=e.onmessage;return e.onmessage=function(){t=!1},e.postMessage("","*"),e.onmessage=i,t}}()?(s="setImmediate$"+Math.random()+"$",e.addEventListener?e.addEventListener("message",p,!1):e.attachEvent("onmessage",p),function(t){e.postMessage(s+t,"*")}):e.MessageChannel?((r=new MessageChannel).port1.onmessage=function(e){h(e.data)},function(e){r.port2.postMessage(e)}):u&&"onreadystatechange"in u.createElement("script")?(n=u.documentElement,function(e){var t=u.createElement("script");t.onreadystatechange=function(){h(e),t.onreadystatechange=null,n.removeChild(t),t=null},n.appendChild(t)}):function(e){setTimeout(h,0,e)},c.setImmediate=function(e){"function"!=typeof e&&(e=new Function(""+e));for(var t=new Array(arguments.length-1),n=0;n<t.length;n++)t[n]=arguments[n+1];var r={callback:e,args:t};return a[o]=r,i(o),o++},c.clearImmediate=d}function d(e){delete a[e]}function h(e){if(l)setTimeout(h,0,e);else{var t=a[e];if(t){l=!0;try{!function(e){var t=e.callback,i=e.args;switch(i.length){case 0:t();break;case 1:t(i[0]);break;case 2:t(i[0],i[1]);break;case 3:t(i[0],i[1],i[2]);break;default:t.apply(undefined,i)}}(t)}finally{d(e),l=!1}}}}function p(t){t.source===e&&"string"==typeof t.data&&0===t.data.indexOf(s)&&h(+t.data.slice(s.length))}}("undefined"==typeof self?void 0===e?this:e:self)}).call(this,void 0!==i.g?i.g:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}]},{},[10])(10)},433:(e,t,i)=>{"use strict";i.r(t)},5549:(e,t,i)=>{"use strict";i.r(t)},9693:(e,t,i)=>{"use strict";i.r(t)},765:(e,t,i)=>{"use strict";i.r(t)},9585:function(e,t,i){"use strict";var n,r=this&&this.__extends||(n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])},n(e,t)},function(e,t){function i(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),s=this&&this.__spreadArrays||function(){for(var e=0,t=0,i=arguments.length;t<i;t++)e+=arguments[t].length;var n=Array(e),r=0;for(t=0;t<i;t++)for(var s=arguments[t],o=0,a=s.length;o<a;o++,r++)n[r]=s[o];return n};t.__esModule=!0,t.StrictEventEmitter=void 0;var o=function(e){function t(){return e.call(this)||this}return r(t,e),t.prototype.on=function(t,i){return e.prototype.on.call(this,t.toString(),i)},t.prototype.once=function(t,i){return e.prototype.once.call(this,t.toString(),i)},t.prototype.off=function(t,i){return e.prototype.off.call(this,t.toString(),i)},t.prototype.emit=function(t){for(var i=[],n=1;n<arguments.length;n++)i[n-1]=arguments[n];return e.prototype.emit.apply(this,s([t.toString()],i))},t.prototype.addListener=function(t,i){return e.prototype.addListener.call(this,t.toString(),i)},t.prototype.prependListener=function(t,i){return e.prototype.prependListener.call(this,t.toString(),i)},t.prototype.prependOnceListener=function(t,i){return e.prototype.prependOnceListener.call(this,t.toString(),i)},t.prototype.removeListener=function(t,i){return e.prototype.removeListener.call(this,t.toString(),i)},t.prototype.removeAllListeners=function(t){return t?e.prototype.removeAllListeners.call(this,t.toString()):e.prototype.removeAllListeners.call(this)},t.prototype.eventNames=function(){return e.prototype.eventNames.call(this)},t.prototype.listeners=function(t){return e.prototype.listeners.call(this,t.toString())},t.prototype.rawListeners=function(t){return e.prototype.rawListeners.call(this,t.toString())},t.prototype.listenerCount=function(t){return e.prototype.listenerCount.call(this,t.toString())},t}(i(7187).EventEmitter);t.StrictEventEmitter=o},8533:function(e,t,i){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,i,n){void 0===n&&(n=i),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[i]}})}:function(e,t,i,n){void 0===n&&(n=i),e[n]=t[i]}),r=this&&this.__exportStar||function(e,t){for(var i in e)"default"===i||Object.prototype.hasOwnProperty.call(t,i)||n(t,e,i)};t.__esModule=!0,r(i(9585),t)},6752:function(e,t,i){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),n(i(9500)).default.launch()},8551:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Arc=void 0;var n=i(5954),r=i(7892),s=function(){function e(e,t,i,n){this.center=e,this.radius=t,this.startAngle=i,this.endAngle=n}return Object.defineProperty(e,"Zero",{get:function(){return new e(n.Point.Zero,0,0,0)},enumerable:!1,configurable:!0}),e.duplicate=function(t){return new e(n.Point.duplicate(t.center),t.radius,t.startAngle,t.endAngle)},e.prototype.intersect=function(e){var t=new r.Vector(e.start),i=e.direction,s=new r.Vector(this.center),o=this.radius,a=new r.Vector(this.center,e.start),l=4*i.dot(a)*i.dot(a)-4*i.magSqr()*(a.magSqr()-o*o);if(l<0)return null;if(0===l){var u=-i.dot(a)/i.magSqr();return u>1||u<0||(d=(c=t.add(i.times(u))).sub(s).argument())<this.startAngle||d>this.endAngle?null:[new n.Point(c.x,c.y)]}var c,d,h=[],p=-(2*i.dot(a)-Math.sqrt(l))/(2*i.magSqr()),f=-(2*i.dot(a)+Math.sqrt(l))/(2*i.magSqr());return p>=0&&p<=1&&(d=(c=t.add(i.times(p))).sub(s).argument())>=this.startAngle&&d<=this.endAngle&&h.push(new n.Point(c.x,c.y)),f>=0&&f<=1&&(d=(c=t.add(i.times(f))).sub(s).argument())>=this.startAngle&&d<=this.endAngle&&h.push(new n.Point(c.x,c.y)),0===h.length?null:h},e.prototype.serialize=function(){return{type:"Arc",center:this.center.serialize(),radius:this.radius,startAngle:this.startAngle,endAngle:this.endAngle}},e.deserializer=function(t){if("Arc"!==t.type)throw new Error("bad type");return new e(n.Point.deserializer(t.center),t.radius,t.startAngle,t.endAngle)},e}();t.Arc=s,t.default=s},8644:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Collection=void 0;var n=i(738),r=function(){function e(){this.storage=[]}return e.Empty=function(){return new e},e.from=function(t){for(var i=new e,n=0,r=t;n<r.length;n++){var s=r[n];i.add(s)}return i},Object.defineProperty(e.prototype,"length",{get:function(){return this.storage.length},enumerable:!1,configurable:!0}),e.prototype.get=function(e){return this.storage[e]},e.prototype.add=function(e){this.storage.push(e)},e.prototype.remove=function(e){var t=this.storage.indexOf(e);if(t<0)throw new Error("instance not found");this.storage.splice(t,1)},e.prototype.tryRemove=function(e){var t=this.storage.indexOf(e);t<0||this.storage.splice(t,1)},e.prototype.forEach=function(e,t){this.storage.forEach(e,t)},e.prototype.map=function(t,i){return e.from(this.storage.map(t,i))},e.prototype.find=function(e,t){var i=this.storage.find(e,t);return void 0===i?null:i},e.prototype.filter=function(t,i){return e.from(this.storage.filter(t,i))},e.prototype.toArray=function(){return this.storage},e.prototype.clear=function(){this.storage=[]},e.prototype.destroy=function(){this.clear()},e.prototype.serialize=function(){for(var e=[],t=0,i=this.storage;t<i.length;t++){var r=i[t];(0,n.IsSerializable)(r)?e.push(r.serialize()):e.push(r)}return{type:"Collection",storage:e}},e.deserializer=function(t,i){if("Collection"!==t.type)throw new Error("bad type");if(void 0===i)throw new Error("unable to deserialize generic class without types");for(var n=[],r=0;r<t.storage.length;r++){var s=i[t.storage[r].type];if(void 0===s)throw new Error("unable to find the type ".concat(t.storage[r].type));n.push(s(t.storage[r],i))}return e.from(n)},e}();t.Collection=r,t.default=r},2854:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Line=void 0;var n=i(5966),r=i(5954),s=i(7892),o=function(){function e(e,t){this.start=e,this.end=t}return Object.defineProperty(e,"Zero",{get:function(){return new e(r.Point.Zero,r.Point.Zero)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"direction",{get:function(){return new s.Vector(this.start,this.end)},enumerable:!1,configurable:!0}),e.duplicate=function(t){return new e(r.Point.duplicate(t.start),r.Point.duplicate(t.end))},e.prototype.intersect=function(e){var t=new s.Vector(this.start),i=this.direction,o=new s.Vector(e.start),a=e.direction,l=i.cross(a),u=o.sub(t).cross(i);if((0,n.equals0)(l)&&(0,n.equals0)(u)){var c=o.add(a.sub(t)).dot(i)/i.dot(i),d=c-a.dot(i)/i.dot(i);if(d>=0&&d<=1||c>=0&&c<=1){var h=t.add(i.times(c));return new r.Point(h.x,h.y)}return null}if((0,n.equals0)(l)&&!(0,n.equals0)(u))return null;var p=o.sub(t).cross(a)/i.cross(a),f=o.sub(t).cross(i)/i.cross(a);return!(0,n.equals0)(l)&&p>=0&&p<=1&&f>=0&&f<=1?(h=t.add(i.times(p)),new r.Point(h.x,h.y)):null},e.prototype.serialize=function(){return{type:"Line",start:this.start.serialize(),end:this.end.serialize()}},e.deserializer=function(t){if("Line"!==t.type)throw new Error("bad type");return new e(r.Point.deserializer(t.start),r.Point.deserializer(t.end))},e}();t.Line=o,t.default=o},738:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ObjectMapper=t.IsSerializable=void 0,t.IsSerializable=function(e){return"function"==typeof e.serialize};var i=function(){function e(){}return e.stringify=function(e){return JSON.stringify(e.serialize())},e.parse=function(e,t){var i=JSON.parse(e);if(void 0===i.type)throw new Error("bad data");if(void 0===t[i.type])throw new Error("unable to find the type ".concat(i.type));return(0,t[i.type])(i,t)},e}();t.ObjectMapper=i},5954:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Point=void 0;var i=function(){function e(e,t){this.x="number"==typeof e?e:0,this.y="number"==typeof t?t:0}return Object.defineProperty(e,"Zero",{get:function(){return new e(0,0)},enumerable:!1,configurable:!0}),e.add=function(t,i){return new e(t.x+i.x,t.y+i.y)},e.sub=function(t,i){return new e(t.x-i.x,t.y-i.y)},e.mul=function(t,i){return new e(t.x*i.x,t.y*i.y)},e.div=function(t,i){return new e(t.x/i.x,t.y/i.y)},e.duplicate=function(t){return new e(t.x,t.y)},e.prototype.serialize=function(){return{type:"Point",x:this.x,y:this.y}},e.deserializer=function(t){if("Point"!==t.type)throw new Error("bad type");return new e(t.x,t.y)},e}();t.Point=i,t.default=i},1301:function(e,t,i){"use strict";var n,r=this&&this.__extends||(n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])},n(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function i(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)});Object.defineProperty(t,"__esModule",{value:!0}),t.isPointer=t.makePointer=t.Pointer=void 0;var s=i(8533),o=i(738),a=function(e){function t(t){var i=e.call(this)||this;return i.value=t,i}return r(t,e),t.prototype.set=function(e){this.value=e,this.emit("change")},t.prototype.get=function(){return this.value},t.make=function(e){return new t(e)},t.prototype.serialize=function(){return{type:"Pointer",value:(0,o.IsSerializable)(this.value)?this.value.serialize():this.value}},t.deserializer=function(e,i){if("Registry"!==e.type)throw new Error("bad type");if(void 0===i)throw new Error("unable to deserialize generic class without types");if(void 0===e.value.type)return t.make(e.value);var n=i[e.value.type];if(void 0===n)throw new Error("unable to find the type ".concat(e.value.type));return t.make(n(e.value,i))},t}(s.StrictEventEmitter);t.Pointer=a,t.makePointer=function(e){return a.make(e)},t.isPointer=function(e){return e instanceof a}},9778:function(e,t,i){"use strict";var n,r=i(9755),s=this&&this.__extends||(n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])},n(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function i(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)});Object.defineProperty(t,"__esModule",{value:!0}),t.Property=t.SelectFormBuilder=t.DefaultFormBuilder=t.PropertySelect=t.PropertyInput=t.PropertyForm=t.floatDeconvertor=t.floatConvertor=void 0;var o=i(8533),a=i(1301);t.floatConvertor=function(e){if(""===e.trim()||e.trim().length>0&&"."===e.trim().charAt(e.trim().length-1)||Number.isNaN(Number(e)))throw new Error("bad value");return parseFloat(e)},t.floatDeconvertor=function(e){return e+""};var l=function(){function e(e,t){this.placeholder="",this.placeholder=e,this.value=t}return e.prototype.setConvertor=function(e){return this.convertor=e,this},e.prototype.setDeConvertor=function(e){return this.deconvertor=e,this},e.prototype.convert=function(e){return void 0===this.convertor?e:this.convertor(e)},e.prototype.deconvert=function(e){return void 0===this.deconvertor?e:this.deconvertor(e)},e.prototype.build=function(){var e=this,t=r(document.createElement("input"));if(t.attr("placeholder",this.placeholder),void 0!==this.value)if((0,a.isPointer)(this.value)){var i=this.value,n=function(){t.val(e.deconvert(i.get()))};t.val(e.deconvert(this.value.get())),t.on("change keyup keydown",(function(){i.off("change",n);try{i.set(e.convert(t.val())),t.val(e.deconvert(i.get()))}catch(e){}i.on("change",n)})),i.on("change",n)}else t.val(e.deconvert(this.value));return t},e}(),u=function(){function e(e,t,i){this.placeholder="",this.placeholder=e,this.value=i,this.options=t}return e.prototype.setConvertor=function(e){return this.convertor=e,this},e.prototype.setDeConvertor=function(e){return this.deconvertor=e,this},e.prototype.convert=function(e){return void 0===this.convertor?e:this.convertor(e)},e.prototype.deconvert=function(e){return void 0===this.deconvertor?e:this.deconvertor(e)},e.prototype.build=function(){for(var e=this,t=r(document.createElement("select")),i=0,n=Object.entries(this.options);i<n.length;i++){var s=n[i],o=s[0],l=s[1];t.append(r("<option>",{value:o,text:l}))}if(void 0!==this.value)if((0,a.isPointer)(this.value)){var u=this.value,c=function(){t.val(e.deconvert(u.get()))};t.val(e.deconvert(this.value.get())),t.on("change keyup keydown",(function(){u.off("change",c);try{u.set(e.convert(t.val())),t.val(e.deconvert(u.get()))}catch(e){}u.on("change",c)})),u.on("change",c)}else t.val(e.deconvert(this.value));return t},e}(),c=function(){function e(){this.name="unnamed",this.input=r(document.createElement("input"))}return e.prototype.setName=function(e){return this.name=e,this},e.prototype.setInput=function(e){return this.input=e,this},e.prototype.build=function(){var e=r(document.createElement("tr")),t=r(document.createElement("td"));t.addClass("fitwidth"),t.html(this.name);var i=r(document.createElement("td"));return i.append(this.input),e.append(t),e.append(i),e},e}();t.PropertyForm=function(){return new c},t.PropertyInput=function(e,t){return new l(e,t)},t.PropertySelect=function(e,t,i){return new u(e,t,i)},t.DefaultFormBuilder=function(e,i,n,r){return function(){return(0,t.PropertyForm)().setName(e).setInput((0,t.PropertyInput)(e,i).setConvertor(n).setDeConvertor(r).build()).build()}},t.SelectFormBuilder=function(e,i,n,r,s){return function(){return(0,t.PropertyForm)().setName(e).setInput((0,t.PropertySelect)(e,i,n).setConvertor(r).setDeConvertor(s).build()).build()}};var d=function(e){function t(t,i,n,r){var s=e.call(this)||this;return s.name=t,s.value=i,s.convertor=n,s.formbuilder=r,s}return s(t,e),t.prototype.getForm=function(){var e=this,t=this.formbuilder(),i=function(){t.remove(),e.off("destroy",i)};return this.on("destroy",i),t},t.prototype.getName=function(){return this.name},t.prototype.setValue=function(e){(0,a.isPointer)(this.value)?this.value.set(this.convertor(e)):this.value=this.convertor(e),this.emit("set")},t.prototype.getValue=function(){return(0,a.isPointer)(this.value)?this.value.get():this.value},t.prototype.destroy=function(){this.emit("destroy")},t}(o.StrictEventEmitter);t.Property=d,t.default=d},252:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Rectangle=void 0;var n=i(5954),r=function(){function e(e,t){this.origin=e,this.size=t}return Object.defineProperty(e,"Zero",{get:function(){return e.from(0,0,0,0)},enumerable:!1,configurable:!0}),e.prototype.ratio=function(){return this.size.x/this.size.y},e.from=function(t,i,r,s){return new e(new n.Point(t,i),new n.Point(r,s))},e.fromSize=function(t,i){return new e(new n.Point(0,0),new n.Point(t,i))},e.duplicate=function(t){return new e(n.Point.duplicate(t.origin),n.Point.duplicate(t.size))},e.prototype.serialize=function(){return{type:"Rectangle",origin:this.origin.serialize(),size:this.size.serialize()}},e.deserializer=function(t){if("Rectangle"!==t.type)throw new Error("bad type");return new e(n.Point.deserializer(t.origin),n.Point.deserializer(t.size))},e}();t.Rectangle=r,t.default=r},4558:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.UniqueID=void 0;var i=function(){function e(){this.data=[]}return e.prototype.get=function(){for(var e=1;void 0!==this.data[e];)e++;return this.data[e]=!0,e},e.prototype.remove=function(e){if(void 0===this.data[e])throw new Error("unable to remove id");delete this.data[e]},e}();t.UniqueID=i,t.default=i},7892:function(e,t,i){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.Vector=void 0;var r=i(5966),s=n(i(5954)),o=function(){function e(e,t){if(e instanceof s.default&&t instanceof s.default){var i=s.default.sub(t,e);this.values=[i.x,i.y]}else Array.isArray(e)?this.values=e.length>=2?[e[0],e[1]]:1===e.length?[e[0],e[0]]:[0,0]:void 0===t?e instanceof s.default?this.values=[e.x,e.y]:this.values=["number"==typeof e?e:0,"number"==typeof e?e:0]:this.values=["number"==typeof e?e:0,"number"==typeof t?t:0]}return Object.defineProperty(e.prototype,"x",{get:function(){return this.values[0]},set:function(e){this.values[0]=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"y",{get:function(){return this.values[1]},set:function(e){this.values[1]=e},enumerable:!1,configurable:!0}),Object.defineProperty(e,"Left",{get:function(){return new e(-1,0)},enumerable:!1,configurable:!0}),Object.defineProperty(e,"Right",{get:function(){return new e(1,0)},enumerable:!1,configurable:!0}),Object.defineProperty(e,"Up",{get:function(){return new e(0,1)},enumerable:!1,configurable:!0}),Object.defineProperty(e,"Down",{get:function(){return new e(0,-1)},enumerable:!1,configurable:!0}),Object.defineProperty(e,"Zero",{get:function(){return new e(0,0)},enumerable:!1,configurable:!0}),Object.defineProperty(e,"One",{get:function(){return new e(1,1)},enumerable:!1,configurable:!0}),Object.defineProperty(e,"X",{get:function(){return new e(1,0)},enumerable:!1,configurable:!0}),Object.defineProperty(e,"Y",{get:function(){return new e(0,1)},enumerable:!1,configurable:!0}),e.prototype.add=function(t){return t instanceof e?new e(this.values[0]+t.values[0],this.values[1]+t.values[1]):new e(this.values[0]+t,this.values[1]+t)},e.prototype.sub=function(t){return t instanceof e?new e(this.values[0]-t.values[0],this.values[1]-t.values[1]):new e(this.values[0]-t,this.values[1]-t)},e.prototype.dot=function(e){return this.values[0]*e.values[0]+this.values[1]*e.values[1]},e.prototype.cross=function(e){return this.values[0]*e.values[1]-this.values[1]*e.values[0]},e.prototype.times=function(t){return t instanceof e?new e(this.values[0]*t.values[0],this.values[1]*t.values[1]):new e(this.values[0]*t,this.values[1]*t)},e.prototype.div=function(t){return t instanceof e?new e(this.values[0]/t.values[0],this.values[1]/t.values[1]):new e(this.values[0]/t,this.values[1]/t)},e.prototype.negate=function(){return this.times(-1)},e.prototype.magSqr=function(){return this.values[0]*this.values[0]+this.values[1]*this.values[1]},e.prototype.mag=function(){return Math.sqrt(this.magSqr())},e.prototype.normalized=function(){return this.div(this.mag())},e.prototype.angle=function(e){return Math.atan2(this.values[1]-e.values[1],this.values[0]-e.values[1])},e.prototype.argument=function(){return Math.atan2(this.values[1],this.values[0])},e.prototype.clone=function(){return new e(this.values[0],this.values[1])},e.prototype.cap=function(t){if(t<=r.EPSILON)return new e(0,0);var i=this.mag();return t<i?this.times(t/i):this.clone()},e.prototype.transpose=function(){return new e(this.values[1],this.values[0])},e.prototype.orthogonal=function(){return new e(-this.values[1],this.values[0])},e.prototype.floor=function(){return new e(Math.floor(this.values[0]),Math.floor(this.values[1]))},e.prototype.ceil=function(){return new e(Math.ceil(this.values[0]),Math.ceil(this.values[1]))},e.prototype.abs=function(){return new e(Math.abs(this.values[0]),Math.abs(this.values[1]))},e.prototype.map=function(t){return new e(t(this.values[0]),t(this.values[1]))},e.prototype.max=function(t){return void 0===t?Math.max(this.values[0],this.values[1]):new e(Math.max(this.values[0],t.values[0]),Math.max(this.values[1],t.values[1]))},e.prototype.min=function(t){return void 0===t?Math.min(this.values[0],this.values[1]):new e(Math.min(this.values[0],t.values[0]),Math.min(this.values[1],t.values[1]))},e.dist=function(e,t){return e.sub(t).mag()},e.Project=function(e,t){return t.times(e.dot(t))},e.FromPolar=function(t,i){return new e(t*Math.cos(i),t*Math.sin(i))},e.Interpolate=function(e,t,i){return e.add(t.sub(e).times(i))},e.Average=function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];var n=new e(0,0);if(0===t.length)return n;for(var r=0,s=t;r<s.length;r++){var o=s[r];n=n.add(o)}return n.div(t.length)},e.WeightedAverage=function(t,i){var n=new e(0,0),s=0,o=Math.min(t.length,i.length);if(0===o)return n;for(var a=0;a<o;a++){var l=t[a],u=i[a];u>r.EPSILON&&(s+=u,n=n.add(l.times(u)))}return s>r.EPSILON?n.div(s):n},e}();t.Vector=o},9708:function(e,t,i){"use strict";var n,r=this&&this.__extends||(n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])},n(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function i(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.Canvas=void 0;var o=i(5954),a=i(5966),l=i(8533),u=s(i(7874)),c=s(i(1173)),d=s(i(6614)),h=function(e){function t(){var t=e.call(this)||this;t.scene=null,t.state=null,t.canvas=document.createElement("canvas");var i=t.canvas.getContext("2d");if(null==i)throw new Error("Unable to retrieve 2d canvas context");t.ctx=(0,a.trackTransforms)(i),t.ctx.imageSmoothingEnabled=!1,t.logicals=[],t.dragged=!1,t.dragStart=null,t.dragButton=null,t.last=new o.Point(t.canvas.width/2,t.canvas.height/2),t.center=new o.Point(0,0);var n=0,r=Date.now(),s=t;return function e(){var t,i=s.canvas,a=s.ctx;n=r,r=Date.now(),s.state=new c.default(d.default.Screen,s,null==s.scene?u.default.Empty:s.scene,(r-n)/1e3,a,s.last),window.requestAnimationFrame(e);var l=a.duplicateTransform();i.width=i.offsetWidth,i.height=i.offsetHeight,a.setTransform(l.a,l.b,l.c,l.d,l.e,l.f),s.center=new o.Point(i.width/2,i.height/2),a.translate(s.center.x/l.a,s.center.y/l.d),s.clear(),a.imageSmoothingEnabled=!1,null===(t=s.scene)||void 0===t||t.render(s.state),s.emit("render",s.state),a.translate(-s.center.x/l.a,-s.center.y/l.d)}(),t.listen(),t}return r(t,e),t.prototype.reset=function(){this.ctx.setTransform((0,a.ResetTransformation)())},t.prototype.setScene=function(e){this.scene=e},t.prototype.element=function(){return this.canvas},t.prototype.register=function(e){this.logicals.push(e),e.register(this)},t.prototype.unregister=function(e){var t=this.logicals.indexOf(e);if(t<0)throw new Error("logical not found");this.logicals[t].unregister(this),this.logicals.splice(t,1)},t.prototype.getWorldPoint=function(e){var t=this.ctx.getTransform();return o.Point.sub(this.ctx.screenToWorld(e),o.Point.div(this.center,new o.Point(t.a,t.d)))},t.prototype.clear=function(){var e=this.ctx,t=this.canvas,i=e.screenToWorld(0,0),n=e.screenToWorld(t.width,t.height);e.clearRect(i.x,i.y,n.x-i.x,n.y-i.y),e.save(),e.setTransform((0,a.ResetTransformation)()),e.clearRect(0,0,t.width,t.height),e.restore()},t.prototype.listen=function(){var e=this.canvas,t=this.ctx,i=this;e.addEventListener("mousedown",(function(t){i.last=(0,a.getMousePos)(e,t),i.dragButton=t.button,i.dragStart=i.getWorldPoint(i.last),i.dragged=!1,i.emit("mousedown",i.last,i.dragButton),i.emit("dragstart",i.dragStart,i.dragButton)}),!1),window.addEventListener("mousemove",(function(n){i.last=(0,a.getMousePos)(e,n);var r=i.getWorldPoint(i.last);i.emit("mousemove",r),i.dragged=!0,null!=i.dragStart&&2===i.dragButton&&t.translate(r.x-i.dragStart.x,r.y-i.dragStart.y),null!=i.dragStart&&i.emit("dragstep",r,i.dragButton)}),!1),window.addEventListener("mouseup",(function(t){t.target!==i.canvas&&(i.dragged=!1,i.emit("dragcancel")),i.last=(0,a.getMousePos)(e,t);var n=i.getWorldPoint(i.last);i.emit("mouseup",n,i.dragButton),i.dragged&&i.emit("dragend",n,i.dragButton),i.dragButton=null,i.dragStart=null}),!1),window.addEventListener("mouseleave",(function(e){i.dragStart=null,i.dragged=!1,i.dragButton=null,i.emit("mouseleave",i.getWorldPoint(i.last))}),!1),e.addEventListener("contextmenu",(function(e){e.preventDefault(),e.stopPropagation()}),!1);var n=function(e){var n=e.deltaY?-e.deltaY/40:e.detail?-e.detail:0;return n&&function(e){var n=i.getWorldPoint(i.last);t.translate(n.x,n.y);var r=Math.pow(1.1,e);t.scale(r,r),t.translate(-n.x,-n.y)}(n),i.emit("mousewheel",i.last,n),e.preventDefault(),!1};e.addEventListener("DOMMouseScroll",n,!1),e.addEventListener("mousewheel",n,!1)},t}(l.StrictEventEmitter);t.Canvas=h,t.default=h},3812:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Color=void 0;var i=function(){function e(e,t,i){this._r=e,this._g=t,this._b=i}return Object.defineProperty(e,"Default",{get:function(){return e.fromRGB(100,100,100)},enumerable:!1,configurable:!0}),Object.defineProperty(e,"Blue",{get:function(){return e.fromRGB(0,0,255)},enumerable:!1,configurable:!0}),Object.defineProperty(e,"Red",{get:function(){return e.fromRGB(255,0,0)},enumerable:!1,configurable:!0}),Object.defineProperty(e,"Green",{get:function(){return e.fromRGB(0,255,0)},enumerable:!1,configurable:!0}),Object.defineProperty(e,"Yellow",{get:function(){return e.fromRGB(255,255,0)},enumerable:!1,configurable:!0}),Object.defineProperty(e,"Magenta",{get:function(){return e.fromRGB(255,0,255)},enumerable:!1,configurable:!0}),Object.defineProperty(e,"Cyan",{get:function(){return e.fromRGB(0,255,255)},enumerable:!1,configurable:!0}),Object.defineProperty(e,"Amber",{get:function(){return e.fromRGB(255,191,0)},enumerable:!1,configurable:!0}),Object.defineProperty(e,"Black",{get:function(){return e.fromRGB(0,0,0)},enumerable:!1,configurable:!0}),Object.defineProperty(e,"White",{get:function(){return e.fromRGB(255,255,255)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"r",{get:function(){return this._r},set:function(e){this._r=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"g",{get:function(){return this._g},set:function(e){this._g=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"b",{get:function(){return this._b},set:function(e){this._b=e},enumerable:!1,configurable:!0}),e.rgbToHsl=function(e,t,i){e/=255,t/=255,i/=255;var n=Math.max(e,t,i),r=Math.min(e,t,i),s=0,o=0,a=(n+r)/2;if(n===r)s=o=0;else{var l=n-r;switch(o=a>.5?l/(2-n-r):l/(n+r),n){case e:s=(t-i)/l+(t<i?6:0);break;case t:s=(i-e)/l+2;break;case i:s=(e-t)/l+4}s/=6}return[s,o,a]},e.hslToRgb=function(e,t,i){var n,r,s;if(0===t)n=r=s=i;else{var o=function(e,t,i){return i<0&&(i+=1),i>1&&(i-=1),i<1/6?e+6*(t-e)*i:i<.5?t:i<2/3?e+(t-e)*(2/3-i)*6:e},a=i<.5?i*(1+t):i+t-i*t,l=2*i-a;n=o(l,a,e+1/3),r=o(l,a,e),s=o(l,a,e-1/3)}return[Math.round(255*n),Math.round(255*r),Math.round(255*s)]},e.prototype.toString=function(){return"rgb(".concat(this.r,",").concat(this.g,",").concat(this.b,")")},e.fromRGB=function(t,i,n){return new e(t,i,n)},e.from=function(t){return new e(t.r,t.g,t.b)},e.prototype.addRed=function(e){this.r+=e,this.r<0&&(this.r=0),this.r>255&&(this.r=255)},e.prototype.addGreen=function(e){this.g+=e,this.g<0&&(this.g=0),this.g>255&&(this.g=255)},e.prototype.addBlue=function(e){this.b+=e,this.b<0&&(this.b=0),this.b>255&&(this.b=255)},e.prototype.serialize=function(){return{type:"Color",r:this.r,g:this.g,b:this.b}},e.deserializer=function(t){if("Color"!==t.type)throw new Error("bad type");return e.fromRGB(t.r,t.g,t.b)},e}();t.Color=i,t.default=i},9884:function(e,t,i){"use strict";var n,r=this&&this.__extends||(n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])},n(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function i(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),s=this&&this.__assign||function(){return s=Object.assign||function(e){for(var t,i=1,n=arguments.length;i<n;i++)for(var r in t=arguments[i])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e},s.apply(this,arguments)},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.GrabPoint=void 0;var a=o(i(5954)),l=i(5966),u=o(i(3337)),c=i(1301),d=o(i(8644)),h=o(i(9076)),p=o(i(3812)),f=function(e){function t(t,i){var n=e.call(this)||this;return n.overflow=!0,n.tmppos=null,n.hovered=!1,n.grabbed=!1,n.registered=!1,n.color=new h.default(5),n.radius=20,n.time=0,n.dispatchers=new Map,n.instance=n,n.button=i,n.ondragstart=n.dragstart(n),n.ondragstep=n.dragstep(n),n.ondragcancel=n.dragcancel(n),n.ondragend=n.dragend(n),n.x=(0,c.makePointer)(t.x),n.y=(0,c.makePointer)(t.y),n}return r(t,e),t.prototype.destroy=function(){e.prototype.destroy.call(this);for(var t=0,i=Array.from(this.dispatchers.keys());t<i.length;t++){var n=i[t];this.unregister(n)}},t.prototype.pointers=function(){return[this.x,this.y]},t.prototype.setPosition=function(e){this.x.set(e.x),this.y.set(e.y)},t.prototype.getPosition=function(){return new a.default(this.x.get(),this.y.get())},t.prototype.render=function(e){if(this.registered){var t=e.ctx;this.time+=e.dt,this.time>l.TAU&&(this.time=l.TAU-this.time),this.radius=20+4*Math.sin(this.time);var i=t.getTransform(),n=(i.a+i.d)/2,r=this.radius/n;this.color.update(e.dt);var s=t.createRadialGradient(this.x.get(),this.y.get(),0,this.x.get(),this.y.get(),r);s.addColorStop(0,this.color.toString()),s.addColorStop(1,"rgba(".concat(this.color.r,",").concat(this.color.g,",").concat(this.color.b,",0.3)")),t.beginPath(),t.arc(this.x.get(),this.y.get(),r,0,2*Math.PI,!1),t.fillStyle=s,t.fill(),t.closePath(),t.beginPath(),t.arc(this.x.get(),this.y.get(),r/5,0,2*Math.PI,!1),t.fillStyle=p.default.Black.toString(),t.fill(),t.lineWidth=4/n,t.beginPath(),t.arc(this.x.get(),this.y.get(),r+2/n,0,2*Math.PI,!1),t.strokeStyle=p.default.Black.toString(),t.stroke(),t.lineWidth=4/n,t.beginPath(),t.arc(this.x.get(),this.y.get(),r,0,2*Math.PI,!1),t.strokeStyle=this.color.toString(),t.stroke(),t.lineWidth=1}},t.prototype.isHover=function(e){var t=e.ctx,i=t.getTransform();return t.beginPath(),t.arc(this.x.get(),this.y.get(),20/((i.a+i.d)/2),0,2*Math.PI,!1),t.closePath(),this.hovered=e.isMouseInPath(),this.hovered},t.prototype.isGrabbed=function(){return this.grabbed},t.prototype.hover=function(e){this.register(e.dispatcher)},t.prototype.unhover=function(e){this.unregister(e.dispatcher)},t.prototype.forceHover=function(){this.hovered=!0},t.prototype.renderables=function(){return d.default.Empty()},t.prototype.register=function(e,t){this.registered=!0,this.instance=void 0===t?this:t,this.dispatchers.set(e,!0),e.on("dragstart",this.ondragstart),e.on("dragstep",this.ondragstep),e.on("dragcancel",this.ondragcancel),e.on("dragend",this.ondragend)},t.prototype.unregister=function(e){this.grabbed=!1,this.hovered=!1,this.instance=this,this.dispatchers.delete(e),this.registered=!1,e.off("dragstart",this.ondragstart),e.off("dragstep",this.ondragstep),e.off("dragcancel",this.ondragcancel),e.off("dragend",this.ondragend)},t.prototype.dragstart=function(e){var t=this;return function(i,n){n===e.button&&t.hovered?e.tmppos=a.default.sub(i,e.getPosition()):e.tmppos=null,e.grabbed&&(e.grabbed=!1)}},t.prototype.dragstep=function(e){return function(t){if(null!=e.tmppos)return e.setPosition(a.default.sub(t,e.tmppos)),e.grabbed||e.instance.select(),e.grabbed=!0,void e.emit("change",e.getPosition());e.grabbed&&(e.grabbed=!1)}},t.prototype.dragend=function(e){return function(t){null!=e.tmppos&&(e.setPosition(a.default.sub(t,e.tmppos)),e.emit("change",e.getPosition())),e.grabbed&&(e.grabbed=!1),e.tmppos=null}},t.prototype.dragcancel=function(e){return function(){e.tmppos=null,e.grabbed&&(e.grabbed=!1)}},t.prototype.serialize=function(){return s(s({},e.prototype.serialize.call(this)),{type:"GrabPoint",button:this.button,position:this.getPosition().serialize()})},t.deserializer=function(e){if("GrabPoint"!==e.type)throw new Error("bad type");if("number"!=typeof e.button)throw new Error("bad type");return new t(a.default.deserializer(e.position),e.button)},t}(u.default);t.GrabPoint=f},1663:function(e,t,i){"use strict";var n,r=this&&this.__extends||(n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])},n(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function i(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),s=this&&this.__assign||function(){return s=Object.assign||function(e){for(var t,i=1,n=arguments.length;i<n;i++)for(var r in t=arguments[i])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e},s.apply(this,arguments)},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.GrabRectangle=void 0;var a=o(i(5954)),l=i(1301),u=o(i(252)),c=o(i(3337)),d=i(9884),h=o(i(8644)),p=function(e){function t(t,i){var n=e.call(this)||this;n.overflow=!0,n.keepRatio=!1,n.ratio=0,n.registered=!1;var r=a.default.duplicate(t.origin),s=a.default.duplicate(t.size);n.ratio=t.ratio();var o=n;n.x1=(0,l.makePointer)(r.x),n.y1=(0,l.makePointer)(r.y),n.x2=(0,l.makePointer)(s.x),n.y2=(0,l.makePointer)(s.y);var c=[new d.GrabPoint(r,i),new d.GrabPoint(a.default.add(r,new a.default(s.x,0)),i),new d.GrabPoint(a.default.add(r,s),i),new d.GrabPoint(a.default.add(r,new a.default(0,s.y)),i)];return c[0].on("change",(function(e){o.keepRatio&&(e.y-=(c[2].getPosition().x-e.x)/o.ratio-(c[2].getPosition().y-e.y));var t=new a.default(o.x1.get(),o.y1.get()),i=new a.default(o.x2.get(),o.y2.get());o.x1.set(e.x),o.y1.set(e.y),o.x2.set(c[2].getPosition().x-e.x),o.y2.set(c[2].getPosition().y-e.y),c[1].setPosition(a.default.add(t,new a.default(i.x,0))),c[3].setPosition(a.default.add(t,new a.default(0,i.y))),o.emit("change",u.default.from(o.x1.get(),o.y1.get(),o.x2.get(),o.y2.get()))})),c[2].on("change",(function(e){o.keepRatio&&(e.y-=(c[0].getPosition().x-e.x)/o.ratio-(c[0].getPosition().y-e.y));var t=new a.default(o.x1.get(),o.y1.get()),i=new a.default(o.x2.get(),o.y2.get());o.x2.set(e.x-t.x),o.y2.set(e.y-t.y),c[1].setPosition(a.default.add(t,new a.default(i.x,0))),c[3].setPosition(a.default.add(t,new a.default(0,i.y))),o.emit("change",u.default.from(o.x1.get(),o.y1.get(),o.x2.get(),o.y2.get()))})),c[1].on("change",(function(e){o.keepRatio&&(e.y+=(c[3].getPosition().x-e.x)/o.ratio+(c[3].getPosition().y-e.y));var t=new a.default(o.x1.get(),o.y1.get()),i=new a.default(o.x2.get(),o.y2.get());o.x1.set(e.x-i.x),o.y1.set(e.y),o.x2.set(e.x-c[3].getPosition().x),o.y2.set(c[3].getPosition().y-e.y),c[0].setPosition(t),c[2].setPosition(a.default.add(t,i)),o.emit("change",u.default.from(o.x1.get(),o.y1.get(),o.x2.get(),o.y2.get()))})),c[3].on("change",(function(e){o.keepRatio&&(e.y+=(c[1].getPosition().x-e.x)/o.ratio+(c[1].getPosition().y-e.y));var t=new a.default(o.x1.get(),o.y1.get()),i=new a.default(o.x2.get(),o.y2.get());o.x1.set(e.x),o.y1.set(e.y-i.y),o.x2.set(c[1].getPosition().x-e.x),o.y2.set(e.y-c[1].getPosition().y),c[0].setPosition(t),c[2].setPosition(a.default.add(t,i)),o.emit("change",u.default.from(o.x1.get(),o.y1.get(),o.x2.get(),o.y2.get()))})),n.grabPoints=c,n}return r(t,e),t.prototype.getGrabPoints=function(){return this.grabPoints},t.prototype.destroy=function(){e.prototype.destroy.call(this);for(var t=0,i=this.grabPoints;t<i.length;t++)i[t].destroy()},t.prototype.pointers=function(){return[this.x1,this.y1,this.x2,this.y2]},t.prototype.refresh=function(e){this.ratio=e.ratio(),this.x1.set(e.origin.x),this.y1.set(e.origin.y),this.x2.set(e.size.x),this.y2.set(e.size.y),this.grabPoints[0].setPosition(e.origin),this.grabPoints[1].setPosition(a.default.add(e.origin,new a.default(e.size.x,0))),this.grabPoints[2].setPosition(a.default.add(e.origin,e.size)),this.grabPoints[3].setPosition(a.default.add(e.origin,new a.default(0,e.size.y)))},t.prototype.render=function(e){if(this.registered){var t=e.ctx;t.beginPath(),t.lineWidth=1;for(var i=!0,n=0,r=this.grabPoints;n<r.length;n++){var s=r[n].getPosition();i?(i=!1,t.moveTo(s.x,s.y)):t.lineTo(s.x,s.y)}t.closePath(),t.strokeStyle="red",t.stroke();for(var o=0,a=this.grabPoints;o<a.length;o++)a[o].render(e)}},t.prototype.hover=function(e){this.registered=!0;for(var t=0,i=this.grabPoints;t<i.length;t++)i[t].hover(e)},t.prototype.unhover=function(e){this.registered=!1;for(var t=0,i=this.grabPoints;t<i.length;t++)i[t].unhover(e)},t.prototype.isGrabbed=function(){for(var e=0,t=this.grabPoints;e<t.length;e++)if(t[e].isGrabbed())return!0;return!1},t.prototype.isHover=function(e){var t=e.ctx;t.beginPath(),t.lineWidth=1;for(var i=!0,n=0,r=this.grabPoints;n<r.length;n++){var s=r[n].getPosition();i?(i=!1,t.moveTo(s.x,s.y)):t.lineTo(s.x,s.y)}t.closePath();var o=!1,a=!1;e.isMouseInPath()&&(o||(o=!0));for(var l=0,u=this.grabPoints;l<u.length;l++)u[l].isHover(e)&&(o||(o=!0),a||(a=!0));if(!a)for(var c=0,d=this.grabPoints;c<d.length;c++)d[c].forceHover();return o},t.prototype.renderables=function(){return h.default.Empty()},t.prototype.register=function(e,t){this.registered=!0;for(var i=0,n=this.grabPoints;i<n.length;i++)n[i].register(e,t)},t.prototype.unregister=function(e){this.registered=!1;for(var t=0,i=this.grabPoints;t<i.length;t++)i[t].unregister(e)},t.prototype.serialize=function(){return s(s({},e.prototype.serialize.call(this)),{type:"GrabRectangle",overflow:this.overflow,keepRatio:this.keepRatio,box:u.default.from(this.x1.get(),this.y1.get(),this.x2.get(),this.y2.get()).serialize()})},t.deserializer=function(e){if("GrabRectangle"!==e.type)throw new Error("bad type");if("number"!=typeof e.button)throw new Error("bad type");return new t(u.default.deserializer(e.box),e.button)},t}(c.default);t.GrabRectangle=p,t.default=p},3337:function(e,t,i){"use strict";var n,r=this&&this.__extends||(n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])},n(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function i(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.Grab=void 0;var o=function(e){function t(){var t=e.call(this)||this;return t.zIndex.clear(),t.zIndex.set(1e4),t}return r(t,e),t.prototype.destroy=function(){e.prototype.destroy.call(this)},t}(s(i(2834)).default);t.Grab=o,t.default=o},3401:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.HoverResult=void 0;var n=i(6917),r=function(){function e(e,t){this.layer=void 0!==e?e:null,this.renderable=void 0!==t?t:null}return Object.defineProperty(e,"Empty",{get:function(){return new e},enumerable:!1,configurable:!0}),e.from=function(t,i){return new e(t,i)},e.prototype.hover=function(e){null!=this.renderable&&this.renderable.hover(e)},e.prototype.unhover=function(e){null!=this.renderable&&this.renderable.unhover(e)},e.prototype.isEmpty=function(){return null==this.renderable},e.prototype.select=function(){null!=this.renderable&&this.renderable.select()},e.prototype.unselect=function(){null!=this.renderable&&this.renderable.unselect()},e.prototype.isGrabbed=function(){return null!=this.renderable&&this.renderable instanceof n.Item&&this.renderable.isGrabbed()},e.prototype.isHover=function(e){return null!=this.renderable&&null!=this.layer&&this.layer.applyRenderable(e,this.renderable,(function(t){return t.isHover(e)}))},e.prototype.instance=function(){return this.renderable},e}();t.HoverResult=r},6917:function(e,t,i){"use strict";var n,r=this&&this.__extends||(n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])},n(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function i(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),s=this&&this.__assign||function(){return s=Object.assign||function(e){for(var t,i=1,n=arguments.length;i<n;i++)for(var r in t=arguments[i])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e},s.apply(this,arguments)},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.Item=void 0;var a=o(i(2834)),l=i(9884),u=o(i(9778)),c=o(i(8644)),d=o(i(5954)),h=o(i(1663)),p=function(e){function t(){var t=e.call(this)||this;return t.overflow=!1,t._islistening=!1,t.properties={},t.grabs=new c.default,t.zIndex.set(0),t}return r(t,e),t.prototype.render=function(e){this.renderGrab(e)},t.prototype.hover=function(e){this.enableGrab(e.dispatcher)},t.prototype.unhover=function(e){this.disableGrab(e.dispatcher)},t.prototype.isHover=function(e){for(var t=0,i=this.grabs.toArray();t<i.length;t++)if(i[t].isHover(e))return!0;return!1},t.prototype.renderables=function(){return this.grabs},t.prototype.destroy=function(){e.prototype.destroy.call(this),this.grabs.forEach((function(e){return e.destroy()})),this.grabs.destroy()},t.prototype.set=function(e,t){this.getProperty(e).setValue(t)},t.prototype.get=function(e){return this.getProperty(e).getValue()},t.prototype.getProperty=function(e){var t=this.properties[e];if(void 0===t)throw new Error('no property "'.concat(e,'"'));return t},t.prototype.getProperties=function(){return this.properties},t.prototype.setProperty=function(e,t,i,n){var r=new u.default(e,t,i,n);return this.properties[e]=r,r},t.prototype.removeProperty=function(e){var t,i="string"==typeof e?e:e.getName();null===(t=this.properties[i])||void 0===t||t.destroy(),delete this.properties[i]},t.prototype.addGrab=function(e,t){var i=e instanceof d.default?new l.GrabPoint(e,t):new h.default(e,t);return this.grabs.add(i),i},t.prototype.removeGrab=function(e){this.grabs.remove(e)},t.prototype.enableGrab=function(e,t){this.grabs.forEach((function(i){return i.register(e,t)}))},t.prototype.disableGrab=function(e){this.grabs.forEach((function(t){return t.unregister(e)}))},t.prototype.renderGrab=function(e){this.grabs.forEach((function(t){return t.render(e)}))},t.prototype.isGrabbed=function(){for(var e=0,t=this.grabs.toArray();e<t.length;e++)if(t[e].isGrabbed())return!0;return!1},t.prototype.serialize=function(){return s(s({},e.prototype.serialize.call(this)),{type:"Item",grabs:this.grabs.serialize()})},t}(a.default);t.Item=p},1401:function(e,t,i){"use strict";var n,r=this&&this.__extends||(n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])},n(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function i(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),s=this&&this.__createBinding||(Object.create?function(e,t,i,n){void 0===n&&(n=i);var r=Object.getOwnPropertyDescriptor(t,i);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[i]}}),Object.defineProperty(e,n,r)}:function(e,t,i,n){void 0===n&&(n=i),e[n]=t[i]}),o=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),a=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)"default"!==i&&Object.prototype.hasOwnProperty.call(e,i)&&s(t,e,i);return o(t,e),t},l=this&&this.__spreadArray||function(e,t,i){if(i||2===arguments.length)for(var n,r=0,s=t.length;r<s;r++)!n&&r in t||(n||(n=Array.prototype.slice.call(t,0,r)),n[r]=t[r]);return e.concat(n||Array.prototype.slice.call(t))},u=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.Layer=void 0;var c=u(i(8644)),d=i(5966),h=a(i(2834)),p=i(3401),f=function(e){function t(t){var i=e.call(this)||this;return i.offscreen=(0,d.create2DCanvasContextTracked)(),i.overscreen=(0,d.create2DCanvasContextTracked)(),i.collection=new c.default,i.filters=new c.default,void 0===t&&(t={name:"unnamed layer"}),i.overflow="boolean"==typeof t.overflow&&t.overflow,i.currentZIndex="number"==typeof t.zIndex?t.zIndex:0,i.name=t.name,i.background="string"==typeof t.background?t.background:null,i.renderingType=void 0!==t.type?t.type:h.RenderableType.Normal,i.zIndex.set(i.currentZIndex),i.ondestroy=i.ondestroytrigger(i),i}return r(t,e),t.prototype.destroy=function(){this.collection.forEach((function(e){return e.destroy()})),this.collection.clear(),this.filters.clear()},t.prototype.ondestroytrigger=function(e){return function(t){t.zIndex.pop(),e.collection.tryRemove(t)}},t.prototype.addRenderable=function(e){this.collection.add(e),e.zIndex.push(this.currentZIndex),e.on("destroy",this.ondestroy)},t.prototype.removeRenderable=function(e){e.zIndex.pop(),this.collection.remove(e),e.off("destroy",this.ondestroy)},t.prototype.filter=function(e){var t=this;this.filters.forEach((function(i){i.apply(t.offscreen,void 0===e?t.collection:e)}))},t.prototype.setTransform=function(e){this.offscreen.setTransform(e),this.overscreen.setTransform(e)},t.prototype.resetTransform=function(){this.offscreen.setTransform((0,d.ResetTransformation)()),this.overscreen.setTransform((0,d.ResetTransformation)())},t.prototype.clear=function(e){(0,d.clearCanvas)(this.offscreen,void 0===e?null==this.background?e:this.background:e),(0,d.clearCanvas)(this.overscreen)},t.prototype.save=function(){this.offscreen.save(),this.overscreen.save()},t.prototype.restore=function(){this.overscreen.restore(),this.offscreen.restore()},t.prototype.rect=function(e,t){this.offscreen.beginPath(),this.offscreen.rect(e.origin.x,e.origin.y,e.size.x,e.size.y),this.offscreen.fillStyle=t,this.offscreen.fill()},t.prototype.fit=function(e){if(e instanceof CanvasRenderingContext2D||(0,d.isContextTracked)(e))this.resize(e.canvas.width,e.canvas.height);else if(e instanceof HTMLImageElement)this.resize(e.naturalWidth,e.naturalHeight);else{if(!(e instanceof HTMLCanvasElement))throw new Error("unable to fit the layer based on the target");this.resize(e.width,e.height)}},t.prototype.resize=function(e,t){(0,d.resize2DCanvasContext)(this.offscreen,e,t),(0,d.resize2DCanvasContext)(this.overscreen,e,t)},t.prototype.renderables=function(){return this.collection},t.prototype.getHoveredRenderable=function(e){for(var t=0,i=l([],this.collection.toArray(),!0).sort((function(e,t){return e.compare(t)})).reverse();t<i.length;t++){var n=i[t];if(n.overflow){if(e.push(this.overscreen),n.isHover(e))return p.HoverResult.from(this,n);e.pop()}else{if(e.push(this.offscreen),n.isHover(e))return p.HoverResult.from(this,n);e.pop()}}return p.HoverResult.Empty},t.prototype.applyRenderable=function(e,t,i){if(t.overflow){e.push(this.overscreen);var n=i(t);return e.pop(),n}return e.push(this.offscreen),n=i(t),e.pop(),n},t.prototype.render=function(e){this.offscreen.imageSmoothingEnabled=!1,this.overscreen.imageSmoothingEnabled=!1;for(var t=this.collection.toArray(),i=[],n=0,r=t;n<r.length;n++){var s=r[n];i=i.concat(s.renderables().toArray())}for(var o=0,a=i=i.concat(t).sort((function(e,t){return e.compare(t)}));o<a.length;o++)(s=a[o]).overflow?(e.push(this.overscreen),s.render(e),e.pop()):(e.push(this.offscreen),s.render(e),e.pop())},t.prototype.isHover=function(){return!1},t.prototype.serialize=function(){return{type:"Layer",name:this.name,zIndex:this.currentZIndex,background:this.background,renderingType:this.renderingType,overflow:this.overflow,collection:this.collection.serialize(),filters:this.filters.serialize()}},t.deserializer=function(e,i){if("Layer"!==e.type)throw new Error("bad type");if(void 0===i)throw new Error("unable to deserialize generic class without types");var n=new t({zIndex:e.zIndex,name:e.name,type:e.renderingType,background:e.background,overflow:e.overflow});return c.default.deserializer(e.collection,i).forEach((function(e){return n.addRenderable(e)})),c.default.deserializer(e.filters,i).forEach((function(e){return n.filters.add(e)})),n},t}(h.default);t.Layer=f,t.default=f},9076:function(e,t,i){"use strict";var n,r=this&&this.__extends||(n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])},n(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function i(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.MultiColor=void 0;var o=s(i(3812)),a=function(e){function t(t){var i=e.call(this,255,0,0)||this;return i.h=0,i.s=1,i.l=.5,i.factor=5,i.factor=t,i}return r(t,e),Object.defineProperty(t,"Default",{get:function(){return new t(1)},enumerable:!1,configurable:!0}),t.prototype.update=function(e){var t=o.default.hslToRgb(this.h,this.s,this.l),i=t[0],n=t[1],r=t[2];this.h+=e/this.factor,this.h>1&&(this.h=0),this.r=i,this.g=n,this.b=r},t}(o.default);t.MultiColor=a,t.default=a},1173:function(e,t,i){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.RenderState=void 0;var r=n(i(5954)),s=function(){function e(e,t,i,n,s,o){this._isHoverEnabled=!1,this._dispatcher=t,this.stack=[s],this._mouse=[r.default.duplicate(o)],this._dt=n,this.scene=i,this.status=e}return e.prototype.isMouseInPath=function(){return!!this._isHoverEnabled&&this.ctx.isPointInPath(this.mouse.x,this.mouse.y)},e.prototype.isPointInPath=function(e,t){var i=this.ctx.worldToScreen(e,t);return this.ctx.isPointInPath(i.x,i.y)},e.prototype.enableHover=function(){this._isHoverEnabled=!0},e.prototype.disableHover=function(){this._isHoverEnabled=!1},Object.defineProperty(e.prototype,"ctx",{get:function(){return this.stack[this.stack.length-1]},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"mouse",{get:function(){return this._mouse[this._mouse.length-1]},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"dispatcher",{get:function(){return this._dispatcher},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"dt",{get:function(){return this._dt},enumerable:!1,configurable:!0}),e.prototype.screenToWorld=function(e){return this.ctx.screenToWorld(e)},e.prototype.worldToScreen=function(e){return this.ctx.worldToScreen(e)},e.prototype.push=function(e){this._mouse.push(this.ctx.screenToWorld(this.mouse)),this.stack.push(e)},e.prototype.pop=function(){var e=this.stack.pop(),t=this._mouse.pop();if(null==e||null==t)throw new Error("too much pop()");return e},e}();t.RenderState=s,t.default=s},6614:(e,t)=>{"use strict";var i;Object.defineProperty(t,"__esModule",{value:!0}),t.RenderStatus=void 0,function(e){e[e.File=0]="File",e[e.Screen=1]="Screen"}(i=t.RenderStatus||(t.RenderStatus={})),t.default=i},2834:function(e,t,i){"use strict";var n,r=this&&this.__extends||(n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])},n(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function i(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.Renderable=t.RenderableType=void 0;var o,a=i(8533),l=s(i(4651));!function(e){e[e.Normal=0]="Normal",e[e.Draft=1]="Draft"}(o=t.RenderableType||(t.RenderableType={}));var u=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._isselected=!1,t.overflow=!1,t.zIndex=new l.default,t.renderingType=o.Normal,t}return r(t,e),t.prototype.getRenderingType=function(){return this.renderingType},t.prototype.setRenderingType=function(e){this.renderingType=e},t.prototype.hover=function(e){},t.prototype.unhover=function(e){},t.prototype.destroy=function(){this.emit("destroy",this)},t.prototype.select=function(){this._isselected=!0,this.emit("select",this)},t.prototype.unselect=function(){this._isselected=!1,this.emit("unselect",this)},t.prototype.isSelected=function(){return this._isselected},t.prototype.compare=function(e){return this.zIndex.compare(e.zIndex)},t.prototype.serialize=function(){return{type:"Renderable",zIndex:this.zIndex.data(),isselected:this._isselected,overflow:this.overflow}},t}(a.StrictEventEmitter);t.Renderable=u,t.default=u},7874:function(e,t,i){"use strict";var n,r=this&&this.__extends||(n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])},n(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function i(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),s=this&&this.__assign||function(){return s=Object.assign||function(e){for(var t,i=1,n=arguments.length;i<n;i++)for(var r in t=arguments[i])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e},s.apply(this,arguments)},o=this&&this.__createBinding||(Object.create?function(e,t,i,n){void 0===n&&(n=i);var r=Object.getOwnPropertyDescriptor(t,i);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[i]}}),Object.defineProperty(e,n,r)}:function(e,t,i,n){void 0===n&&(n=i),e[n]=t[i]}),a=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),l=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)"default"!==i&&Object.prototype.hasOwnProperty.call(e,i)&&o(t,e,i);return a(t,e),t},u=this&&this.__spreadArray||function(e,t,i){if(i||2===arguments.length)for(var n,r=0,s=t.length;r<s;r++)!n&&r in t||(n||(n=Array.prototype.slice.call(t,0,r)),n[r]=t[r]);return e.concat(n||Array.prototype.slice.call(t))},c=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.Scene=void 0;var d=i(5312),h=l(i(2834)),p=i(5966),f=c(i(252)),g=c(i(8644)),m=c(i(1173)),v=i(3401),y=c(i(5954)),w=c(i(9708)),b=c(i(6614)),x=function(e){function t(t,i){var n=e.call(this)||this;return n.overflow=!1,n.box=null,n.layers=new g.default,n.grabEnabled=!1,n.hovered=v.HoverResult.Empty,n.selected=!1,n.name="string"==typeof t?t:"unnamed",n.box=void 0===i?t instanceof f.default?f.default.duplicate(t):null:f.default.duplicate(i),n}return r(t,e),Object.defineProperty(t,"Empty",{get:function(){return new t(f.default.from(-50,-50,100,100))},enumerable:!1,configurable:!0}),t.prototype.destroy=function(){this.layers.forEach((function(e){return e.destroy()})),this.layers.destroy(),this.disableGrab()},t.prototype.renderables=function(){var e=[];return this.layers.forEach((function(t){e=e.concat(t.renderables().toArray())})),g.default.from(e)},t.prototype.enableGrab=function(){this.grabEnabled=!0},t.prototype.disableGrab=function(){this.grabEnabled=!1},t.prototype.isGrabEnabled=function(){return this.grabEnabled},t.prototype.getBox=function(){return null==this.box?f.default.Zero:this.box},t.prototype.toBMP=function(e){var t=this;if(null==this.box)throw new Error("infinite canvas to bmp not yet implemented");var i=(0,p.create2DCanvasContextTracked)();i.canvas.width=this.box.size.x,i.canvas.height=this.box.size.y,i.setTransform((0,p.ResetTransformation)()),i.translate(-this.box.origin.x,-this.box.origin.y);var n={};this.layers.forEach((function(e){n[e.name]=e.getRenderingType()})),void 0!==e&&(this.layers.forEach((function(e){return e.setRenderingType(h.RenderableType.Draft)})),e.forEach((function(e){var i=t.layers.find((function(t){return t.name===e}));null!=i&&n[i.name]!==h.RenderableType.Draft&&i.setRenderingType(h.RenderableType.Normal)}))),this.renderInternal(new m.default(b.default.File,new w.default,this,0,i,new y.default),!1),this.layers.forEach((function(e){return e.setRenderingType(n[e.name])}));var r=(0,d.fromCanvas)(d.RGBA,i.canvas);return new Blob([r],{type:"image/bmp"})},t.prototype.setName=function(e){this.name=e},t.prototype.getName=function(){return this.name},t.prototype.resize=function(e,t){this.box=f.default.from(-e/2,-t/2,e,t)},t.prototype.reset=function(){this.layers.forEach((function(e){e.renderables().forEach((function(e){return e.destroy()})),e.renderables().destroy()})),this.layers.forEach((function(e){return e.resetTransform()}))},t.prototype.render=function(e){this.renderInternal(e,!0)},t.prototype.isHover=function(){return!1},t.prototype.renderInternal=function(e,t){var i=this,n=e.ctx;this.isGrabEnabled()?e.enableHover():(e.disableHover(),this.hovered.isEmpty()||this.hovered.unhover(e),this.hovered=v.HoverResult.Empty);var r=n.duplicateTransform();n.setTransform((0,p.ResetTransformation)()),this.layers.forEach((function(e){(t||e.getRenderingType()!==h.RenderableType.Draft)&&e.fit(n)})),this.layers.forEach((function(e){(t||e.getRenderingType()!==h.RenderableType.Draft)&&e.clear()})),this.layers.forEach((function(e){(t||e.getRenderingType()!==h.RenderableType.Draft)&&e.setTransform(r)}));var s=this.layers.toArray().sort((function(e,t){return e.compare(t)}));if(!this.hovered.isEmpty()&&this.hovered.isGrabbed())this.selected||(this.selected=!0,this.hovered.select()),this.hovered.isHover(e)||this.hovered.isGrabbed()||(this.hovered.unhover(e),this.hovered=v.HoverResult.Empty);else{this.selected=!1;for(var o=u([],this.layers.toArray(),!0).sort((function(e,t){return t.compare(e)})),a=this.hovered,l=v.HoverResult.Empty,c=0,d=o;c<d.length;c++){var f=d[c].getHoveredRenderable(e);if(!f.isEmpty()){l=f;break}}this.hovered=l,this.hovered.instance()!==a.instance()&&(null==a||a.unhover(e)),this.hovered.isEmpty()||a.instance()===l.instance()||this.hovered.hover(e)}s.forEach((function(i){(t||i.getRenderingType()!==h.RenderableType.Draft)&&i.render(e)})),this.layers.forEach((function(e){(t||e.getRenderingType()!==h.RenderableType.Draft)&&e.filter(i.renderables())})),s.forEach((function(e){(t||e.getRenderingType()!==h.RenderableType.Draft)&&(null!=i.box&&(0,p.clip)(n,r,i.box),n.drawImage(e.offscreen.canvas,0,0),null!=i.box&&(0,p.unclip)(n),n.drawImage(e.overscreen.canvas,0,0))})),n.setTransform(r)},t.prototype.serialize=function(){var e={type:"Scene",name:this.getName()};return null!=this.box&&(e.box=this.box.serialize()),s(s({},e),{layers:this.layers.serialize()})},t.deserializer=function(e,i){if("Scene"!==e.type)throw new Error("bad type");if(void 0===i)throw new Error("unable to deserialize generic class without types");var n=void 0===e.box?new t:new t(f.default.deserializer(e.box));return n.setName(e.name),g.default.deserializer(e.layers,i).forEach((function(e){return n.layers.add(e)})),n},t}(h.default);t.Scene=x,t.default=x},2736:function(e,t,i){"use strict";var n,r=this&&this.__extends||(n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])},n(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function i(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.Sprite=void 0;var o=s(i(5954)),a=s(i(4558)),l=i(5966),u=i(6917),c=s(i(252)),d=i(9778),h=function(e){function t(i,n){var r,s=e.call(this)||this;return s.box=c.default.Zero,s.id=t.GenID.get(),s.internal=i,s._isloaded=void 0!==n||(0,l.isImageLoaded)(s.internal),s._keep_ratio=!1,s._isloaded&&(s.box=void 0!==n?c.default.duplicate(n):c.default.from(-s.internal.naturalWidth/2,-s.internal.naturalHeight/2,s.internal.naturalWidth,s.internal.naturalHeight)),s.grab=s.addGrab(s.box,l.MouseButton.Left),s.zIndex.set(0),r=s.grab.pointers(),s.x=r[0],s.y=r[1],s.width=r[2],s.height=r[3],s.setProperty("x",s.x,d.floatConvertor,(0,d.DefaultFormBuilder)("x",s.x,d.floatConvertor,d.floatDeconvertor)),s.setProperty("y",s.y,d.floatConvertor,(0,d.DefaultFormBuilder)("y",s.y,d.floatConvertor,d.floatDeconvertor)),s.setProperty("width",s.width,d.floatConvertor,(0,d.DefaultFormBuilder)("width",s.width,d.floatConvertor,d.floatDeconvertor)),s.setProperty("height",s.height,d.floatConvertor,(0,d.DefaultFormBuilder)("height",s.height,d.floatConvertor,d.floatDeconvertor)),s.setProperty("zIndex",s.zIndex,d.floatConvertor,(0,d.DefaultFormBuilder)("z-index",s.zIndex,d.floatConvertor,d.floatDeconvertor)),s}return r(t,e),t.prototype.getID=function(){return this.id},t.prototype.destroy=function(){e.prototype.destroy.call(this),t.GenID.remove(this.id)},t.prototype.render=function(e){var t=e.ctx;if(!this._isloaded&&(0,l.isImageLoaded)(this.internal)&&(this._isloaded=!0,this.box=c.default.from(-this.internal.naturalWidth/2,-this.internal.naturalHeight/2,this.internal.naturalWidth,this.internal.naturalHeight),this.grab.refresh(this.box)),this._isloaded&&(0,l.isImageLoaded)(this.internal)){var i=new o.default(this.x.get(),this.y.get()),n=new o.default(this.width.get(),this.height.get()),r=o.default.sub(new o.default(this.x.get(),this.y.get()),new o.default(this.x.get()+this.width.get(),this.y.get()+this.height.get()));t.translate(i.x,i.y),t.scale(r.x<0?1:-1,r.y<0?1:-1),t.drawImage(this.internal,r.x<0?0:-n.x,r.y<0?0:-n.y,n.x,n.y),t.scale(r.x<0?1:-1,r.y<0?1:-1),t.translate(-i.x,-i.y)}},t.from=function(e,i){if(e instanceof HTMLImageElement)return new t(e,i);if(e instanceof File)return new Promise((function(i,n){var r=new FileReader;r.onload=function(e){if(null==e.target)return n(new Error("unable to load the image"));var r=new Image;r.src=e.target.result,i(t.from(r))},r.readAsDataURL(e)}));for(var n=[],r=0;r<e.length;r++)n.push(t.from(e[r]));return n},t.prototype.serialize=function(){var e=document.createElement("canvas"),t=e.getContext("2d");if(null==t)throw new Error("unable to get 2d context");return e.height=this.internal.naturalHeight,e.width=this.internal.naturalWidth,t.drawImage(this.internal,0,0),{type:"Sprite",box:c.default.from(this.x.get(),this.y.get(),this.width.get(),this.height.get()).serialize(),zIndex:this.zIndex.get(),image:e.toDataURL()}},t.GenID=new a.default,t.deserializer=function(e){if("Sprite"!==e.type)throw new Error("bad type");var i=new Image,n=c.default.deserializer(e.box),r=t.from(i,n);return r.zIndex.set(e.zIndex),i.src=e.image,r},t}(u.Item);t.Sprite=h,t.default=h},4651:function(e,t,i){"use strict";var n,r=this&&this.__extends||(n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])},n(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function i(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)});Object.defineProperty(t,"__esModule",{value:!0}),t.ZIndex=void 0;var s=function(e){function t(t){var i=e.call(this,0)||this;return i.values=[],i.values="number"==typeof t?[t]:[],i}return r(t,e),t.prototype.push=function(e){this.values.unshift(e)},t.prototype.pop=function(){var e=this.values.shift();return void 0===e?null:e},t.prototype.get=function(e){return this.values["number"==typeof e?e:this.values.length-1]},t.prototype.set=function(e){0===this.values.length?this.values.push(e):this.values[this.values.length-1]=e},t.prototype.size=function(){return this.values.length},t.prototype.clear=function(){this.values=[]},t.prototype.data=function(){return this.values},t.prototype.compare=function(e){if(this.size()!==e.size())return this.size()-e.size();for(var t=this.size()-1;t>=0;t--)if(this.get(t)!==e.get(t))return this.get(t)-e.get(t);return 0},t}(i(1301).Pointer);t.ZIndex=s,t.default=s},7953:function(e,t,i){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.RoadFilter=void 0;var r=i(5966),s=n(i(3812)),o=i(9918),a=n(i(9388)),l=function(){function e(){}return e.prototype.apply=function(e,t){var i=e.globalCompositeOperation;e.globalCompositeOperation="destination-over";var n=e.lineWidth,l=s.default.Magenta,u=s.default.Yellow;if(e.lineCap="butt",e.lineWidth=1,0!==t.length){var c=t.find((0,r.IsInstanceOf)(o.RoadLine));if(null==c&&(c=t.find((0,r.IsInstanceOf)(a.default))),null!=c){for(var d=c.getWidth(),h=.7,p=t.filter((0,r.IsInstanceOf)(o.RoadLine)).toArray(),f=t.filter((0,r.IsInstanceOf)(a.default)).toArray(),g=p.concat(f),m=0;m<d*(1/h);m++)for(var v=g.length-1;v>=0;v--){var y=g[v];if(y instanceof o.RoadLine||y instanceof a.default){var w=d/2+e.lineWidth/2;if(y instanceof o.RoadLine){var b=y.getStart(),x=y.getEnd(),_=Math.atan2(x.y-b.y,x.x-b.x),k=(m*h+w)*Math.cos(_),C=(m*h+w)*Math.sin(_);(0,r.line)(e,b.x-C,b.y+k,x.x-C,x.y+k),(0,r.stroke)(e,l),(0,r.arc)(e,x.x,x.y,w+m*h,_,_+Math.PI/2),(0,r.stroke)(e,l),(0,r.arc)(e,b.x,b.y,w+m*h,_+Math.PI/2,_+Math.PI),(0,r.stroke)(e,l),(0,r.line)(e,b.x+C,b.y-k,x.x+C,x.y-k),(0,r.stroke)(e,u),(0,r.arc)(e,x.x,x.y,w+m*h,_-Math.PI/2,_),(0,r.stroke)(e,u),(0,r.arc)(e,b.x,b.y,w+m*h,_+Math.PI,_+Math.PI+Math.PI/2),(0,r.stroke)(e,u)}else if(y instanceof a.default){var T=y.getCenter(),S=y.getRadius(),O=(0,r.DegToRad)(y.getStartAngle()),E=(0,r.DegToRad)(y.getEndAngle()),I=O,D=E;I>=D&&(I=E,D=O),(0,r.arc)(e,T.x,T.y,S+(m*h+w),I,D),(0,r.stroke)(e,l),(0,r.arc)(e,T.x,T.y,S-(m*h+w),I,D),(0,r.stroke)(e,u)}}}e.globalCompositeOperation=i,e.lineWidth=n}}},e.prototype.serialize=function(){return{type:"RoadFilter"}},e.deserializer=function(t){if("RoadFilter"!==t.type)throw new Error("bad type");return new e},e}();t.RoadFilter=l,t.default=l},8107:function(e,t,i){"use strict";var n,r=this&&this.__extends||(n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])},n(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function i(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.LogicalLines=void 0;var o=i(8533),a=s(i(2854)),l=s(i(9388)),u=i(9918),c=function(e){function t(t){var i=e.call(this)||this;return i.tmppos=null,i.tmpcur=null,i.button=t,i.lastButton=t,i.ondragstart=i.dragstart(i),i.ondragstep=i.dragstep(i),i.ondragcancel=i.dragcancel(i),i.ondragend=i.dragend(i),i}return r(t,e),t.prototype.getCurrentLine=function(){return this.tmppos&&this.tmpcur&&this.lastButton===this.button?new a.default(this.tmppos,this.tmpcur):null},t.prototype.register=function(e){e.on("dragstart",this.ondragstart),e.on("dragstep",this.ondragstep),e.on("dragcancel",this.ondragcancel),e.on("dragend",this.ondragend)},t.prototype.unregister=function(e){e.off("dragstart",this.ondragstart),e.off("dragstep",this.ondragstep),e.off("dragcancel",this.ondragcancel),e.off("dragend",this.ondragend)},t.prototype.dragstart=function(e){var t=this;return function(i,n){n===e.button?e.tmppos=i:t.tmppos=null,e.tmpcur=null,e.lastButton=n}},t.prototype.dragstep=function(e){return function(t){e.tmpcur=t}},t.prototype.dragend=function(e){return function(t){null!=e.tmppos&&e.emit("newline",new a.default(e.tmppos,t)),e.tmppos=null,e.tmpcur=null}},t.prototype.dragcancel=function(e){return function(){e.tmppos=null,e.tmpcur=null}},t.prototype.renderCurrentLine=function(e){var t=this;return function(i){var n=t.getCurrentLine();if(null!=n){var r=u.RoadLine.from(a.default.Zero);r.setColor(e),r.setStart(n.start),r.setEnd(n.end),r.render(i),r.destroy()}}},t.prototype.renderCurrentArc=function(e){var t=this;return function(i){var n=t.getCurrentLine();if(null!=n){var r=l.default.from(n);r.setColor(e),r.render(i),r.destroy()}}},t}(o.StrictEventEmitter);t.LogicalLines=c,t.default=c},7630:function(e,t,i){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.MapWriter=void 0;var r=i(5966),s=n(i(5954)),o=n(i(593)),a=n(i(101)),l=n(i(2850)),u=n(i(1522)),c=n(i(1271)),d=n(i(3618)),h=n(i(8964)),p=n(i(8836)),f=i(9918),g=i(9388),m=i(5990),v=i(9669),y=i(8087),w=i(9064),b=function(){function e(e){this.name=(0,r.getOrDefaultValue)(e.name,"unnamed"),this.graphics=(0,r.getOrDefaultValue)(e.graphics,"game-unnamed.bmp"),this.guide=(0,r.getOrDefaultValue)(e.guide,"b-unnamed.bmp"),this.init=(0,r.getOrDefaultValue)(e.init,o.default.Zero),this.roads=(0,r.getOrDefaultValue)(e.roads,[]),this.ways=(0,r.getOrDefaultValue)(e.ways,[]),this.trafficLights=(0,r.getOrDefaultValue)(e.trafficLights,[]),this.stops=(0,r.getOrDefaultValue)(e.stops,[]),this.obstacles=(0,r.getOrDefaultValue)(e.obstacles,[]),this.itinerary=(0,r.getOrDefaultValue)(e.itinerary,a.default.Default)}return e.prototype.getName=function(){return this.name},e.prototype.getItiName=function(){return"".concat(this.name,".iti")},e.prototype.getGraphicsName=function(){return this.graphics},e.prototype.getGuideName=function(){return this.guide},e.prototype.build=function(){var e="";e+='map "'.concat(this.name,'"\n'),e+='graphics "'.concat(this.graphics,'"\n'),e+='guide "'.concat(this.guide,'"\n'),e+=this.init.toString(),e+="rd ".concat(this.roads.length,"\n");for(var t=0,i=this.roads;t<i.length;t++)e+=i[t].toString();e+="wp ".concat(this.ways.length,"\n");for(var n=0,r=this.ways;n<r.length;n++)e+=r[n].toString();e+="tl ".concat(this.trafficLights.length,"\n");for(var s=0,o=this.trafficLights;s<o.length;s++)e+=o[s].toString();e+="st ".concat(this.stops.length,"\n");for(var a=0,l=this.stops;a<l.length;a++)e+=l[a].toString();e+="obst ".concat(this.obstacles.length,"\n");for(var u=0,c=this.obstacles;u<c.length;u++)e+=c[u].toString();return e+="iti ".concat(this.itinerary.size(),"\n"),(e+=this.itinerary.toString())+"end\n"},e.prototype.buildItinerary=function(){return this.itinerary.toString()},e.computeCoordinate=function(e,t){return new s.default(t.x-e.origin.x,e.size.y-(t.y-e.origin.y))},e.from=function(t){var i=this,n={},s=t.getBox();n.name=t.getName(),n.graphics="game-".concat(n.name,".bmp"),n.guide="b-".concat(n.name,".bmp"),n.roads=[];var b=[],x=t.renderables().filter((0,r.IsInstanceOf)(f.RoadLine)).toArray(),_=t.renderables().filter((0,r.IsInstanceOf)(g.RoadArc)).toArray(),k=t.renderables().filter((0,r.IsInstanceOf)(y.Obstacle)).toArray(),C=t.renderables().filter((0,r.IsInstanceOf)(m.StartingPoint)).toArray(),T=t.renderables().filter((0,r.IsInstanceOf)(v.Step)).toArray().sort((function(e,t){return e.getIndex()-t.getIndex()})),S=t.renderables().filter((0,r.IsInstanceOf)(w.Stop)).toArray();C.length>0&&(n.init=new o.default(this.computeCoordinate(s,C[0].getPosition()),C[0].getAngle()),b.push(a.default.Go.from(C[0].getSpeed())));for(var O=0,E=x;O<E.length;O++){var I=E[O];n.roads.push(new u.default(I.getDirection(),I.getSpeed(),this.computeCoordinate(s,I.getStart()),this.computeCoordinate(s,I.getEnd())))}for(var D=0,z=_;D<z.length;D++){var A=z[D];n.roads.push(new c.default(A.getDirection(),A.getSpeed(),this.computeCoordinate(s,A.getCenter()),A.getRadius(),A.getStartAngle(),A.getEndAngle()))}var P=k.map((function(e){return new l.default(i.computeCoordinate(s,e.getPosition()),e.getSince(),e.getTill())}));if(n.obstacles=P,T.length>0){for(var R=C.length>0?C[0].getSpeed():20,j=0,$=T;j<$.length;j++){var M=(B=$[j]).getAction();b.push(M),M instanceof a.default.Go?R=M.getValue():M instanceof a.default.Turn&&b.push(a.default.Go.from(R))}for(var L=[],F=0,N=T;F<N.length;F++){var B=N[F];L.push(new p.default(this.computeCoordinate(s,B.getPosition()),B.getRoadIndex()))}n.itinerary=new a.default(b),n.ways=L}if(C.length>0&&0===T.length&&(b.push(a.default.Stop.from()),n.itinerary=new a.default(b)),S.length>0){for(var H=[],W=[],U=0;U<S.length;U++){var G=S[U];W.push(new h.default(this.computeCoordinate(s,G.getLightPosition()),G.getRoadIndex(),G.getLightDelayR(),G.getLightDelayA(),G.getLightDelayG(),G.getLightPhase())),H.push(new d.default(this.computeCoordinate(s,G.getPosition()),G.getRoadIndex(),U))}n.stops=H,n.trafficLights=W}return new e(n)},e}();t.MapWriter=b,t.default=b},8087:function(e,t,i){"use strict";var n,r=this&&this.__extends||(n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])},n(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function i(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.Obstacle=void 0;var o=s(i(5954)),a=s(i(4558)),l=i(5966),u=i(6917),c=i(1301),d=i(9778),h=function(e){function t(i){var n,r=e.call(this)||this;r.id=t.GenID.get();var s=r;return r.imageloaded=!1,r.image=new Image,r.image.onload=function(){s.imageloaded=!0},r.image.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADUAAAAwCAYAAACxKzLDAAABhWlDQ1BJQ0MgcHJvZmlsZQAAKJF9kT1Iw0AcxV9TpaKVChYRcchQnSyIijhKFYtgobQVWnUwufRDaNKQpLg4Cq4FBz8Wqw4uzro6uAqC4AeIo5OToouU+L+k0CLGg+N+vLv3uHsHCPUyU82OcUDVLCMVj4nZ3IoYeEUP+hBCAAMSM/VEeiEDz/F1Dx9f76I8y/vcn6NXyZsM8InEs0w3LOJ14ulNS+e8TxxmJUkhPiceM+iCxI9cl11+41x0WOCZYSOTmiMOE4vFNpbbmJUMlXiKOKKoGuULWZcVzluc1XKVNe/JXxjMa8tprtMcRhyLSCAJETKq2EAZFqK0aqSYSNF+zMM/5PiT5JLJtQFGjnlUoEJy/OB/8LtbszA54SYFY0Dni21/jACBXaBRs+3vY9tunAD+Z+BKa/krdWDmk/RaS4scAaFt4OK6pcl7wOUOMPikS4bkSH6aQqEAvJ/RN+WA/luge9XtrbmP0wcgQ10t3QAHh8BokbLXPN7d1d7bv2ea/f0AQOtyk26TIBIAAAAGYktHRAD4APgA+Im2+KUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAAHdElNRQfmCx4LFimZoIHYAAAL7UlEQVRo3u2Za7CV1XnHf2u9t307+9w4V+BwEPAAAoKXKIpJqRJpHaOjKZLMtDVeYtpMJk0cbKiXdEaoTpI6pmpMmGhrdZKqGRNRi4qIaUQQUECOcDjAgXPd57L3Pvt+e993rX7YNv2SjlI8ZJzhP7Nnf9hr1rN/s57nef/reeGszuqsPlP6qxsXvhPffrN+7cGr9ZmKKaY6QGHwn7R1bDt794yzf1Cx94SfeOLlQ9OmMqacaihjeAd+KkXUdqkzMyxpdxu/cf1C/ZmGEskCfrGAgUuNoxFuhiXtmtuu6cp+ZqHchotRnotWHo7hE7I02dQ4ly2IRj6zUM7E+yivgtAetlSEbI0pNZOjffzb97+kpxTq3GXf1ktvdPU5Vxb1gtXv6UWPvKHn3Pa90w/q5THQGEJjmRCyBSFb4PsKL36Qb33lcj1lUMu+8BWa2wxCTSbq5rlUzumiZvm1px9BuUipMaTGlGAZELBACijk0iyfM4UnlUnW06999N8odHSScq6MG2o87QAa0Lr67DAEmAbYpsA0wPU0qpBgzapFP5gSKP1dC/uWOPmeHRRODOInxlATg0y/fHXnaXU/L4vW1QwzDHBMQdASBGyJUpBLx1m9JLpuSqCG1t15u3jq5xj9x1H9hykc3kMaSdMt3zvx/918x6a1OitbievpJMpBcmWNr8C2BI5ZPcWKp8hlx6beUSy54x49GmhG1zUT7VpAQ2mCPbdc9Yndx0MPPaSvv+HLtNTZmFYAz/MYHerj0NvPkenZjFdKki4oskVFwBK0NEZ58VDo/uffOHzflNqkRese1hNWPdRNo3XRAiL7trHj7ts/Fmzbtm36oosuolAoMBGPIwHHsmifMYNUOs3uHW9y5PV/hlw/JVfhmIKmWpuDIwY/fjkmphQKYNXjW/SB4QTWrNm0zemk/8E7N028/h93/F/rn376aR2UsHf3bl73Z5FUFlfEf8uypfPJZcrc8Z27SKfT7N61g4MvPUCEccKOoD5s0Ny+jGu+v3XqoQA6739WFxQE5nZRGRlgPG/SELR5/MIAOjnCgQMfsHHjBgGw6+23dXf3PmZMb+avXzpKS0Cz5a6baJwmeOXF37Bvf5Jbv/51YrEY7+3cTnzXY9Q6RerCkqZpTVy7sedTgTI/bsHJe28Sy5/apnsnJhCLlqHGIV7xYGaUc+oCDH2wlZ/cdbU+mQ4yMTHGhZ9bQiikaMi8RYfp0NBokcsNEa212bxlK63Tp7N8+XLmLryAwsTVqKHNoKGcTZ45m9T5zfX66PkrKLfOZ/7wcVbrIYyRXiqlEpZlEa6dRiW2m9biTibH+nG9NMlCkkgxTfzIEUZjfaTS4xw6dJJx7fDo81voOzkAwMzFV+JFFqARVGq6PjWojz+pxx4QMwNX6OQlXbwd6GROMU5DNECtofDKHo7jYAcFkyWNlPCrXQfZeulaPvzqMsyhEdb/4Blm1SpeOlxi7NKvMiokj+08zu0XtCOEpHnZWlJ7fsbs5oYzBwWQ2vnIgukLNhweSlU44ZaY1xLFMMB1XUyVo6gglfcxa+v5adcqMrWzYSZUajp5vnkextgJ3Jk1aDsIwH+N99N+tJsvtNo0NrZS96ff4cjJQ6z/xnX6gZ++KKY8/QCy72zpmfHOzzn/nFbCkSjZ7nd5eH8MT5pY5VFiKUWu6PHL+UvIdJ4HOSAvoOTiK03FDqELGcgmoJRHOSFeKDSzfyRNJpOhtXM+l1/zl9T6/fzjmha94Zur9JRDAcx1c2+9dnmIOwaf47boBE3lSZ7pL5AeO0ps0iejA3TrNpgEEkC6COkEJIcJjvcxO9lDYOw4JIYgm6AkbX6RnsaHQ3Gy2SyWbSGFQPhlyrF93Lii7c4pTT8A0zQ7APLZDH+++mpW2gEe7o7zdr4Rx9co10OMl6s7pvKQmoBj3ZivvkRzvod7/uFW7v7xs4xeehWEIhCuI93YycvHDxEe+RcOBCUDJ47jK40QPq3Byo++9WeNP9LSwQhNI5Yo/7D53BXrauqbyeVyPPLII+K0oQzDaAbo6uqisbGRXC7H4uObebccZLYA06/Q/t5bZOatgbEBrN9tR7z6JiqfY4gyd/79z8jMaIJKsQplBzDCEWal9zLStwfTFAghEOJ//b3vVgjaLosbytx44bnrZtzwXZrbZ9Hd3c2KlVfqm264XpwWlFIq7ThOZOXKlWSzWUaH+pg8vJX5qkLaad/576/2Xja744iuMd+nsnsPxm9+h450IOvD+I4kvSyC7miAcC2E6zCcIIt7nqFt/D20Aeqjq4kQELQFrXUGQUswt9Wkvc4k37WG9o7q5euFfX08s3+Q6Np7dFNdmOjkAPuefVycMtSTTz45Y/Xq1VoIQbSmhsPvbuFEnKX/uSt2AGIAnHjqQTHzuqT2V91KcjyFSlTw57fjt0UhEkFaASwqNCf309X/Cu3x9zFNXa0lqkCGUb1zmRJaag3qQpK8FyHYcRmmadI/NMzz+/oYyfkQiJJpmEdr22Lm3WDqoy9UU9I8lQJcs2bNx7bbwRc3ibZs8u6bv/YnG/ozLtnROInBg0Ri40Qz/USzAwS8PKYpsB2JaUigCmbIKoyvNMm8ImD5SAkq0sLCYA2FQoFdB3sZypRBWhCdBvMvxU30cdMlc9jwwime1Kko9uavNl583v4N6+cVqdQrXukrsHuggqeqZlMYAssUWEa1hgwpMAwImAIpBWVXky9pYikfT0GoprW6byzGWz0ncQ0HGQwTtk3Ub5/BzI+zV0wcOuX0O1UdTYb4vNaUdZEV5wWJhAx29JYpuRrLEh81BpASHEtQExCYQpAvK2wTChVNKl91KU6kE9d1iccTvJ9ysecuZqUxxsSeV599/6VfrM0Dr56JEdnlCywa2+pRGnwN5063WHV+kBlNJpZV7XS/vyoICDsSrcE0BUFb0ho1MA3BeMZA1M6mVCoRGxtDtnTgtswl5TvMqrHO/YOdeiqAtm1cplcu8AnbBQwpcH3IlzRaQ31YYkio+KBU9SMlGBKkrMLaspqKDWGDCT2dhtkX4TgOhXyO6xfOZPuTjyZCgwfue/PXv7z5tFr6J9WuRy/QFzSkKI6WkY02IVNTHxTUBW2KJZ9kTjGr0aRU0YykfQYTHoWyxvWrDcKW4ven51gwv7FAKRunv1+ydOlSent7GHjliWkDZ/Kth3r3Dq36XyM1WkFrcKIGPpDNKioljRRgmyBMQdHVjEz69I66jKYUbkVhGgJDCgK2IBKoNo5w+/n0+ssYnsiyadMm8anZpE+q5LFewp4iEDWZTHpMDlcIRiSBkIFlC1xXU/HBr2g8v+pbLUOAr/H96oRJyuq3q0BojTnWzawGzf5j2ds/kfv5NIHu/9vlekVHiWI8RamswRRYAUmhoEmlFdmcj+dVp7SWKciUNbG0Tyzhkc4r3I+g/mdGKKXAMqBY9smnRrm4U35J2XV9PQOTH5yxl25/d98LeiIbpJIY47qaf+WS1h6KPgTCBjVhScCudrhs0Wc44dE34jKW8ilVND7V5oEGwxBYVhVcShBCEHIEyoecCjCQr+cnv/5QTDnUxVc9occCX6OofZSXwBzdyS2dD7F28RGyeUWmqFBS4ClNsawoVzQBWxB0JBUfsmVNrlIddnoCfK0BgfzoWSYkaC0IBSQz5yzh2ru3iymvqcRwHJ8+8ItolaBUzvNE4kriqRRfPn+UlgYTPvqDpiFAQNnTFCqabEkhbLBcgas0SoHWRvV3T+OjsYTAsQQhB4rl/JmpqTlzZqzxfaupmD2GLvejvTE0ZXozHRx26zF1kraaCi1NJuEaA8ORSNvAsAWWIwkFDaIRSU1YEnQkPpqiB56q2ighwDAtGud8jr+49y1xxmrq2ztieujASSaODJEbHyZYH2HehV0c27udmuSgFxl65YGLZzv3ttfkqQ2BYULZg5JbTTutNRVPUyxrihWNp0BpiRWsJVkK0peUP3zu9YN3nfYw81S14Iprv2jW1q33ysU3lFc5eGT75s1/aN21n1/0xZAsXIOXxZRilsB3tFZlwzCalSIdiNStcGXk6FMv77+Aszqrs/qj6r8BR15xJG0hTiEAAAAASUVORK5CYII=",r.grab=r.addGrab(i,l.MouseButton.Left),n=r.grab.pointers(),r.x=n[0],r.y=n[1],r.since=(0,c.makePointer)(1),r.till=(0,c.makePointer)(8),r.setProperty("x",r.x,d.floatConvertor,(0,d.DefaultFormBuilder)("x",r.x,d.floatConvertor,d.floatDeconvertor)),r.setProperty("y",r.y,d.floatConvertor,(0,d.DefaultFormBuilder)("y",r.y,d.floatConvertor,d.floatDeconvertor)),r.setProperty("since",r.since,d.floatConvertor,(0,d.DefaultFormBuilder)("since",r.since,d.floatConvertor,d.floatDeconvertor)),r.setProperty("till",r.till,d.floatConvertor,(0,d.DefaultFormBuilder)("till",r.till,d.floatConvertor,d.floatDeconvertor)),r}return r(t,e),t.prototype.getID=function(){return this.id},t.prototype.destroy=function(){e.prototype.destroy.call(this),t.GenID.remove(this.id)},t.prototype.setSince=function(e){this.since.set(e)},t.prototype.getSince=function(){return this.since.get()},t.prototype.setTill=function(e){this.till.set(e)},t.prototype.getTill=function(){return this.till.get()},t.prototype.setPosition=function(e){this.x.set(e.x),this.y.set(e.y)},t.prototype.getPosition=function(){return new o.default(this.x.get(),this.y.get())},t.prototype.render=function(t){e.prototype.render.call(this,t);var i=t.ctx;this.imageloaded&&i.drawImage(this.image,-this.image.naturalWidth/2+this.x.get(),-this.image.naturalHeight/2+this.y.get())},t.prototype.isHover=function(t){if(e.prototype.isHover.call(this,t))return!0;var i=t.ctx;return!!this.imageloaded&&(i.beginPath(),i.rect(-this.image.naturalWidth/2+this.x.get(),-this.image.naturalHeight/2+this.y.get(),this.image.naturalWidth,this.image.naturalHeight),t.isMouseInPath())},t.from=function(e){return new t(e)},t.prototype.serialize=function(){return{type:"Obstacle",position:this.getPosition().serialize(),since:this.since.get(),till:this.till.get()}},t.GenID=new a.default,t.deserializer=function(e){if("Obstacle"!==e.type)throw new Error("bad type");var i=t.from(o.default.deserializer(e.position));return i.setSince(e.since),i.setTill(e.till),i},t}(u.Item);t.Obstacle=h,t.default=h},9388:function(e,t,i){"use strict";var n,r=this&&this.__extends||(n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])},n(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function i(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),s=this&&this.__assign||function(){return s=Object.assign||function(e){for(var t,i=1,n=arguments.length;i<n;i++)for(var r in t=arguments[i])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e},s.apply(this,arguments)},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.RoadArc=void 0;var a=o(i(5954)),l=o(i(4558)),u=i(5966),c=o(i(3812)),d=i(1301),h=i(9778),p=o(i(9076)),f=i(7892),g=function(e){function t(i,n){var r,s,o,l=e.call(this)||this;if(l.time=0,l.m=0,l.id=t.GenID.get(),i instanceof a.default)l.radius=(0,d.makePointer)(void 0===n?1:n),l.grab=l.addGrab(i,u.MouseButton.Left),l.startAngle=(0,d.makePointer)(90),l.endAngle=(0,d.makePointer)(-90),l.grab2=l.addGrab(a.default.Zero,u.MouseButton.Left),l.grab3=l.addGrab(a.default.Zero,u.MouseButton.Left);else{var c=new f.Vector(i.start,i.end);l.radius=(0,d.makePointer)(c.mag()/2),l.grab=l.addGrab(new a.default((i.start.x+i.end.x)/2,(i.start.y+i.end.y)/2),u.MouseButton.Left),l.startAngle=(0,d.makePointer)((0,u.RadToDeg)(c.argument())),l.endAngle=(0,d.makePointer)((0,u.RadToDeg)(c.argument()+Math.PI)),l.grab2=l.addGrab(i.start,u.MouseButton.Left),l.grab3=l.addGrab(i.end,u.MouseButton.Left)}r=l.grab.pointers(),l.centerx=r[0],l.centery=r[1],s=l.grab2.pointers(),l.testx=s[0],l.testy=s[1],o=l.grab3.pointers(),l.testx2=o[0],l.testy2=o[1];var p=function(){l.testx.off("change",p),l.testy.off("change",p);var e=new f.Vector(l.getCenter()),t=new f.Vector(l.getCenter(),new a.default(l.testx.get(),l.testy.get())),i=e.add(t.normalized().times(l.radius.get()));l.testx.set(i.x),l.testy.set(i.y),l.testx.on("change",p),l.testy.on("change",p);var n=t.argument();l.startAngle.set((0,u.RadToDeg)(n))};l.testx.on("change",p),l.testy.on("change",p);var g=function(){l.testx2.off("change",g),l.testy2.off("change",g);var e=new f.Vector(l.getCenter()),t=new f.Vector(l.getCenter(),new a.default(l.testx2.get(),l.testy2.get())),i=e.add(t.normalized().times(l.radius.get()));l.testx2.set(i.x),l.testy2.set(i.y),l.testx2.on("change",g),l.testy2.on("change",g);var n=t.argument();l.endAngle.set((0,u.RadToDeg)(n))};return l.testx2.on("change",g),l.testy2.on("change",g),l.setProperty("centerx",l.centerx,h.floatConvertor,(0,h.DefaultFormBuilder)("center.x",l.centerx,h.floatConvertor,h.floatDeconvertor)),l.setProperty("centery",l.centery,h.floatConvertor,(0,h.DefaultFormBuilder)("center.y",l.centery,h.floatConvertor,h.floatDeconvertor)),l.setProperty("radius",l.radius,h.floatConvertor,(0,h.DefaultFormBuilder)("radius",l.radius,h.floatConvertor,h.floatDeconvertor)),l.setProperty("startAngle",l.startAngle,h.floatConvertor,(0,h.DefaultFormBuilder)("startAngle",l.startAngle,h.floatConvertor,h.floatDeconvertor)),l.setProperty("endAngle",l.endAngle,h.floatConvertor,(0,h.DefaultFormBuilder)("endAngle",l.endAngle,h.floatConvertor,h.floatDeconvertor)),l.radius.on("change",(function(){l.testx.emit("change"),l.testy.emit("change"),l.testx2.emit("change"),l.testy2.emit("change")})),l.centerx.on("change",(function(){l.testx.emit("change"),l.testy.emit("change"),l.testx2.emit("change"),l.testy2.emit("change")})),l.centery.on("change",(function(){l.testx.emit("change"),l.testy.emit("change"),l.testx2.emit("change"),l.testy2.emit("change")})),l.testx.emit("change"),l.testy.emit("change"),l.testx2.emit("change"),l.testy2.emit("change"),l}return r(t,e),t.prototype.getID=function(){return this.id},t.prototype.destroy=function(){e.prototype.destroy.call(this),t.GenID.remove(this.id)},t.prototype.setP1=function(e){this.testx.set(e.x),this.testy.set(e.y),this.testx.emit("change"),this.testy.emit("change")},t.prototype.setP2=function(e){this.testx2.set(e.x),this.testy2.set(e.y),this.testx2.emit("change"),this.testy2.emit("change")},t.prototype.setCenter=function(e){this.centerx.set(e.x),this.centery.set(e.y)},t.prototype.getCenter=function(){return new a.default(this.centerx.get(),this.centery.get())},t.prototype.setRadius=function(e){this.radius.set(e)},t.prototype.getRadius=function(){return this.radius.get()},t.prototype.setStartAngle=function(e){this.startAngle.set(e)},t.prototype.setEndAngle=function(e){this.endAngle.set(e)},t.prototype.getStartAngle=function(){return this.startAngle.get()},t.prototype.getEndAngle=function(){return this.endAngle.get()},t.prototype.render=function(e){var t=e.ctx;t.lineCap="round",t.lineWidth=this.width;var i=this.startAngle.get(),n=this.endAngle.get();i>=n&&(i=this.endAngle.get(),n=this.startAngle.get()),(0,u.arc)(t,this.centerx.get(),this.centery.get(),this.radius.get(),(0,u.DegToRad)(i),(0,u.DegToRad)(n)),(0,u.stroke)(t,this.color),this.color instanceof p.default&&this.color.update(e.dt)},t.from=function(e,i){return new t(e,i)},t.prototype.serialize=function(){return s(s({},e.prototype.serialize.call(this)),{type:"RoadArc",center:this.getCenter().serialize(),color:this.color.serialize(),width:this.width,speed:this.speed.get(),direction:this.direction.get(),radius:this.radius.get(),startAngle:this.startAngle.get(),endAngle:this.endAngle.get(),p1:new a.default(this.testx.get(),this.testy.get()).serialize(),p2:new a.default(this.testx2.get(),this.testy2.get()).serialize()})},t.GenID=new l.default,t.deserializer=function(e){if("RoadArc"!==e.type)throw new Error("bad type");var i=t.from(a.default.deserializer(e.center),e.radius);return i.setColor(c.default.deserializer(e.color)),i.setDirection(e.direction),i.setSpeed(e.speed),i.setWidth(e.width),i.setRadius(e.radius),i.setP1(a.default.deserializer(e.p1)),i.setP2(a.default.deserializer(e.p2)),i},t}(o(i(4375)).default);t.RoadArc=g,t.default=g},9918:function(e,t,i){"use strict";var n,r=this&&this.__extends||(n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])},n(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function i(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),s=this&&this.__assign||function(){return s=Object.assign||function(e){for(var t,i=1,n=arguments.length;i<n;i++)for(var r in t=arguments[i])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e},s.apply(this,arguments)},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.RoadLine=void 0;var a=i(2854),l=o(i(5954)),u=o(i(4558)),c=i(5966),d=o(i(3812)),h=i(9778),p=o(i(9076)),f=function(e){function t(i){var n,r,s=e.call(this)||this;return s.id=t.GenID.get(),s.p1=s.addGrab(i.start,c.MouseButton.Left),s.p2=s.addGrab(i.end,c.MouseButton.Left),n=s.p1.pointers(),s.x1=n[0],s.y1=n[1],r=s.p2.pointers(),s.x2=r[0],s.y2=r[1],s.setProperty("x1",s.x1,h.floatConvertor,(0,h.DefaultFormBuilder)("x1",s.x1,h.floatConvertor,h.floatDeconvertor)),s.setProperty("y1",s.y1,h.floatConvertor,(0,h.DefaultFormBuilder)("y1",s.y1,h.floatConvertor,h.floatDeconvertor)),s.setProperty("x2",s.x2,h.floatConvertor,(0,h.DefaultFormBuilder)("x2",s.x2,h.floatConvertor,h.floatDeconvertor)),s.setProperty("y2",s.y2,h.floatConvertor,(0,h.DefaultFormBuilder)("y2",s.y2,h.floatConvertor,h.floatDeconvertor)),s}return r(t,e),t.prototype.getID=function(){return this.id},t.prototype.destroy=function(){e.prototype.destroy.call(this),t.GenID.remove(this.id)},t.prototype.setStart=function(e){this.x1.set(e.x),this.y1.set(e.y)},t.prototype.setEnd=function(e){this.x2.set(e.x),this.y2.set(e.y)},t.prototype.getStart=function(){return new l.default(this.x1.get(),this.y1.get())},t.prototype.getEnd=function(){return new l.default(this.x2.get(),this.y2.get())},t.prototype.render=function(e){var t=e.ctx;t.lineCap="round",t.lineWidth=this.width,(0,c.line)(t,this.x1,this.y1,this.x2,this.y2),(0,c.stroke)(t,this.color),this.color instanceof p.default&&this.color.update(e.dt)},t.from=function(e){return new t(e)},t.prototype.serialize=function(){return s(s({},e.prototype.serialize.call(this)),{type:"RoadLine",line:new a.Line(this.getStart(),this.getEnd()).serialize()})},t.GenID=new u.default,t.deserializer=function(e){if("RoadLine"!==e.type)throw new Error("bad type");var i=t.from(a.Line.deserializer(e.line));return i.setColor(d.default.deserializer(e.color)),i.setDirection(e.direction),i.setSpeed(e.speed),i.setWidth(e.width),i},t}(o(i(4375)).default);t.RoadLine=f,t.default=f},4375:function(e,t,i){"use strict";var n,r=this&&this.__extends||(n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])},n(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function i(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.Road=void 0;var o=s(i(3812)),a=i(6917),l=i(1301),u=i(9778),c=function(e){function t(){var t=e.call(this)||this;t.direction=(0,l.makePointer)(1),t.speed=(0,l.makePointer)(20),t.width=2,t.color=o.default.Default;var i=function(e){return"1"===e?1:2};return t.setProperty("direction",t.direction,i,(0,u.SelectFormBuilder)("direction",{1:"1",2:"2"},t.direction,i,(function(e){return e+""}))),t.setProperty("speed",t.speed,u.floatConvertor,(0,u.DefaultFormBuilder)("speed",t.speed,u.floatConvertor,u.floatDeconvertor)),t}return r(t,e),t.prototype.setColor=function(e){this.color=e},t.prototype.getColor=function(){return o.default.from(this.color)},t.prototype.getDirection=function(){return this.direction.get()},t.prototype.getSpeed=function(){return this.speed.get()},t.prototype.setDirection=function(e){this.direction.set(e)},t.prototype.setSpeed=function(e){this.speed.set(e)},t.prototype.setWidth=function(e){this.width=e},t.prototype.getWidth=function(){return this.width},t.prototype.serialize=function(){return{type:"Road",color:this.color.serialize(),width:this.width,speed:this.speed.get(),direction:this.direction.get()}},t}(a.Item);t.Road=c,t.default=c},5990:function(e,t,i){"use strict";var n,r=this&&this.__extends||(n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])},n(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function i(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.StartingPoint=void 0;var o=s(i(5954)),a=s(i(4558)),l=i(5966),u=i(6917),c=i(1301),d=i(9778),h=s(i(3812)),p=function(e){function t(t){var i,n=e.call(this)||this;return n.radius=2,n.time=0,n.grab=n.addGrab(t,l.MouseButton.Left),i=n.grab.pointers(),n.x=i[0],n.y=i[1],n.angle=(0,c.makePointer)(0),n.speed=(0,c.makePointer)(20),n.setProperty("x",n.x,d.floatConvertor,(0,d.DefaultFormBuilder)("x",n.x,d.floatConvertor,d.floatDeconvertor)),n.setProperty("y",n.y,d.floatConvertor,(0,d.DefaultFormBuilder)("y",n.y,d.floatConvertor,d.floatDeconvertor)),n.setProperty("angle",n.angle,d.floatConvertor,(0,d.DefaultFormBuilder)("angle",n.angle,d.floatConvertor,d.floatDeconvertor)),n.setProperty("speed",n.speed,d.floatConvertor,(0,d.DefaultFormBuilder)("speed",n.speed,d.floatConvertor,d.floatDeconvertor)),n}return r(t,e),t.prototype.setPosition=function(e){this.x.set(e.x),this.y.set(e.y)},t.prototype.getPosition=function(){return new o.default(this.x.get(),this.y.get())},t.prototype.setAngle=function(e){this.angle.set(e)},t.prototype.getAngle=function(){return this.angle.get()},t.prototype.setSpeed=function(e){this.speed.set(e)},t.prototype.getSpeed=function(){return this.speed.get()},t.prototype.render=function(e){var t=e.ctx;this.time+=e.dt,this.time>=l.TAU&&(this.time=0),t.lineCap="round",t.lineWidth=2,(0,l.arc)(t,this.x.get(),this.y.get(),this.radius/4,0,l.TAU),(0,l.fill)(t,h.default.fromRGB(0,0,200)),t.lineWidth=1+2*Math.abs(Math.sin(this.time)),t.globalAlpha=.7*(1-Math.abs(Math.sin(this.time)))+.3,(0,l.arc)(t,this.x.get(),this.y.get(),this.radius+10*Math.abs(Math.sin(this.time)),0,l.TAU),(0,l.stroke)(t,h.default.fromRGB(0,0,200)),t.globalAlpha=1,t.lineWidth=1;var i=(0,l.DegToRad)(360-this.angle.get());(0,l.arc)(t,this.x.get(),this.y.get(),this.radius+10*Math.abs(Math.sin(this.time)),i-.2,i+.2),(0,l.stroke)(t,h.default.fromRGB(200,0,0))},t.from=function(e){return new t(e)},t.prototype.serialize=function(){return{type:"StartingPoint",position:this.getPosition().serialize(),angle:this.angle.get(),speed:this.speed.get()}},t.GenID=new a.default,t.deserializer=function(e){if("StartingPoint"!==e.type)throw new Error("bad type");var i=t.from(o.default.deserializer(e.position));return i.setAngle(e.angle),i.setSpeed(e.speed),i},t}(u.Item);t.StartingPoint=p,t.default=p},9669:function(e,t,i){"use strict";var n,r=this&&this.__extends||(n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])},n(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function i(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.Step=void 0;var o=i(2854),a=s(i(5954)),l=s(i(4558)),u=i(5966),c=s(i(3812)),d=i(6917),h=i(1301),p=s(i(101)),f=i(9778),g=s(i(9076)),m=i(9918),v=s(i(9388)),y=s(i(8551)),w=function(e){function t(i){var n,r,s=e.call(this)||this;s.roadIntersection=a.default.Zero,s.roadIndex=-1,s.width=2,s.color=c.default.Default,s.id=t.GenID.get(),s.p1=s.addGrab(i.start,u.MouseButton.Left),s.p2=s.addGrab(i.end,u.MouseButton.Left),n=s.p1.pointers(),s.x1=n[0],s.y1=n[1],r=s.p2.pointers(),s.x2=r[0],s.y2=r[1],s.value=(0,h.makePointer)(20),s.action=(0,h.makePointer)(p.default.Go.from(s.value.get())),s.index=(0,h.makePointer)(s.id),s.setProperty("index",s.index,f.floatConvertor,(0,f.DefaultFormBuilder)("index",s.index,f.floatConvertor,f.floatDeconvertor)),s.setProperty("x1",s.x1,f.floatConvertor,(0,f.DefaultFormBuilder)("x1",s.x1,f.floatConvertor,f.floatDeconvertor)),s.setProperty("y1",s.y1,f.floatConvertor,(0,f.DefaultFormBuilder)("y1",s.y1,f.floatConvertor,f.floatDeconvertor)),s.setProperty("x2",s.x2,f.floatConvertor,(0,f.DefaultFormBuilder)("x2",s.x2,f.floatConvertor,f.floatDeconvertor)),s.setProperty("y2",s.y2,f.floatConvertor,(0,f.DefaultFormBuilder)("y2",s.y2,f.floatConvertor,f.floatDeconvertor));var o=function(e){var t="GO"===e?p.default.Go.from(s.value.get()):"TURN"===e?p.default.Turn.from(s.value.get()):p.default.Stop.from();return"GO"!==e&&"TURN"!==e&&s.value.set(0),t};s.setProperty("action",s.action,o,(0,f.SelectFormBuilder)("action",{GO:"GO",TURN:"TURN",STOP:"STOP"},s.action,o,(function(e){return e instanceof p.default.Go?"GO":e instanceof p.default.Turn?"TURN":"STOP"})));var l=function(e){if(s.action.get()instanceof p.default.Stop)return s.value.set(0),0;var t=(0,f.floatConvertor)(e);return s.action.get()instanceof p.default.Go?s.action.set(p.default.Go.from(s.value.get())):s.action.get()instanceof p.default.Turn&&s.action.set(p.default.Turn.from(s.value.get())),t};return s.setProperty("value",s.value,l,(0,f.DefaultFormBuilder)("value",s.value,l,(function(e){return e+""}))),s}return r(t,e),t.prototype.getID=function(){return this.id},t.prototype.destroy=function(){e.prototype.destroy.call(this),t.GenID.remove(this.id)},t.prototype.setAction=function(e){return this.action.set(e),this.value.set(e.getValue()),this},t.prototype.getAction=function(){return this.action.get()},t.prototype.setColor=function(e){return this.color=e,this},t.prototype.getColor=function(){return c.default.from(this.color)},t.prototype.setWidth=function(e){return this.width=e,this},t.prototype.getWidth=function(){return this.width},t.prototype.getStart=function(){return new a.default(this.x1.get(),this.y1.get())},t.prototype.getEnd=function(){return new a.default(this.x2.get(),this.y2.get())},t.prototype.getRoadIndex=function(){return this.roadIndex},t.prototype.getPosition=function(){return this.roadIntersection},t.prototype.setIndex=function(e){this.index.set(e)},t.prototype.getIndex=function(){return this.index.get()},t.prototype.render=function(e){var t=e.ctx;t.lineCap="round",t.lineWidth=this.width,(0,u.line)(t,this.x1,this.y1,this.x2,this.y2),(0,u.stroke)(t,this.color),this.color instanceof g.default&&this.color.update(e.dt);var i=e.scene.renderables().filter((0,u.IsInstanceOf)(m.RoadLine)).toArray(),n=e.scene.renderables().filter((0,u.IsInstanceOf)(v.default)).toArray(),r=i.map((function(e){return new o.Line(e.getStart(),e.getEnd())})),s=n.map((function(e){return new y.default(e.getCenter(),e.getRadius(),e.getStartAngle(),e.getEndAngle())})),a=new o.Line(this.getStart(),this.getEnd()),l=0;this.roadIndex=-1;for(var c=0,d=r;c<d.length;c++){if(null!=(w=d[c].intersect(a))){var h=w;this.roadIntersection=h,this.roadIndex=l}l++}for(var p=0,f=s;p<f.length;p++){var w;null!=(w=f[p].intersect(a))&&(h=w[0],this.roadIntersection=h,this.roadIndex=l),l++}this.roadIndex<0&&this.destroy()},t.from=function(e){return new t(e)},t.prototype.serialize=function(){return{type:"Step",index:this.index.get(),line:new o.Line(this.getStart(),this.getEnd()).serialize(),color:this.color.serialize(),width:this.width,action:this.action.get()instanceof p.default.Go?["GO",this.value.get()]:this.action.get()instanceof p.default.Turn?["TURN",this.value.get()]:["STOP"]}},t.GenID=new l.default,t.deserializer=function(e){if("Step"!==e.type)throw new Error("bad type");var i=t.from(o.Line.deserializer(e.line));return i.setColor(c.default.deserializer(e.color)),i.setWidth(e.width),"GO"===e.action[0]?i.setAction(p.default.Go.from(e.action[1])):"TURN"===e.action[0]?i.setAction(p.default.Turn.from(e.action[1])):i.setAction(p.default.Stop.from()),i.setIndex(e.index||0),i},t}(d.Item);t.Step=w,t.default=w},9064:function(e,t,i){"use strict";var n,r=this&&this.__extends||(n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])},n(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function i(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.Stop=void 0;var o=i(2854),a=s(i(5954)),l=s(i(4558)),u=i(5966),c=s(i(3812)),d=i(6917),h=i(1301),p=i(9778),f=i(7892),g=s(i(6614)),m=s(i(9076)),v=s(i(9505)),y=i(9918),w=s(i(9388)),b=s(i(8551)),x=function(e){function t(i){var n,r,s,o=e.call(this)||this;return o.time=0,o.roadIntersection=a.default.Zero,o.roadIndex=-1,o.width=2,o.color=c.default.Default,o.id=t.GenID.get(),o.p1=o.addGrab(i.start,u.MouseButton.Left),o.p2=o.addGrab(i.end,u.MouseButton.Left),o.p3=o.addGrab(new a.default((i.start.x+i.end.x)/2,(i.start.y+i.end.y)/2),u.MouseButton.Left),n=o.p1.pointers(),o.x1=n[0],o.y1=n[1],r=o.p2.pointers(),o.x2=r[0],o.y2=r[1],s=o.p3.pointers(),o.lightx=s[0],o.lighty=s[1],o.lightdelayR=(0,h.makePointer)(4),o.lightdelayA=(0,h.makePointer)(3),o.lightdelayG=(0,h.makePointer)(2),o.lightphase=(0,h.makePointer)(0),o.internalTick=o.lightphase.get(),o.lightphase.on("change",(function(){o.internalTick=o.lightphase.get()})),o.setProperty("x1",o.x1,p.floatConvertor,(0,p.DefaultFormBuilder)("x1",o.x1,p.floatConvertor,p.floatDeconvertor)),o.setProperty("y1",o.y1,p.floatConvertor,(0,p.DefaultFormBuilder)("y1",o.y1,p.floatConvertor,p.floatDeconvertor)),o.setProperty("x2",o.x2,p.floatConvertor,(0,p.DefaultFormBuilder)("x2",o.x2,p.floatConvertor,p.floatDeconvertor)),o.setProperty("y2",o.y2,p.floatConvertor,(0,p.DefaultFormBuilder)("y2",o.y2,p.floatConvertor,p.floatDeconvertor)),o.setProperty("lightx",o.lightx,p.floatConvertor,(0,p.DefaultFormBuilder)("light.x",o.lightx,p.floatConvertor,p.floatDeconvertor)),o.setProperty("lighty",o.lighty,p.floatConvertor,(0,p.DefaultFormBuilder)("light.y",o.lighty,p.floatConvertor,p.floatDeconvertor)),o.setProperty("lightdelayR",o.lightdelayR,p.floatConvertor,(0,p.DefaultFormBuilder)("light.delayR",o.lightdelayR,p.floatConvertor,p.floatDeconvertor)),o.setProperty("lightdelayA",o.lightdelayA,p.floatConvertor,(0,p.DefaultFormBuilder)("light.delayA",o.lightdelayA,p.floatConvertor,p.floatDeconvertor)),o.setProperty("lightdelayG",o.lightdelayG,p.floatConvertor,(0,p.DefaultFormBuilder)("light.delayG",o.lightdelayG,p.floatConvertor,p.floatDeconvertor)),o.setProperty("lightphase",o.lightphase,p.floatConvertor,(0,p.DefaultFormBuilder)("light.phase",o.lightphase,p.floatConvertor,p.floatDeconvertor)),o}return r(t,e),t.prototype.getID=function(){return this.id},t.prototype.destroy=function(){e.prototype.destroy.call(this),t.GenID.remove(this.id)},t.prototype.setColor=function(e){return this.color=e,this},t.prototype.getColor=function(){return c.default.from(this.color)},t.prototype.setWidth=function(e){return this.width=e,this},t.prototype.getWidth=function(){return this.width},t.prototype.getStart=function(){return new a.default(this.x1.get(),this.y1.get())},t.prototype.getEnd=function(){return new a.default(this.x2.get(),this.y2.get())},t.prototype.setLightPosition=function(e){return this.lightx.set(e.x),this.lighty.set(e.y),this},t.prototype.getLightPosition=function(){return new a.default(this.lightx.get(),this.lighty.get())},t.prototype.setLightDelayR=function(e){return this.lightdelayR.set(e),this},t.prototype.getLightDelayR=function(){return this.lightdelayR.get()},t.prototype.setLightDelayA=function(e){return this.lightdelayA.set(e),this},t.prototype.getLightDelayA=function(){return this.lightdelayA.get()},t.prototype.setLightDelayG=function(e){return this.lightdelayG.set(e),this},t.prototype.getLightDelayG=function(){return this.lightdelayG.get()},t.prototype.setLightPhase=function(e){return this.lightphase.set(e),this},t.prototype.getLightPhase=function(){return this.lightphase.get()},t.prototype.getRoadIndex=function(){return this.roadIndex},t.prototype.getPosition=function(){return this.roadIntersection},t.prototype.render=function(e){var t=e.ctx;this.time+=e.dt,this.time>1&&(this.time=1-this.time,this.internalTick++,this.internalTick>this.lightdelayR.get()+this.lightdelayA.get()+this.lightdelayG.get()&&(this.internalTick=0)),t.lineCap="round",t.lineWidth=this.width,(0,u.line)(t,this.x1,this.y1,this.x2,this.y2),(0,u.stroke)(t,this.color),this.color instanceof m.default&&this.color.update(e.dt),e.status===g.default.Screen&&(t.lineCap="butt",(0,u.rect)(t,this.lightx,this.lighty,10),this.internalTick>=0&&this.internalTick<this.lightdelayG.get()?(0,u.fill)(t,c.default.Green):this.internalTick>=this.lightdelayG.get()&&this.internalTick<this.lightdelayG.get()+this.lightdelayA.get()?(0,u.fill)(t,c.default.Amber):(0,u.fill)(t,c.default.Red),(0,u.rect)(t,this.lightx,this.lighty,2),(0,u.fill)(t,c.default.White));var i=e.scene.renderables().filter((0,u.IsInstanceOf)(y.RoadLine)).toArray(),n=e.scene.renderables().filter((0,u.IsInstanceOf)(w.default)).toArray(),r=i.map((function(e){return new o.Line(e.getStart(),e.getEnd())})),s=n.map((function(e){return new b.default(e.getCenter(),e.getRadius(),e.getStartAngle(),e.getEndAngle())})),a=new o.Line(this.getStart(),this.getEnd()),l=0;this.roadIndex=-1;for(var d="line",h=0,p=r;h<p.length;h++){if(null!=(C=p[h].intersect(a))){var x=C;this.roadIntersection=x,this.roadIndex=l,d="line"}l++}for(var _=0,k=s;_<k.length;_++){var C;null!=(C=k[_].intersect(a))&&(x=C[0],this.roadIntersection=x,this.roadIndex=l,d="arc"),l++}if(this.roadIndex<0)this.destroy();else{var T,S=(T="line"===d?new f.Vector(r[this.roadIndex].start,r[this.roadIndex].end).normalized().orthogonal():new f.Vector(s[this.roadIndex-r.length].center,this.roadIntersection).normalized()).negate().orthogonal();e.status===g.default.Screen&&(t.lineWidth=.5,(0,u.arc)(t,this.roadIntersection.x,this.roadIntersection.y,v.default.TLView,S.argument()-Math.acos(v.default.TLCosDir),S.argument()+Math.acos(v.default.TLCosDir),!0),(0,u.stroke)(t,c.default.Black)),e.isPointInPath(this.lightx.get(),this.lighty.get())||(this.lightx.set(this.roadIntersection.x+14*S.x+8*T.x),this.lighty.set(this.roadIntersection.y+14*S.y+8*T.y))}},t.from=function(e){return new t(e)},t.prototype.serialize=function(){return{type:"Stop",line:new o.Line(this.getStart(),this.getEnd()).serialize(),color:this.color.serialize(),width:this.width,lightPos:new a.default(this.lightx.get(),this.lighty.get()).serialize(),delayR:this.lightdelayR.get(),delayA:this.lightdelayA.get(),delayG:this.lightdelayG.get(),phase:this.lightphase.get()}},t.GenID=new l.default,t.deserializer=function(e){if("Stop"!==e.type)throw new Error("bad type");var i=t.from(o.Line.deserializer(e.line));return i.setColor(c.default.deserializer(e.color)),i.setWidth(e.width),i.setLightPosition(a.default.deserializer(e.lightPos)),i.setLightDelayR(e.delayR),i.setLightDelayA(e.delayA),i.setLightDelayG(e.delayG),i.setLightPhase(e.phase),i},t}(d.Item);t.Stop=x,t.default=x},9785:function(e,t,i){"use strict";var n=i(9755),r=this&&this.__assign||function(){return r=Object.assign||function(e){for(var t,i=1,n=arguments.length;i<n;i++)for(var r in t=arguments[i])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e},r.apply(this,arguments)},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.Form=void 0;var o=s(i(4558)),a=function(){function e(t){this.root=n(document.createElement("div")),this.form=this.root.w2form(r(r({},t),{name:"form-".concat(e.genId.get()),box:this.root})),this.record=t.record}return e.prototype.refresh=function(){this.form.refresh()},e.prototype.get=function(e){return this.form.getValue(e)},e.prototype.set=function(e,t){this.form.setValue(e,t)},e.prototype.clear=function(){this.form.clear()},e.prototype.reset=function(){this.record?this.form.record=this.record:this.clear()},e.prototype.element=function(){return this.root},e.genId=new o.default,e}();t.Form=a,t.default=a},831:function(e,t,i){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.Layout=void 0;var r=n(i(9755)),s=i(1281),o=function(){function e(t){this.root=t,this.mainlayout=t.w2layout({box:this.root[0],name:"layout_".concat(e.id),padding:0,panels:[]}),e.id++}return e.prototype.state=function(){return this.mainlayout},e.prototype.element=function(){return this.root},e.prototype.getMain=function(){return(0,r.default)(this.mainlayout.el("main"))},e.prototype.getTop=function(){return(0,r.default)(this.mainlayout.el("top"))},e.prototype.getLeft=function(){return(0,r.default)(this.mainlayout.el("left"))},e.prototype.getRight=function(){return(0,r.default)(this.mainlayout.el("right"))},e.prototype.getBottom=function(){return(0,r.default)(this.mainlayout.el("bottom"))},e.prototype.getPreview=function(){return(0,r.default)(this.mainlayout.el("preview"))},e.prototype.render=function(){this.mainlayout.render()},e.prototype.assignTabs=function(e){this.mainlayout.assignTabs("main",new s.W2Tabs(e))},e.prototype.setMain=function(e){e.type="main",this.mainlayout.set(e.type,e),this.mainlayout.show(e.type,!0)},e.prototype.setTop=function(e){e.type="top",this.mainlayout.set(e.type,e),this.mainlayout.show(e.type,!0)},e.prototype.setLeft=function(e){e.type="left",this.mainlayout.set(e.type,e),this.mainlayout.show(e.type,!0)},e.prototype.setRight=function(e){e.type="right",this.mainlayout.set(e.type,e),this.mainlayout.show(e.type,!0)},e.prototype.setBottom=function(e){e.type="bottom",this.mainlayout.set(e.type,e),this.mainlayout.show(e.type,!0)},e.prototype.setPreview=function(e){e.type="preview",this.mainlayout.set(e.type,e),this.mainlayout.show(e.type,!0)},e.Style="padding: 5px;",e.id=0,e}();t.Layout=o,t.default=o},4530:function(e,t,i){"use strict";var n,r=this&&this.__extends||(n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])},n(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function i(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.Menu=void 0;var o=s(i(9755)),a=i(8533),l=i(8283),u=function(e,t){this.options=e,this.data=t,this.data.push(e)},c=function(e){function t(t,i){var n=e.call(this)||this;n.options=t;var r=t;return r.handler=n.handlertrigger(n),i.push(r),n}return r(t,e),t.prototype.handlertrigger=function(e){var t=this;return function(){e.emit("trigger",t)}},t.prototype.add=function(e){if(void 0===this.data){var t=this.options;t.subMenuItems=[],this.data=t.subMenuItems}return d.from(e,this.data)},t}(a.StrictEventEmitter),d=function(){function e(){}return e.from=function(e,t){return"separator"in e?new u(e,t):new c(e,t)},e}(),h=function(){function e(){this.root=(0,o.default)(document.createElement("div")),this.data=[],this.internal=new l.MenuBar(this.root[0],this.data)}return e.prototype.add=function(e){return d.from(e,this.data)},e.prototype.build=function(){var e;null===(e=this.internal)||void 0===e||e.update()},e.prototype.element=function(){return this.root},e}();t.Menu=h,t.default=h},1694:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Popup=void 0;var n=i(1281),r=function(){function e(){}return e.open=function(e){if("opening"===n.W2Popup.status||"open"===n.W2Popup.status)throw new Error("a popup is already opened");n.W2Popup.open(e)},e.close=function(){if("closing"===n.W2Popup.status||"closed"===n.W2Popup.status)throw new Error("no popup to close");n.W2Popup.close()},e}();t.Popup=r,t.default=r},1187:function(e,t,i){"use strict";var n,r=this&&this.__extends||(n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])},n(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function i(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.Tool=void 0;var o=s(i(9755)),a=function(e){function t(t){var i=e.call(this)||this;return i.selected=!1,i.icon=t.icon,i.root=(0,o.default)(document.createElement("div")),i.root.html('<div class="tool-icon"><i class="'.concat(i.icon,'"></i></div>')),i.root.addClass("tool"),i.root.on("click",(function(){i.select()})),i}return r(t,e),t.prototype.element=function(){return this.root},t.prototype.select=function(){this.isSelected()||(this.selected=!0,this.root.addClass("active"),this.emit("select",this))},t.prototype.unselect=function(){this.isSelected()&&(this.selected=!1,this.root.removeClass("active"),this.emit("unselect",this))},t.prototype.isSelected=function(){return this.selected},t}(i(8533).StrictEventEmitter);t.Tool=a,t.default=a},8428:function(e,t,i){"use strict";var n,r=this&&this.__extends||(n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])},n(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function i(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.Toolbar=void 0;var o=s(i(9755)),a=function(e){function t(){var t=e.call(this)||this;return t.internal=[],t._selected=null,t.root=(0,o.default)(document.createElement("div")),t.root.addClass("toolbar"),t.toolonselect=t.toolonselecttrigger(t),t.toolonunselect=t.toolonunselecttrigger(t),t}return r(t,e),t.prototype.toolonselecttrigger=function(e){var t=this;return function(i){e._selected=i;for(var n=0,r=t.internal;n<r.length;n++){var s=r[n];s.isSelected()&&i===s||(s.off("select",e.toolonselect),s.off("unselect",e.toolonunselect),i!==s||s.isSelected()?s.isSelected()&&s.unselect():s.select(),s.on("select",e.toolonselect),s.on("unselect",e.toolonunselect))}}},t.prototype.toolonunselecttrigger=function(e){var t=this;return function(){e._selected=null;for(var i=0,n=t.internal;i<n.length;i++){var r=n[i];r.isSelected()&&(r.off("select",e.toolonselect),r.off("unselect",e.toolonunselect),r.unselect(),r.on("select",e.toolonselect),r.on("unselect",e.toolonunselect))}}},t.prototype.element=function(){return this.root},t.prototype.register=function(e){return this.internal.push(e),this.root.append(e.element()),e.on("select",this.toolonselect),e.on("unselect",this.toolonunselect),this},t.prototype.unregister=function(e){var t=this.internal.indexOf(e);return t>=0&&this.internal.splice(t,1),this.root.find(e.element()).remove(),e.off("select",this.toolonselect),e.off("unselect",this.toolonunselect),this},t.prototype.selected=function(){return this._selected},t}(i(8533).StrictEventEmitter);t.Toolbar=a,t.default=a},4457:function(e,t,i){"use strict";var n,r=i(9755),s=this&&this.__extends||(n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])},n(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function i(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)});Object.defineProperty(t,"__esModule",{value:!0}),t.ViewItem=void 0;var o=function(e){function t(t,i){var n=e.call(this)||this;return n._isselected=!1,n.index=0,n.ondelete=n.deletetrigger(n),n.onclick=n.clicktrigger(n),n.ondestroy=n.destroytrigger(n),n.onselect=n.selecttrigger(n),n.onunselect=n.unselecttrigger(n),n.name=t,n.item=i,n.container=document.createElement("div"),n.container.classList.add("view-item"),n.container.addEventListener("click",n.onclick,!1),n.indexElement=document.createElement("span"),n.indexElement.classList.add("view-item-index"),n.nameElement=document.createElement("span"),n.nameElement.classList.add("view-item-name"),n.deleteElement=document.createElement("span"),n.deleteElement.classList.add("view-item-delete"),n.deleteElement.innerHTML="🗑️",n.deleteElement.addEventListener("click",n.ondelete,!1),n.setIndex(n.index),n.setName(n.name),n.container.appendChild(n.indexElement),n.container.appendChild(n.nameElement),n.container.appendChild(n.deleteElement),n.item.on("destroy",n.ondestroy),n.item.on("select",n.onselect),n.item.on("unselect",n.onunselect),n}return s(t,e),t.prototype.selecttrigger=function(e){return function(){e.emit("select")}},t.prototype.unselecttrigger=function(e){return function(){e.emit("unselect")}},t.prototype.destroytrigger=function(e){return function(){e.item.off("destroy",e.ondestroy),e.item.off("select",e.onselect),e.item.off("unselect",e.onunselect),e.emit("delete")}},t.prototype.select=function(){this._isselected=!0,this.container.classList.add("selected"),this.item.off("select",this.onselect),this.item.select(),this.item.on("select",this.onselect)},t.prototype.unselect=function(){this._isselected=!1,this.container.classList.remove("selected"),this.item.off("unselect",this.onunselect),this.item.unselect(),this.item.on("unselect",this.onunselect)},t.prototype.isSelected=function(){return this._isselected},t.prototype.clicktrigger=function(e){return function(t){t.stopPropagation(),e.emit("click")}},t.prototype.deletetrigger=function(e){var t=this;return function(i){i.stopPropagation(),t.item.off("destroy",t.ondestroy),e.item.destroy(),e.emit("delete")}},t.prototype.element=function(){return r(this.container)},t.prototype.setIndex=function(e){this.index=e,this.indexElement.innerHTML="#".concat(this.index)},t.prototype.setName=function(e){this.name=e,this.nameElement.innerHTML=e},t.prototype.getName=function(){return this.name},t.prototype.getProperties=function(){return this.item.getProperties()},t.prototype.getItem=function(){return this.item},t}(i(8533).StrictEventEmitter);t.ViewItem=o,t.default=o},7281:function(e,t,i){"use strict";var n,r=this&&this.__extends||(n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])},n(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function i(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.View=void 0;var o=s(i(9755)),a=i(831),l=function(e){function t(){var t=e.call(this)||this;return t.selected=null,t.onclick=t.clicktrigger(t),t.root=document.createElement("div"),t.container=document.createElement("div"),t.properties=document.createElement("div"),t.items=[],t._layout=new a.Layout((0,o.default)(t.root)),t._layout.setTop({size:200,resizable:!0,style:a.Layout.Style,title:"Items",content:t.container}),t._layout.setMain({size:200,resizable:!0,style:a.Layout.Style,title:"Properties",content:t.properties}),t}return r(t,e),t.prototype.clicktrigger=function(e){return function(t){if(t.stopPropagation(),null!=e.selected){var i=e.getIndex(e.selected);e.selected.unselect(),e.selected=null,e.emit("unselect",i)}}},t.prototype.onpropertiesupdatetrigger=function(e){var t=this;return function(){t.setProperties(e)}},t.prototype.getIndex=function(e){var t=this.items.indexOf(e);if(t<0)throw new Error("item not found");return t},t.prototype.element=function(){return(0,o.default)(this.container)},t.prototype.layout=function(){return this._layout.state()},t.prototype.add=function(e){this.items.push(e),e.setIndex(this.items.length),this.container.appendChild(e.element()[0]);var t=this;e.on("delete",(function(){t.remove(e)})),e.on("click",(function(){t.toggleSelect(e)})),e.on("select",(function(){t.select(e)})),e.on("unselect",(function(){t.unselect(e)}))},t.prototype.listenInput=function(e,t){return function(){t.setValue(e.value)}},t.prototype.toggleSelectByIndex=function(e){if(e<0||e>this.items.length-1)throw new Error("index out of bounds");for(var t=this.items[e],i=0;i<this.items.length;i++)t!==this.items[i]&&this.items[i].unselect();if(t.isSelected())return t.unselect(),this.selected=null,this.emit("unselect",e),void(0,o.default)(this.properties).empty();t.select(),this.selected=t,this.emit("select",e),this.setProperties(t)},t.prototype.toggleSelect=function(e){var t=this.items.indexOf(e);if(t<0)throw new Error("item not found");this.toggleSelectByIndex(t)},t.prototype.selectByIndex=function(e){if(e<0||e>this.items.length-1)throw new Error("index out of bounds");for(var t=this.items[e],i=0;i<this.items.length;i++)t!==this.items[i]&&this.items[i].unselect();t.isSelected()||(t.select(),this.selected=t,this.emit("select",e),this.setProperties(t))},t.prototype.select=function(e){var t=this.items.indexOf(e);if(t<0)throw new Error("item not found");this.selectByIndex(t)},t.prototype.unselectByIndex=function(e){if(e<0||e>this.items.length-1)throw new Error("index out of bounds");for(var t=this.items[e],i=0;i<this.items.length;i++)t!==this.items[i]&&this.items[i].unselect();t.isSelected()&&(t.unselect(),this.selected=null,this.emit("unselect",e),(0,o.default)(this.properties).empty())},t.prototype.unselect=function(e){var t=this.items.indexOf(e);if(t<0)throw new Error("item not found");this.unselectByIndex(t)},t.prototype.getSelectedItem=function(){return this.selected},t.prototype.getSelectedIndex=function(){return null==this.selected?null:this.getIndex(this.selected)},t.prototype.removeByIndex=function(e){if(e<0||e>this.items.length-1)throw new Error("index out of bounds");return this.container.removeChild(this.items[e].element()[0]),this.selected===this.items[e]&&(this.selected.unselect(),this.selected=null,(0,o.default)(this.properties).empty(),this.emit("unselect",e)),this.items.splice(e,1),this.reorder(),this.emit("delete",e),e},t.prototype.remove=function(e){var t=this.items.indexOf(e);if(t<0)throw new Error("item not found");return this.removeByIndex(t)},t.prototype.reset=function(){this.items=[],this.selected=null,(0,o.default)(this.properties).empty(),(0,o.default)(this.container).empty()},t.prototype.reorder=function(){for(var e=0;e<this.items.length;e++)this.items[e].setIndex(e+1)},t.prototype.setProperties=function(e){var t=document.createElement("div");t.innerHTML="Properties of <strong>".concat(e.getName(),"</strong>"),(0,o.default)(this.properties).empty(),this.properties.appendChild(t);var i=e.getProperties(),n=(0,o.default)(document.createElement("table"));n.addClass("properties-table");var r=(0,o.default)(document.createElement("tbody"));for(var s in e.getItem().removeAllListeners("propertiesUpdate").on("propertiesUpdate",this.onpropertiesupdatetrigger(e)),i){var a=i[s].getForm();r.append(a)}n.append(r),(0,o.default)(this.properties).append(n)},t}(i(8533).StrictEventEmitter);t.View=l,t.default=l},5966:function(e,t,i){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.isImageLoaded=t.connectarc=t.connectline=t.insert=t.Comparators=t.MouseButton=t.clearCanvas=t.unclip=t.clip=t.isContextTracked=t.create2DCanvasContextTracked=t.resize2DCanvasContext=t.getMousePos=t.trackTransforms=t.ResetTransformation=t.equals0=t.IsInstanceOf=t.notEmpty=t.getOrDefaultValue=t.stroke=t.fill=t.arc=t.line=t.rect=t.RadToDeg=t.DegToRad=t.TAU=t.EPSILON=void 0;var r,s=n(i(5954)),o=i(2854),a=n(i(3812)),l=n(i(4457)),u=n(i(252)),c=i(1301),d=n(i(9918)),h=n(i(9388));function p(){var e=document.createElementNS("http://www.w3.org/2000/svg","svg").createSVGMatrix();return e.a=1,e.b=0,e.c=0,e.d=1,e.e=0,e.f=0,e}function f(e){var t=document.createElementNS("http://www.w3.org/2000/svg","svg"),i=t.createSVGMatrix();e.getTransform=function(){return i};var n=[],r=e.save;e.save=function(){return n.push(i.translate(0,0)),r.call(e)};var o=e.restore;e.restore=function(){var t=n.pop();if(void 0===t)throw new Error("Too much ctx.restore().");return i=t,o.call(e)};var a=e.scale;e.scale=function(t,n){return i=i.scaleNonUniform(t,n),a.call(e,t,n)};var l=e.rotate;e.rotate=function(t){return i=i.rotate(180*t/Math.PI),l.call(e,t)};var u=e.translate;e.translate=function(t,n){return i=i.translate(t,n),u.call(e,t,n)};var c=e.transform;e.transform=function(n,r,s,o,a,l){var u=t.createSVGMatrix();return u.a=n,u.b=r,u.c=s,u.d=o,u.e=a,u.f=l,i=i.multiply(u),c.call(e,n,r,s,o,a,l)};var d=e.setTransform;e.setTransform=function(t,n,r,s,o,a){return void 0===t?d.call(e,t):"number"==typeof t?(i.a=t,i.b="number"==typeof n?n:0,i.c="number"==typeof r?r:0,i.d="number"==typeof s?s:0,i.e="number"==typeof o?o:0,i.f="number"==typeof a?a:0,d.call(e,i)):(i.a="number"==typeof t.a?t.a:0,i.b="number"==typeof t.b?t.b:0,i.c="number"==typeof t.c?t.c:0,i.d="number"==typeof t.d?t.d:0,i.e="number"==typeof t.e?t.e:0,i.f="number"==typeof t.f?t.f:0,d.call(e,i))};var h=t.createSVGPoint();return e.screenToWorld=function(e,t){e instanceof s.default?(h.x=e.x,h.y=e.y):(h.x="number"==typeof e?e:0,h.y="number"==typeof t?t:0);var n=h.matrixTransform(i.inverse());return new s.default(n.x,n.y)},e.worldToScreen=function(e,t){e instanceof s.default?(h.x=e.x,h.y=e.y):(h.x="number"==typeof e?e:0,h.y="number"==typeof t?t:0);var n=h.matrixTransform(i);return new s.default(n.x,n.y)},e.duplicateTransform=function(){var t=document.createElementNS("http://www.w3.org/2000/svg","svg").createSVGMatrix(),i=e.getTransform();return t.a=i.a,t.b=i.b,t.c=i.c,t.d=i.d,t.e=i.e,t.f=i.f,t},e}function g(e,t,i){var n=e instanceof CanvasRenderingContext2D?e.canvas:e,r=e instanceof CanvasRenderingContext2D?e:e.getContext("2d");if(null==r)throw new Error("unable to get 2d context");return n.width=t,n.height=i,r}t.EPSILON=void 0===Number.EPSILON?2220446049250313e-31:Number.EPSILON,t.TAU=2*Math.PI,t.DegToRad=function(e){return e*Math.PI/180},t.RadToDeg=function(e){return 180*e/Math.PI},t.rect=function(e,t,i,n,r){e.beginPath(),t instanceof u.default?e.rect(t.origin.x-t.size.x/2,t.origin.y-t.size.y/2,t.size.x,t.size.y):t instanceof s.default&&"number"==typeof i?e.rect(t.x-i/2,t.y-i/2,i,i):t instanceof s.default&&i instanceof s.default?e.rect(t.x-i.x/2,t.y-i.y/2,i.x,i.y):t instanceof s.default&&"number"==typeof i&&"number"==typeof n?e.rect(t.x-i/2,t.y-n/2,i,n):"number"==typeof t&&"number"==typeof i&&"number"==typeof n&&"number"==typeof r?e.rect(t-n/2,i-r/2,n,r):"number"==typeof t&&"number"==typeof i&&"number"==typeof n&&void 0===r?e.rect(t-n/2,i-n/2,n,n):"number"==typeof t&&"number"==typeof i&&n instanceof s.default&&void 0===r?e.rect(t-n.x/2,i-n.y/2,n.x,n.y):t instanceof c.Pointer&&i instanceof c.Pointer&&"number"==typeof n&&"number"==typeof r?e.rect(t.get()-n/2,i.get()-r/2,n,r):t instanceof c.Pointer&&i instanceof c.Pointer&&"number"==typeof n&&void 0===r?e.rect(t.get()-n/2,i.get()-n/2,n,n):t instanceof c.Pointer&&i instanceof c.Pointer&&n instanceof s.default&&void 0===r&&e.rect(t.get()-n.x/2,i.get()-n.y/2,n.x,n.y)},t.line=function(e,t,i,n,r){e.beginPath(),"number"==typeof t&&"number"==typeof i&&"number"==typeof n&&"number"==typeof r?(e.moveTo(t,i),e.lineTo(n,r)):t instanceof c.Pointer&&i instanceof c.Pointer&&n instanceof c.Pointer&&r instanceof c.Pointer?(e.moveTo(t.get(),i.get()),e.lineTo(n.get(),r.get())):t instanceof o.Line?(e.moveTo(t.start.x,t.start.y),e.lineTo(t.start.x,t.start.y)):t instanceof s.default&&i instanceof s.default?(e.moveTo(t.x,t.y),e.lineTo(i.x,i.y)):"number"==typeof t&&"number"==typeof i&&n instanceof s.default?(e.moveTo(t,i),e.lineTo(n.x,n.y)):t instanceof s.default&&"number"==typeof i&&"number"==typeof n?(e.moveTo(t.x,t.y),e.lineTo(i,n)):t instanceof c.Pointer&&i instanceof c.Pointer&&n instanceof s.default?(e.moveTo(t.get(),i.get()),e.lineTo(n.x,n.y)):t instanceof s.default&&i instanceof c.Pointer&&n instanceof c.Pointer&&(e.moveTo(t.x,t.y),e.lineTo(i.get(),n.get()))},t.arc=function(e,t,i,n,r,s,o){e.beginPath(),o&&e.moveTo(t,i),e.arc(t,i,n,r,s,!1),o&&e.closePath()},t.fill=function(e,t){e.fillStyle=t.toString(),e.fill()},t.stroke=function(e,t){e.strokeStyle=t.toString(),e.stroke()},t.getOrDefaultValue=function(e,t){return void 0===e?t:e},t.notEmpty=function(e){return null!=e},t.IsInstanceOf=function(e){return function(t){return function(e,t){return"string"==typeof t?typeof e===t:e instanceof t}(t,e)}},t.equals0=function(e){return Math.abs(e)<t.EPSILON},t.ResetTransformation=p,t.trackTransforms=f,t.getMousePos=function(e,t){var i=e.getBoundingClientRect(),n=e.width/i.width,r=e.height/i.height;return new s.default((t.clientX-i.left)*n,(t.clientY-i.top)*r)},t.resize2DCanvasContext=g,t.create2DCanvasContextTracked=function(e,t){var i=document.createElement("canvas").getContext("2d");if(null==i)throw new Error("unable to get 2d context");return i.imageSmoothingEnabled=!1,f("number"==typeof e&&"number"==typeof t?g(i,e,t):i)},t.isContextTracked=function(e){return e instanceof CanvasRenderingContext2D&&"duplicateTransform"in e&&"transformedPoint"in e},t.clip=function(e,t,i){e.save(),e.setTransform(t),e.beginPath(),e.rect(i.origin.x,i.origin.y,i.size.x,i.size.y),e.clip(),e.setTransform(p())},t.unclip=function(e){e.restore()},t.clearCanvas=function(e,t){var i=e.canvas;e.save(),e.setTransform(1,0,0,1,0,0),void 0===t?e.clearRect(0,0,i.width,i.height):(e.beginPath(),e.rect(0,0,i.width,i.height),e.fillStyle=t,e.fill()),e.restore()},(r=t.MouseButton||(t.MouseButton={}))[r.Left=0]="Left",r[r.Middle=1]="Middle",r[r.Right=2]="Right",t.Comparators={number:function(e,t){return e-t}},t.insert=function(e,t,i){void 0===i&&(i=function(e,t){return"string"!=typeof e&&(e=String(e)),"string"!=typeof t&&(t=String(t)),e>t?1:e<t?-1:0});for(var n=0,r=e.length;n<r;){var s=n+r>>1;i(e[s],t)>0?r=s:n=s+1}e.splice(n,0,t)},t.connectline=function(e,t,i,n,r){return function(t){var s=d.default.from(t);s.setColor(a.default.Red),e.add(s),s.on("select",(function(){s.setColor(a.default.Green),s.enableGrab(n),r.select()})),s.on("unselect",(function(){s.setColor(a.default.Red),s.disableGrab(n)})),i.add(new l.default("line n°".concat(s.getID()),s))}},t.connectarc=function(e,t,i,n,r){return function(t){var s=h.default.from(t);s.setColor(a.default.Red),e.add(s),s.on("select",(function(){s.setColor(a.default.Green),s.enableGrab(n),r.select()})),s.on("unselect",(function(){s.setColor(a.default.Red),s.disableGrab(n)})),i.add(new l.default("line n°".concat(s.getID()),s))}},t.isImageLoaded=function(e){return e.complete&&0!==e.naturalHeight}},2370:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Icons=void 0,i(9693);var n="custom-icons icons-";t.Icons={CarSide:n+"car-side",Flag:n+"flag",Hand:n+"hand",Kamek:n+"kamek",RoadLine:n+"road-line",RoadArc:n+"road-arc",TrafficLight:n+"traffic-light",UpDownLeftRight:n+"up-down-left-right"}},5765:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Base=void 0;var i=function(){};t.Base=i,t.default=i},593:function(e,t,i){"use strict";var n,r=this&&this.__extends||(n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])},n(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function i(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.Init=void 0;var o=s(i(5954)),a=function(e){function t(t,i){var n=e.call(this)||this;return n.position=o.default.duplicate(t),n.angle=i,n}return r(t,e),Object.defineProperty(t,"Zero",{get:function(){return new t(o.default.Zero,0)},enumerable:!1,configurable:!0}),t.prototype.toString=function(){return"init ".concat(this.position.x," ").concat(this.position.y," ").concat(this.angle,"\n")},t}(s(i(5765)).default);t.Init=a,t.default=a},101:function(e,t,i){"use strict";var n,r=this&&this.__extends||(n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])},n(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function i(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.Itinerary=void 0;var o=s(i(5765)),a=function(e){function t(t){var i=e.call(this)||this;return i.speed=t,i}return r(t,e),t.prototype.toString=function(){return"go ".concat(this.speed,"\n")},t.prototype.getValue=function(){return this.speed},t.from=function(e){return new t(e)},t}(o.default),l=function(e){function t(t){var i=e.call(this)||this;return i.angle=t,i}return r(t,e),t.prototype.toString=function(){return"turn ".concat(this.angle,"\n")},t.prototype.getValue=function(){return this.angle},t.from=function(e){return new t(e)},t}(o.default),u=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.toString=function(){return"stop 0.\n"},t.prototype.getValue=function(){return 0},t.from=function(){return new t},t}(o.default),c=function(e){function t(t){var i=e.call(this)||this;return i.actions=t,i}return r(t,e),Object.defineProperty(t,"Default",{get:function(){return new t([a.from(20),u.from()])},enumerable:!1,configurable:!0}),t.prototype.size=function(){return this.actions.length},t.prototype.toString=function(){for(var e="",t=0,i=this.actions;t<i.length;t++)e+=i[t].toString();return e},t.Go=a,t.Turn=l,t.Stop=u,t}(o.default);t.Itinerary=c,t.default=c},2850:function(e,t,i){"use strict";var n,r=this&&this.__extends||(n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])},n(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function i(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.Obstacle=void 0;var o=s(i(5954)),a=function(e){function t(t,i,n){var r=e.call(this)||this;return r.position=o.default.duplicate(t),r.timeStart=i,r.timeEnd=n,r}return r(t,e),Object.defineProperty(t,"Zero",{get:function(){return new t(o.default.Zero,0,0)},enumerable:!1,configurable:!0}),t.prototype.toString=function(){return"".concat(this.position.x," ").concat(this.position.y," ").concat(this.timeStart," ").concat(this.timeEnd,"\n")},t}(s(i(5765)).default);t.Obstacle=a,t.default=a},1271:function(e,t,i){"use strict";var n,r=this&&this.__extends||(n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])},n(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function i(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.RoadArc=void 0;var o=s(i(5954)),a=function(e){function t(t,i,n,r,s,a){var l=e.call(this,t,i)||this;return l.center=o.default.duplicate(n),l.radius=r,l.startAngle=s,l.endAngle=a,l}return r(t,e),t.prototype.toString=function(){return"arc ".concat(this.direction," ").concat(this.speed," ").concat(Number(this.center.x).toFixed(2)," ").concat(Number(this.center.y).toFixed(2)," ").concat(Number(this.radius).toFixed(2)," ").concat(Number(this.startAngle).toFixed(2)," ").concat(Number(this.endAngle).toFixed(2),"\n")},t}(s(i(4456)).default);t.RoadArc=a,t.default=a},1522:function(e,t,i){"use strict";var n,r=this&&this.__extends||(n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])},n(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function i(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.RoadLine=void 0;var o=s(i(5954)),a=function(e){function t(t,i,n,r){var s=e.call(this,t,i)||this;return s.start=o.default.duplicate(n),s.end=o.default.duplicate(r),s}return r(t,e),t.prototype.toString=function(){return"line ".concat(this.direction," ").concat(this.speed," ").concat(Number(this.start.x).toFixed(2)," ").concat(Number(this.start.y).toFixed(2)," ").concat(Number(this.end.x).toFixed(2)," ").concat(Number(this.end.y).toFixed(2),"\n")},t}(s(i(4456)).default);t.RoadLine=a,t.default=a},4456:function(e,t,i){"use strict";var n,r=this&&this.__extends||(n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])},n(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function i(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.Road=void 0;var o=function(e){function t(t,i){var n=e.call(this)||this;return n.direction=t,n.speed=i,n}return r(t,e),t}(s(i(5765)).default);t.Road=o,t.default=o},3618:function(e,t,i){"use strict";var n,r=this&&this.__extends||(n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])},n(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function i(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.Stop=void 0;var o=s(i(5954)),a=function(e){function t(t,i,n){var r=e.call(this)||this;return r.position=o.default.duplicate(t),r.roadIndex=i,r.trafficLightIndex=n,r}return r(t,e),Object.defineProperty(t,"Zero",{get:function(){return new t(o.default.Zero,0,0)},enumerable:!1,configurable:!0}),t.prototype.toString=function(){return"".concat(this.roadIndex," ").concat(this.trafficLightIndex," ").concat(this.position.x," ").concat(this.position.y,"\n")},t}(s(i(5765)).default);t.Stop=a,t.default=a},8964:function(e,t,i){"use strict";var n,r=this&&this.__extends||(n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])},n(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function i(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.TrafficLight=void 0;var o=s(i(5954)),a=function(e){function t(t,i,n,r,s,a){var l=e.call(this)||this;return l.position=o.default.duplicate(t),l.roadIndex=i,l.delayR=n,l.delayA=r,l.delayG=s,l.dephase=a,l}return r(t,e),Object.defineProperty(t,"Zero",{get:function(){return new t(o.default.Zero,0,0,0,0,0)},enumerable:!1,configurable:!0}),t.prototype.toString=function(){return"".concat(this.roadIndex," ").concat(this.position.x," ").concat(this.position.y," ").concat(this.delayR," ").concat(this.delayA," ").concat(this.delayG," ").concat(this.dephase,"\n")},t}(s(i(5765)).default);t.TrafficLight=a,t.default=a},8836:function(e,t,i){"use strict";var n,r=this&&this.__extends||(n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])},n(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function i(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.WayPoint=void 0;var o=s(i(5954)),a=function(e){function t(t,i){var n=e.call(this)||this;return n.position=o.default.duplicate(t),n.roadIndex=i,n}return r(t,e),Object.defineProperty(t,"Zero",{get:function(){return new t(o.default.Zero,0)},enumerable:!1,configurable:!0}),t.prototype.toString=function(){return"".concat(this.roadIndex," ").concat(this.position.x," ").concat(this.position.y,"\n")},t}(s(i(5765)).default);t.WayPoint=a,t.default=a},6534:function(e,t,i){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.deserializers=void 0;var r=n(i(1401)),s=n(i(7874)),o=n(i(2736)),a=n(i(8087)),l=n(i(7953)),u=n(i(5990)),c=n(i(9669)),d=n(i(9064)),h=n(i(9918)),p=n(i(9388)),f=n(i(2854)),g=n(i(5954)),m=n(i(8551));t.deserializers={Line:f.default.deserializer,Point:g.default.deserializer,Arc:m.default.deserializer,Scene:s.default.deserializer,Layer:r.default.deserializer,RoadLine:h.default.deserializer,RoadArc:p.default.deserializer,Sprite:o.default.deserializer,StartingPoint:u.default.deserializer,Obstacle:a.default.deserializer,Step:c.default.deserializer,Stop:d.default.deserializer,RoadFilter:l.default.deserializer},t.default=t.deserializers},9500:function(e,t,i){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.Editor=void 0;var r=n(i(9755)),s=n(i(5733)),o=i(3162),a=n(i(4171));i(765),i(5549),i(433);var l=n(i(5954)),u=n(i(252)),c=n(i(8644)),d=i(738),h=n(i(9708)),p=n(i(2736)),f=n(i(3812)),g=n(i(1401)),m=n(i(7874)),v=n(i(8107)),y=n(i(8087)),w=n(i(7953)),b=n(i(5990)),x=n(i(9669)),_=n(i(9064)),k=n(i(7630)),C=n(i(9785)),T=n(i(831)),S=n(i(4530)),O=n(i(1694)),E=n(i(1187)),I=n(i(8428)),D=n(i(7281)),z=n(i(4457)),A=i(5966),P=n(i(6534)),R=i(2370),j=i(2834),$=n(i(9076)),M=n(i(9918)),L=n(i(9388)),F=function(){function e(e){this.menu=new S.default,this.toolbar=new I.default,this.canvas=new h.default,this.view=new D.default,this.logicalLines=new v.default(A.MouseButton.Left),this.roadsCollection=new c.default,this.stepsCollection=new c.default,this.stopsCollection=new c.default,this.roadFilter=new w.default,this.scene=new m.default(u.default.from(-300,-150,600,300)),this.tools={roadline:new E.default({icon:R.Icons.RoadLine}),roadarc:new E.default({icon:R.Icons.RoadArc}),step:new E.default({icon:R.Icons.Flag}),pan:new E.default({icon:R.Icons.UpDownLeftRight}),grab:new E.default({icon:R.Icons.Hand}),starting:new E.default({icon:R.Icons.CarSide}),obstacle:new E.default({icon:R.Icons.Kamek}),stop:new E.default({icon:R.Icons.TrafficLight})},this.layers={lines:new g.default({name:"line",zIndex:3}),steps:new g.default({name:"step",zIndex:4}),stops:new g.default({name:"stop",zIndex:5}),images:new g.default({name:"image",zIndex:2}),board:new g.default({name:"board",zIndex:1,background:"#ffffff"}),starting:new g.default({name:"starting",zIndex:7,type:j.RenderableType.Draft}),obstacles:new g.default({name:"obstacle",zIndex:6,type:j.RenderableType.Draft})},this.c=function(){},this.h=function(){},this.carc=function(){},this.harc=function(){},this.cstep=function(){},this.hstep=function(){},this.ctrafficlight=function(){},this.htrafficlight=function(){},this.toolroadlineselect=function(){},this.toolroadlineunselect=function(){},this.toolroadarcselect=function(){},this.toolroadarcunselect=function(){},this.toolstepselect=function(){},this.toolstepunselect=function(){},this.toolgrabselect=function(){},this.toolgrabunselect=function(){},this.monster=y.default.from(l.default.Zero),this.cc6=function(){},this.ccc6=function(){},this.startingPoint=b.default.from(l.default.Zero),this.cc=function(){},this.ccc=function(){},this.toolstartingselect=function(){},this.toolstartingunselect=function(){},this.toolobstacleselect=function(){},this.toolobstacleunselect=function(){},this.tooltrafficlightselect=function(){},this.tooltrafficlightunselect=function(){},this.container=e,this.layout=new T.default(this.container),this.newform=new C.default({style:"border: 0px; background-color: transparent; color: white;",fields:[{field:"name",type:"text",required:!0,html:{label:"name"}},{field:"width",type:"int",required:!0,html:{label:"width"}},{field:"height",type:"int",required:!0,html:{label:"height"}},{field:"guide",type:"checkbox",required:!0,html:{label:"guide"}}],record:{name:"my dummy map",width:600,height:300,guide:!0}})}return e.prototype.init=function(){this.initLayers(),this.initTools(),this.initListeningTools(),this.initMenu(),this.initLayout(),this.canvas.setScene(this.scene),this.canvas.register(this.logicalLines)},e.prototype.initLayers=function(){this.scene.layers.clear(),this.layers.lines=new g.default({name:"line",zIndex:3}),this.layers.lines.filters.add(this.roadFilter),this.layers.steps=new g.default({name:"step",zIndex:4}),this.layers.images=new g.default({name:"image",zIndex:2}),this.layers.board=new g.default({name:"board",zIndex:1,background:"#ffffff"}),this.layers.starting=new g.default({name:"starting",zIndex:7,type:j.RenderableType.Draft}),this.layers.obstacles=new g.default({name:"obstacle",zIndex:6,type:j.RenderableType.Draft}),this.layers.stops=new g.default({name:"stop",zIndex:5}),this.scene.layers.add(this.layers.lines),this.scene.layers.add(this.layers.steps),this.scene.layers.add(this.layers.images),this.scene.layers.add(this.layers.board),this.scene.layers.add(this.layers.starting),this.scene.layers.add(this.layers.obstacles),this.scene.layers.add(this.layers.stops)},e.prototype.initTools=function(){this.toolbar.register(this.tools.roadline).register(this.tools.roadarc).register(this.tools.step).register(this.tools.grab).register(this.tools.starting).register(this.tools.obstacle).register(this.tools.stop)},e.prototype.setToolListeners=function(){var e=this;this.c=function(t){var i=M.default.from(t);i.setColor(f.default.Red),e.roadsCollection.add(i),i.on("select",(function(){i.setColor($.default.Default),e.tools.grab.select()})),i.on("unselect",(function(){i.setColor(f.default.Red)})),e.layers.lines.addRenderable(i),e.view.add(new z.default("RoadLine n°".concat(i.getID()),i))},this.h=this.logicalLines.renderCurrentLine(f.default.Red),this.carc=function(t){var i=L.default.from(t);i.setColor(f.default.Red),e.roadsCollection.add(i),i.on("select",(function(){i.setColor($.default.Default),e.tools.grab.select()})),i.on("unselect",(function(){i.setColor(f.default.Red)})),e.layers.lines.addRenderable(i),e.view.add(new z.default("RoadLine n°".concat(i.getID()),i))},this.harc=this.logicalLines.renderCurrentArc(f.default.Red),this.cstep=function(t){var i=x.default.from(t).setColor(f.default.Green);e.stepsCollection.add(i),i.on("select",(function(){i.setColor($.default.Default),e.tools.grab.select()})),i.on("unselect",(function(){i.setColor(f.default.Green)})),e.layers.steps.addRenderable(i),e.view.add(new z.default("Step n°".concat(i.getID()),i))},this.hstep=this.logicalLines.renderCurrentLine(f.default.Green),this.ctrafficlight=function(t){var i=_.default.from(t).setColor(f.default.Blue);e.stopsCollection.add(i),i.on("select",(function(){i.setColor($.default.Default),e.tools.grab.select()})),i.on("unselect",(function(){i.setColor(f.default.Blue)})),e.layers.stops.addRenderable(i),e.view.add(new z.default("Traffic Light n°".concat(i.getID()),i))},this.htrafficlight=this.logicalLines.renderCurrentLine(f.default.Blue),this.toolroadlineselect=function(){e.canvas.on("render",e.h),e.logicalLines.on("newline",e.c)},this.toolroadlineunselect=function(){e.canvas.off("render",e.h),e.logicalLines.off("newline",e.c)},this.toolroadarcselect=function(){e.canvas.on("render",e.harc),e.logicalLines.on("newline",e.carc)},this.toolroadarcunselect=function(){e.canvas.off("render",e.harc),e.logicalLines.off("newline",e.carc)},this.toolstepselect=function(){e.canvas.on("render",e.hstep),e.logicalLines.on("newline",e.cstep)},this.toolstepunselect=function(){e.canvas.off("render",e.hstep),e.logicalLines.off("newline",e.cstep)},this.tooltrafficlightselect=function(){e.canvas.on("render",e.htrafficlight),e.logicalLines.on("newline",e.ctrafficlight)},this.tooltrafficlightunselect=function(){e.canvas.off("render",e.htrafficlight),e.logicalLines.off("newline",e.ctrafficlight)},this.toolgrabselect=function(){e.scene.enableGrab()},this.toolgrabunselect=function(){e.scene.disableGrab()},this.monster=y.default.from(l.default.Zero),this.cc6=function(t){e.monster.setPosition(t.screenToWorld(t.mouse)),e.monster.render(t)},this.ccc6=function(t,i){i===A.MouseButton.Left&&(e.canvas.off("render",e.cc6),e.canvas.off("dragstart",e.ccc6),e.tools.pan.select(),e.monster.setPosition(t),e.layers.obstacles.addRenderable(e.monster),e.view.add(new z.default("Obstacle n°".concat(e.monster.getID()),e.monster)))},this.startingPoint=b.default.from(l.default.Zero),this.cc=function(t){e.startingPoint.setPosition(t.screenToWorld(t.mouse)),e.startingPoint.render(t)},this.ccc=function(t,i){i===A.MouseButton.Left&&(e.canvas.off("render",e.cc),e.canvas.off("dragstart",e.ccc),e.tools.pan.select(),e.startingPoint.setPosition(t),e.layers.starting.addRenderable(e.startingPoint),e.view.add(new z.default("Starting Point",e.startingPoint)))},this.toolstartingselect=function(){e.layers.starting.renderables().length>0?O.default.open({title:"Warning",body:"Only one starting point per map. You can delete the previously added starting point or simply move it using the object grabber tool",speed:.1,style:"display:flex;align-items:center;",actions:{Ok:function(){O.default.close()}}}):(e.startingPoint=b.default.from(l.default.Zero),e.canvas.on("render",e.cc),e.canvas.on("dragstart",e.ccc))},this.toolstartingunselect=function(){e.canvas.off("render",e.cc),e.canvas.off("dragstart",e.ccc)},this.toolobstacleselect=function(){e.monster=y.default.from(l.default.Zero),e.canvas.on("render",e.cc6),e.canvas.on("dragstart",e.ccc6)},this.toolobstacleunselect=function(){e.canvas.off("render",e.cc6),e.canvas.off("dragstart",e.ccc6)}},e.prototype.stopListeningTools=function(){this.toolroadlineunselect(),this.toolroadarcunselect(),this.toolstepunselect(),this.toolgrabunselect(),this.toolstartingunselect(),this.toolobstacleunselect(),this.tooltrafficlightunselect(),this.tools.roadline.off("select",this.toolroadlineselect),this.tools.roadline.off("unselect",this.toolroadlineunselect),this.tools.roadarc.off("select",this.toolroadarcselect),this.tools.roadarc.off("unselect",this.toolroadarcunselect),this.tools.step.off("select",this.toolstepselect),this.tools.step.off("unselect",this.toolstepunselect),this.tools.grab.off("select",this.toolgrabselect),this.tools.grab.off("unselect",this.toolgrabunselect),this.tools.starting.off("select",this.toolstartingselect),this.tools.starting.off("unselect",this.toolstartingunselect),this.tools.obstacle.off("select",this.toolobstacleselect),this.tools.obstacle.off("unselect",this.toolobstacleunselect),this.tools.stop.off("select",this.tooltrafficlightselect),this.tools.stop.off("unselect",this.tooltrafficlightunselect)},e.prototype.initListeningTools=function(){this.stopListeningTools(),this.setToolListeners(),this.tools.roadline.on("select",this.toolroadlineselect),this.tools.roadline.on("unselect",this.toolroadlineunselect),this.tools.roadarc.on("select",this.toolroadarcselect),this.tools.roadarc.on("unselect",this.toolroadarcunselect),this.tools.step.on("select",this.toolstepselect),this.tools.step.on("unselect",this.toolstepunselect),this.tools.grab.on("select",this.toolgrabselect),this.tools.grab.on("unselect",this.toolgrabunselect),this.tools.starting.on("select",this.toolstartingselect),this.tools.starting.on("unselect",this.toolstartingunselect),this.tools.obstacle.on("select",this.toolobstacleselect),this.tools.obstacle.on("unselect",this.toolobstacleunselect),this.tools.stop.on("select",this.tooltrafficlightselect),this.tools.stop.on("unselect",this.tooltrafficlightunselect),this.tools.roadline.select()},e.prototype.loadScene=function(e){var t=this;this.scene.destroy(),this.canvas.reset(),this.view.reset(),this.roadsCollection.clear(),this.stepsCollection.clear(),this.stopsCollection.clear(),this.scene=e;for(var i={},n=0,r=this.scene.layers.toArray();n<r.length;n++){var s=r[n];i[s.name]=s}this.layers.lines=i.line,this.layers.steps=i.step,this.layers.board=i.board,this.layers.images=i.image,this.layers.starting=i.starting,this.layers.obstacles=i.obstacle,this.layers.stops=i.stop,this.canvas.setScene(this.scene);for(var o=this.scene.renderables().filter((0,A.IsInstanceOf)(M.default)).toArray(),a=this.scene.renderables().filter((0,A.IsInstanceOf)(L.default)).toArray(),l=this.scene.renderables().filter((0,A.IsInstanceOf)(x.default)).toArray(),u=this.scene.renderables().filter((0,A.IsInstanceOf)(p.default)).toArray(),c=this.scene.renderables().filter((0,A.IsInstanceOf)(b.default)).toArray(),d=this.scene.renderables().filter((0,A.IsInstanceOf)(y.default)).toArray(),h=this.scene.renderables().filter((0,A.IsInstanceOf)(_.default)).toArray(),g=function(e){m.roadsCollection.add(e),e.on("select",(function(){e.setColor($.default.Default),t.tools.grab.select()})),e.on("unselect",(function(){e.setColor(f.default.Red)})),m.view.add(new z.default("RoadLine n°".concat(e.getID()),e))},m=this,v=0,w=o;v<w.length;v++)g(w[v]);for(var k=function(e){C.roadsCollection.add(e),e.on("select",(function(){e.setColor($.default.Default),t.tools.grab.select()})),e.on("unselect",(function(){e.setColor(f.default.Red)})),C.view.add(new z.default("RoadArc n°".concat(e.getID()),e))},C=this,T=0,S=a;T<S.length;T++)k(S[T]);for(var O=function(e){E.stepsCollection.add(e),e.on("select",(function(){e.setColor($.default.Default),t.tools.grab.select()})),e.on("unselect",(function(){e.setColor(f.default.Green)})),E.view.add(new z.default("Step n°".concat(e.getID()),e))},E=this,I=0,D=l;I<D.length;I++)O(D[I]);for(var P=function(e){R.stopsCollection.add(e),e.on("select",(function(){e.setColor($.default.Default),t.tools.grab.select()})),e.on("unselect",(function(){e.setColor(f.default.Blue)})),R.view.add(new z.default("Traffic Light n°".concat(e.getID()),e))},R=this,j=0,F=h;j<F.length;j++)P(F[j]);for(var N=0,B=u;N<B.length;N++){var H=B[N];this.view.add(new z.default("Sprite n°".concat(H.getID()),H))}for(var W=0,U=c;W<U.length;W++){var G=U[W];this.view.add(new z.default("Starting Point",G))}for(var q=0,Y=d;q<Y.length;q++){var V=Y[q];this.view.add(new z.default("Obstacle n°".concat(V.getID()),V))}},e.prototype.initMenu=function(){var e=this,t=this.menu,i=t.add({text:"File"});i.add({text:"New map",shortcut:"Ctrl+N",icon:"✏"}).on("trigger",(function(){e.newform.reset(),e.newform.refresh(),O.default.open({title:"New",body:e.newform.element()[0],speed:.1,style:"display:flex;align-items:center;",actions:{New:function(){e.canvas.reset(),e.scene.layers.forEach((function(e){return e.renderables().clear()})),e.scene.resize(e.newform.get("width"),e.newform.get("height")),e.scene.setName(e.newform.get("name")),e.view.reset(),e.roadsCollection.clear(),O.default.close()},Cancel:function(){O.default.close()}}})})),i.add({text:"Open map..."}).on("trigger",(function(){(0,a.default)({accept:"application/json"}).then((function(t){if(t.length>0){var i=new FileReader;i.onload=function(t){if(null==t.target)throw new Error("unable to load json");e.loadScene(d.ObjectMapper.parse(t.target.result,P.default))},i.readAsText(t[0])}}))})),i.add({text:"Save map"}).on("trigger",(function(){var t=d.ObjectMapper.stringify(e.scene);(0,o.saveAs)(new Blob([t],{type:"text/plain"}),"".concat(e.scene.getName(),".json"))})),i.add({separator:!0}),i.add({text:"Export map"}).on("trigger",(function(){console.log("start exporting..");var t,i,n=new s.default,r=k.default.from(e.scene);e.newform.get("guide")?(t=e.scene.toBMP(["board","image"]),i=e.scene.toBMP(e.scene.layers.filter((function(e){return"image"!==e.name})).map((function(e){return e.name})).toArray())):i=t=e.scene.toBMP(),n.file("".concat(r.getName(),".map"),r.build()),n.file(r.getItiName(),r.buildItinerary()),n.file(r.getGuideName(),i),n.file(r.getGraphicsName(),t),n.generateAsync({type:"blob"}).then((function(e){(0,o.saveAs)(e,"".concat(r.getName(),".zip"))}))})),i.add({separator:!0}),i.add({text:"Exit"}).on("trigger",(function(){confirm("Close Editor?")&&close()}));var n=t.add({text:"Map"});n.add({text:"Import image..",shortcut:"Ctrl+I"}).on("trigger",(function(){(0,a.default)({accept:"image/*"}).then((function(t){for(var i=0;i<t.length;i++)p.default.from(t[i]).then((function(t){e.layers.images.addRenderable(t),e.view.add(new z.default("Image n°".concat(t.getID()),t)),console.log("image added!")})).catch((function(){}))}))})),n.add({text:"Settings.."}).on("trigger",(function(){e.newform.reset(),e.newform.refresh(),e.newform.set("name",e.scene.getName()),e.newform.set("width",e.scene.getBox().size.x),e.newform.set("height",e.scene.getBox().size.y),O.default.open({title:"Map Settings",body:e.newform.element()[0],speed:.1,style:"display:flex;align-items:center;",actions:{Update:function(){e.scene.resize(e.newform.get("width"),e.newform.get("height")),e.scene.setName(e.newform.get("name")),O.default.close()},Cancel:function(){O.default.close()}}})})),t.add({text:"Help"}).add({text:"About"}).on("trigger",(function(){O.default.open({title:"About",body:'<div style="width:100%"><center>Created&nbsp;by&nbsp;<span style="color: red;"><strong>Lemmy Briot</strong>&nbsp;(Flammrock)</span>&nbsp;<i>(&copy;&nbsp;2022&nbsp;-&nbsp;License&nbsp;MIT)</i></center></div>',speed:.1,width:400,height:150,style:"display:flex;align-items:center;",actions:{Ok:function(){O.default.close()}}})})),t.build()},e.prototype.initLayout=function(){this.layout.setMain({style:T.default.Style,content:this.canvas.element()}),this.layout.setTop({size:40,resizable:!1,overflow:"visible",content:this.menu.element(),flex:!0,style:T.default.Style+"border-bottom: 1px solid var(--theme-secondary-bg-color);",zIndex:1e3}),this.layout.setLeft({size:40,resizable:!1,style:T.default.Style+"border-right: 1px solid var(--theme-secondary-bg-color);",content:this.toolbar.element(),overflow:"visible",flex:!0,zIndex:900}),this.layout.setRight({size:300,resizable:!0,style:T.default.Style,content:this.view.layout()})},e.launch=function(){(0,r.default)((function(){new e((0,r.default)("<main />").appendTo("body")).init()}))},e}();t.Editor=F,t.default=F},9505:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Globals=void 0,t.Globals={MaxRoads:50,MaxSteps:50,MaxStops:50,MaxObstacles:10,MaxTrafficLights:6,MaxItinerary:50,MinX:0,MinY:0,MaxX:600,MaxY:300,TLNumber:5,TLView:50,TLCosDir:.5,STPAfter:3,MinSpeed:20,MaxSpeed:40},t.default=t.Globals}},__webpack_module_cache__={};function __webpack_require__(e){var t=__webpack_module_cache__[e];if(void 0!==t)return t.exports;var i=__webpack_module_cache__[e]={exports:{}};return __webpack_modules__[e].call(i.exports,i,i.exports,__webpack_require__),i.exports}__webpack_require__.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),__webpack_require__.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var __webpack_exports__=__webpack_require__(6752)})();
//# sourceMappingURL=bundle.js.map
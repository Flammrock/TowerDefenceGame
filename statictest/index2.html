<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Mon site</title>
  <meta name="description" content="A simple test">
  <meta name="author" content="Flammrock">
  <style>
    img {
      width: 70%;
      height: auto;
      margin-left: 15%;
    }
  </style>
</head>
<body>
  <div id="data"></div>
  <script>
    var link = "https://raw.githubusercontent.com/Flammrock/flammrock.github.io/master/statictest/liens.txt?" + new Date().getTime();
    var items_per_page = 10;
    
    
    var youtube_regex = /(?:youtube\.com\/(?:[^\/]+\/.+\/|(?:v|e(?:mbed)?)\/|.*[?&]v=)|youtu\.be\/)([^"&?\/\s]{11})/gi
    var google_image_regex = /^((?:https?:)?\/\/)drive\.google\.com\/file\/d\/(.*)\/view\?usp=sharing$/;
    
    var gettype = function(url) {
        var mode = false;
        var id = null;
        var html = "";
        
        if (youtube_regex.test(url)) {
            mode = 1;
            id = url.match(youtube_regex)[1];
            html = "<iframe src=\"https://www.youtube.com/embed/"+id+"></iframe><br />";
        } else if (google_image_regex.test(url)) {
            mode = 2;
            id = url.match(google_image_regex)[1];
            html = "<img src=\"https://drive.google.com/uc?export=view&id="+id+"\"><br />";
        }
        
        return {
            mode: mode,
            id: id,
            html: html
        };
    };
    
    var url = new URL(document.location);
    var page = url.searchParams.get("page");
    if (page==null||isNaN(page)) page = "0";
    page = parseInt(page);
    var xhttp = new XMLHttpRequest();
    xhttp.onreadystatechange = function() {
        if (this.readyState == 4 && this.status == 200) {
           console.log(xhttp.responseText);
           var links = xhttp.responseText.split('\n');
           var text = "";
           var datalinks = [];
           for (var i = 0; i < links.length; i++) {
               var r = gettype(links[i].trim());
               if (r.mode) {
                   datalinks.push({
                      url: links[i].trim(),
                      type: r
                   });
               }
           }
           var itemscount = 0;
           var pages = Math.ceil(datalinks.length / items_per_page);
           for (var i = 0; i < datalinks.length; i++) {
               if (page==0) {
                   if (datalinks[i].type.mode==1) {
                        text += datalinks[i].type.html;
                   }
               } else {
                  if (datalinks[i].type.mode==2) {
                  console.log(page,itemscount,items_per_page,itemscount > items_per_page * page);
                        if (itemscount > items_per_page * page) {
                            text += datalinks[i].type.html;
                        }
                        itemscount++;
                       if (itemscount + items_per_page >= items_per_page * page) break;
                   }
               }
           }
           var pagestext = "";
           for (var i = 0; i < pages; i++) {
               pagestext += '<a href="?page='+i+'">'+i+'</a>';
           }
           document.getElementById('data').innerHTML = pagestext + '<br />' + text;
        }
    };//"<img src=\""+links[i].trim()+"\"><br />"
    xhttp.open("GET", link, true);
    xhttp.send();
  </script>
</body>
</html>
